"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4036],{4036:(e,t,n)=>{n.d(t,{_:()=>oG});var l=n(50979),a=n(81154),s=n(61553),r=n.n(s),i=n(25963),o=n(26254),c=n(95925),d=n(63315),u=n(45479),m=n(18731),x=n(15857),h=n(758),p=n(18571),g=n(37915),v=n(17032);function j(){}function y(e){return window.addEventListener("visibilitychange",e,!1),()=>window.removeEventListener("visibilitychange",e)}function f(){return"undefined"!=typeof document&&"visible"===document.visibilityState}var b=n(8718),w=n(61649),N=n(76299),I=n(12645),k=n(64162),C=n(24554),S=n(84044),T=n(31754),D=n(10733),A=n(88887),E=n(93208),R=n(55850),L=n(52992),M=n(72898),P=n(77505),z=n(47188),O=n(89757),U=n(44039),F=n(72287),V=n(43308),B=n(90454);let _=(0,S.Iz)(e=>(0,C.eU)(null,async(t,n)=>{null!=e&&await n((0,F.wc)(e),{payload:(0,k.emptySerializedEnvironment)()})})),q=(0,S.Iz)(e=>(0,C.eU)(null,t=>t((0,U.pG)(e)))),W=(0,S.Iz)(e=>(0,C.eU)(null,async(t,n,l)=>{var a;let{message:s,skipDeploys:r,promptIfDestructivePatch:i}=l,o=t(B.a);if(null==o||!t((0,V.xJ)(e))||null==e)return;let c=t((0,V.B)(e)),d=t((0,V.D7)(e));if(!await i({patch:d}))return;n((0,V.E2)(e),{patch:d,status:u.oSY.Applying}),await o.environmentPatchCommitStaged({environmentId:e,message:s,skipDeploys:r});let m=Object.values(null!=(a=d.volumes)?a:{}).some(e=>e.isDeleted);(null==c?void 0:c.id)!=null&&m&&n(g.lg,c.id),n(O.Sr,null)})),K=(0,S.Iz)(e=>(0,C.eU)(null,t=>t((0,V.D7)(e)))),Y=e=>{let{graphqlClient:t}=(0,R.q)(),n=(0,a.Xr)(q(e));(0,a.Xr)(K(e));let s=(0,a.md)(z.DM),r=(0,a.md)((0,m.yH)(e));(0,a.md)((0,V.xJ)(e));let{showModal:o}=(0,L.h)(),{isConfirmed:c}=(0,E.S)(),{modalActions:d}=(0,P.U)(),u=(0,a.Xr)(W(e)),x=(0,i.useCallback)(e=>{u({...e,promptIfDestructivePatch:async e=>{let{patch:t}=e,l=n(),a=(0,k.patchContainsDestructiveChange)({patch:t,environmentConfig:null!=l?l:(0,k.emptySerializedEnvironment)()});return!a||(null==s?void 0:s.Admin)?!a||!!await c({confirmLabel:"Commit",input:"apply destructive changes",message:"Destructive changes will be applied immediately and cannot be rolled back. Are you sure you want to continue?",title:"This patch contains destructive changes",type:"input"}):(o(Q,{}),!1)}})},[u,n,s]),h=(0,a.Xr)(_(e));return{commitStagedChanges:x,discardStagedChanges:(0,M.F)(r,async()=>{await h()},e=>{d.createToast((0,l.jsx)(A.y8,{variant:"error",title:"Error: ".concat("Discarding staged changes"),description:e.message}))})}},Q=e=>{let{open:t,onOpenChange:n}=e;return(0,l.jsx)(D.a.Root,{open:t,onOpenChange:n,title:"Unable to commit change",children:(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{children:"Only project admins can apply destructive changes."}),(0,l.jsx)("div",{className:"flex items-center justify-end w-full mt-4",children:(0,l.jsx)(T.$n,{onClick:()=>n(!1),children:"Okay"})})]})})};var $=n(2551),G=n(76356),J=n(54131),X=n(36609),H=n(25207),Z=n(13077),ee=n(42419),et=n(99850),en=n(7776),el=n(50253),ea=n.n(el),es=n(70375),er=n(97865),ei=n(25508),eo=n(2590),ec=n(67970),ed=n(82660),eu=n(47654),em=n(12725),ex=n(87531),eh=n.n(ex),ep=n(75612),eg=n(90029),ev=n(45588),ej=n(73648),ey=n(80374),ef=n(75749),eb=n(95662);ea().extend(eh());let ew=e=>{let t=(0,a.md)(x.T6),n=(0,a.md)(G.RE),s=(e=>{let{projectId:t,onClaim:n}=e,{graphqlClient:s}=(0,R.q)(),{modalActions:r}=(0,P.U)(),[{user:i},{setClaimProjectOnLogin:o}]=(0,ev.Jd)(),{workspace:c}=(0,ej.hA)(),d=(0,a.md)(x.K8),u=(0,M.n)(d,async()=>{var e,a;if(null!=t&&null!=i&&i.workspaces.length)try{await s.projectClaim({id:t,workspaceId:null==(e=i.workspaces[0])?void 0:e.id}),null==n||n(),r.createToast((0,l.jsx)(A.y8,{variant:"success",title:"Sweet, this project is now yours"}))}catch(e){r.createToast((0,l.jsx)(A.y8,{variant:"error",title:null!=(a=e.message)?a:"There was a problem claiming the project"}))}}),m=async()=>{null==i&&r.openModal((0,l.jsx)(eg.zC,{authState:{next:"".concat(window.location.href,"?claim=true")},onLogin:()=>{o(!0)}}))};return async()=>{null==i?await m():await u({})}})({projectId:null==t?void 0:t.id}),{modalActions:r}=(0,P.U)(),[{user:o,claimProjectOnLogin:c},{setClaimProjectOnLogin:d}]=(0,ev.Jd)(),{query:u,navActions:m}=(0,es.c)(),[h,p]=(0,i.useState)(!1),g=(0,i.useMemo)(()=>null!=u.claim||c,[u.claim,c]);(0,ep.Z)(async()=>{n&&null!=o&&g&&!h&&(d(!1),p(!0),await s(),m.replace({url:window.location.pathname}))},[o,g,h]);let v=()=>{null!=o&&p(!0),s()};return null==t?null:(0,l.jsx)(ed.l,{variant:"warning",...e,className:(0,X.xW)(e.className,"px-5 md:px-3 md:items-center"),customIconStyles:"hidden md:block",children:(0,l.jsxs)("div",{className:(0,X.xW)("flex flex-col md:flex-row","md:items-center","space-y-4 md:space-y-0 md:space-x-4","justify-between w-full"),children:[(0,l.jsxs)("span",{children:["This is a temporary project (",(0,l.jsx)(T.z9,{variant:"underline",onClick:()=>{r.openModal((0,l.jsx)(eN,{claimProject:v}))},children:"what's this?"}),") and will be deleted ",ea()(t.expiredAt).fromNow(),". Claim it to make it yours."]}),(0,l.jsx)(T.$n,{onClick:v,size:"sm",isLoading:g||h,name:"Claim Project Banner",className:"max-w-max",children:"Claim Project"})]})})},eN=e=>{let{claimProject:t}=e,{modalActions:n}=(0,P.U)(),{id:a}=(0,eg.eR)();return(0,l.jsxs)(eg.aF,{title:"About temporary projects",children:[(0,l.jsx)(eg.wt,{className:"mb-4",children:"About temporary projects"}),(0,l.jsx)(eg.xW,{className:"mb-4",children:"Any project created without logging in is a temporary public project."}),(0,l.jsxs)(eg.xW,{className:"mb-4",children:["These projects can be modified by anyone with the URL and are automatically"," ",(0,l.jsxs)("span",{className:"text-red-500 font-bold",children:["destroyed in ",em.TEMP_PROJECT_MAX_DAYS," ",(0,ey.td)("day",em.TEMP_PROJECT_MAX_DAYS)]})," ","if nobody claims it."]}),(0,l.jsx)(ef.c,{className:"my-8"}),(0,l.jsx)(eg.wt,{className:"mb-6",children:"Thinking about keeping this project?"}),(0,l.jsx)(eg.xW,{className:"mb-8",children:"Login to claim it as yours, this turns this project into a private project where only you can access it"}),(0,l.jsxs)(eb.z,{space:4,justify:"end",children:[(0,l.jsx)(T.$n,{color:"gray",onClick:()=>n.exitModal(a),children:"Dismiss"}),(0,l.jsx)(T.$n,{color:"pink",onClick:()=>{n.exitModal(a),t()},name:"Claim Project Modal",children:"Claim Project"})]})]})};var eI=n(34243),ek=n(36725);let eC=()=>{var e;let t=(0,a.md)(x.T6),{isSudoMode:n,workspaces:s}=(0,ej.hA)(),r=(0,a.md)(G.RE),i=s.some(e=>e.teamId===(null==t?void 0:t.teamId));(0,eo.I)();let{modalActions:o}=(0,P.U)(),{isConfirmed:c}=(0,E.S)(),{sourceTemplate:d}=(e=>{let{projectId:t,enabled:n}=e,{graphqlClient:l}=(0,R.q)(),{result:a}=(0,er.W)(["source-template",t],async()=>(await l.templateSourceForProject({projectId:t})).templateSourceForProject,{enabled:n,staleTime:1/0,refetchOnWindowFocus:!1,refetchOnReconnect:!1,retry:(e,t)=>!t.message.includes("not found")});return{sourceTemplate:a}})({projectId:null!=(e=null==t?void 0:t.id)?e:"",enabled:null!=t&&t.isPublic}),{routes:u}=(0,es.c)();return(0,l.jsxs)("div",{className:"project-banners",children:[n&&null!=t&&(0,l.jsx)(eI.x,{projectId:t.id}),(null==t?void 0:t.deletedAt)!=null&&(0,l.jsx)(eS,{project:t}),r&&(0,l.jsx)(ew,{centerAlign:!0,className:"z-20 h-max border-0 rounded-none"}),null!=d.data&&!i&&(0,l.jsx)("div",{className:"p-4",children:(0,l.jsxs)(ed.l,{variant:"info",children:["You are currently viewing a public project.",(0,l.jsx)(eu.N,{variant:"underline",...u.newTemplate({code:d.data.code}),className:"mx-1",children:"Click here"}),"to deploy your own version of this project."]})})]})},eS=e=>{let{project:t}=e,n=(0,eo.I)(),{modalActions:a}=(0,P.U)(),{isConfirmed:s}=(0,E.S)(),{routes:r,navActions:i}=(0,es.c)(),[o,c]=(0,ei.b)(),d=ea()(new Date).isBefore(null==t?void 0:t.deletedAt),u=async()=>{if(null==t)return;let e=await n.cancelScheduledProjectDeletion({id:t.id});(null==e?void 0:e.projectScheduleDeleteCancel)?a.createToast((0,l.jsx)(A.y8,{variant:"success",title:"Your project is being restored.",description:"Please wait while your services are redeployed."}),15):a.createToast((0,l.jsx)(A.y8,{variant:"error",title:"Failed to cancel project deletion.",description:"Please try again."}),10)},m=async()=>{if(null!=t&&await s({confirmLabel:"Delete",input:"I confirm that I want to delete the project ".concat(t.name),message:(0,l.jsxs)("div",{className:"flex flex-col space-y-3",children:[(0,l.jsxs)("p",{children:["Are you sure you want to delete the project ",(0,l.jsx)("i",{children:t.name}),"?"]}),(0,l.jsx)("p",{className:"text-center",children:(0,l.jsxs)("b",{children:["The project will be"," ",(0,l.jsx)("span",{className:"text-danger",children:"permanently deleted"})," ","immediately."]})}),(0,l.jsx)("p",{children:"Deleting this project will delete all services, environments and data it contains. This action can not be undone."})]}),title:"Delete Project",type:"input"})){try{a.openModal((0,l.jsx)(eg.Cg,{text:"Deleting the ".concat(t.name," project"),messages:ec.d_}));let e=await n.forceScheduledProjectDeletion({id:t.id});(null==e?void 0:e.projectScheduleDeleteForce)?(a.createToast((0,l.jsx)(A.y8,{variant:"success",title:"Your project is being deleted."})),i.push(r.dashboard({}))):a.createToast((0,l.jsx)(A.y8,{variant:"error",title:"Failed to delete project."}))}catch(e){c(e.message)}a.exitModal()}};return(0,l.jsx)(l.Fragment,{children:(null==t?void 0:t.deletedAt)!=null&&(0,l.jsx)("div",{className:"p-4",children:(0,l.jsx)(ed.l,{size:"sm",variant:"danger",children:(0,l.jsxs)("div",{className:"flex justify-between w-full items-center",children:[(0,l.jsxs)("div",{children:[d?"Project will be deleted on ":"Project was deleted on ",(0,l.jsx)(ek.g,{children:t.deletedAt})]}),d&&(0,l.jsxs)("div",{className:"ml-8 flex items-center space-x-4",children:[(0,l.jsx)(T.$n,{size:"sm",icon:$.bE2,variant:"outline",color:"red",onClick:u,children:"Cancel Deletion"}),(0,l.jsx)(T.$n,{size:"sm",icon:$.TBR,variant:"outline",color:"red",onClick:m,children:"Delete Immediately"})]})]})})})})};var eT=n(13025),eD=n(80428),eA=n(22986),eE=n(1142),eR=n(55348);let eL=(0,S.Iz)(e=>(0,C.eU)(new Map)),eM=(0,S.Iz)(e=>(0,C.eU)(null,(t,n,l)=>{if(null==e)return;let a=eL(e),s=new Map(t(a)),r="".concat(l.patchId,":").concat(l.resourceId||"global");"COMPLETED"===l.status||"FAILED"===l.status?s.delete(r):s.set(r,l),n(a,s)}));var eP=n(91630);let ez=(0,S.Iz)(e=>(0,C.eU)(null,(t,n,l)=>{n((0,V.qy)(e),l),n((0,V.GO)(e),null)}));var eO=n(27975),eU=n(78652),eF=n(21328),eV=n(49368),eB=n(64124),e_=n.n(eB),eq=n(17194),eW=n(2631),eK=n(41054),eY=n(48089),eQ=n(67044),e$=n(37321),eG=n(96218),eJ=n(78781),eX=n(76685),eH=n(99231),eZ=n(65431),e0=n(2888);let e1=(0,C.eU)(e=>{var t;let n=e(x.T6);if(null==n)return null;let l=e(eZ.Us);return null==l?null:null!=(t=n.plugins.find(e=>e.id===l))?t:null}),e2=(0,C.eU)(e=>{var t;let n=e(e1);return null==n?null:null!=(t=e0.WB.find(e=>e.value===n.name))?t:null}),e5=(0,C.eU)(e=>{let t=e(e2);if(null==t||null==t.views)return null;let n=e(eZ.HH);return null==n?t.views[0]:n});var e4=n(10635),e6=n(1508),e8=n(94621),e3=n(5041);let e7=e=>{let{text:t,secrets:n=[],label:a,openLink:s,...r}=e,[i,o]=(0,e8.E)(!0,1e4),c=(0,e6.obscureSecretsFromText)(t,n,8),d=t!==c;return(0,l.jsxs)("div",{className:"grid gap-2",children:[null!=a&&(0,l.jsxs)("div",{className:"flex items-center justify-between gap-4",...r,children:[(0,l.jsx)(ee.xC,{children:a}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[d&&(0,l.jsx)(T.z9,{variant:"small",onClick:()=>o(!i),children:i?"show":"hide"}),s&&(0,l.jsx)(eu.N,{href:s,variant:"small",children:"open"})]})]}),(0,l.jsx)(e3.$,{textToCopy:t,children:i?(0,e6.obscureSecretsFromText)(t,n,8):t})]})},e9=e=>{let{commandName:t,plugin:n,secret:a,rawCommand:s}=e;return(0,l.jsxs)(eb.T,{space:3,children:[(0,l.jsx)(ee.QO,{children:"Using the Command Line"}),(0,l.jsx)(e7,{label:(0,l.jsxs)(l.Fragment,{children:["Railway CLI ",(0,l.jsx)(ee.R0,{children:t})," command"]}),text:"railway connect ".concat(te(n.friendlyName))}),(0,l.jsx)(e7,{secrets:[a],label:(0,l.jsxs)(l.Fragment,{children:["Raw ",(0,l.jsx)(ee.R0,{children:t})," command"]}),text:s})]})},te=e=>e.includes(" ")?'"'.concat(e,'"'):e,tt=()=>{let{routes:e}=(0,es.c)();return(0,l.jsxs)(eb.T,{space:3,children:[(0,l.jsx)(ee.QO,{children:"Connect to a Railway Service"}),(0,l.jsxs)(ee.xC,{children:['Go to a service, create a variable, and click "Add Reference".'," ",(0,l.jsxs)(eu.N,{variant:"coloured",...e.docs({page:"/develop/services#connecting-to-your-database"}),className:"text-sm whitespace-nowrap",children:["Docs ",(0,l.jsx)("span",{"aria-hidden":!0,children:"↗"})]})]})]})};var tn=n(96429),tl=n(66767);let ta=e=>{var t;let{plugin:n,projectId:a,environmentId:s}=e,{projectVariablesByEnvironment:r}=(0,tl.i$)({projectId:a}),o=null!=(t=r[s])?t:[],c=(0,eH.U7)({projectId:a,enabled:!0,environmentId:s,pluginId:n.id,serviceId:null}),d=(0,i.useMemo)(()=>{var e;return null!=(e=null==o?void 0:o.filter(e=>e.pluginId===n.id).sort((e,t)=>e.name.localeCompare(t.name)))?e:[]},[o]);return(0,l.jsxs)(eb.T,{space:3,children:[(0,l.jsx)(ee.QO,{children:"Available Variables"}),(0,l.jsx)(ee.xC,{children:"This plugin exposes the following variables."}),(0,l.jsx)(eb.T,{space:1,children:d.map(e=>{var t,n;return(0,l.jsx)(tn._,{name:e.name,value:null!=(n=null==(t=c.variables)?void 0:t[e.name])?n:"",className:"text-gray-600 rounded-md bg-gray-50 hover:!bg-gray-50 dark:bg-gray-100 dark:hover:!bg-gray-100"},e.name)})})]})};var ts=n(15887);let tr=e=>{let{projectId:t,environmentId:n,pluginId:l}=e,a=(0,eH.zs)({projectId:t,environmentId:n,pluginId:l}),{graphqlClient:s}=(0,R.q)();return{resetPluginEnvs:(0,M.n)(a,async()=>{null!=t&&null!=n&&null!=l&&await s.pluginReset({id:l,input:{environmentId:n}})})}},ti=(0,i.createContext)([{},{}]),to=e=>{let{project:t,environment:n,pluginId:a,serviceId:s,envs:r,children:o,loadingComponent:c,failedToConnect:d,logsEnabled:u}=e,m=t.id,x=n.id,{isConfirmed:h}=(0,E.S)(),[p,g]=(0,i.useState)(k.DEFAULT_MONGO_DATABASE),[v,j]=(0,i.useState)(null),[y,f]=(0,i.useState)(null),{graphqlClient:b}=(0,R.q)(),{result:w}=((e,t)=>{let{graphqlClient:n}=(0,R.q)();return(0,er.W)(["mongo","databaseNames",e.environmentId,e.pluginId,e.serviceId],async()=>(await n.getMongoDatabaseNames(e)).mongoDatabaseNames,{enabled:t,retry:!0,refetchInterval:8e3})})({environmentId:x,pluginId:a,serviceId:s},null!=r);(0,i.useEffect)(()=>{g(w.data?w.data[0]:k.DEFAULT_MONGO_DATABASE),j(null),f(null)},[m,x,a,s,w.data]);let{result:N,cancelQuery:I,invalidateQuery:C,setQuery:S}=((e,t,n)=>{let{graphqlClient:l}=(0,R.q)();return(0,er.W)(["mongo",e,"collectionNames",t.environmentId,t.pluginId],async()=>(await l.getMongoCollectionNames({database:e,...t})).mongoCollectionNames,{enabled:n,retry:!0,refetchInterval:8e3})})(p,{environmentId:x,pluginId:a,serviceId:s},null!=r),{result:T,cancelQuery:D,invalidateQuery:A,setQuery:L}=((e,t,n,l)=>{let{graphqlClient:a}=(0,R.q)();return(0,er.W)(["mongo",e,"collectionData",t,n.environmentId,n.pluginId],async()=>{if(null==t)throw Error("Cannot fetch collection");return(await a.getMongoCollection({database:e,name:t,...n})).mongoCollectionData},{enabled:l&&null!=t,refetchInterval:8e3})})(p,v,{environmentId:x,pluginId:a,serviceId:s},null!=r),{resetPluginEnvs:M}=tr({projectId:m,environmentId:x,pluginId:a}),P=(0,i.useMemo)(()=>{var e,t;return null!=(t=(null!=(e=N.data)?e:[]).findIndex(e=>e===v))?t:null},[v,N.data]),z=(0,i.useMemo)(()=>{var e,t,n;return null==y?null:null!=(n=(null!=(t=null==(e=T.data)?void 0:e.data)?t:[]).findIndex(e=>e._id===y._id))?n:null},[T.data,y]),O=(0,i.useMemo)(()=>({selectDatabase:e=>{g(e),j(null),f(null)},selectCollection:e=>{j(e),f(null)},selectDocument:f,selectCollectionByIndex:e=>{null==N.data||e<0||e>=N.data.length||(j(N.data[e]),f(null))},selectDocumentByIndex:e=>{var t;let n=null==(t=T.data)?void 0:t.data;null==n||e<0||e>=n.length||f(n[e])},addDocument:async(e,t,n)=>{I(),j(e),f({...t,_id:"<new-document>"});let l=await b.insertMongoDocument({environmentId:x,pluginId:a,serviceId:s,database:null!=n?n:p,name:e,data:t});f({...t,_id:l.mongoInsertDocument}),C(),A()},updateDocument:async(e,t)=>{null!=v&&(D(),await b.updateMongoDocument({environmentId:x,pluginId:a,serviceId:s,database:p,id:e,name:v,data:t}),A())},deleteDocument:async e=>{var t;let n=null==(t=T.data)?void 0:t.data;null!=v&&null!=n&&(D(),L({...T.data,data:n.filter(t=>t._id!==e)}),f(null),await b.deleteMongoDocument({environmentId:x,pluginId:a,serviceId:s,database:p,id:e,name:v}),A())},deleteCollection:async e=>{null!=N.data&&(I(),D(),S(N.data.filter(t=>t!==e)),f(null),j(null),await b.deleteMongoCollection({environmentId:x,pluginId:a,serviceId:s,database:p,name:e}),C(),A())},generateDummyData:async()=>{await h({confirmLabel:"Generate",message:"Are you sure you want to generate dummy data within this database?",theme:"info",title:"Generate Data"})&&(await b.generateMongoDummyData({environmentId:x,pluginId:a,serviceId:s,database:p}),C())},resetData:async()=>{await M({}),S([]),j(null),f(null)}}),[w,N,T,p,v,y]);return(0,l.jsx)(ti.Provider,{value:[{projectId:m,environmentId:x,pluginId:a,logsEnabled:!0,envs:r,databaseNames:w,collectionNames:N,collectionData:T,database:p,selectedCollection:v,selectedDocument:y,selectedCollectionIndex:P,selectedDocumentIndex:z},O],children:(w.isError||w.failureCount>3)&&null!=d?(0,l.jsx)(l.Fragment,{children:d}):null==w.data&&w.isLoading&&c?(0,l.jsx)(l.Fragment,{children:c}):(0,l.jsx)(l.Fragment,{children:o})})},tc=()=>(0,i.useContext)(ti),td=()=>{let e=(0,a.md)(x.T6),t=(0,a.md)(z.mz),n=(0,a.md)(e1),s=(0,a.md)(I.Zy),[{envs:r}]=tc();if(!t)return(0,l.jsx)(ts.e,{});if(null==e||null==r||null==n||null==s)return(0,l.jsx)(ec.m6,{});let i=(0,e4.G)(r);return(0,l.jsxs)("section",{className:"pb-12",children:[(0,l.jsx)(tt,{}),(0,l.jsx)(ef.c,{className:"my-6"}),(0,l.jsx)(e9,{commandName:"mongo",rawCommand:i,secret:r.MONGOPASSWORD,plugin:n}),(0,l.jsx)(ef.c,{className:"my-6"}),(0,l.jsx)(ta,{projectId:e.id,environmentId:s.id,plugin:n})]})};var tu=n(4110);let tm=e=>{let t=e.length;return{height:40*t>500?500:40*t,width:"100%",itemCount:t,itemSize:()=>40}};var tx=n(61259),th=n(86954),tp=n(6783),tg=n(80430),tv=n(67906),tj=n(80991),ty=n(42113);let tf=e=>{let{addDocument:t}=e,{modalActions:n}=(0,P.U)(),[a,s]=(0,ei.b)(),{register:r,control:o,handleSubmit:c,formState:{errors:d}}=(0,ty.mN)(),[u,m]=(0,i.useState)(!1),x=async e=>{try{s(null),m(!0),await t(e.collection,e.document,e.database),n.createToast((0,l.jsx)(A.y8,{variant:"success",title:"Database successfully added!"})),n.exitModal()}catch(e){s(e.message)}m(!1)};return(0,l.jsx)(tx.lV,{onSubmit:c(x),name:"Add Mongo Database",className:"space-y-4 md:min-w-96",children:(0,l.jsxs)(eb.T,{space:5,children:[(0,l.jsx)(eg.wt,{children:"Add database"}),null!=a&&(0,l.jsx)(ee.yn,{children:a}),(0,l.jsx)(th.pd,{...r("database",{required:!0,minLength:2,maxLength:128}),label:"Database name",error:null!=d.database}),(0,l.jsx)(th.pd,{...r("collection",{required:!0,minLength:2,maxLength:128}),label:"Collection name",error:null!=d.collection}),(0,l.jsx)(ty.xI,{name:"document",control:o,rules:{required:!0},defaultValue:JSON.stringify({hello:"world"}),render:e=>{let{field:{onChange:t,value:n}}=e;return(0,l.jsxs)(eb.T,{children:[(0,l.jsx)(th.JU,{children:"Document (json)"}),(0,l.jsx)(tp.i,{value:n,onChange:e=>t(e),editorStyles:{margin:0}}),null!=d.document&&(0,l.jsx)(ee.ax,{className:"text-red-400",children:"Required"})]})}}),(0,l.jsxs)(eb.z,{justify:"end",space:3,children:[(0,l.jsx)(T.$n,{type:"button",color:"gray",onClick:()=>n.exitModal(),children:"Cancel"}),(0,l.jsx)(T.jn,{type:"submit",isLoading:u,children:"Add database"})]})]})})};var tb=function(e){return e[e.Normal=0]="Normal",e[e.AddingCollection=1]="AddingCollection",e[e.AddingDocument=2]="AddingDocument",e}(tb||{});let tw=[{value:k.DEFAULT_MONGO_DATABASE}],tN=e=>{var t;null==(t=document.getElementById("json-editor-".concat(e)))||t.focus()},tI=()=>{var e,t;let n=(0,a.md)(z.mz),[{database:s,selectedCollection:r,selectedDocument:o,databaseNames:c,collectionNames:d,collectionData:u},m]=tc(),[x,h]=(0,ei.b)(),[p,g]=(0,i.useState)(0),[v,j]=(0,i.useState)([]),{isConfirmed:y}=(0,E.S)(),{modalActions:f}=(0,P.U)();(e=>{let{state:t,setState:n}=e,[{selectedCollectionIndex:l,selectedDocumentIndex:a,selectedDocument:s},r]=tc();(0,i.useEffect)(()=>{let e=()=>{var e;return(null==(e=document.activeElement)?void 0:e.nodeName)==="TEXTAREA"},i=(0,b.Ay)(window,{ArrowDown:n=>{0!==t||e()||(n.preventDefault(),null!=a?r.selectDocumentByIndex((null!=a?a:-1)+1):r.selectCollectionByIndex((null!=l?l:-1)+1))},ArrowUp:n=>{0!==t||e()||(n.preventDefault(),null!=a?r.selectDocumentByIndex((null!=a?a:-1)-1):r.selectCollectionByIndex((null!=l?l:-1)-1))},ArrowRight:n=>{0!==t||e()||(n.preventDefault(),null==a?r.selectDocumentByIndex(0):null!=s&&tN(s._id))},ArrowLeft:n=>{0!==t||e()||(n.preventDefault(),r.selectDocument(null))},Escape:()=>{var e;n(0),null==(e=document.getElementById("json-editor-".concat(null==s?void 0:s._id)))||e.blur()},"$mod+Enter":()=>{var e;null==(e=document.getElementById("json-editor-".concat(null==s?void 0:s._id)))||e.blur()}});return()=>i()},[l,a,s,t,r])})({state:p,setState:g}),(0,w.bU)(()=>({text:"Generate dummy data",value:"generateMongoDummyData",category:"Mongo",icon:$.KqI,isAvailable:()=>null!=d.data&&0===d.data.length,action:async()=>{try{await m.generateDummyData()}catch(e){tu.A.log("Error generating Mongo dummy data",e)}}}),[d.data]);let N=(0,i.useMemo)(()=>["\uD83C\uDFE0",s,r,null==o?void 0:o._id,...v,...2===p?["new document"]:[]].filter(Boolean),[r,o,v,p,s]),I=()=>{g(1),m.selectCollection(null)},k=()=>{g(2),m.selectDocument(null)},C=()=>{g(0),j([])},S=async(e,t)=>{g(0),j([]);try{await m.addDocument(e,t)}catch(e){h(e.message)}},D=async e=>{if(await y({confirmLabel:"Delete",message:"Are you sure you want to delete this document? Deleting this document is permanent and cannot be undone.",title:"Delete document"}))try{await m.deleteDocument(e)}catch(e){h(e.message)}},A=async e=>{if(await y({confirmLabel:"Delete",message:"Are you sure you want to delete the collection ".concat(e,"? All documents in it will be gone forever."),title:"Delete collection"}))try{await m.deleteCollection(e)}catch(e){h(e.message)}};return((0,w.bU)(()=>({value:"create-collection-document",text:null==o?"Create Collection":"Create Document",icon:$.FWt,highlighted:!0,group:"Mongo",keybinding:"C",isAvailable:()=>0===p&&n,action:()=>{null==o?I():k()}}),[p,o,n]),(0,w.bU)(()=>({value:"delete-collection-document",text:null==o?"Delete Collection":"Delete Document",icon:$.TBR,highlighted:!0,group:"Mongo",keybinding:"D",isAvailable:()=>0===p&&n,action:()=>{null!=o?D(o._id):null!=r&&A(r)}}),[p,r,o,n]),(0,w.bU)(()=>({value:"edit-document",text:"Edit Document",icon:$.ffu,highlighted:!0,group:"Mongo",keybinding:"E",isAvailable:()=>null!=o&&0===p,action:()=>{var e;return tN(null!=(e=null==o?void 0:o._id)?e:"")}}),[p,o]),n)?null==d.data?(0,l.jsx)(ec.m6,{}):(0,l.jsxs)("div",{className:"flex flex-col flex-grow",children:[null!=x&&(0,l.jsx)(ee.yn,{children:x}),(0,l.jsxs)(eb.T,{space:1,className:"mb-5 max-w-xs",children:[(0,l.jsxs)(eb.z,{align:"center",justify:"between",children:[(0,l.jsx)(th.JU,{children:"Database"}),(0,l.jsx)(T.K0,{title:"Add Database",icon:$.f5w,onClick:()=>{f.openModal((0,l.jsx)(eg.aF,{title:"Add database",children:(0,l.jsx)(tf,{addDocument:m.addDocument})}))}})]}),(0,l.jsxs)(eb.z,{align:"center",space:3,className:"max-w-xs",children:[(0,l.jsx)("div",{className:"w-full",children:(0,l.jsx)(tg.l,{label:{text:"Database",hidden:!0},options:null!=(t=null==(e=c.data)?void 0:e.map(e=>({value:e})))?t:tw,value:s,onChange:e=>{g(0),m.selectDatabase(e)},size:"sm"})}),c.isFetching&&(0,l.jsx)(ec.Rh,{})]})]}),(0,l.jsxs)(tj.Kf,{path:N,pathClickable:!0,onClickPath:(e,t)=>(e=>{e<2&&m.selectDocument(null),e<1&&m.selectCollection(null),g(0),j([])})(t),children:[(0,l.jsxs)(tj.Zk,{title:"collections",children:[(0,l.jsxs)(tj.N0,{onClick:()=>I(),selected:1===p,children:["Start collection",(0,l.jsx)(Z.In,{icon:$.FWt})]}),d.data.length>0&&(0,l.jsx)(tj.B8,{...tm(d.data),children:e=>{let{index:t,style:n}=e,a=d.data[t];return(0,l.jsx)(tj.ck,{style:n,onClick:()=>{g(0),j([]),m.selectCollection(a)},selected:a===r,children:a})}})]}),1===p&&(0,l.jsx)(tC,{onAddDocument:S,onCancel:C,onPathUpdate:e=>j(e)}),null!=r&&1!==p&&(0,l.jsx)(tj.Zk,{title:r,panelActions:(0,l.jsx)(T.K0,{icon:$.TBR,title:"Delete collection",onClick:()=>A(r)}),children:null==u.data?(0,l.jsx)(ec.m6,{}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(tj.N0,{onClick:()=>k(),selected:2===p,children:["Add document",(0,l.jsx)(Z.In,{icon:$.FWt})]}),(0,l.jsx)(tj.B8,{...tm(u.data.data),children:e=>{let{index:t,style:n}=e;if(null==u.data)return null;let a=u.data.data[t];return(0,l.jsx)(tj.ck,{style:n,selected:a._id===(null==o?void 0:o._id),onClick:()=>{g(0),m.selectDocument(a)},children:a._id})}})]})}),2===p&&null!=r&&(0,l.jsx)(tk,{collectionName:r,onAddDocument:S,onCancel:C}),null!=o&&2!==p&&(0,l.jsx)(tj.Zk,{title:o._id,panelActions:(0,l.jsx)(T.K0,{icon:$.TBR,title:"Delete document",onClick:()=>D(o._id)}),children:(0,l.jsx)(tS,{document:o})},o._id)]})]}):(0,l.jsx)(ts.e,{})},tk=e=>{let{collectionName:t,onAddDocument:n,onCancel:a}=e;return(0,l.jsx)(tj.Zk,{title:"new document (json)",children:(0,l.jsx)(tp.i,{value:{hello:"world"},onChange:e=>n(t,e),onCancel:a,alwaysShowButtons:!0,autoFocus:!0})})},tC=e=>{let{onAddDocument:t,onCancel:n,onPathUpdate:a}=e,[s,r]=(0,i.useState)(""),[o,c]=(0,i.useState)(!1),d=(0,i.useRef)(null);return(0,i.useEffect)(()=>{o?a([s,"new document"]):a(["new collection"])},[o]),(0,i.useEffect)(()=>{setTimeout(()=>{var e;null==(e=d.current)||e.focus()},0)},[d.current]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(tj.Zk,{title:"new collection",children:(0,l.jsx)(tx.lV,{onSubmit:()=>c(!0),name:"New Mongo Collection",children:(0,l.jsxs)(eb.z,{space:3,align:"center",children:[(0,l.jsx)(th.pd,{ref:d,placeholder:"name",label:{text:"Name",hidden:!0},value:s,onChange:e=>r(e.target.value),disabled:o,autoFocus:!0,className:"rounded-none"}),(0,l.jsx)(T.K0,{icon:$.c_$,title:"Create collection",disabled:""===s.trim()}),(0,l.jsx)(tv.h,{x:3})]})})}),o&&(0,l.jsx)(tj.Zk,{title:"new document (json)",children:(0,l.jsx)(tp.i,{value:{hello:"world"},onChange:e=>{""!==s.trim()&&t(s,e)},onCancel:n,alwaysShowButtons:!0,autoFocus:!0})})]})},tS=e=>{let{document:t}=e,[,{updateDocument:n}]=tc(),a=(0,i.useMemo)(()=>{let e={...t};return delete e._id,e},[t]);return(0,l.jsx)("div",{className:"whitespace-pre-wrap px-2",children:(0,l.jsx)(tp.i,{value:a,editorId:t._id,onChange:e=>n(t._id,e)})})};var tT=n(46650),tD=n(84455),tA=n(64126),tE=n(3732),tR=n(24224),tL=n(64963),tM=n(89633),tP=n(28476);let tz=e=>{var t;let{projectId:n,pluginId:a,environmentId:s,logsEnabled:r}=e,[{filter:o,filterWithExtras:c,contextStart:d,contextEnd:u},{setDateRangeAndFilter:m,logExplorerRoute:x}]=(0,tE.v)({projectId:n,extraFilter:"@plugin:".concat(a)}),[h,p]=(0,tR.j)({dateRange:tM.E,environmentId:s,contextStart:d,contextEnd:u,filter:c}),g=(0,i.useRef)(null),v=(0,i.useRef)(null),j=(0,tD.Z)();if((0,i.useEffect)(()=>{j?(g.current=document.querySelector(".metro-pane-content"),v.current=document.querySelector(".tabs-root")):(g.current=null,v.current=null)},[j]),(0,tA.N)({scrollContainer:g,childContainer:v}),!r)return(0,l.jsx)(ed.l,{variant:"info",children:"Logs are not available for plugins created before June 10, 2023"});let y="plugin";return(0,l.jsxs)(tT.bL,{value:y,onValueChange:()=>null,className:(0,X.xW)("tabs-root","grid relative min-h-full -mx-5 md:-mx-12","grid-rows-[auto_minmax(0px,_1fr)] h-full"),children:[(0,l.jsx)(tP.f,{activeTab:y,activeDateRange:tM.E,activeFilter:o,setActiveDateRangeAndFilter:m,logExplorerRoute:x,isLoading:h.isLoading,tabs:[{label:"Plugin Logs",value:y}]}),(0,l.jsx)(tL.R3,{...h,...p,lineClassName:"px-5 sm:px-12",stickyScrollParent:null!=(t=g.current)?t:void 0,logExplorerRoute:x,emptyMessage:""!==o?(0,l.jsxs)(l.Fragment,{children:["No logs found containing ",(0,l.jsx)("strong",{children:o})]}):"No plugin logs found"})]})},tO=()=>{let[{projectId:e,pluginId:t,environmentId:n,logsEnabled:a}]=tc();return null==t?null:(0,l.jsx)(tz,{projectId:e,pluginId:t,environmentId:n,logsEnabled:a})};var tU=n(86422),tF=n(49767);let tV=()=>(0,l.jsxs)(tF.o8,{children:[(0,l.jsx)(tF.fV,{children:"Backup Database"}),(0,l.jsx)(ed.l,{variant:"info",children:(0,l.jsx)(ee.ax,{children:"While we do not offer first-party backups, we have a workaround in the form of deploying a service to automatically back up your database to an Amazon S3 bucket."})}),(0,l.jsx)(T.vx,{color:"blue",variant:"outline",size:"sm",href:"https://blog.railway.com/p/automated-postgresql-backups",className:"max-w-max mt-4 font-medium",children:"Learn More"})]});var tB=n(65910);let t_=e=>{let{plugin:t}=e,n=(0,a.md)(z.mz),{updatePluginFriendlyName:s}=(()=>{let e=(0,a.md)(x.T6),t=(0,a.md)(e1),{optimisticallyUpdateProject:n}=(0,eo.I)(),l=(0,x.NU)(null==e?void 0:e.id),{graphqlClient:s}=(0,R.q)();return{updatePluginFriendlyName:(0,M.F)(l,async l=>{null!=t&&((l=>{n({plugins:null==e?void 0:e.plugins.map(e=>e.id===(null==t?void 0:t.id)?{...e,..."function"==typeof l?l(e):l}:e)})})({friendlyName:l}),await s.pluginUpdate({id:t.id,input:{friendlyName:l}}))})}})();return(0,l.jsxs)(tF.o8,{children:[(0,l.jsx)(tF.fV,{children:"Plugin Name"}),(0,l.jsx)(tB.j,{name:"plugin-name",validate:e=>{if(!(0,em.validatePluginName)(e))return"Must only contain letters, numbers, spaces, and dashes"},value:t.friendlyName,readOnly:!n,label:{text:"Service Name",hidden:!0},onChange:e=>s(e)})]})};var tq=n(49643);let tW=e=>{let{projectId:t,environmentId:n,pluginId:s,pluginName:r}=e,o=(0,a.md)(z.DM),c=(0,a.md)(I.Zy),{graphqlClient:d}=(0,R.q)(),{isConfirmed:m}=(0,E.S)(),{modalActions:x}=(0,P.U)(),[h,p]=(0,i.useState)(null),[g,v]=(0,ei.b)(),{routes:j,navActions:y}=(0,es.c)(),{invalidateDecryptedVariables:f}=(0,eH.U7)({projectId:t,environmentId:n,pluginId:s,enabled:o.Write}),{resetCredentials:b}=(e=>{let{projectId:t,environmentId:n,pluginId:l}=e,a=(0,eH.zs)({projectId:t,environmentId:n,pluginId:l}),{onServiceChanged:s}=(0,tq.u)(),{graphqlClient:r}=(0,R.q)();return{resetCredentials:(0,M.n)(a,async()=>{if(null==t||null==n||null==l)throw Error("Cannot reset credentials for empty project");let e=(await r.pluginResetCredentials({id:l,input:{environmentId:n}})).pluginResetCredentials;return s({environmentId:n}),e})}})({projectId:t,environmentId:n,pluginId:s}),{result:w}=(0,er.W)(["workflow",h],async()=>{if(null==h)throw Error("workflowId is null");return(await d.workflowStatus({workflowId:h})).workflowStatus},{enabled:null!=h,refetchInterval:!g&&2e3});(0,i.useEffect)(()=>{null!=w.data&&w.data.status!==u.sAf.Running&&(p(null),x.exitModal(),w.data.status===u.sAf.Error?v("There was a problem resetting plugin credentials"):w.data.status===u.sAf.Complete&&(f(),y.push(j.projectPluginView({view:"connect"}))))},[w.data]);let N=async()=>{var e;if(await m({confirmLabel:"Reset Credentials",input:r,message:(0,l.jsxs)(l.Fragment,{children:["Are you sure you want to reset credentials for this plugin in the"," ",(0,l.jsx)("strong",{children:null!=(e=null==c?void 0:c.name)?e:""})," environment? Current credentials will no longer work."]}),title:"Reset Plugin Credentials",type:"input"}))try{x.openModal((0,l.jsx)(eg.Cg,{text:"Resetting plugin credentials",preventClose:!0,messages:["hold on to your hats","this should only take a few seconds"]}));let e=await b({});null!=e&&p(e)}catch(e){v(e.message),x.exitModal()}};return(0,l.jsxs)(tF.o8,{children:[(0,l.jsx)(tF.fV,{children:"Reset Database Credentials"}),(0,l.jsx)(ed.l,{variant:"warning",children:(0,l.jsxs)(ee.ax,{children:["Resetting the plugin credentials will change the password for the plugin."," ",(0,l.jsx)("b",{children:"Anything that uses the old credentials, including deployments, will need to be updated"}),"."]})}),null!=g&&(0,l.jsx)(ee.yn,{children:g}),(0,l.jsx)(T.$n,{color:"red",variant:"outline",size:"sm",disabled:!o.Admin,onClick:()=>N(),className:"max-w-max mt-4 font-medium",children:"Reset Plugin Credentials"})]})},tK=e=>{let{environmentId:t,pluginId:n,pluginName:s}=e,r=(0,a.md)(z.DM),i=(0,a.md)(I.Zy),{graphqlClient:o}=(0,R.q)(),{isConfirmed:c}=(0,E.S)(),{modalActions:d}=(0,P.U)(),u=async()=>{var e,a;if(await c({confirmLabel:"Restart Database",input:s,message:"Are you sure you want to restart the ".concat(s," database in the ").concat(null!=(e=null==i?void 0:i.name)?e:""," environment?"),title:"Restart Database",type:"input"}))try{await o.pluginRestart({id:n,input:{environmentId:t}}),d.createToast((0,l.jsx)(A.y8,{variant:"success",title:"Database Restarted",description:"The ".concat(s," database has been restarted successfully!")}))}catch(e){d.createToast((0,l.jsx)(A.y8,{variant:"error",title:"Error restarting database",description:null!=(a=e.message)?a:"We ran into issues restarting your database. Please reach out to support for assistance."}))}};return(0,l.jsxs)(tF.o8,{children:[(0,l.jsx)(tF.fV,{children:"Restart Database"}),(0,l.jsx)(ed.l,{variant:"warning",children:(0,l.jsx)(ee.ax,{children:"Restarting a database will result in a short amount of downtime. Only do this if you know what you are doing or are facing issues with your database."})}),(0,l.jsx)(T.$n,{color:"red",variant:"outline",size:"sm",disabled:!r.Admin,onClick:u,className:"max-w-max mt-4 font-medium",children:"Restart Database"})]})},tY=e=>{let{onWipe:t,pluginName:n}=e,{isConfirmed:s}=(0,E.S)(),{modalActions:r}=(0,P.U)(),[i,o]=(0,ei.b)(),c=(0,a.md)(I.Zy),d=(0,a.md)(z.DM),u=async()=>{var e;if(await s({confirmLabel:"Wipe Data",input:n,message:(0,l.jsxs)(l.Fragment,{children:["Are you sure you want to wipe data for this plugin in"," ",(0,l.jsx)("strong",{children:null!=(e=null==c?void 0:c.name)?e:""})," environment? The data will be lost forever."]}),title:"Wipe Plugin Data",type:"input"})){try{r.openModal((0,l.jsx)(eg.Cg,{text:"Wiping data in plugin",preventClose:!0,messages:["hold on to your hats","this should only take a few seconds"]})),await t()}catch(e){o(e.message)}r.exitModal()}};return(0,l.jsxs)(tF.o8,{className:"mb-0",children:[(0,l.jsx)(tF.fV,{children:"Wipe Plugin Data"}),(0,l.jsx)(ed.l,{variant:"danger",children:(0,l.jsxs)(ee.ax,{children:["Wiping a plugin will fully tear down and setup a new container. As a result,"," ",(0,l.jsx)("b",{children:"all data will be deleted and environment variables will be changed"}),"."]})}),null!=i&&(0,l.jsx)(ee.yn,{children:i}),(0,l.jsx)(T.$n,{color:"red",variant:"outline",size:"sm",disabled:!d.Admin,onClick:()=>u(),className:"max-w-max mt-4 font-medium",children:"Wipe Plugin Data"})]})},tQ=e=>{let{projectId:t,plugin:n,environment:s,resetData:r}=e,i=(0,a.md)(z.uV),o=(0,tU.C)(),{navActions:c,routes:d}=(0,es.c)(),{isConfirmed:u}=(0,E.S)(),m=async()=>{await u({confirmLabel:n.friendlyName,input:"Delete",message:"Are you sure you want to delete this service. All deployments will be removed forever.",title:"Delete Service",type:"input"})&&(c.push(d.project({})),await o.removePlugin({id:n.id}))};return(0,l.jsxs)(eb.T,{className:"pb-12",children:[(0,l.jsxs)(tF.XY,{children:[(0,l.jsxs)(tF.ix,{children:[(0,l.jsx)(ee.f_,{as:"h2",children:"Environment"}),(0,l.jsxs)(ee.zb,{children:["Settings scoped to ",(0,l.jsx)("b",{children:s.name})," environment."]})]}),(0,l.jsx)(tF.Ij,{children:(0,l.jsxs)("div",{className:tF.Sc,children:["postgresql"===n.name&&(0,l.jsx)(tV,{}),(0,l.jsx)(tK,{environmentId:s.id,pluginId:n.id,pluginName:n.friendlyName}),(0,l.jsx)(ef.c,{className:"mt-10 mb-8"}),(0,l.jsx)(tW,{projectId:t,environmentId:s.id,pluginId:n.id,pluginName:n.friendlyName}),(0,l.jsx)(ef.c,{className:"mt-10 mb-8"}),(0,l.jsx)(tY,{pluginName:n.friendlyName,onWipe:async()=>{await r(),c.push(d.projectPluginView({view:"data"}))}})]})})]}),(0,l.jsxs)(tF.XY,{children:[(0,l.jsxs)(tF.ix,{children:[(0,l.jsx)(ee.f_,{as:"h2",children:"Plugin"}),(0,l.jsxs)(ee.zb,{children:["Settings scoped to ",(0,l.jsx)("b",{children:"ALL"})," environments."]})]}),(0,l.jsx)(tF.Ij,{children:(0,l.jsx)("div",{className:tF.Sc,children:(0,l.jsx)(t_,{plugin:n})})}),(0,l.jsx)(tF.zl,{title:"Danger",danger:!0,children:(0,l.jsxs)(tF.o8,{children:[(0,l.jsx)(tF.fV,{className:"text-red-500",children:"Delete Service"}),(0,l.jsx)(ed.l,{variant:"danger",children:(0,l.jsxs)(ee.ax,{children:["Deleting this database service will ",(0,l.jsx)("b",{children:"permanently delete"})," ","all the service data and remove it from ",(0,l.jsx)("b",{children:"all environments"}),". This cannot be undone."]})}),(0,l.jsx)(T.$n,{color:"red",size:"sm",onClick:m,disabled:!i,className:"max-w-max mt-4 font-bold",children:"Delete Service from All Environments"})]})})]})]})},t$=()=>{let[{projectId:e},{resetData:t}]=tc();(0,a.md)(x.T6);let n=(0,a.md)(e1),s=(0,a.md)(I.Zy);return null==s||null==n?(0,l.jsx)(ec.m6,{}):(0,l.jsx)(tQ,{projectId:e,plugin:n,environment:s,resetData:t})},tG=e=>{let{view:t}=e;return"connect"===t?(0,l.jsx)(td,{}):"settings"===t?(0,l.jsx)(t$,{}):"logs"===t?(0,l.jsx)(tO,{}):(0,l.jsx)(tI,{})},tJ=[{value:"PRIMARY KEY",text:"Primary Key"},{value:"NOT NULL",text:"Not NULL"},{value:"UNIQUE",text:"Unique"}],tX=e=>{let{value:t,text:n,tags:l}=e;return{value:t,text:null!=n?n:t,tags:l}},tH=[{value:"text",tags:["string"]},{value:"integer",tags:["number"]},{value:"bigint",tags:["number"]},{value:"real",tags:["number","float"]},{value:"boolean"},{value:"character"},{value:"date"},{value:"json"},{value:"serial"},{value:"uuid"},{value:"money"}].map(tX),tZ=[{value:"text",tags:["string"]},{value:"integer",tags:["number"]},{value:"real",tags:["number","float"]},{value:"boolean"},{value:"character"},{value:"date"},{value:"json"},{value:"serial"}].map(tX),t0=["ADD","ADD CONSTRAINT","ALTER","ALTER COLUMN","ALTER TABLE","ALL","AND","ANY","AS","ASC","BACKUP DATABASE","BETWEEN","CASE","CHECK","COLUMN","CONSTRAINT","CREATE","CREATE DATABASE","CREATE INDEX","CREATE OR","CREATE TABLE","CREATE PROCEDURE","CREATE UNIQUE","CREATE VIEW","DATABASE","DEFAULT","DELETE","DESC","DISTINCT","DROP","DROP COLUMN","DROP CONSTRAINT","DROP DATABASE","DROP DEFAULT","DROP INDEX","DROP TABLE","DROP VIEW","EXEC","EXISTS","FOREIGN KEY","FROM","FULL OUTER ","GROUP BY","HAVING","IN","INDEX","INNER JOIN","INSERT INTO","INSERT INTO SELECT","IS NULL","IS NOT ","JOIN","LEFT JOIN","LIKE","LIMIT","NOT","NOT NULL","OR","ORDER BY","OUTER JOIN","PRIMARY KEY","PROCEDURE","RIGHT JOIN","ROWNUM","SELECT","SELECT DISTINCT","SELECT INTO","SELECT TOP","SET","TABLE","TOP","TRUNCATE TABLE","UNION","UNION ALL","UNIQUE","UPDATE","VALUES","VIEW","WHERE"],t1=["DELETE","DROP"],t2=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15,[n,l]=(0,i.useState)(0),a=Math.ceil(e.length/t),s=(0,i.useMemo)(()=>Math.min(n,a-1),[n,a]),r=(0,i.useMemo)(()=>e.slice(s*t,(s+1)*t),[s,e]);return{page:s,setPage:l,totalPages:a,visibleItems:r}};var t5=n(71144),t4=n(37590);let t6=e_()(()=>Promise.all([n.e(3681),n.e(6248)]).then(n.bind(n,56248)),{loadableGenerated:{webpack:()=>[56248]},ssr:!1,loading:()=>(0,l.jsx)(t4.g,{width:"100%",height:"40px"})});var t8=n(18970),t3=n(24023);let t7=(0,i.createContext)([{},{}]),t9=(e,t,n)=>{let{name:l,limit:a,offset:s}=e,{graphqlClient:r}=(0,R.q)();return(0,er.W)(["sql","tableData",l,a,s,t.environmentId,t.pluginId],async()=>{if(null==l)throw Error("Cannot fetch table data");return(await r.getSQLTable({name:l,limit:a,offset:s,...t})).sqlTable},{enabled:null!=l&&n,placeholderData:t3.rX,refetchInterval:8e3})},ne=e=>{var t,n;let{envs:a,project:s,environment:r,pluginId:o,serviceId:c,databaseType:d,formatValue:u,isJsonColumnType:m,children:x,loadingComponent:h,failedToConnect:p,logsEnabled:g,columnTypeLookup:v}=e,{graphqlClient:j}=(0,R.q)(),{query:y}=(0,es.c)(),[f,b]=(0,i.useState)(0),[w]=(0,i.useState)(10),{isConfirmed:N}=(0,E.S)(),I="string"==typeof y.table?y.table:null,k=s.id,C=r.id;(0,i.useEffect)(()=>{b(0)},[I]);let S={environmentId:C,pluginId:o,serviceId:c,databaseType:d},{result:T,cancelQuery:D,setQuery:A,invalidateQuery:L}=((e,t)=>{let{graphqlClient:n}=(0,R.q)();return(0,er.W)(["sql","tableNames",e.environmentId,e.pluginId,e.serviceId],async()=>(await n.getSQLTableNames(e)).sqlTableNames,{enabled:t,retry:!0,refetchInterval:8e3})})(S,null!=a),{result:M,invalidateQuery:P}=t9({name:I,limit:w,offset:f*w},S,null!=a),{resetPluginEnvs:z}=tr({projectId:k,environmentId:C,pluginId:o}),O={...S,projectId:k,pluginId:o,envs:a,viewState:"string"==typeof y.state?y.state:"",page:f,totalPages:Math.ceil((null!=(n=null==(t=M.data)?void 0:t.totalRows)?n:0)/w),pageSize:w,selectedTableName:I,tableNames:T,tableData:M,formatValue:u,isJsonColumnType:m,logsEnabled:g,columnTypeLookup:v};return(0,l.jsx)(t7.Provider,{value:[O,{refresh:()=>P(),createTable:async e=>{D(),A([...T.data||[],e.name]),await j.createSQLTable({...e,...S}),L()},deleteTable:async e=>{var t;D(),A((null!=(t=T.data)?t:[]).filter(t=>t!==e.name)),await j.deleteSQLTable({...e,...S}),L()},insertColumn:async e=>{await j.insertSQLColumn({...e,...S}),P()},insertRow:async e=>{await j.insertSQLRow({...e,...S}),P()},deleteRows:async e=>{await j.deleteSQLRows({...e,...S}),P()},updateRow:async e=>{await j.updateSQLRow({...e,...S}),P()},generateDummyData:async()=>{await N({confirmLabel:"Generate",message:"Are you sure you want to generate dummy data within this database?",theme:"info",title:"Generate Data"})&&(await j.dummyDataSQL({...S}),L())},runRawQuery:async e=>(await j.runRawQuery({...S,...e})).sqlRawQueryRun,changePage:e=>b(e),resetData:async()=>{await z({}),A([])}}],children:(T.isError||T.failureCount>3)&&null!=p?(0,l.jsx)(l.Fragment,{children:p}):null==T.data&&T.isLoading&&h?(0,l.jsx)(l.Fragment,{children:h}):(0,l.jsx)(l.Fragment,{children:x})})},nt=()=>(0,i.useContext)(t7),nn=()=>{let e=(0,a.md)(z.mz),[t,n]=(0,i.useState)(""),[{tableNames:s,databaseType:r,environmentId:o,pluginId:c},d]=nt(),[u,m]=(0,i.useState)(null),{result:x}=t9({name:u,limit:1,offset:0},{databaseType:r,environmentId:o,pluginId:c},e),[h,p]=(0,ei.b)(),{modalActions:g}=(0,P.U)(),[v,j]=(0,i.useState)(null),{isConfirmed:y}=(0,E.S)();(0,i.useEffect)(()=>{""===t.trim()&&m(null)},[t]);let f=(0,i.useMemo)(()=>{let e=[];return null!=s.data&&(e=s.data),null!=x.data&&null!=u&&(e=x.data.columnNames),e.map(e=>({id:e}))},[x.data,s.data,t]),[b,w]=(0,i.useState)(!1),{track:N}=(0,t5.j)(),I=async()=>{try{if(j(null),""===t.trim()||(e=>{for(let t of t1)if(e.includes(t))return!0;return!1})(t)&&!await y({message:"Looks like you're doing a destructive action. Please confirm to proceed.",title:"Are you sure?"}))return;w(!0);let e=await d.runRawQuery({query:t});N({action:"Submit",object:"Raw Query",properties:{query:t}}),j(e),g.createToast((0,l.jsx)(A.y8,{variant:"success",title:"Query ran successfully"})),m(null)}catch(e){p(e.message)}w(!1)};return e?(0,l.jsx)(tx.lV,{onSubmit:I,enableBindings:!0,children:(0,l.jsxs)(eb.T,{space:3,children:[(0,l.jsx)(eb.T,{space:2,className:"flex-1",children:(0,l.jsx)(t6,{value:t,onChange:(e,t,l)=>{n(l)},placeholder:'Select * from "TABLE_NAME"',prompts:[{trigger:"/",data:t0.map(e=>({id:e})),appendSpaceOnAdd:!0},{trigger:".",data:f,onAdd:e=>{"string"==typeof e&&null!=s.data&&s.data.includes(e)&&m(e)}}]})}),(0,l.jsxs)("div",{className:"block md:flex md:space-x-2 md:justify-between",children:[(0,l.jsxs)(ee.ae,{className:"hidden md:block",children:[(0,l.jsx)("strong",{children:"ProTip"}),": Press ",(0,l.jsx)(ee.Uz,{children:"/"})," to view basic SQL commands or press ",(0,l.jsx)(ee.Uz,{children:"."})," to view table data."]}),(0,l.jsx)(T.$n,{isLoading:b,disabled:""===t.trim()||b,children:"Run query"})]}),null!=h&&(0,l.jsx)(ee.yn,{children:h}),null!=v&&(0,l.jsx)(eb.T,{className:"mt-5",children:"mysql"===r?(0,l.jsx)(ns,{response:v.raw}):"postgres"===r?(0,l.jsx)(na,{response:v.raw}):(0,l.jsxs)(l.Fragment,{children:["Query response is not supported for ",r]})})]})}):(0,l.jsx)(ts.e,{})},nl=e=>{let{value:t,field:n,fields:a}=e,[{formatValue:s}]=nt(),r=a.find(e=>e.name===n);if(null==r)return null;let i="number"==typeof t?t:s(t,r.dataTypeID);return(0,l.jsx)(t8.xC,{children:(0,l.jsx)("span",{title:null!=i?i.toString():i,children:i})})},na=e=>{var t;let{response:n}=e,{page:a,setPage:s,totalPages:r,visibleItems:i}=t2(null!=(t=n.rows)?t:[],10);return 0===i.length?(0,l.jsx)(l.Fragment,{children:"No data to display, table is empty."}):i.length>0?(0,l.jsxs)("div",{children:[(0,l.jsx)(t8.J6,{children:(0,l.jsxs)(t8.XI,{children:[(0,l.jsx)(t8.D1,{children:(0,l.jsx)(t8.fI,{children:Object.keys(i[0]).map(e=>(0,l.jsx)(t8.A3,{children:e},e))})}),(0,l.jsx)(t8.vc,{children:i.map((e,t)=>(0,l.jsx)(t8.fI,{children:Object.keys(e).map(t=>(0,l.jsx)(nl,{field:t,value:e[t],fields:n.fields},t))},t))})]})}),(0,l.jsx)(t8.$o,{canPreviousPage:a>0,canNextPage:a+1<r,pageIndex:a,totalPages:r,gotoPage:s,previousPage:()=>s(a-1),nextPage:()=>s(a+1)})]}):(0,l.jsx)("pre",{children:JSON.stringify(n,null,2)})},ns=e=>{let{response:t}=e,n=Array.isArray(t[0]),{page:a,setPage:s,totalPages:r,visibleItems:i}=t2(n?t[0]:[],10);return n?0===t[0].length?(0,l.jsx)(l.Fragment,{children:"No data to display, table is empty."}):(0,l.jsxs)("div",{className:"mt-5",children:[(0,l.jsx)(t8.J6,{children:(0,l.jsxs)(t8.XI,{children:[(0,l.jsx)(t8.D1,{children:(0,l.jsx)(t8.fI,{children:Object.keys(i[0]).map(e=>(0,l.jsx)(t8.A3,{children:e},e))})}),(0,l.jsx)(t8.vc,{children:i.map((e,n)=>(0,l.jsx)(t8.fI,{children:Object.keys(e).map(n=>(0,l.jsx)(nl,{field:n,value:e[n],fields:t.fields},n))},n))})]})}),(0,l.jsx)(t8.$o,{canPreviousPage:a>0,canNextPage:a+1<r,pageIndex:a,totalPages:r,gotoPage:s,previousPage:()=>s(a-1),nextPage:()=>s(a+1)})]}):(0,l.jsx)("pre",{children:JSON.stringify(t[0],null,2)})};var nr=n(942);let ni={16:"bool",20:"int8",21:"int2",23:"int4",25:"text",114:"json",700:"float4",701:"float8",790:"money",1042:"bpchar",1043:"varchar",1082:"date",1083:"time",1114:"timestamp",1184:"timestamptz",2950:"uuid",3802:"jsonb"},no=e=>"json"===ni[e]||"jsonb"===ni[e],nc=(e,t)=>null==e?"":"timestamp"===ni[t]?ea()(e).format("YYYY-MM-DD HH:mm:ss"):"time"===ni[t]?ea()(e).format("HH:mm:ss"):"date"===ni[t]?ea()(e).format("YYYY-MM-DD"):no(t)?JSON.stringify(e):e.toString(),nd=e=>(0,l.jsx)(ne,{...e,databaseType:"postgres",formatValue:nc,isJsonColumnType:no,columnTypeLookup:ni}),nu=()=>nt(),nm=()=>{let e=(0,a.md)(z.mz),t=(0,a.md)(x.T6),n=(0,a.md)(I.Zy),s=(0,a.md)(e1),[{envs:r}]=nu();if(!e)return(0,l.jsx)(ts.e,{});if(null==r||null==t||null==n||null==s)return(0,l.jsx)(ec.m6,{});let i=(0,nr.q)(r);return(0,l.jsxs)("section",{className:"pb-12",children:[(0,l.jsx)(tt,{}),(0,l.jsx)(ef.c,{className:"my-6"}),(0,l.jsx)(e9,{commandName:"psql",rawCommand:i,secret:r.PGPASSWORD,plugin:s}),(0,l.jsx)(ef.c,{className:"my-6"}),(0,l.jsx)(ta,{projectId:t.id,environmentId:n.id,plugin:s})]})};var nx=n(86739),nh=n(36726),np=n(6605),ng=n(76706),nv=n(76043),nj=n(6008),ny=n(69249);function nf(){let e=(0,nx._)(["flex flex-col"]);return nf=function(){return e},e}function nb(){let e=(0,nx._)(["border-none"]);return nb=function(){return e},e}function nw(){let e=(0,nx._)(["relative"]);return nw=function(){return e},e}function nN(){let e=(0,nx._)(["bg-secondaryBg"]);return nN=function(){return e},e}function nI(){let e=(0,nx._)(["flex items-center flex-grow justify-between"]);return nI=function(){return e},e}function nk(){let e=(0,nx._)(["\n  px-2 py-1 text-sm cursor-pointer focus:outline-none\n"]);return nk=function(){return e},e}let nC=e=>{let{mode:t,autoFocus:n,placeholder:a,defaultValues:s,searchItems:r,maxHeight:o,className:c,onChange:d,allowCustomValue:u,error:m,icon:x,iconRight:h,label:p}=e,g=(0,i.useRef)(null),v=(0,i.useRef)(null),j=(0,nv.a)(),y=(0,i.useCallback)((e,n)=>{let l=()=>{e.results=(0,ny.W)(e.text,r,"multi"===t?e.selected:[])},a=n=>{"multi"===t?(e.text="",e.selected.push(n)):(e.text=n.text,e.selected=[n])};if("updateText"===n.type)e.text=n.text,e.isDeleting=!1,l(),1===e.results.length&&(e.selectedIndex=0);else if("changeSelectedIndex"===n.type)e.selectedIndex=Math.max(-1,Math.min(e.results.length-1,n.index));else if("select"===n.type){var s;let t=null!=(s=n.service)?s:e.results[e.selectedIndex];null==t&&u&&(t={text:e.text,value:e.text}),(null!=t||u)&&(e.selectedIndex=-1,a(t),l())}else"remove"===n.type?(e.selected=e.selected.filter(e=>e.value!==n.service.value),l()):"focus"===n.type?(e.focused=n.value,e.focused?(e.textBeforeFocus=e.text,e.text="",l()):""===e.text?e.text=e.textBeforeFocus:u&&a({text:e.text,value:e.text})):"removeSelected"===n.type?e.isDeleting?(e.selected.pop(),e.isDeleting=!1,l()):e.isDeleting=!0:tu.A.warn("Action not handled",n)},[t,r,u]),f=(0,i.useMemo)(()=>{var e,n;return null==s||"multi"===t?"":null!=(n=null==(e=s[0])?void 0:e.text)?n:""},[]),[b,w]=(0,nh.A)(y,{focused:null!=n&&n,selectedIndex:-1,selected:null!=s?s:[],results:(0,ny.W)("",r),text:f,textBeforeFocus:f,isDeleting:!1});(0,i.useEffect)(()=>{j&&null!=d&&d(b.selected)},[b.selected]),(0,i.useEffect)(()=>{n&&setTimeout(()=>{var e;null==(e=g.current)||e.focus()},0)},[]);let{focused:N,isDeleting:I,results:k,selected:C,selectedIndex:S,text:T}=b,D=(0,nj.l)(),A=(0,ng.d)(v),E=(0,i.useMemo)(()=>D.height-A.top-32,[A.top,D]),R=(0,i.useMemo)(()=>j?Math.min(Math.min(null!=o?o:1/0,E),A.height+2):"auto",[E,A.height,o,j]),L=b.results.length<=0||!N||"single"===t&&b.results[0].text===b.text||I,M="single"===t&&1===C.length&&null!=C[0].icon,P="string"==typeof p?p:p.text,z="string"!=typeof p&&p.hidden;return(0,l.jsxs)(eb.T,{children:[(0,l.jsx)(th.JU,{as:"div",className:z?"sr-only":"",children:P}),(0,l.jsxs)(nS,{className:"select ".concat(null!=c?c:""),children:[(0,l.jsxs)(nA,{error:m,focused:b.focused,children:[C.length>0&&"multi"===t&&(0,l.jsx)(nE,{children:C.map((e,t)=>(0,l.jsx)(nT,{item:e,isDeleting:I&&t===C.length-1,onRemove:()=>w({type:"remove",service:e})},e.value))}),(0,l.jsxs)(eb.z,{align:"center",space:+!!M,children:[M&&null!=C[0].icon&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(tv.h,{x:2}),(0,l.jsx)(Z.In,{icon:C[0].icon})]}),(0,l.jsx)(nR,{autoFocus:n,placeholder:a,label:{text:P,hidden:!0},value:T,onChange:e=>w({type:"updateText",text:e.target.value}),onFocus:()=>w({type:"focus",value:!0}),onBlur:()=>w({type:"focus",value:!1}),onKeyDown:e=>{e.keyCode===np.HP.enter?(w({type:"select"}),e.preventDefault()):e.keyCode===np.HP.down?w({type:"changeSelectedIndex",index:b.selectedIndex+1}):e.keyCode===np.HP.up?w({type:"changeSelectedIndex",index:b.selectedIndex-1}):e.keyCode===np.HP.backspace?w({type:"removeSelected"}):e.keyCode===np.HP.escape&&w({type:"focus",value:!1})},ref:g,icon:x,iconRight:h})]})]}),(0,l.jsx)(nL,{children:(0,l.jsx)(nM,{hidden:L,style:{height:R,opacity:"number"==typeof R&&R<=2?0:1},children:(0,l.jsx)(nP,{ref:v,children:k.map((e,t)=>{var n;return(0,l.jsx)(nD,{item:e,isSelected:(null==(n=C[0])?void 0:n.value)===e.value,isHovered:t===S&&!I,setSelected:()=>w({type:"changeSelectedIndex",index:t}),onClick:()=>w({type:"select",service:e})},e.value)})})})})]})]})},nS=X.qy.div(nf()),nT=e=>{let{item:t,isDeleting:n,onRemove:a}=e;return(0,l.jsxs)(nF,{isDeleting:n,children:[null!=t.icon&&(0,l.jsx)(Z.In,{icon:t.icon}),(0,l.jsx)(tv.h,{x:3}),(0,l.jsx)(ee.EY,{children:t.text}),(0,l.jsx)(nV,{onClick:()=>a(),children:"\xd7"})]})},nD=e=>{let{item:t,isSelected:n,isHovered:a,setSelected:s,onClick:r}=e;return(0,l.jsxs)(nz,{isHovered:a,onMouseDown:()=>r(),onMouseOver:()=>s(),className:"search-result",children:[(0,l.jsxs)(nO,{children:[(0,l.jsxs)(eb.z,{align:"center",children:[null!=t.icon&&(0,l.jsx)(Z.In,{icon:t.icon}),(0,l.jsx)(tv.h,{x:3}),(0,l.jsx)(ee.EY,{children:t.text})]}),n&&(0,l.jsx)(Z.In,{icon:$.Jlk})]}),null!=t.info?(0,l.jsx)(nU,{children:t.info}):(0,l.jsx)("div",{})]})},nA=(0,X.Wp)("div")(e=>["border rounded",e.error?"border-red-500 hover:border-red-500":e.focused?"border-blue-500 hover:border-blue-500":"border-gray-200 hover:border-gray-400"]),nE=(0,X.Wp)("div")(()=>["flex flex-wrap pt-1 px-1","[&>*]:mr-3 [&>*]:mb-3"]),nR=(0,X.DR)(th.pd)(nb()),nL=X.qy.div(nw()),nM=(0,X.Wp)("div")(e=>["absolute left-0 top-0 right-0 overflow-x-hidden overflow-y-auto","mt-1 border border-gray-200 rounded-sm z-50 shadow rounded-md",e.hidden?"hidden":"block"]),nP=(0,X.Wp)("div")(nN()),nz=(0,X.Wp)("div")(e=>["flex items-center justify-between p-2 cursor-pointer",e.isHovered?"bg-gray-200":"bg-transparent"]),nO=X.qy.div(nI()),nU=(0,X.Wp)("div")(()=>["bg-gray-200 py-0 px-2 rounded text-base"],{boxShadow:"1px 1px 10px #0000001c"}),nF=(0,X.Wp)("div")(e=>["flex items-center p-1 border rounded border-pink-500",e.isDeleting?"bg-pink-500":"bg-transparent"]),nV=X.qy.button(nk());var nB=n(13934);function n_(){let e=(0,nx._)(["\n  grid gap-x-2 gap-y-1 mt-4\n  grid-cols-[repeat(4,_1fr)_44px]\n"]);return n_=function(){return e},e}let nq=()=>{let[{databaseType:e},{createTable:t}]=nt(),{routes:n,navActions:a}=(0,es.c)(),[s,r]=(0,i.useState)(!1),[o,c]=(0,i.useState)(null),{control:d,register:u,handleSubmit:m,formState:{errors:x}}=(0,ty.mN)({defaultValues:{columns:[{name:"id",type:{text:"serial",value:"serial"},constraint:{text:"Primary Key",value:"PRIMARY KEY"}}]}}),{fields:h,append:p,remove:g}=(0,ty.jz)({control:d,name:"columns"}),v=async e=>{try{var l;c(null),r(!0),await t({name:e.tableName,columns:(null!=(l=e.columns)?l:[]).map(e=>{var t;return{...e,default:e.default||void 0,constraint:null==(t=e.constraint)?void 0:t.value,type:e.type.value}})}),a.push(n.projectPluginView({view:"data"}))}catch(e){c(e.message)}r(!1)};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(ee.EY,{className:"mb-4 text-center",children:"Create Table"}),null!=o&&(0,l.jsx)(ee.yn,{children:o}),(0,l.jsx)(nB.n4,{message:"You do not have permission to create a table",children:(0,l.jsxs)(tx.lV,{enableBindings:!0,onCancel:()=>{var e;null==(e=document.activeElement)||e.blur()},onSubmit:m(v),name:"Create SQL Table",children:[(0,l.jsx)(tx.D0,{label:"table name",...u("tableName",{required:!0,minLength:1,maxLength:100}),placeholder:"MyTable",error:null!=x.tableName,autoFocus:!0,className:"max-w-xs"}),(0,l.jsxs)(nW,{children:[(0,l.jsx)(ee.ae,{children:"column name"}),(0,l.jsx)(ee.ae,{children:"type"}),(0,l.jsx)(ee.ae,{children:"default"}),(0,l.jsx)(ee.ae,{children:"constraints"}),(0,l.jsx)(ee.ae,{style:{maxWidth:20}}),h.map((t,n)=>(0,l.jsxs)(i.Fragment,{children:[(0,l.jsx)(ty.xI,{name:"columns.".concat(n,".name"),control:d,rules:{required:!0},render:e=>{var t;let{field:{onChange:a,value:s,name:r}}=e;return(0,l.jsx)(th.pd,{value:s,onChange:a,name:r,placeholder:"my-column",label:{text:"Column Name",hidden:!0},error:null!=x.columns&&null!=x.columns[n]&&(null==(t=x.columns[n])?void 0:t.name)!=null})}}),(0,l.jsx)(ty.xI,{name:"columns.".concat(n,".type"),control:d,rules:{required:!0,validate:e=>{let{value:t}=e;return""!==t.trim()}},render:t=>{var a;let{field:{onChange:s,value:r}}=t;return(0,l.jsx)(nC,{searchItems:"mysql"===e?tZ:tH,label:{text:"Type",hidden:!0},defaultValues:[r],allowCustomValue:!0,onChange:e=>s(e[0]),error:null!=x.columns&&null!=x.columns[n]&&(null==(a=x.columns[n])?void 0:a.type)!=null})}}),(0,l.jsx)(ty.xI,{name:"columns.".concat(n,".default"),control:d,render:e=>{var t;let{field:{onChange:a,value:s,name:r}}=e;return(0,l.jsx)(th.pd,{value:s,onChange:a,name:r,label:{text:"Default",hidden:!0},placeholder:"no default",error:null!=x.columns&&null!=x.columns[n]&&(null==(t=x.columns[n])?void 0:t.default)!=null})}}),(0,l.jsx)(ty.xI,{name:"columns.".concat(n,".constraint"),control:d,render:e=>{var t;let{field:{onChange:a,value:s}}=e;return(0,l.jsx)(nC,{searchItems:tJ,defaultValues:null!=s?[s]:void 0,onChange:e=>a(e[0]),label:{text:"Constraint",hidden:!0},error:null!=x.columns&&null!=x.columns[n]&&(null==(t=x.columns[n])?void 0:t.constraint)!=null})}}),(0,l.jsx)(T.K0,{icon:$.X,onClick:()=>g(n),title:"Delete Column",type:"button",hidden:h.length<=1,className:"delete-column"})]},t.id))]}),(0,l.jsx)("div",{className:"mt-4",children:(0,l.jsx)(T.$n,{size:"sm",color:"blue",onClick:()=>p({name:"",type:{value:"text",text:"text"}}),type:"button",className:"add-column",children:"Add column"})}),(0,l.jsxs)(eb.z,{justify:"end",className:"mt-8",children:[(0,l.jsx)(T.vx,{variant:"primary",...n.projectPluginView({view:"data"}),scroll:!1,className:"cancel-create-table",children:"Cancel"}),(0,l.jsx)(tv.h,{x:3}),(0,l.jsx)(T.$n,{type:"submit",disabled:s,className:"create-table",children:s?(0,l.jsx)(ec.Rh,{}):"Create"})]})]})})]})},nW=X.qy.div(n_());var nK=n(41110),nY=n.n(nK);let nQ=e=>{let[,t]=nt(),[n,a]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{if(!n)return;let e=setTimeout(()=>a(!1),500);return()=>clearTimeout(e)},[n]),(0,l.jsx)($.e9t,{...e,className:(0,X.xW)(e.className,"refresh ".concat(n?"animate-spin":"")),onClick:()=>{a(!0),t.refresh()}})},n$=()=>{let[{tableNames:e,tableData:{data:t}},n]=nt(),[s,r]=(0,i.useState)([]),[o,c]=(0,ei.b)(),{routes:d,navActions:u}=(0,es.c)(),m=(0,N.T7)(),x=(0,N.gq)(),h=(0,i.useRef)(null),{isConfirmed:p}=(0,E.S)(),g=(0,i.useRef)(null),[v,j]=(0,i.useState)(null),y=(0,a.md)(z.mz),f=(0,i.useMemo)(()=>{var t;return nY()(null!=(t=e.data)?t:[],[e=>e.toLowerCase()]).filter(e=>null==v||""==v.trim()||e.toLowerCase().includes(v.toLowerCase()))},[e.data,v]);(0,i.useEffect)(()=>{null!=v&&""!==v.trim()&&(0===f.length?r([]):1===f.length&&r([0]))},[v,f]),(0,w.bU)(()=>({value:"sql-table-create",text:"New Table",icon:$.FWt,highlighted:!0,group:"SQL",keybinding:"C",isAvailable:()=>y,action:async()=>{u.push(d.projectPluginView({view:"data",query:{state:"create-table"}}))}}),[u,y]),(0,w.bU)(()=>({text:"Generate dummy data",value:"generateSQLDummyData",category:"SQL",group:"SQL",icon:$.KqI,highlighted:!0,isAvailable:()=>null==t&&null!=e.data&&0===e.data.length,action:async()=>{try{await n.generateDummyData()}catch(e){c(e.message),tu.A.log("Error generating Postgres dummy data",e)}}}),[t,e.data]),(0,w.bU)(()=>({value:"sql-tables-filter",text:"Filter Tables",icon:$.dJT,group:"SQL",keybinding:"/",highlighted:!0,isAvailable:()=>0===s.length,action:()=>{j(""),setTimeout(()=>{var e;return null==(e=g.current)?void 0:e.focus()},0)}}),[s]);let I=async()=>{if(0!==f.length&&0!==s.length&&await p({confirmLabel:"Delete",message:1===s.length?"Are you sure you want to delete the table ".concat(f[s[0]],"?"):"Are you sure you want to delete ".concat(s.length," ").concat((0,ey.td)("table",s.length),"?"),title:"Delete Table"}))try{await Promise.all(s.map(e=>n.deleteTable({name:f[e]}))),r([]),c(null)}catch(e){c(e.message)}};(0,w.bU)(()=>({value:"sql-delete-table",text:"Delete Table",icon:$.TBR,highlighted:!0,group:"SQL",keybinding:"D",isAvailable:()=>s.length>0,action:()=>I()}),[s]);let k=e=>{0!==f.length&&u.push(d.projectPluginView({view:"data",query:{state:"table",table:f[e]}}))},{activeElement:C,setActiveElement:S}=(e=>{let{tableGridRef:t,selected:n,sortedTableNames:l,setSelected:a,clickTable:s}=e,[r,o]=(0,i.useState)(null),c=(0,nj.l)(),d=(0,i.useMemo)(()=>c.width<1024?4:5,[c]),u=()=>{o(0)},m=()=>null!=t.current&&0===n.length;return(0,i.useEffect)(()=>{let e=(0,b.Ay)(window,{ArrowDown:e=>{if(e.preventDefault(),!m())return;if(null==r)return void u();let t=r+d;t>=l.length&&(t=l.length-1),o(t)},ArrowUp:e=>{if(e.preventDefault(),!m())return;if(null===r)return void u();let t=r-d;t<0?o(null):o(t)},ArrowRight:e=>{if(e.preventDefault(),!m())return;if(null===r)return void u();let t=r+1;t<l.length&&o(t)},ArrowLeft:e=>{if(e.preventDefault(),!m())return;if(null===r)return void u();let t=r-1;t>=0&&o(t)},Escape:()=>{a([]),o(null)},Enter:()=>{if(n.length>0)return void s(n[0]);null!=r&&s(r)}});return()=>e()},[n,r,l]),{activeElement:r,setActiveElement:o}})({tableGridRef:h,selected:s,setSelected:r,sortedTableNames:f,clickTable:k});return null==e||e.isLoading?(0,l.jsx)(ec.m6,{}):0===f.length&&null==v?(0,l.jsxs)("div",{className:"flex flex-col justify-center items-center pt-8",children:[(0,l.jsx)(ee.QO,{children:"You have no tables"}),y&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(tv.h,{y:4}),(0,l.jsx)(T.vx,{...d.projectPluginView({view:"data",query:{state:"create-table"}}),scroll:!1,className:"create-table-link no-tables",children:"Create table"}),(0,l.jsx)(tv.h,{y:4}),(0,l.jsx)(ee.ae,{children:"or"})]}),(0,l.jsx)(tv.h,{y:4}),(0,l.jsx)(eu.N,{variant:"underline",...d.docs({page:"databases/database-view"}),className:"read-the-docs-link no-tables",children:"Read the docs"})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{onClick:()=>r([]),className:"flex flex-col flex-grow relative",children:[(0,l.jsxs)("div",{className:"relative flex items-center justify-center mb-8",children:[(0,l.jsxs)(ee.EY,{children:["Tables"," ",s.length>0&&"(".concat(s.length," ").concat((0,ey.td)("table",s.length)," selected)")]}),(0,l.jsxs)(eb.z,{space:2,align:"center",className:"absolute right-0 top-0",children:[(0,l.jsx)(T.K0,{title:"Delete table",icon:$.TBR,hidden:0===s.length,onClick:e=>{e.stopPropagation(),I()},className:"delete-table"}),(0,l.jsx)(T.K0,{title:"Refresh tables",icon:nQ,className:"refresh-tables"})]})]}),null!=v&&(0,l.jsx)("div",{className:"hidden md:block absolute top-7 right-0",children:(0,l.jsx)(eT.P.div,{initial:{y:-10,opacity:0},animate:{y:0,opacity:1},children:(0,l.jsx)(th.pd,{value:v,onChange:e=>j(e.target.value),label:{text:"Filter",hidden:!0},placeholder:"Filter",name:"filter",autoFocus:!0,ref:g,onKeyDown:e=>{"Escape"===e.key&&j(null)},className:"h-6 text-sm"})})}),e.isError||null!=o&&(0,l.jsx)(ee.yn,{children:null!=o?o:"Error loading tables"}),f.length>0?(0,l.jsx)(nX,{isSelecting:x||m,ref:h,children:f.map((e,t)=>(0,l.jsx)(nG,{name:e,isSelected:s.includes(t),isFocused:C===t,index:t,onHover:()=>S(t),onClick:()=>(e=>{if(0!==f.length){if(!x&&!m||!y)return void k(e);(e=>{if(0===s.length)r([e]);else if(m){let t=[...s].sort((e,t)=>e-t)[0],n=[];for(let l=Math.min(e,t);l<=Math.max(e,t);l+=1)n.push(l);r(n)}else x&&(s.includes(e)?r(t=>t.filter(t=>t!==e)):r(t=>[...t,e]))})(e)}})(t)},e))}):(0,l.jsx)(ee.xC,{className:"text-center my-8",children:"No tables here"})]}),y&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(tv.h,{y:5}),(0,l.jsx)("div",{className:"flex justify-end",children:(0,l.jsx)(T.vx,{variant:"primary",...d.projectPluginView({view:"data",query:{state:"create-table"}}),className:"create-table",children:"Create table"})})]})]})},nG=e=>{let{name:t,isSelected:n,isFocused:a,onHover:s,onClick:r}=e;return(0,l.jsx)(eT.P.div,{animate:a?"hover":"",variants:{hover:{scale:1.05}},children:(0,l.jsxs)(nJ,{isSelected:n,isFocused:a,onMouseMove:s,onClick:e=>{e.preventDefault(),e.stopPropagation(),r()},children:[(0,l.jsx)(Z.In,{icon:$.PEP,size:"2xl",className:"text-blue-600"}),(0,l.jsx)(tv.h,{y:3}),(0,l.jsx)(ee.EY,{title:t,className:"text-center overflow-hidden overflow-ellipsis max-w-full",children:t})]})})},nJ=(0,X.Wp)("div")(e=>["flex flex-col items-center","p-2 rounded cursor-pointer stroke-current",e.isSelected&&"bg-gray-200",e.isFocused&&"bg-gray-200"]),nX=(0,X.Wp)("div")(e=>["grid gap-x-2 gap-y-4","grid-cols-[repeat(auto-fill,_minmax(140px,_1fr))]",e.isSelecting&&"select-none"]);var nH=n(83279),nZ=n(72370),n0=n(29455);let n1=e=>{let{row:t,primaryKey:n}=e,l=t[n]?t[n].toString():null;if(null==l)throw Error("The table does not have a PRIMARY KEY. Please set one of the columns as a primary key in order to be able to edit/delete rows from this table.");return l},n2=ty.xI,n5=e=>{let{primaryKey:t,columnNames:n,columnTypes:a,row:s,isJsonColumnType:r,formatValue:o,onUpdateRow:c,onDeleteRow:d,onOpenChange:u,open:m,columnTypeLookup:x}=e,[h,p]=(0,i.useState)(!1),[g,v]=(0,i.useState)(!1),[j,y]=(0,ei.b)(),[f,w]=(0,e8.E)(!1,4e3),{isConfirmed:N}=(0,E.S)(),{modalActions:I}=(0,P.U)(),k=(0,i.useMemo)(()=>Object.entries(s).reduce((e,t,n)=>{let[l,s]=t;return{...e,[l]:null==s?null:r(a[n])?JSON.stringify(s,null,2):o(s,a[n])}},{}),[s]),{register:C,control:S,watch:D,getValues:R,handleSubmit:L,reset:M,formState:{errors:z,isValid:O}}=(0,ty.mN)({defaultValues:k}),U=D(),F=(0,i.useMemo)(()=>Object.entries(k).some(e=>{let[t,n]=e;return n!==U[t]}),[k,U]),V=(0,i.useCallback)(async e=>{if(!F)return;let n=Object.entries(e).reduce((e,t)=>{let[n,l]=t;return{...e,[n]:""===l?null:l}},{});try{p(!0),n1({row:s,primaryKey:t}),await c(n),w(!0)}catch(e){y(e.message)}p(!1)},[F,U]);(0,i.useEffect)(()=>{m&&M(k)},[m,k]),(0,i.useEffect)(()=>{let e=(0,b.Ay)(window,{Enter:()=>{V(R())},"$mod+Enter":()=>{V(R())},"$mod+S":e=>{e.preventDefault(),V(R())},Escape:async()=>{u(!1)}});return()=>e()},[V,u]);let B=()=>{u(!1)},_=async()=>{if(await N({confirmLabel:"Delete",message:"Are you sure you want to delete this row? Deleting this row is permanent and cannot be undone.",title:"Delete Row"})){try{v(!0);let e=n1({row:s,primaryKey:t});await d(e),I.createToast((0,l.jsx)(A.y8,{variant:"success",title:"Row successfully deleted"})),u(!1)}catch(e){y(e.message)}v(!1)}};return(0,l.jsx)(n0.w.Root,{open:m,onOpenChange:u,closable:!0,hideCloseButton:!0,children:(0,l.jsxs)(eb.T,{className:"w-[600px] py-4 space-y-4 h-screen overflow-y-hidden",children:[(0,l.jsxs)(eb.z,{align:"center",justify:"between",className:"px-4",children:[(0,l.jsx)(ee.lD,{as:"h2",children:"Edit Row"}),(0,l.jsxs)(eb.z,{space:2,align:"center",children:[g?(0,l.jsx)(ec.Rh,{}):(0,l.jsx)(T.K0,{icon:$.TBR,title:"Delete",disabled:h||g,onClick:_}),(0,l.jsx)(T.K0,{icon:$.X,title:"Close",onClick:B})]})]}),null!=j&&(0,l.jsx)(ee.yn,{children:j}),(0,l.jsx)(tx.lV,{onSubmit:L(V),name:"Edit SQL",className:"overflow-y-auto px-4",children:(0,l.jsxs)(eb.T,{space:5,children:[n.map((e,t)=>{var n;return(0,l.jsxs)(eb.T,{space:2,children:[(0,l.jsx)(th.JU,{className:"mb-0 text-foreground font-medium",children:e}),r(a[t])?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n2,{name:e,control:S,rules:{validate:e=>(0,nH.j)(e)},render:e=>{let{field:{onChange:t,value:n,name:a}}=e;return(0,l.jsx)(nZ.t,{language:"json",name:a,value:n,onChange:t,onKeyDown:e=>{e.metaKey&&"Enter"===e.key?e.preventDefault():"Enter"===e.key?e.stopPropagation():"Tab"===e.key&&e.preventDefault()},error:null!=z[a],styles:{minHeight:"100px"}})}}),(0,l.jsx)("small",{className:"text-xs text-gray-600",children:x[a[t]]})]}):(0,l.jsx)(th.pd,{...C(e),autoComplete:"off",placeholder:"DEFAULT",label:{text:"Value",hidden:!0},error:null!=z[e],onKeyDown:e=>{"Enter"===e.key&&e.preventDefault()},className:"max-w-none",hint:null!=(n=x[a[t]])?n:"Type: ".concat(a[t])})]},e)}),(0,l.jsxs)(eb.z,{space:3,align:"center",className:"pb-8",children:[(0,l.jsx)(T.$n,{variant:"primary",color:"gray",onClick:B,className:"cancel-edit-row",autoFocus:!0,children:"Cancel"}),F&&(0,l.jsx)(T.$n,{disabled:h||!O,className:"save-edit-row",children:h?(0,l.jsx)(ec.Rh,{}):"Save"}),f&&(0,l.jsx)("div",{className:"pl-2",children:(0,l.jsx)(Z.In,{icon:$.Jlk,size:"lg",color:"success",initial:{y:-10,scale:0},animate:{y:0,scale:1}})})]})]})}),(0,l.jsx)(tv.h,{y:5})]})})},n4=e=>{let{tableName:t,databaseType:n,insertColumn:a}=e,[s,r]=(0,ei.b)(),[o,c]=(0,i.useState)(!1),{modalActions:d}=(0,P.U)(),{control:u,register:m,handleSubmit:x,formState:{errors:h}}=(0,ty.mN)(),p=async e=>{try{var n;r(null),c(!0),await a({tableName:t,column:{name:e.name,default:e.default,type:e.type.value,constraint:null==(n=e.constraint)?void 0:n.value}}),d.createToast((0,l.jsx)(A.y8,{variant:"success",title:"Column ".concat(e.name," added to ").concat(t)})),d.exitModal()}catch(e){r(e.message)}c(!1)};return(0,l.jsxs)(eb.T,{space:6,children:[(0,l.jsx)(eg.wt,{children:"Insert column"}),null!=s&&(0,l.jsx)(ee.yn,{children:s}),(0,l.jsx)(nB.n4,{message:"You do not have permission to create a column",children:(0,l.jsxs)(tx.lV,{onSubmit:x(p),enableBindings:!0,name:"Insert SQL Column",className:"space-y-5",children:[(0,l.jsx)(tx.D0,{label:"Name",...m("name",{required:!0,minLength:2,maxLength:128}),placeholder:"name",error:null!=h.name,autoFocus:!0}),(0,l.jsx)(ty.xI,{name:"type",control:u,rules:{required:!0,validate:e=>{let{value:t}=e;return""!==t.trim()}},render:e=>{let{field:{onChange:t,value:a}}=e;return(0,l.jsx)(nC,{searchItems:"mysql"===n?tZ:tH,label:"Type",onChange:e=>t(e[0]),error:null!=h.type,placeholder:"text",allowCustomValue:!0})}}),(0,l.jsx)(ty.xI,{name:"default",control:u,render:e=>{let{field:{onChange:t,value:n,name:a}}=e;return(0,l.jsx)(th.pd,{value:n,onChange:t,name:a,label:"Default",placeholder:"No default",error:null!=h.default})}}),(0,l.jsx)(ty.xI,{name:"constraint",control:u,render:e=>{let{field:{onChange:t,value:n}}=e;return(0,l.jsx)(nC,{searchItems:tJ,defaultValues:null!=n?[n]:void 0,label:"Constraint",onChange:e=>t(e[0]),error:null!=h.constraint,placeholder:"No constraint"})}}),(0,l.jsxs)(eb.z,{justify:"end",space:4,children:[(0,l.jsx)(T.$n,{type:"button",onClick:()=>d.exitModal(),color:"gray",children:"Cancel"}),(0,l.jsx)(T.jn,{isLoading:o,children:"Add column"})]})]})})]})};function n6(){let e=(0,nx._)(["flex flex-col flex-grow"]);return n6=function(){return e},e}function n8(){let e=(0,nx._)(["relative flex items-center justify-center"]);return n8=function(){return e},e}function n3(){let e=(0,nx._)(["flex flex-col justify-between flex-grow mt-5"]);return n3=function(){return e},e}function n7(){let e=(0,nx._)(["flex justify-end pt-2"]);return n7=function(){return e},e}function n9(){let e=(0,nx._)(["flex flex-col items-center text-center"]);return n9=function(){return e},e}let le=()=>{let[{tableData:e,selectedTableName:t}]=nt();if(e.isError||null==t){var n,a;return(0,l.jsx)(ee.yn,{children:null!=(a=null==(n=e.error)?void 0:n.message)?a:"Error loading table"})}return e.isLoading?(0,l.jsx)(ec.m6,{}):null==e.data?(0,l.jsx)(ln,{tableName:t}):(0,l.jsx)(lt,{table:e.data,selectedTableName:t})},lt=e=>{let{table:t,selectedTableName:n}=e,{routes:s}=(0,es.c)(),[{page:r,totalPages:o,formatValue:c,isJsonColumnType:d,pageSize:u,databaseType:m,columnTypeLookup:x},h]=nt(),[p,g]=(0,ei.b)(),[v,j]=(0,i.useState)(!1),[y,f]=(0,i.useState)(!1),[I,k]=(0,i.useState)({}),[C,S]=(0,i.useState)([]),D=(0,N.T7)(),R=(0,N.gq)(),{isConfirmed:M}=(0,E.S)(),O=(0,i.useRef)(null),U=(0,a.md)(z.mz),{modalActions:F}=(0,P.U)(),{showModal:V}=(0,L.h)(),B=()=>{h.changePage(r-1)},_=()=>{h.changePage(r+1)};(0,w.bU)(()=>({value:"sql-create-row",text:"New Row",icon:$.FWt,highlighted:!0,keybinding:"C",group:"SQL",isAvailable:()=>!v&&U,action:async()=>q()}),[v,U]);let q=()=>{U&&(j(!0),setTimeout(()=>{var e;null==(e=O.current)||e.focus()},0))},W=async()=>{if(null==t||y)return;let e=Object.entries(I).map(e=>{let[t,n]=e;return{name:t,value:n}}).filter(e=>{let{value:t}=e;return""!==t.trim()});try{f(!0),await h.insertRow({tableName:t.name,columns:e}),g(null),k({}),j(!1)}catch(e){g(e.message)}f(!1)},K=async()=>{let e=await M({confirmLabel:"Delete",message:"Are you sure you want to delete ".concat(C.length," ").concat((0,ey.td)("row",C.length),"? Deleting these rows is permanent and cannot be undone."),title:"Delete Rows"});if(null!=t&&e)try{let e=C.map(e=>t.rows[e][t.primaryKey].toString());await h.deleteRows({tableName:t.name,columnName:t.primaryKey,rows:e}),F.createToast((0,l.jsx)(A.y8,{variant:"success",title:"".concat(e.length," ").concat((0,ey.td)("row",e.length)," successfully deleted")})),g(null),S([])}catch(e){g(e.message)}},Y=async()=>{null!=t&&F.openModal((0,l.jsx)(eg.aF,{title:"Insert column",children:(0,l.jsx)(n4,{tableName:t.name,databaseType:m,insertColumn:h.insertColumn})}))};(0,w.bU)(()=>({value:"sql-delete-row",text:"Delete Row",icon:$.TBR,highlighted:!0,group:"SQL",keybinding:"D",isAvailable:()=>C.length>0,action:()=>K()}),[C]),(0,w.bU)(()=>({value:"sql-insert-column",text:"Insert column",category:"SQL",action:()=>Y()}));let Q=e=>{let n=C.includes(e);if(R)n?S(t=>t.filter(t=>t!==e)):S(t=>[...t,e]);else if(D){var l;let t=null!=(l=[...C].sort((e,t)=>e-t)[0])?l:e,n=[];for(let l=Math.min(e,t);l<=Math.max(e,t);l+=1)n.push(l);S(n)}else{let n=t.rows[e],l=async e=>{h.updateRow({pKey:t.primaryKey,pKeyValue:n[t.primaryKey].toString(),tableName:t.name,data:e})},a=async e=>{h.deleteRows({tableName:t.name,columnName:t.primaryKey,rows:Array.of(e)})};V(n5,{columnTypes:t.columnTypes,columnNames:t.columnNames,primaryKey:t.primaryKey,columnTypeLookup:x,isJsonColumnType:d,formatValue:c,row:n,onDeleteRow:a,onUpdateRow:l})}},{activeElement:G,setActiveElement:J}=(e=>{let{pageSize:t,page:n,isInserting:l,selectedRows:a,setSelectedRows:s,table:r,gotoPrevPage:o,gotoNextPage:c,onClickRow:d}=e,[u,m]=(0,i.useState)(null),{routes:x,navActions:h}=(0,es.c)(),{sidePanels:p,modals:g}=(0,P.U)(),v=()=>0===a.length&&0!==r.totalRows;return(0,i.useEffect)(()=>{if(l||p.length>0||g.length>0)return;let e=(0,b.Ay)(window,{ArrowDown:e=>{if(e.preventDefault(),!v())return;if(null==u)return void m(0);let l=u+1;t*n+l>=r.totalRows||(l===t&&(c(),l=0),m(l))},ArrowUp:e=>{if(e.preventDefault(),!v()||null==u)return;let l=u-1;l<0&&(0===n?l=null:(o(),l=t-1)),m(l)},Escape:()=>{u||a.length>0?(m(null),s([])):h.push(x.projectPluginView({view:"data"}))},Enter:()=>{null!=u&&d(u)}});return()=>e()},[r,a,u,n,t,l,p]),{activeElement:u,setActiveElement:m}})({page:r,pageSize:u,gotoNextPage:_,gotoPrevPage:B,selectedRows:C,setSelectedRows:S,isInserting:v,table:t,onClickRow:Q});return(0,l.jsxs)(ll,{onClick:()=>{S([])},children:[(0,l.jsxs)(la,{children:[(0,l.jsx)(ls,{position:"left",children:(0,l.jsx)(T.sh,{icon:$.nkM,scroll:!1,...s.projectPluginView({view:"data"}),className:"table-back"})}),(0,l.jsxs)(ee.EY,{children:[n," ",C.length>0&&"(selected ".concat(C.length," ").concat((0,ey.td)("row",C.length),")")]}),(0,l.jsxs)(ls,{position:"right",children:[(0,l.jsx)(T.K0,{icon:$.TBR,hidden:0===C.length,onClick:K,title:"Delete",color:"pink",className:"delete-row"}),0===C.length&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(T.K0,{icon:nQ,title:"Refresh table",color:"pink"}),(0,l.jsx)(T.$n,{onClick:Y,title:"Insert column",variant:"ghost",size:"sm",className:"text-pink-500",children:(0,l.jsxs)(eb.z,{align:"center",children:[(0,l.jsx)(Z.In,{icon:$.O3j,className:"mr-1"}),"Add Column"]})})]})]})]}),(0,l.jsx)(tv.h,{y:2}),(0,l.jsxs)(lr,{children:[null!=p&&(0,l.jsx)(ee.yn,{className:"mt-2",children:p}),(0,l.jsxs)(t8.J6,{children:[(0,l.jsxs)(t8.XI,{isSelecting:R||D,children:[(0,l.jsx)(t8.D1,{children:(0,l.jsx)(t8.fI,{children:t.columnNames.map(e=>(0,l.jsx)(t8.A3,{children:e},e))})}),(0,l.jsxs)(t8.vc,{children:[t.rows.map((e,n)=>(0,l.jsx)(t8.fI,{className:C.includes(n)?"selected":"",isActive:n===G,onMouseMove:()=>J(n),children:t.columnNames.map((a,s)=>{let r=e[a],i="number"==typeof r?r:c(r,t.columnTypes[s]);return(0,l.jsx)(t8.xC,{onClick:e=>{e.preventDefault(),e.stopPropagation(),Q(n)},children:(0,l.jsx)("span",{title:null!=i?i.toString():i,children:i})},a)})},n)),v&&null!=t&&(0,l.jsx)(t8.fI,{isInserting:!0,className:"inserting",children:t.columnNames.map((e,t)=>(0,l.jsx)(t8.xC,{children:(0,l.jsx)(th.pd,{ref:0===t?O:null,autoFocus:0===t,placeholder:"DEFAULT",label:{text:"Value",hidden:!0},onKeyDown:e=>{e.keyCode===np.HP.enter?W():e.keyCode===np.HP.escape&&j(!1)},onChange:t=>{let n=t.target.value;k(t=>({...t,[e]:n}))}})},e))})]})]}),null!=t&&0===t.rows.length&&!v&&(0,l.jsx)(lo,{children:(0,l.jsx)(ee.QO,{className:"py-8",children:"This table is empty"})})]}),(0,l.jsx)(li,{space:3,children:v?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(T.$n,{variant:"primary",color:"gray",onClick:()=>{j(!1),k({})},disabled:y,className:"cancel-insert-row",children:"Cancel"}),(0,l.jsx)(T.$n,{onClick:W,disabled:y,className:"insert-row",children:y?(0,l.jsx)(ec.Rh,{}):"Insert"})]}):(0,l.jsx)(l.Fragment,{children:U&&(0,l.jsx)(T.$n,{variant:"outline",size:"sm",onClick:()=>{q()},className:"add-row",children:"Add Row"})})}),t.rows.length>0&&(0,l.jsx)(t8.$o,{canPreviousPage:r>0,canNextPage:r+1<o,pageIndex:r,totalPages:o,gotoPage:h.changePage,previousPage:B,nextPage:_})]})]})},ln=e=>{let{tableName:t}=e,{routes:n}=(0,es.c)();return(0,l.jsxs)(lo,{children:[(0,l.jsx)(tv.h,{y:5}),(0,l.jsxs)(ee.QO,{children:["Table ",(0,l.jsx)(ee.EY,{color:"primary",children:t})," not found"]}),(0,l.jsx)(tv.h,{y:4}),(0,l.jsx)(T.vx,{...n.projectPluginView({}),scroll:!1,children:"Go back"})]})},ll=X.qy.div(n6()),la=X.qy.div(n8()),ls=(0,X.DR)(eb.z)(e=>["absolute top-0 flex items-center","left"===e.position?"left-0":"right-0"]),lr=X.qy.div(n3()),li=(0,X.DR)(eb.z)(n7()),lo=X.qy.div(n9()),lc=()=>{let e=(0,a.md)(z.mz),[{viewState:t}]=nu();if(!e)return(0,l.jsx)(ts.e,{});let n=(0,l.jsx)(n$,{});return"create-table"===t?n=(0,l.jsx)(nq,{}):"table"===t&&(n=(0,l.jsx)(le,{})),(0,l.jsx)(eb.T,{className:"flex-grow",children:n})},ld=()=>{let[{projectId:e,pluginId:t,environmentId:n,logsEnabled:a}]=nu();return null==t?null:(0,l.jsx)(tz,{projectId:e,pluginId:t,environmentId:n,logsEnabled:a})},lu=()=>{let[{projectId:e},{resetData:t}]=nu(),n=(0,a.md)(I.Zy),s=(0,a.md)(e1);return null==n||null==s?(0,l.jsx)(ec.m6,{}):(0,l.jsx)(tQ,{projectId:e,plugin:s,environment:n,resetData:t})},lm=e=>{let{view:t}=e;return(0,l.jsx)(l.Fragment,{children:"connect"===t?(0,l.jsx)(nm,{}):"data"===t?(0,l.jsx)(lc,{}):"settings"===t?(0,l.jsx)(lu,{}):"query"===t?(0,l.jsx)(nn,{}):"logs"===t?(0,l.jsx)(ld,{}):null})};var lx=n(69992);let lh=(0,i.createContext)([{},{}]),lp=e=>{var t,n,a;let{envs:s,project:r,pluginId:o,serviceId:d,environment:u,children:m,failedToConnect:x,loadingComponent:h,logsEnabled:p}=e,{graphqlClient:g}=(0,R.q)(),v=(0,c.jE)(),j=r.id,y=u.id,{isConfirmed:f}=(0,E.S)(),[b,N]=(0,i.useState)({}),[I,k]=(0,i.useState)(null),[C,S]=(0,ei.b)(),[T,D]=(0,i.useState)(!1),{keys:A,keysQuery:L,setKeys:M,invalidateKeys:P}=((e,t,n,l)=>{let{graphqlClient:a}=(0,R.q)(),{result:s,queryKey:r,setQuery:o,invalidateQuery:c}=(0,er.W)(["redis","keys",e,n,l],async()=>(await a.getRedisKeys({pluginId:n,serviceId:l,environmentId:e})).redisKeys,{enabled:t,retry:!0,refetchInterval:8e3});return(0,i.useEffect)(()=>{if(null==s.data)return;let e=setInterval(()=>{var e;o((null!=(e=s.data)?e:[]).map(e=>({...e,ttl:null==e.ttl||e.ttl<=0?e.ttl:e.ttl-1})))},1e3);return()=>clearInterval(e)},[s.data]),(0,i.useEffect)(()=>{null!=s.data&&s.data.filter(e=>0===e.ttl).length>0&&c()},[s.data]),{keys:s,keysQuery:r,setKeys:o,invalidateKeys:c}})(y,null!=s,o,d);(0,w.bU)(()=>({text:"Generate dummy data",value:"generateRedisDummyData",category:"Redis",icon:$.KqI,isAvailable:()=>null!=A.data&&0===A.data.length,action:async()=>{try{await q.generateDummyData()}catch(e){tu.A.log("Error generating redis dummy data",e)}}}),[A.data]);let z=(0,i.useMemo)(()=>{var e;if(T)return null;let t=null==(e=A.data)?void 0:e.find(e=>e.name===I);return null!=I&&null!=t?t:null},[T,I,A]),O=e=>["redis","data",e,j,y,o,d],{result:U}=(0,er.W)(O(null!=(n=null==z?void 0:z.name)?n:null),async()=>{if(null==z)throw Error("No selected key");return(await g.getRedisData({key:z.name,pluginId:o,serviceId:d,environmentId:y})).redisGetKey},{enabled:null!=z,refetchInterval:8e3}),{resetPluginEnvs:F}=tr({projectId:j,environmentId:y,pluginId:o}),V={projectId:j,environmentId:y,pluginId:o,logsEnabled:p,envs:s,keys:A,selectedKey:z,keyData:U,error:C,isAdding:(null!=(a=null==(t=A.data)?void 0:t.length)?a:0)===0||T,keyState:b},B=(0,i.useMemo)(()=>({projectId:j,environmentId:y,pluginId:o,serviceId:d}),[j,y,o,d]),_=async(e,t)=>{let n=v.getQueryData(e);v.cancelQueries({queryKey:e});try{await t()}catch(t){v.setQueryData(e,n),S(t.message)}finally{v.invalidateQueries({queryKey:e})}},q=(0,i.useMemo)(()=>({setSelectedKey:e=>{var t;k(null!=(t=null==e?void 0:e.name)?t:null),D(!1),N({})},setIsAddingKey:e=>{k(null),D(e)},setKeyExpire:async(e,t)=>_(L,async()=>{var n;M((null!=(n=A.data)?n:[]).map(n=>n.name===e?{...n,ttl:t}:n)),await g.setRedisExpire({...B,key:e,ttl:t})}),deleteKey:async e=>_(L,async()=>{var t;M((null!=(t=A.data)?t:[]).filter(t=>t.name!==e)),k(null),await g.deleteRedisKey({...B,key:e})}),setString:async(e,t)=>{v.setQueryData(O(e),t),await g.setRedisString({...B,key:e,value:t})},setListIndex:async(e,t,n)=>_(O(e),async()=>{var l;let a=null!=(l=v.getQueryData(O(e)))?l:[];v.setQueryData(O(e),a.map((e,l)=>l===t?n:e)),await g.setRedisListIndex({...B,key:e,index:t,value:n})}),pushList:async(e,t,n)=>_(O(e),async()=>{var l;let a=null!=(l=v.getQueryData(O(e)))?l:[];"left"===t?v.setQueryData(O(e),[...n,...a]):v.setQueryData(O(e),[...a,...n]),await g.pushRedisList({...B,key:e,side:t,values:n})}),popList:async(e,t)=>_(O(e),async()=>{var n;let l=null!=(n=v.getQueryData(O(e)))?n:[];"left"===t?v.setQueryData(O(e),l.slice(1)):v.setQueryData(O(e),l.slice(0,l.length-1)),await g.popRedisList({...B,key:e,side:t})}),setAdd:async(e,t)=>_(O(e),async()=>{var n;let l=null!=(n=v.getQueryData(O(e)))?n:[];v.setQueryData(O(e),Array.from(new Set([...l,...t]))),await g.addRedisSet({...B,key:e,values:t})}),setRemove:async(e,t)=>_(O(e),async()=>{var n;let l=null!=(n=v.getQueryData(O(e)))?n:[];v.setQueryData(O(e),l.filter(e=>!t.includes(e))),await g.removeRedisSet({...B,key:e,values:t})}),hashSet:async(e,t)=>_(O(e),async()=>{let n=v.getQueryData(O(e));v.setQueryData(O(e),{...n,...t}),await g.setRedisHash({...B,key:e,values:t})}),hashDelete:async(e,t)=>_(O(e),async()=>{var n;let l=null!=(n=v.getQueryData(O(e)))?n:{};v.setQueryData(O(e),Object.keys(l).reduce((e,n)=>t.includes(n)?e:{...e,[n]:l[n]},{})),await g.deleteRedisHash({...B,key:e,values:t})}),addKey:(e,t)=>{var n;M([...null!=(n=A.data)?n:[],{name:e,type:t,ttl:-1}])},generateDummyData:async()=>{await f({confirmLabel:"Generate",title:"Generate Data",message:"Are you sure you want to generate dummy data within this database?",theme:"info"})&&(await g.generateRedisDummyData(B),P())},setKeyState:N,resetData:async()=>{await F({}),M([]),k(null)}}),[B,A]);return(0,l.jsx)(lh.Provider,{value:[V,q],children:(A.isError||A.failureCount>3)&&null!=x?(0,l.jsx)(l.Fragment,{children:x}):null==A.data&&A.isLoading&&h?(0,l.jsx)(l.Fragment,{children:h}):(0,l.jsx)(l.Fragment,{children:m})})},lg=()=>(0,i.useContext)(lh),lv=()=>{let e=(0,a.md)(x.T6),t=(0,a.md)(e1),n=(0,a.md)(z.DM),s=(0,a.md)(I.Zy),[{envs:r}]=lg();if(!n.Write)return(0,l.jsx)(ts.e,{});if(null==e||null==r||null==s||null==t)return(0,l.jsx)(ec.m6,{});let i=(0,lx.$)(r);return(0,l.jsxs)("section",{className:"pb-12",children:[(0,l.jsx)(tt,{}),(0,l.jsx)(ef.c,{className:"my-6"}),(0,l.jsx)(e9,{commandName:"redis-cli",rawCommand:i,secret:r.REDISPASSWORD,plugin:t}),(0,l.jsx)(ef.c,{className:"my-6"}),(0,l.jsx)(ta,{projectId:e.id,environmentId:s.id,plugin:t})]})};var lj=n(71267),ly=n(63344);let lf=e=>{var t,n;let{redisKey:a}=e,[s,r]=(0,i.useState)(!1),[o,c]=(0,i.useState)(null!=(n=null==(t=a.ttl)?void 0:t.toString())?n:"-1"),[,{setKeyExpire:d}]=lg(),u=(0,i.useMemo)(()=>/^-?\d+$/.test(o),[o]),m=(0,i.useCallback)(()=>{u&&(d(a.name,parseInt(o,10)),r(!1))},[o,u,a.name]),x=()=>{var e,t;c(null!=(t=null==(e=a.ttl)?void 0:e.toString())?t:"-1"),r(!0)};return(0,w.bU)(()=>({value:"redis-expire-key",text:"Set Item TTL",icon:$.zD7,group:"Redis",highlighted:!0,keybinding:"E",isAvailable:()=>!s,action:()=>x()}),[s,a.ttl]),(0,l.jsx)("div",{className:"h-8",children:s?(0,l.jsx)(lj.n1,{autoFocus:!0,contain:!0,children:(0,l.jsx)(tx.lV,{enableBindings:!0,onSubmit:m,onCancel:()=>r(!1),name:"Expire Redis Key",children:(0,l.jsxs)(eb.z,{align:"center",space:1,children:[(0,l.jsx)(th.pd,{placeholder:"seconds",label:{text:"Expire Seconds",hidden:!0},value:o,onChange:e=>c(e.target.value),error:!u,style:{maxWidth:100},className:"px-1 h-8"}),(0,l.jsx)(T.K0,{icon:$.X,onClick:()=>r(!1),title:"Cancel",type:"button"}),(0,l.jsx)(T.K0,{icon:$.Jlk,onClick:()=>m(),title:"Submit",type:"submit"})]})})}):(0,l.jsx)(T.z9,{variant:"small",onClick:()=>x(),children:(0,l.jsx)(ee.ae,{children:null!=a.ttl&&a.ttl>=0?(0,l.jsxs)(l.Fragment,{children:[a.ttl,"s"]}):"no expiry"})})})};var lb=n(28592);let lw=e=>{let{redisKey:t}=e,[,{deleteKey:n}]=lg(),{isConfirmed:a}=(0,E.S)(),[s,r]=(0,lb.T)(),i=async()=>{await a({confirmLabel:"Delete",message:"Are you sure you want to delete this key?",title:"Delete key"})&&n(t.name)};return(0,l.jsxs)("div",{className:"flex justify-between p-2 mt-auto",children:[(0,l.jsx)(T.z9,{variant:"small",onClick:()=>r(t.name),className:"text-gray-600",children:s?"copied":"copy key"}),(0,l.jsx)(T.z9,{variant:"small",onClick:()=>i(),className:"text-gray-600",children:"delete key"})]})},lN=e=>{let{value:t,onSave:n}=e,[a,s]=(0,i.useState)(t),r=(0,i.useMemo)(()=>t!==a,[t,a]),o=()=>n(a),c=()=>{s(t)};return(0,i.useEffect)(()=>{let e=(0,b.Ay)(window,{"$mod+Enter":o,Escape:c});return()=>e()},[t,a]),(0,l.jsxs)(eb.T,{space:2,className:"h-full px-2 flex-grow",children:[(0,l.jsx)(ly.T,{className:"string-editor",label:{text:"Value",hidden:!0},value:a,onChange:e=>s(e.target.value)}),r&&(0,l.jsxs)(eb.z,{justify:"end",children:[(0,l.jsx)(T.$n,{variant:"primary",color:"gray",onClick:c,size:"sm",children:"Revert"}),(0,l.jsx)(tv.h,{x:3}),(0,l.jsx)(T.$n,{onClick:()=>o(),size:"sm",children:"Save"})]})]})},lI=e=>{let{redisKey:t,data:n,selectedItem:a,isAddingItem:s}=e,[,{hashSet:r,hashDelete:i,setKeyState:o}]=lg();return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(tj.Zk,{title:t.name,panelActions:(0,l.jsx)(lf,{redisKey:t}),children:[(0,l.jsxs)(tj.N0,{selected:null!=s&&s,onClick:()=>o({isAddingItem:!0}),children:["add item ",(0,l.jsx)(Z.In,{icon:$.FWt})]}),(0,l.jsx)(tj.B8,{...tm(Object.keys(n)),children:e=>{let{index:t,style:r}=e,i=Object.keys(n).sort()[t];return(0,l.jsx)(tj.ck,{style:r,selected:!s&&null!=a&&a===i,onClick:()=>{o({selectedItem:i})},children:i})}}),(0,l.jsx)(lw,{redisKey:t})]}),s&&(0,l.jsx)(tj.Zk,{title:"add item",children:(0,l.jsx)(lk,{redisKey:t})}),!s&&null!=a&&null!=n[a]&&(0,l.jsxs)(tj.Zk,{title:a.toString(),panelActions:(0,l.jsx)(T.K0,{icon:$.TBR,title:"Delete",onClick:()=>(e=>{e===a&&o({}),i(t.name,[e])})(a.toString())}),children:[(0,l.jsx)(lN,{value:n[a],onSave:e=>r(t.name,{[a]:e})},"".concat(a,"-").concat(n[a])),(0,l.jsx)(tv.h,{y:3})]})]})},lk=e=>{let{redisKey:t}=e,[,{hashSet:n,setKeyState:a}]=lg(),[s,r]=(0,i.useState)(""),[o,c]=(0,i.useState)(""),d=(0,i.useMemo)(()=>""!==s.trim()&&""!==o.trim(),[s,o]),u=()=>{d&&(n(t.name,{[s]:o}),a({selectedItem:s}))};return(0,i.useEffect)(()=>{let e=(0,b.Ay)(window,{"$mod+Enter":u});return()=>e()},[s,o]),(0,l.jsx)(lj.n1,{autoFocus:!0,contain:!0,children:(0,l.jsx)(tx.lV,{onSubmit:u,name:"Redis Hash",children:(0,l.jsxs)(eb.T,{space:3,className:"px-2 pb-2",children:[(0,l.jsx)(tx.D0,{name:"name",label:"name",value:s,onChange:e=>r(e.target.value),placeholder:"name",autoFocus:!0}),(0,l.jsx)(tx.E8,{children:(0,l.jsx)(ly.T,{value:o,onChange:e=>c(e.target.value),label:"value",placeholder:"value"})}),(0,l.jsx)(T.$n,{disabled:!d,children:"Add"})]})})})},lC=e=>{let{redisKey:t,data:n,selectedItem:a,isAddingItem:s}=e,[,{setListIndex:r,setKeyState:o,popList:c}]=lg(),d=(0,i.useMemo)(()=>null!=a&&"number"==typeof a&&a>=0&&a<n.length?a:null,[a,n.length]);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(tj.Zk,{title:t.name,panelActions:(0,l.jsx)(lf,{redisKey:t}),children:[(0,l.jsxs)(tj.N0,{selected:null!=s&&s,onClick:()=>o({isAddingItem:!0}),children:["add item ",(0,l.jsx)(Z.In,{icon:$.FWt})]}),(0,l.jsx)(tj.B8,{...tm(n),children:e=>{let{index:t,style:a}=e,r=n[t];return(0,l.jsx)(tj.ck,{style:a,selected:!s&&d===t,onClick:()=>o({selectedItem:t}),children:(0,l.jsxs)(eb.z,{children:[(0,l.jsx)("div",{className:"min-w-5 text-gray-500 overflow-hidden overflow-ellipsis",children:t}),(0,l.jsx)(ee.EY,{children:r})]})})}}),(0,l.jsx)(lw,{redisKey:t})]}),s&&(0,l.jsx)(tj.Zk,{title:"add item",children:(0,l.jsx)(lS,{redisKey:t,numItems:n.length})}),!s&&null!=d&&(0,l.jsxs)(tj.Zk,{title:"item ".concat(d),panelActions:0===d?(0,l.jsx)(T.z9,{variant:"small",onClick:()=>c(t.name,"left"),children:"lpop"}):d===n.length-1?(0,l.jsx)(T.z9,{variant:"small",onClick:()=>{c(t.name,"right"),o({selectedItem:n.length-2})},children:"rpop"}):null,children:[(0,l.jsx)(lN,{value:n[d],onSave:e=>r(t.name,d,e)},"".concat(d,"-").concat(n[d])),(0,l.jsx)(tv.h,{y:3})]})]})},lS=e=>{let{redisKey:t,numItems:n}=e,[,{pushList:a,setKeyState:s}]=lg(),[r,o]=(0,i.useState)("left"),[c,d]=(0,i.useState)(""),u=(0,i.useMemo)(()=>""!==r.trim()&&""!==c.trim(),[r,c]),m=()=>{u&&(a(t.name,r,[c]),s({selectedItem:"left"===r?0:n}))};return(0,i.useEffect)(()=>{let e=(0,b.Ay)(window,{"$mod+Enter":m});return()=>e()},[t.name,c]),(0,l.jsx)(lj.n1,{autoFocus:!0,contain:!0,children:(0,l.jsx)(tx.lV,{onSubmit:m,name:"Redis List",children:(0,l.jsxs)(eb.T,{space:3,className:"px-2 pb-2",children:[(0,l.jsx)(tg.l,{value:r,onChange:e=>o(e),label:{text:"Type",hidden:!0},options:[{value:"left",text:"push left"},{value:"right",text:"push right"}]}),(0,l.jsx)(tx.E8,{children:(0,l.jsx)(ly.T,{value:c,label:"Value",onChange:e=>d(e.target.value),placeholder:"value"})}),(0,l.jsx)(T.$n,{disabled:!u,children:"Add"})]})})})},lT=e=>{let{redisKey:t,data:n,selectedItem:a,isAddingItem:s}=e,[,{setAdd:r,setRemove:i,setKeyState:o}]=lg();return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(tj.Zk,{title:t.name,panelActions:(0,l.jsx)(lf,{redisKey:t}),children:[(0,l.jsxs)(tj.N0,{selected:null!=s&&s,onClick:()=>o({isAddingItem:!0}),children:["add item ",(0,l.jsx)(Z.In,{icon:$.FWt})]}),(0,l.jsx)(tj.B8,{...tm(n),children:e=>{let{index:t,style:r}=e,i=n.sort()[t];return(0,l.jsx)(tj.ck,{style:r,selected:!s&&null!=a&&a===i,onClick:()=>o({selectedItem:i}),children:i})}}),(0,l.jsx)(lw,{redisKey:t})]}),s&&(0,l.jsx)(tj.Zk,{title:"add item",children:(0,l.jsx)(lD,{redisKey:t})}),!s&&null!=a&&(0,l.jsxs)(tj.Zk,{title:a.toString(),panelActions:(0,l.jsx)(T.K0,{icon:$.TBR,title:"Delete",onClick:()=>{i(t.name,[a.toString()]),o({})}}),children:[(0,l.jsx)(lN,{value:a.toString(),onSave:e=>((e,n)=>{i(t.name,[e]),r(t.name,[n]),o({selectedItem:n})})(a.toString(),e)},"".concat(a,"-").concat(n[a])),(0,l.jsx)(tv.h,{y:3})]})]})},lD=e=>{let{redisKey:t}=e,[,{setAdd:n,setKeyState:a}]=lg(),[s,r]=(0,i.useState)(""),o=(0,i.useMemo)(()=>""!==s.trim(),[s]),c=()=>{o&&(n(t.name,[s]),a({selectedItem:s}))};return(0,i.useEffect)(()=>{let e=(0,b.Ay)(window,{"$mod+Enter":c});return()=>e()},[t.name,s]),(0,l.jsx)(lj.n1,{autoFocus:!0,contain:!0,children:(0,l.jsx)(tx.lV,{onSubmit:c,name:"Redis Set",children:(0,l.jsxs)(eb.T,{space:3,className:"px-2 pb-2",children:[(0,l.jsx)(tx.E8,{children:(0,l.jsx)(ly.T,{value:s,label:"value",onChange:e=>r(e.target.value),placeholder:"value"})}),(0,l.jsx)(T.$n,{disabled:!o,children:"Add"})]})})})},lA=e=>{let{redisKey:t,data:n}=e,[,{setString:a}]=lg();return(0,l.jsxs)(tj.Zk,{title:t.name,panelActions:(0,l.jsx)(lf,{redisKey:t}),children:[(0,l.jsx)(lN,{value:n,onSave:e=>a(t.name,e)},"".concat(t.name,"-").concat(n)),(0,l.jsx)(lw,{redisKey:t})]})},lE=()=>{let[{keyState:e,keys:t,selectedKey:n,keyData:s,error:r,isAdding:o},c]=lg(),d=(0,a.md)(z.mz);(()=>{let[{keyState:e,keys:t,selectedKey:n,keyData:l,isAdding:a},s]=lg(),{isConfirmed:r}=(0,E.S)(),o=(0,i.useCallback)(()=>{var e,t;return(null==(e=document.activeElement)?void 0:e.nodeName)==="TEXTAREA"||(null==(t=document.activeElement)?void 0:t.nodeName)==="INPUT"},[]),c=(0,i.useCallback)(()=>{if(null==n||null==l.data||(null==e?void 0:e.selectedItem)==null||"string"===n.type);else if("list"===n.type)return e.selectedItem;else if("hash"===n.type)return Object.keys(l.data).sort().findIndex(t=>t===e.selectedItem);else if("set"===n.type)return l.data.findIndex(t=>t===e.selectedItem);return -1},[n,l.data,e]),d=(0,i.useCallback)(e=>{if(null==n||null==l.data)return;let t="list"===n.type?Math.max(0,Math.min(l.data.length-1,e)):"hash"===n.type?Object.keys(l.data).sort()[Math.max(0,Math.min(Object.keys(l.data).length-1,e))]:"set"===n.type?l.data.sort()[Math.max(0,Math.min(l.data.length-1,e))]:null;s.setKeyState({selectedItem:t})},[n,l.data,s]);(0,w.bU)(()=>({value:"redis-add-key",text:"Add Item",group:"Redis",icon:$.FWt,keybinding:"C",highlighted:!0,isAvailable:()=>!o(),action:()=>{(null==e?void 0:e.selectedItem)!=null&&(null==n?void 0:n.type)!=="string"?s.setKeyState({...e,isAddingItem:!0}):s.setIsAddingKey(!0)}}),[e,n,o]),(0,w.bU)(()=>({value:"redis-delete-item",text:"Delete Item",icon:$.TBR,group:"Redis",highlighted:!0,keybinding:"D",isAvailable:()=>!o()&&null!=n,action:async()=>{null!=n&&((null==e?void 0:e.selectedItem)==null?await r({confirmLabel:"Delete",title:"Delete Key",message:"Are you sure you want to delete this Redis key?"})&&s.deleteKey(n.name):null!=l.data&&("hash"===n.type?(s.hashDelete(n.name,[e.selectedItem]),1===Object.keys(l.data).length?s.setKeyState({}):d(0)):"list"===n.type?(0===e.selectedItem?s.popList(n.name,"left"):e.selectedItem===l.data.length-1&&(s.popList(n.name,"right"),d(l.data.length-2)),1===l.data.length&&s.setKeyState({})):"set"===n.type&&(s.setRemove(n.name,[e.selectedItem]),1===l.data.length?s.setKeyState({}):d(0))))}}),[e,n,l.data]),(0,i.useEffect)(()=>{let l=(null==e?void 0:e.isAddingItem)!=null||(null==e?void 0:e.selectedItem)!=null,r=()=>{var e;return null==n?-1:(null!=(e=t.data)?e:[]).findIndex(e=>e.name===n.name)},i=()=>{var e;return null==(e=document.querySelector(".string-editor"))?void 0:e.focus()},u=()=>{var e;return null==(e=document.querySelector(".string-editor"))?void 0:e.blur()},m=(0,b.Ay)(window,{ArrowDown:a=>{if(!o()){if(a.preventDefault(),null==n&&null!=t.data)s.setSelectedKey(t.data[0]);else if(l)d(c()+1);else if(null!=t.data&&(null==e?void 0:e.selectedItem)==null){let e=Math.min(t.data.length-1,r()+1);s.setSelectedKey(t.data[e])}}},ArrowUp:n=>{if(!o()){if(n.preventDefault(),l)d(c()-1);else if(null!=t.data&&(null==e?void 0:e.selectedItem)==null){let e=Math.max(0,r()-1);s.setSelectedKey(t.data[e])}}},ArrowRight:t=>{o()||(t.preventDefault(),(null==n?void 0:n.type)==="string"?i():(null==e?void 0:e.selectedItem)==null?d(0):i())},ArrowLeft:t=>{o()||(null==e?void 0:e.selectedItem)!=null&&(t.preventDefault(),s.setKeyState({}))},Escape:()=>{u(),a?s.setIsAddingKey(!1):(null==e?void 0:e.isAddingItem)&&s.setKeyState({...e,isAddingItem:!1})},"$mod+Enter":()=>{u()}});return()=>m()},[t,e,l,n,a])})();let u=(0,i.useMemo)(()=>(null==e?void 0:e.isAddingItem)?["add item"]:(null==e?void 0:e.selectedItem)!=null?[e.selectedItem.toString()]:[],[e]),m=(0,i.useMemo)(()=>["\uD83C\uDFE0",o?"add key":null,null==n?void 0:n.name,...u].filter(e=>null!=e),[n,s,o,u]);return d?null==t.data?(0,l.jsx)(ec.m6,{}):(0,l.jsxs)("div",{className:"flex-grow",children:[null!=r&&(0,l.jsx)(ee.yn,{children:r}),(0,l.jsxs)(tj.Kf,{path:m,pathClickable:!0,onClickPath:(e,t)=>{0===t?c.setSelectedKey(null):1===t&&c.setKeyState({})},children:[(0,l.jsxs)(tj.Zk,{title:"keys",children:[(0,l.jsxs)(tj.N0,{onClick:()=>c.setIsAddingKey(!0),selected:o,children:["add key ",(0,l.jsx)(Z.In,{icon:$.FWt})]}),(0,l.jsx)(tj.B8,{...tm(t.data),children:e=>{let{index:a,style:s}=e,r=t.data[a];return(0,l.jsx)(tj.ck,{style:s,selected:null!=n&&n.name===r.name,onClick:()=>c.setSelectedKey(r),children:(0,l.jsx)(lM,{...r})})}})]}),o&&(0,l.jsx)(lR,{}),null!=n&&(0,l.jsx)(lL,{redisKey:n,data:s.data})]})]}):(0,l.jsx)(ts.e,{})},lR=()=>{let[,{setString:e,setAdd:t,pushList:n,hashSet:a,setSelectedKey:s,addKey:r}]=lg(),[o,c]=(0,i.useState)("string"),[d,u]=(0,i.useState)(""),m=async()=>{if(""===d.trim())return;let l={string:()=>e(d,"hello world"),set:()=>t(d,["item"]),list:()=>n(d,"left",["item"]),hash:()=>a(d,{hello:"world"})}[o];null!=l&&(l(),s({name:d,type:o}),r(d,o))};return(0,i.useEffect)(()=>{let e=(0,b.Ay)(window,{"$mod+Enter":m});return()=>e()},[d,o]),(0,l.jsx)(tj.Zk,{title:"add key",children:(0,l.jsx)(eb.T,{className:"p-2",children:(0,l.jsx)(lj.n1,{contain:!0,children:(0,l.jsxs)(tx.lV,{onSubmit:m,name:"Add Redis Key",children:[(0,l.jsxs)(eb.z,{space:2,children:[(0,l.jsx)(th.pd,{label:"Name",value:d,name:"name",onChange:e=>u(e.target.value),placeholder:"users"}),(0,l.jsx)(tg.l,{value:o,name:"type",label:"Type",onChange:c,options:[{value:"string",text:"string"},{value:"list",text:"list"},{value:"set",text:"set"},{value:"hash",text:"hash"}]})]}),(0,l.jsx)(tv.h,{y:3}),(0,l.jsx)(T.$n,{disabled:""===d.trim(),className:"w-full",children:"Add Key"})]})})})})},lL=e=>{let{redisKey:t,data:n}=e,[{keyState:a}]=lg();return null==n?(0,l.jsx)(tj.Zk,{title:t.name,children:(0,l.jsx)(ec.m6,{})},t.name):(0,l.jsx)(l.Fragment,{children:"string"===t.type?(0,l.jsx)(lA,{redisKey:t,data:n}):"list"===t.type?(0,l.jsx)(lC,{redisKey:t,data:n,...a}):"set"===t.type?(0,l.jsx)(lT,{redisKey:t,data:n,...a}):"hash"===t.type?(0,l.jsx)(lI,{redisKey:t,data:n,...a}):(0,l.jsx)(eb.T,{align:"center",className:"p-4",children:(0,l.jsx)(ee.yn,{children:"This key type is not supported yet :("})})})},lM=e=>{let{...t}=e,{name:n,type:a,ttl:s}=t;return(0,l.jsxs)("div",{className:"flex items-center justify-between max-w-full min-w-0",children:[(0,l.jsx)("div",{className:"bg-blue-600 text-white rounded-sm min-w-10 text-xs text-center leading-5",children:a}),(0,l.jsx)(tv.h,{x:3}),(0,l.jsx)("div",{className:"flex-grow overflow-hidden overflow-ellipsis whitespace-nowrap",children:n}),null!=s&&-1!==s&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(tv.h,{x:3}),(0,l.jsxs)("div",{className:"text-gray-500 text-xs",children:[s,"s"]})," "]})]})},lP=()=>{let[{projectId:e,pluginId:t,environmentId:n,logsEnabled:a}]=lg();return null==t?null:(0,l.jsx)(tz,{logsEnabled:a,projectId:e,pluginId:t,environmentId:n})},lz=()=>{let[{projectId:e},{resetData:t}]=lg(),n=(0,a.md)(I.Zy),s=(0,a.md)(e1);return null==n||null==s?(0,l.jsx)(ec.m6,{}):(0,l.jsx)(tQ,{projectId:e,plugin:s,environment:n,resetData:t})},lO=e=>{let{view:t}=e;return"connect"===t?(0,l.jsx)(lv,{}):"settings"===t?(0,l.jsx)(lz,{}):"logs"===t?(0,l.jsx)(lP,{}):(0,l.jsx)(lE,{})};var lU=n(24685);let lF={1:"boolean (tinyint)",3:"integer (mediumint)",5:"float",7:"timestamp",8:"integer (bigint)",10:"date",12:"datetime",245:"json",252:"blob",253:"varstring",254:"string"},lV=e=>"json"===lF[e],lB=(e,t)=>null==e?"":"date"===t[t]?ea()(e).format("YYYY-MM-DD"):"timestamp"===t[t]?ea()(e).format("YYYY-MM-DD HH:mm:ss"):"datetime"===lF[t]?ea()(e).format("YYYY-MM-DD HH:mm:ss"):lV(t)?JSON.stringify(e):e.toString(),l_=e=>(0,l.jsx)(ne,{...e,databaseType:"mysql",formatValue:lB,isJsonColumnType:lV,columnTypeLookup:lF}),lq=()=>nt(),lW=()=>{let e=(0,a.md)(x.T6),t=(0,a.md)(z.mz),n=(0,a.md)(I.Zy),s=(0,a.md)(e1),[{envs:r}]=lq();if(!t)return(0,l.jsx)(ts.e,{});if(null==e||null==r||null==s||null==n)return(0,l.jsx)(ec.m6,{});let i=(0,lU.U)(r);return(0,l.jsxs)("section",{className:"pb-12",children:[(0,l.jsx)(tt,{}),(0,l.jsx)(ef.c,{className:"my-6"}),(0,l.jsx)(e9,{commandName:"mysql",rawCommand:i,secret:r.MYSQLPASSWORD,plugin:s}),(0,l.jsx)(ef.c,{className:"my-6"}),(0,l.jsx)(ta,{projectId:e.id,environmentId:n.id,plugin:s})]})},lK=()=>{let e=(0,a.md)(z.mz),[{viewState:t}]=lq();if(!e)return(0,l.jsx)(ts.e,{});let n=(0,l.jsx)(n$,{});return"create-table"===t?n=(0,l.jsx)(nq,{}):"table"===t&&(n=(0,l.jsx)(le,{})),(0,l.jsx)(eb.T,{className:"flex-grow",children:n})},lY=()=>{let[{projectId:e,pluginId:t,environmentId:n,logsEnabled:a}]=lq();return null==t?null:(0,l.jsx)(tz,{projectId:e,pluginId:t,environmentId:n,logsEnabled:a})},lQ=()=>{let[{projectId:e},{resetData:t}]=lq(),n=(0,a.md)(I.Zy),s=(0,a.md)(e1);return null==n||null==s?(0,l.jsx)(ec.m6,{}):(0,l.jsx)(tQ,{projectId:e,plugin:s,environment:n,resetData:t})},l$=e=>{let{view:t}=e;return"settings"===t?(0,l.jsx)(lQ,{}):"connect"===t?(0,l.jsx)(lW,{}):"data"===t?(0,l.jsx)(lK,{}):"query"===t?(0,l.jsx)(nn,{}):"logs"===t?(0,l.jsx)(lY,{}):null},lG={postgresql:e=>{var t,n,s;let r=(0,a.md)(x.T6),i=(0,a.md)(e1),o=(0,a.md)(I.Zy),c=(0,a.md)(z.mz),{variables:d}=(0,eH.U7)({projectId:null!=(t=null==r?void 0:r.id)?t:null,environmentId:null!=(n=null==o?void 0:o.id)?n:null,pluginId:null!=(s=null==i?void 0:i.id)?s:null,enabled:c});return null==r||null==i||null==o?(0,l.jsx)(ec.m6,{}):(0,l.jsx)(nd,{project:r,environment:o,pluginId:i.id,logsEnabled:i.logsEnabled,envs:null!=d?d:null,children:(0,l.jsx)(lm,{...e})})},mongodb:e=>{var t,n,s;let r=(0,a.md)(x.T6),i=(0,a.md)(e1),o=(0,a.md)(z.DM),c=(0,a.md)(I.Zy),{variables:d}=(0,eH.U7)({projectId:null!=(t=null==r?void 0:r.id)?t:null,environmentId:null!=(n=null==c?void 0:c.id)?n:null,pluginId:null!=(s=null==i?void 0:i.id)?s:null,enabled:o.Write});return null==r||null==i||null==c?(0,l.jsx)(ec.m6,{}):(0,l.jsx)(to,{project:r,environment:c,pluginId:i.id,logsEnabled:i.logsEnabled,envs:null!=d?d:null,children:(0,l.jsx)(tG,{...e})})},mysql:e=>{var t,n,s;let r=(0,a.md)(x.T6),i=(0,a.md)(e1),o=(0,a.md)(I.Zy),c=(0,a.md)(z.mz),{variables:d}=(0,eH.U7)({projectId:null!=(t=null==r?void 0:r.id)?t:null,environmentId:null!=(n=null==o?void 0:o.id)?n:null,pluginId:null!=(s=null==i?void 0:i.id)?s:null,enabled:c});return null==r||null==i||null==o?(0,l.jsx)(ec.m6,{}):(0,l.jsx)(l_,{project:r,environment:o,pluginId:i.id,logsEnabled:i.logsEnabled,envs:null!=d?d:null,children:(0,l.jsx)(l$,{...e})})},redis:e=>{var t,n,s;let r=(0,a.md)(x.T6),i=(0,a.md)(e1),o=(0,a.md)(I.Zy),c=(0,a.md)(z.mz),{variables:d}=(0,eH.U7)({projectId:null!=(t=null==r?void 0:r.id)?t:null,environmentId:null!=(n=null==o?void 0:o.id)?n:null,pluginId:null!=(s=null==i?void 0:i.id)?s:null,enabled:c});return null==r||null==i||null==o?(0,l.jsx)(ec.m6,{}):(0,l.jsx)(lp,{project:r,environment:o,pluginId:i.id,logsEnabled:i.logsEnabled,envs:null!=d?d:null,children:(0,l.jsx)(lO,{...e})})}};n(70336);var lJ=n(95907);let lX=e=>{let{plugin:t,pluginId:n,environmentId:a,pluginStatus:s}=e;return(0,l.jsxs)(eb.T,{space:8,className:"pb-12",children:[(0,l.jsxs)(ee.EY,{children:[(0,l.jsx)("span",{children:"Status: "}),(0,l.jsx)("span",{className:"font-mono font-semibold",children:s})]}),(0,l.jsx)(lJ.$,{pluginId:n,environmentId:a})]})},lH=e=>{let{title:t,message:n,action:a,teamId:s,showUpgradeCta:r=!1,...i}=e,{routes:o}=(0,es.c)();return(0,l.jsx)(ed.l,{hideIcon:!0,variant:"warning",...i,children:(0,l.jsxs)(eb.T,{space:5,align:"center",className:"my-3 w-full",children:[(0,l.jsx)(Z.In,{icon:$.b7J,size:"2xl"}),(0,l.jsxs)(eb.T,{space:1,align:"center",children:[(0,l.jsx)(ee.Ct,{className:"text-center font-semibold text-balance",children:t}),(0,l.jsx)(ee.zb,{className:"text-center max-w-md text-balance",children:n})]}),null!=a?(0,l.jsx)(l.Fragment,{children:a}):r?(0,l.jsx)(T.vx,{size:"sm",...s?o.workspaceBilling({teamId:s}):o.workspaceUpgrade({}),className:"min-w-max",children:"Remove Limits"}):null]})})};var lZ=n(4766),l0=n(38478),l1=n(13786),l2=n(46251),l5=n(5745),l4=n(38814),l6=n(91035);let l8=e=>{let{project:t,environment:n,serviceId:s,pluginId:r}=e,o=(0,a.md)(l2.G),{routes:c}=(0,es.c)(),{limitOverride:d}=(0,l1.B)({projectId:t.id,environmentId:n.id,serviceId:null!=s?s:"",enabled:null!=s}),{result:m}=(0,l0.vJ)({environmentId:n.id,serviceId:s,pluginId:r}),x=(0,i.useMemo)(()=>null!=m.data,[m]),[h]=(0,l0.f$)(),[g]=(0,l0.Th)(),{allDeployments:v}=(0,p.z4)({projectId:t.id,environmentId:n.id,serviceId:s,disabled:null==s}),j=(0,i.useMemo)(()=>{var e,n,l;let a=(0,lZ.bytesToGigaBytes)(lZ.subscriptionPlanLimits[t.subscriptionType].containers.memoryBytes),s=lZ.subscriptionPlanLimits[t.subscriptionType].containers.cpu;if(null==(n=d.data)||null==(e=n.serviceInstanceLimitOverride)?void 0:e.containers){let e=d.data.serviceInstanceLimitOverride.containers,t=e.memoryBytes?(0,lZ.bytesToGigaBytes)(e.memoryBytes):a;return{cpuLimit:null!=(l=e.cpu)?l:s,memoryLimit:t}}if(null==o)return{cpuLimit:s,memoryLimit:a};let r=(0,lZ.bytesToGigaBytes)(o.containers.memoryBytes);return{cpuLimit:o.containers.cpu,memoryLimit:r}},[o,d.data,t]),y=(0,i.useMemo)(()=>{if(null==m.data)return null;let e=m.data.filter(e=>e.measurement===u.zc2.MemoryUsageGb).flatMap(e=>e.values).reduce((e,t)=>t.value>e?t.value:e,0),n=m.data.filter(e=>e.measurement===u.zc2.CpuUsage).flatMap(e=>e.values).reduce((e,t)=>t.value>e?t.value:e,0)>=.75*j.cpuLimit,l=e>=.75*j.memoryLimit;return n||l?{text:t.subscriptionType===u.dh$.Pro?"Need more? We can help!":t.subscriptionType===u.dh$.Hobby?"Upgrade to get up to ".concat(lZ.subscriptionPlanLimits.pro.containers.cpuDescription," and ").concat(lZ.subscriptionPlanLimits.pro.containers.memoryDescription):"Upgrade to get up to ".concat(lZ.subscriptionPlanLimits.hobby.containers.cpuDescription," and ").concat(lZ.subscriptionPlanLimits.hobby.containers.memoryDescription),link:t.subscriptionType===u.dh$.Pro?c.demo({}).url:t.subscriptionType===u.dh$.Hobby?c.workspacePlan({}).url:c.workspaceUpgrade({}).url}:null},[m.data,j]);return(0,l.jsxs)(eb.T,{className:"pb-12 h-full",children:[null!=o&&null!=y&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(eb.z,{align:"center",justify:"between",children:[(0,l.jsxs)(ee.xC,{children:["Your plan includes"," ",(0,l.jsx)("strong",{children:o.containers.cpuDescription})," and"," ",(0,l.jsx)("strong",{children:o.containers.memoryDescription})," of memory."]}),(0,l.jsxs)(eu.N,{variant:"coloured",href:y.link,className:"flex items-center space-x-2",children:[(0,l.jsx)(Z.In,{icon:$.tXn,className:"h-4 w-4"}),(0,l.jsx)(ee.ax,{children:y.text})]})]}),(0,l.jsx)(ef.c,{className:"my-6"})]}),(0,l.jsxs)(eb.T,{space:8,children:[(m.isLoading||x)&&(0,l.jsx)(l5.m,{}),null!=m.error?(0,l.jsx)(ee.yn,{children:m.error.message}):null==m.data?(0,l.jsx)(l4.t,{}):0===m.data.length?(0,l.jsxs)(eb.T,{space:1,justify:"center",className:"text-center py-14 rounded-lg border border-dashed border-gray-200",children:[(0,l.jsx)(ee.xC,{className:"leading-6 font-semibold",children:"No service metrics in this environment"}),(0,l.jsx)(ee.xC,{className:"leading-5 text-gray-500 max-w-lg mx-auto",children:"Create a deployment and then come back here"})]}):(0,l.jsx)(l6.FB,{resourceId:s,limits:{cpu:j.cpuLimit,memory:j.memoryLimit},gridType:g,timeRange:h,metrics:m.data,deployments:null!=s?v:null})]})]})},l3=()=>{var e;let t=(0,a.md)(x.T6),n=(0,a.md)(I.Zy),s=(0,a.md)(e1),r=(0,a.md)(e5),o=(0,a.md)(e2),c=null==s?void 0:s.status,[{user:d}]=(0,ev.Jd)(),{pluginId:m,routes:h}=(0,es.c)(),p=null!=o?lG[o.value]:null,g=(0,eX.tF)();(0,eQ.pO)(g);let v=(0,i.useMemo)(()=>{var e;if(null!=c&&(c===u.u8T.Stopped||c===u.u8T.Locked||c===u.u8T.Deprecated))return[...(null==d?void 0:d.isAdmin)?[{text:"Admin",link:h.projectPluginView({view:"admin"}),active:(null==r?void 0:r.toLowerCase())==="admin"}]:[]];let t=(null!=(e=null==o?void 0:o.views)?e:[]).map(e=>({text:e,link:h.projectPluginView({view:e}),active:(null==r?void 0:r.toLowerCase())===e.toLowerCase()}));return t.splice(t.length-1,0,{text:"Metrics",active:(null==r?void 0:r.toLocaleLowerCase())==="metrics",link:h.projectPluginView({view:"Metrics"})}),(null==d?void 0:d.isAdmin)&&t.push({text:"Admin",link:h.projectPluginView({view:"admin"}),active:(null==r?void 0:r.toLowerCase())==="admin"}),t},[r,c,null==d?void 0:d.isAdmin]);return null==t||null==n||null==s||null==n||null==o||null==o?null:(0,l.jsx)(eJ.lD,{title:s.name,icon:null==o?void 0:o.icon,tabs:(null==d?void 0:d.isAdmin)||c!==u.u8T.Stopped&&c!==u.u8T.Locked?v:[],children:null==o?(0,l.jsx)(ec.m6,{}):(0,l.jsx)(l.Fragment,{children:(null==r?void 0:r.toLowerCase())==="admin"?(0,l.jsx)(lX,{plugin:s,environmentId:n.id,pluginId:null!=m?m:"",pluginStatus:s.status}):(null==r?void 0:r.toLowerCase())==="metrics"?(0,l.jsx)(l8,{project:t,environment:n,pluginId:null!=m?m:void 0}):(0,l.jsx)(l.Fragment,{children:null!=p&&(0,l.jsx)(p,{view:null!=(e=null==r?void 0:r.toLowerCase())?e:null})})})})};var l7=n(7021),l9=n(58599),ae=n(56144),at=n(70578),an=n(21512),al=n(35645),aa=n(17546),as=n(24703),ar=n(68420),ai=n(32507),ao=n(55091),ac=n(40148);let ad=e=>{let{serviceNamesThatWillRedeploy:t,dateCommitted:n}=e,a=t.length;return(0,l.jsxs)("div",{className:(0,X.xW)("flex flex-col xs:flex-row gap-4 xs:items-center justify-between px-6 py-3 border-t border-black border-opacity-[8%] bg-gray-50",0===a&&"justify-end"),children:[a>0&&(0,l.jsxs)(eb.z,{space:4,className:"text-gray-500",children:[(0,l.jsx)(Z.In,{icon:$.RIJ}),t.length>4?(0,l.jsxs)(ee.ax,{children:[a," ",(0,ey.td)("service",a)," deployed"]}):(0,l.jsxs)(ee.ax,{children:[t.map((e,t)=>(0,l.jsxs)(i.Fragment,{children:[(0,l.jsx)("span",{className:"font-semibold",children:e}),t===a-1?"":", "]},e))," ","deployed"]})]}),(0,l.jsx)(ee.xC,{children:ea()(n).format("h:mm a - D MMM, YYYY")})]})},au=e=>{let{serviceNamesThatWillRedeploy:t,isApplying:n,requires2FA:a,commitChanges:s}=e,r=t.length;return(0,l.jsxs)("div",{className:(0,X.xW)("flex flex-col xs:flex-row gap-4 xs:items-center justify-between px-6 py-3 border-t border-black border-opacity-[8%] bg-gray-50",0===r&&"justify-end"),children:[r>0&&(0,l.jsxs)(eb.z,{space:4,className:"text-gray-500",children:[(0,l.jsx)(Z.In,{icon:$.RIJ}),t.length>4?(0,l.jsxs)(ee.ax,{children:[r," ",(0,ey.td)("service",r)," will redeploy"]}):(0,l.jsxs)(ee.ax,{children:[t.map((e,t)=>(0,l.jsxs)(i.Fragment,{children:[(0,l.jsx)("span",{className:"font-semibold",children:e}),t===r-1?"":", "]},e))," ","will redeploy"]})]}),(0,l.jsxs)(eb.z,{align:"center",space:4,children:[a&&(0,l.jsx)(ac.fM,{color:"yellow",children:"Requires 2FA"}),(0,l.jsx)(T.$n,{onClick:s,isLoading:n,name:"Deploy changes (modal)",icon:$.Jlk,children:"Deploy Changes"})]})]})},am={added:"text-green-700",removed:"text-red-700",updated:"text-blue-700"},ax={added:"text-green-500",removed:"text-red-500",updated:"text-blue-500"},ah={added:"bg-green-100",removed:"bg-red-100",updated:"bg-blue-100"},ap=e=>{let{change:t,onSetPathIgnored:n}=e,a=t.isDestructive?$.hcu:"added"===t.type?$.FWt:"removed"===t.type?$.TBR:$.ffu,s=t.path.includes("isSealed"),r=s?$.X_F:t.path.includes("sharedVariables")?$.qzq:t.path.includes("variables")?$.rTt:$.wB_;return(0,l.jsxs)("div",{className:(0,X.xW)("changed-value grid gap-y-1 gap-x-3 grid-cols-2 md:grid-cols-3",n&&"md:grid-cols-[minmax(0,1fr)_minmax(0,1fr)_minmax(0,1fr)_auto]"),children:[(0,l.jsxs)(ag,{text:t.displayName,className:(0,X.xW)("col-span-2 md:col-span-1","flex items-center gap-4",am[t.type]),children:[(0,l.jsx)(Z.In,{icon:a,size:"sm",className:ax[t.type]}),(0,l.jsxs)(eb.z,{space:2,align:"center",className:"overflow-hidden",children:[(0,l.jsx)(Z.In,{icon:r,size:"sm",className:ax[t.type]}),(0,l.jsx)(ee.EY,{className:"text-ellipsis overflow-hidden cursor-pointer","aria-label":"Copy change key",children:t.displayName}),t.additionalInfo&&(0,l.jsx)(ee.ae,{children:t.additionalInfo})]})]}),(0,l.jsx)(ag,{text:t.prevDisplayValue,className:"flex items-center bg-gray-100 px-3 py-2 rounded",children:(0,l.jsx)(ee.ax,{className:"font-mono line-clamp-2 text-ellipsis",children:t.prevDisplayValue})}),(0,l.jsx)(ag,{text:t.newDisplayValue,className:(0,X.xW)("flex items-center px-3 py-2 rounded min-h-[36px]",ah[t.type]),children:(0,l.jsx)(ee.ax,{className:(0,X.xW)("font-mono line-clamp-4 text-ellipsis break-all",s&&"py-1 px-2 bg-black/20 dark:bg-white/20 rounded"),children:s?(0,l.jsxs)(eb.z,{space:2,center:!0,children:[(0,l.jsx)(Z.In,{icon:$.X_F,size:"sm"}),(0,l.jsx)("span",{children:k.SECRET_VARIABLE_VALUE})]}):t.newDisplayValue})}),n&&(0,l.jsx)(eb.z,{center:!0,children:(0,l.jsx)(T.K0,{title:"Discard change",icon:$.X,className:"hidden md:flex",iconStyles:"text-gray-400",onClick:()=>n(t.path)})})]})},ag=e=>{let{text:t,className:n,children:a}=e,[s,r]=(0,lb.T)();return(0,l.jsxs)("button",{type:"button",title:t,className:(0,X.xW)("relative text-left outline-none",n),onClick:()=>{t&&r(t)},"aria-label":"Copy change key",children:[a,s&&(0,l.jsx)(Z.In,{icon:$.Jlk,size:"sm",className:"absolute right-2 top-[50%] translate-y-[-50%] text-green-500",initial:{x:0,y:"-100%"},animate:{x:0,y:"-50%"}})]})};var av=n(2092),aj=n(44153);let ay=e=>{var t;let{volumeId:n,volume:a,volumeName:s,changes:r,volumeInstanceConfig:i,isDefaultOpen:o,onSetPathIgnored:c}=e,d="volumes.".concat(n),u=i.isCreated,m=i.isDeleted,x=!1===i.isDeleted;return(0,l.jsx)(aI,{name:null!=(t=null!=s?s:null==a?void 0:a.name)?t:"<deleted volume>",icon:$.akk,isCreated:u,isDeleted:m,isRestored:x,isDefaultOpen:o,changes:r,discardAllChangesPath:d,onSetPathIgnored:c,volumeId:n})},af=e=>{var t,n;let{serviceId:a,service:s,savedName:r,serviceInstanceConfig:o,serviceInstancePatch:c,changes:d,isDefaultOpen:u,onSetPathIgnored:m}=e,{serviceName:x,serviceIcon:h}=(0,aj.W)(s,null==o?void 0:o.source),p=o.isCreated,g=o.isDeleted,v=(0,i.useMemo)(()=>{var e;let t=d.length,n=Object.keys(null!=(e=null==c?void 0:c.variables)?e:{}).length,l=t-!!p-n;return[...n>0?["".concat(n," ").concat((0,ey.td)("Variable",n))]:[],...l>0?["".concat(l," ").concat((0,ey.td)("Setting",l))]:[]]},[o]);return(0,l.jsx)(aI,{name:null!=(n=null!=(t=null!=x?x:null==s?void 0:s.name)?t:r)?n:"<deleted service>",icon:h,isCreated:p,isDeleted:g,isDefaultOpen:u,changes:d,summaryText:v,discardAllChangesPath:"services.".concat(a),onSetPathIgnored:m})},ab=e=>{let{changes:t,isDefaultOpen:n,onSetPathIgnored:a}=e;return(0,l.jsx)(aI,{name:"Shared Variables",icon:$.qzq,isDefaultOpen:n,changes:t,discardAllChangesPath:"sharedVariables",onSetPathIgnored:a})},aw=e=>{var t,n,s;let{open:r,onOpenChange:o,volumeInstanceId:d,name:u,environment:x}=e,h=(null!=(n=null==(t=(0,a.md)((0,m.z$)(x.id)))?void 0:t.data)?n:{})[d],{graphqlClient:p}=(0,R.q)(),[g,v]=(0,i.useState)(!1),{modalActions:j}=(0,P.U)(),{hideModal:y}=(0,L.h)(),f=(0,c.jE)(),b=async()=>{v(!0);try{await p.volumeInstanceCancelDeletion({volumeInstanceId:d});let e=(0,m.l4)({environmentId:x.id});f.setQueryData(e,e=>null==e?e:{...e,environment:{...e.environment,volumeInstances:{...e.environment.volumeInstances,[d]:{...e.environment.volumeInstances[d],isPendingDeletion:!1}}}}),j.createToast((0,l.jsx)(A.y8,{variant:"success",title:"Success",description:"Volume restored successfully"})),y(aC),o(!1)}catch(t){var e;j.createToast((0,l.jsx)(A.y8,{variant:"error",title:"Error",description:null!=(e=t.message)?e:"Failed to restore volume."}))}v(!1)};return(0,l.jsx)(D.a.Root,{open:r,onOpenChange:o,children:(0,l.jsxs)(eb.T,{className:"max-w-lg",space:4,children:[(0,l.jsx)(ee.Bv,{className:"font-semibold",children:"Restore volume"}),(0,l.jsxs)(ee.EY,{children:["Would you like to restore the deleted volume to the"," ",null!=(s=null==x?void 0:x.name)?s:"active"," environment?"]}),(0,l.jsxs)(eb.T,{space:2,children:[(0,l.jsx)(ee.xC,{children:"Volume that will be restored"}),(0,l.jsxs)(eb.z,{align:"center",justify:"between",className:"border border-neutral rounded-lg py-3 px-6",children:[(0,l.jsxs)(eb.z,{align:"center",space:2,children:[(0,l.jsx)(Z.In,{icon:$.akk,className:"text-gray-500"}),(0,l.jsx)(ee.EY,{className:"font-medium",children:u})]}),null!=h&&(0,l.jsxs)(ee.EY,{className:"text-gray-500",children:[h.toFixed(2)," MB"]})]})]}),(0,l.jsx)(ef.c,{}),(0,l.jsxs)(eb.z,{align:"center",justify:"end",space:2,children:[(0,l.jsx)(T.$n,{variant:"outline",onClick:()=>o(!1),disabled:g,children:"Cancel"}),(0,l.jsx)(T.$n,{variant:"primary",onClick:b,disabled:g,isLoading:g,children:"Restore"})]})]})})},aN=e=>{let{volumeId:t,name:n}=e,{showModal:s}=(0,L.h)(),r=(0,a.md)(I.Zy),i=(0,a.md)((0,ai.VS)(t));return(null==i?void 0:i.isPendingDeletion)&&null!=r?(0,l.jsx)(T.$n,{variant:"outline",size:"sm",onClick:()=>{s(aw,{name:n,volumeInstanceId:i.id,environment:r})},color:"gray",children:"Restore"}):null},aI=e=>{let{name:t,icon:n,isCreated:a,isDeleted:s,isRestored:r,isDefaultOpen:o,discardAllChangesPath:c,changes:d,summaryText:u,onSetPathIgnored:m,volumeId:x}=e,h=d.filter(e=>"Is Created"!==e.displayName&&"Is Deleted"!==e.displayName),p=!s&&h.length>0,g=null==m,v=null!=x;return(0,l.jsx)(av.bL,{type:"single",defaultValue:o?"open":"closed",collapsible:!s,...!p?{value:"closed"}:{},children:(0,l.jsxs)(av.q7,{value:"open",className:(0,X.xW)("rounded-xl border border-gray-100","focus-visible:ring-2 focus-visible:ring-pink-200",s&&"bg-red-50 border-red-100"),children:[(0,l.jsx)(av.Y9,{children:(0,l.jsxs)(av.l9,{className:(0,X.xW)("group px-4 py-4 grid items-center grid-cols-[minmax(0px,1fr)_auto] gap-2 w-full min-h-[66px]","focus:outline-none",!p&&"cursor-default"),children:[(0,l.jsxs)(eb.z,{align:"center",justify:"between",space:2,className:(0,X.xW)("overflow-hidden overflow-ellipsis"),children:[(0,l.jsxs)(eb.z,{align:"center",space:4,className:"max-w-full",children:[(0,l.jsx)(Z.In,{icon:s?$.F5Q:p?$.c_$:$.FWt,size:"sm",className:(0,X.xW)("text-gray-400 group-data-[state=open]:rotate-90 ease-[cubic-bezier(0.87,_0,_0.13,_1)] transition-transform duration-150",s&&"text-red-500")}),(0,l.jsx)(Z.In,{icon:n,size:"lg"}),(0,l.jsxs)(ee.EY,{className:(0,X.xW)("whitespace-nowrap overflow-hidden overflow-ellipsis",a?"text-green-600":s?"text-red-600":"text-blue-700"),children:[(0,l.jsx)("span",{className:"font-semibold",children:t})," ",a?(0,l.jsx)("span",{className:"hidden sm:inline",children:g?"was added":"will be added"}):s?(0,l.jsx)("span",{className:"hidden sm:inline",children:g?"was deleted":"will be deleted"}):r?(0,l.jsx)("span",{className:"hidden sm:inline",children:g?"was restored":"will be restored"}):(0,l.jsx)("span",{className:"hidden sm:inline",children:g?"was updated":"will be updated"})]})]}),v&&s&&(0,l.jsx)(aN,{volumeId:x,name:t})]}),(0,l.jsxs)(eb.z,{align:"center",space:6,children:[!s&&u&&(0,l.jsx)(ee.EY,{className:"text-gray-400",children:u.map((e,t)=>(0,l.jsxs)(i.Fragment,{children:[e,t<u.length-1&&(0,l.jsx)("span",{className:"mx-1",children:" \xb7 "})]},e))}),m&&c&&(0,l.jsx)(l.Fragment,{children:s?(0,l.jsxs)(T.$n,{variant:"outline",color:"gray",size:"sm",onClick:()=>m(c),children:["Keep ",v?"Volume":"Service"]}):(0,l.jsx)(T.$n,{variant:"outline",color:"gray",size:"sm",onClick:()=>m(c),children:"Discard"})})]})]})}),(0,l.jsxs)(av.UC,{className:"bg-black bg-opacity-[2%]",children:[h.length>0&&(0,l.jsxs)("header",{className:(0,X.xW)("hidden md:grid gap-y-1 gap-x-3  px-4 py-3 border-y border-gray-100 text-gray-400 font-medium",null!=m?"grid-cols-[1fr_1fr_1fr_34px]":"grid-cols-3"),children:[(0,l.jsx)(ee.tj,{className:"",children:"Change"}),(0,l.jsx)(ee.tj,{className:"",children:g?"Old Value":"Current Value"}),(0,l.jsx)(ee.tj,{className:"",children:"New Value"})]}),0===h.length?(0,l.jsx)(eb.T,{className:"flex items-center justify-center p-8 border border-gray-200 border-dashed rounded-lg flex-grow",children:(0,l.jsxs)(ee.I5,{className:"font-semibold flex gap-4",children:[(0,l.jsx)(ee.zT,{children:aa.Q.BEACH})," ",(0,l.jsx)("span",{children:"Empty configuration"}),(0,l.jsx)(ee.zT,{children:aa.Q.BEACH})]})}):(0,l.jsx)("div",{className:"grid gap-4 md:gap-1 px-4 py-3",children:h.map(e=>(0,l.jsx)(ap,{change:e,onSetPathIgnored:m},e.path))})]})]})})},ak=()=>(0,l.jsxs)("div",{className:"p-8 flex-grow",children:[(0,l.jsx)(eb.z,{align:"center",justify:"between",space:4,className:"pb-4",children:(0,l.jsxs)(eb.z,{align:"center",space:3,children:[(0,l.jsx)(Z.In,{icon:$.gqo,size:"lg"}),(0,l.jsx)(t4.g,{width:100,height:24})]})}),(0,l.jsxs)("div",{className:"grid gap-1 grid-cols-2 md:grid-cols-3",children:[(0,l.jsx)(t4.g,{width:"120px",height:25,className:"col-span-2 md:col-span-1"}),(0,l.jsx)(t4.g,{width:"100%",height:37}),(0,l.jsx)(t4.g,{width:"100%",height:37})]})]});function aC(e){var t;let{environmentId:n,commitChanges:s,dateCommitted:r,editableMessage:o,isLoading:c,message:d,onOpenChange:m,onSetPathIgnored:h,open:p,originalEnvironmentConfig:g,patch:v,patchMeta:j,patchStatus:y,user:f}=e,b=(0,a.md)(x.T6),{twoFactorStatus:w}=(0,ar.p)(),{serviceInstances:N}=(0,a.md)((0,ai.zC)(n)),I=(0,i.useMemo)(()=>(0,k.applyPatchToEnvironmentConfig)({patch:v,config:g}),[v,g]),{volumeServiceIdToNames:C,prettifiedPatch:S}=(0,i.useMemo)(()=>{var e,t;let n=null!=(t=null==b?void 0:b.services.reduce((e,t)=>({...e,[t.id]:t.name}),null!=(e=null==b?void 0:b.volumes.reduce((e,t)=>({...e,[t.id]:t.name}),{...null==j?void 0:j.serviceNames,...null==j?void 0:j.volumeNames}))?e:{}))?t:{},l=(0,k.getPrettifiedPatch)({patch:v,environmentConfig:null!=g?g:(0,k.emptySerializedEnvironment)(),volumeServiceIdToNames:n});return{volumeServiceIdToNames:n,prettifiedPatch:l}},[b,v,g]),T=(0,i.useMemo)(()=>(0,k.checkIfPatchRequiresTwoFactor)({environmentConfig:null!=g?g:(0,k.emptySerializedEnvironment)(),patch:v}),[v,j,g]),A=(0,i.useMemo)(()=>(0,k.getServicesThatRequireRedeploy)({patch:v,resolvedConfig:I}).filter(e=>{var t,n;let l=(0,U.Zd)({config:I,serviceId:e}),a=N.find(t=>t.serviceId===e),s=null==a?void 0:a.latestDeployment;return(null==l||null==(t=l.source)?void 0:t.repo)!=null||(null==l||null==(n=l.source)?void 0:n.image)!=null||null!=s}).map(e=>{var t,n;return null!=(n=null==b||null==(t=b.services.find(t=>t.id===e))?void 0:t.name)?n:""}),[v,I]),[E,R]=(0,i.useState)(d),L=()=>{s&&(s(E),m(!1))},M=(0,k.numChangesInEnvironmentConfig)(v),P=Object.keys(S.services).length,z=Object.keys(S.volumes).length,{sortedPrettifiedServices:O,sortedPrettifiedVolumes:F}=aS({prettifiedPatch:S,resolvedEnvironmentConfig:I});(0,as.Z)({"$mod+Enter":L},[E]);let V="".concat(M," ").concat((0,ey.td)("change",M)," ").concat(s?"to apply":"applied");return(0,l.jsx)(D.a.Root,{hasFullBleedContent:!0,open:p,onOpenChange:m,title:V,children:(0,l.jsxs)("div",{className:"flex flex-col p-0 h-[80vh] sm:w-[75vw] sm:h-[66vh] sm:max-w-[1024px] sm:max-h-[760px]",children:[(0,l.jsxs)("div",{className:"flex gap-4 items-center px-8 py-3 border-y border-black border-opacity-[8%] dark:border-white dark:border-opacity-[8%]",children:[null==f&&(null==j?void 0:j.createdByRailway)?(0,l.jsx)(ao.g,{className:"rounded-full"}):(0,l.jsx)(al.e,{...f,size:"sm"}),o?(0,l.jsx)(th.pd,{label:{text:"Commit message",hidden:!0},placeholder:"Commit message (optional)",className:"border-none",value:E,onChange:e=>R(e.target.value)}):(0,l.jsx)(ee.EY,{children:E||"".concat(M," ").concat((0,ey.td)("change",M))})]}),c?(0,l.jsx)(ak,{}):(0,l.jsx)("div",{className:"px-5 sm:px-8 py-6 overflow-y-auto flex flex-1 flex-col",children:0===M?(0,l.jsx)(eb.T,{className:"flex items-center justify-center p-8 border border-gray-200 border-dashed rounded-lg flex-grow",children:(0,l.jsxs)(ee.I5,{className:"font-semibold flex gap-4",children:[(0,l.jsx)(ee.zT,{children:aa.Q.BEACH})," ",(0,l.jsx)("span",{children:"Empty configuration"}),(0,l.jsx)(ee.zT,{children:aa.Q.BEACH})]})}):(0,l.jsxs)("div",{className:"flex flex-col gap-1 flex-grow",children:[O.map(e=>{var t,n,a,s;let[r,i]=e,o=null!=(n=null==b||null==(t=b.services)?void 0:t.find(e=>e.id===r))?n:null,c=null!=(a=(0,U.Zd)({config:I,serviceId:r}))?a:(0,k.emptySerializedServiceInstance)(),d=null!=(s=(0,U.Zd)({config:v,serviceId:r}))?s:(0,k.emptySerializedServiceInstance)();return(0,l.jsx)(af,{serviceId:r,service:o,savedName:C[r],changes:i,serviceInstanceConfig:c,serviceInstancePatch:d,onSetPathIgnored:h,isDefaultOpen:P+z<=2},r)}),F.map(e=>{var t,n,a,s;let[r,i]=e,o=null!=(n=null==b||null==(t=b.volumes)?void 0:t.find(e=>e.id===r))?n:null,c=null!=(a=(0,k.getVolumeFromEnvironmentConfig)(I,r))?a:(0,k.emptySerializedVolumeInstance)();return(0,l.jsx)(ay,{volumeId:r,volume:o,changes:i,volumeName:null!=(s=null==o?void 0:o.name)?s:C[r],volumeInstanceConfig:c,onSetPathIgnored:h,isDefaultOpen:P+z<=2},r)}),S.sharedVariables.length>0&&(0,l.jsx)(ab,{changes:S.sharedVariables,isDefaultOpen:Object.keys(S.services).length+Object.keys(S.volumes).length<=2,onSetPathIgnored:h}),null!=S.privateNetworkDisabled&&(0,l.jsx)("div",{className:"rounded-xl border border-gray-100 p-4",children:(0,l.jsx)(ap,{change:S.privateNetworkDisabled,onSetPathIgnored:h})})]})}),r?(0,l.jsx)(ad,{dateCommitted:r,serviceNamesThatWillRedeploy:A}):(0,l.jsx)(au,{isApplying:y===u.oSY.Applying,commitChanges:()=>{L()},serviceNamesThatWillRedeploy:A,requires2FA:null!=s&&(null==(t=w.data)?void 0:t.isEnabled)&&T})]})})}let aS=e=>{let{prettifiedPatch:t,resolvedEnvironmentConfig:n}=e;return(0,i.useMemo)(()=>({sortedPrettifiedVolumes:nY()(Object.entries(t.volumes),[e=>{var t;let[l]=e,a=null!=(t=(0,k.getVolumeFromEnvironmentConfig)(n,l))?t:(0,k.emptySerializedVolumeInstance)();return a.isCreated?0:a.isDeleted?2:1},e=>{let[t]=e;return t}]),sortedPrettifiedServices:nY()(Object.entries(t.services),[e=>{var t;let[l]=e,a=null!=(t=(0,U.Zd)({config:n,serviceId:l}))?t:(0,k.emptySerializedServiceInstance)();return a.isCreated?0:a.isDeleted?2:1},e=>{let[t]=e;return t}])}),[t.volumes,n])};var aT=n(36893);ea().extend(eh());let aD=(0,i.forwardRef)((e,t)=>{let{project:n,environment:a,isOpen:s,automatedMigrations:r,patchId:i,patchToPeek:o}=e,{showModal:c}=(0,L.h)(),d=e=>{var t,n,l,s,r;c(aC,{environmentId:a.id,originalEnvironmentConfig:e.previousEnvironmentConfig,patch:e.patch,patchStatus:u.oSY.Committed,message:null!=(t=e.message)?t:void 0,user:null!=(n=e.appliedBy)?n:void 0,dateCommitted:(s=new Date(null!=(l=e.appliedAt)?l:""),s),patchMeta:null!=(r=e.meta)?r:void 0})};return(0,l.jsx)("div",{className:"border-t border-gray-100",ref:t,children:(0,l.jsxs)(eb.T,{className:(0,X.xW)("overflow-y-auto p-2 flex flex-col gap-1 h-full",s&&"h-full max-h-full"),children:[(0,l.jsx)(aA,{project:n,environment:a,automatedMigrations:r}),(s||null!=i)&&(0,l.jsx)(aE,{project:n,environment:a,onOpenPatch:d,patchId:i}),!s&&null!=o&&(0,l.jsx)("ul",{children:(0,l.jsx)(aM,{patch:o,project:n,onOpen:()=>d(o),isPeeking:!0})})]})})});function aA(e){var t;let{project:n,environment:s,automatedMigrations:r}=e,{routes:o}=(0,es.c)(),c=(0,a.Xr)(ae.I7),d=(0,a.md)((0,U.pG)(s.id)),u=(0,a.Xr)((0,l7.PI)(s.id));return(null==(t=r.data)?void 0:t.length)?(0,l.jsx)("ul",{children:r.data.map((e,t)=>{var a,r,m,x;if(e.sourceServiceId!==e.destVolumeInstance.serviceId)return;let h=e.sourceServiceId,{name:p}=null!=(r=n.services.find(e=>e.id===h))?r:{};if(!(null==(a=d.services)?void 0:a[h])||!p)return null;let g=c(null!=(m=e.sourceVolumeInstance.region)?m:ae.s9),v=c(null!=(x=e.destVolumeInstance.region)?x:ae.s9),j=!(null==g?void 0:g.railwayMetal)&&!!(null==v?void 0:v.railwayMetal);return(0,i.createElement)(eT.P.li,{layout:!0,...aL,key:e.id+t},(0,l.jsxs)(eu.N,{...o.projectServiceDeployments({environmentId:s.id,serviceId:h}),className:"w-full grid group items-center grid-cols-[minmax(0,auto),max-content] gap-2 px-4 py-4 text-left rounded-md hover:bg-gray-50 dark:hover:bg-gray-100 focus:outline-none focus-within:bg-pink-50",children:[(0,l.jsxs)("div",{className:"grid items-center gap-4 grid-cols-[auto_1fr] w-full",children:[(0,l.jsx)(Z.In,{size:"md",icon:$.R2D,className:"text-blue-500"}),(0,l.jsxs)("div",{className:"grid gap-2",children:[(0,l.jsx)("p",{className:"text-sm font-semibold line-clamp-2 text-ellipsis",children:p}),(0,l.jsx)("p",{className:"text-sm",children:j?"Upgraded to Railway Metal":"Automatically redeployed"}),(0,l.jsx)(aT.s,{className:"text-xs text-gray-500",children:e.createdAt})]})]}),(0,l.jsx)(T.K0,{icon:$.X,size:"xs",title:"Dismiss notification",color:"gray",className:"group-hover:visible invisible opacity-60 hover:opacity-100",onClick:e=>{e.preventDefault(),e.stopPropagation(),u(e=>[...e,h])}})]}))})}):null}let aE=e=>{var t;let{project:n,environment:s,onOpenPatch:r,patchId:o}=e,c=(0,a.md)(z.DM),d=null!=(t=null==c?void 0:c.Write)&&t,u=(0,a.md)((0,U.pG)(s.id)),{result:m,activityItems:x}=(0,g.kV)(n.id,s.id,d),h=(0,i.useMemo)(()=>{let e=n.services.reduce((e,t)=>({...e,[t.id]:t.name}),{});return x.forEach(t=>{var n,l;if("commit"===t.type)for(let[a,s]of Object.entries(null!=(l=null==(n=t.data.meta)?void 0:n.serviceNames)?l:{}))null==e[a]&&(e[a]=s)}),e},[n.services,x]),p=(0,i.useMemo)(()=>n.services.flatMap(e=>{var t;let n=(0,k.getServiceFromEnvironmentConfig)(u,e.id);return Object.keys(null!=(t=null==n?void 0:n.volumeMounts)?t:{}).map(t=>({[e.id]:t}))}).reduce((e,t)=>({...e,...t}),{}),[n.services]),v=(0,i.useMemo)(()=>n.volumes.reduce((e,t)=>({...e,[t.id]:t.name}),{}),[n.volumes]);return(0,g.ee)({patchId:o,activityItems:x,decryptVariables:d,onOpenPatch:r}),(0,l.jsxs)("ul",{className:"flex flex-col gap-3",children:[m.isLoading?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(aV,{}),(0,l.jsx)(aV,{}),(0,l.jsx)(aV,{}),(0,l.jsx)(aV,{}),(0,l.jsx)(aV,{}),(0,l.jsx)(aV,{})]}):0===x.length?(0,l.jsx)(aU,{}):(0,l.jsx)(l.Fragment,{children:x.map(e=>{if("commit"===e.type)return(0,l.jsx)(aM,{project:n,patch:e.data,isPeeking:!1,onOpen:()=>r(e.data)},e.id);if("deployment"===e.type)return(0,l.jsx)(az,{item:e,project:n,serviceNameMap:h},e.id);if("backup"===e.type)return(0,l.jsx)(aP,{item:e,project:n,serviceNameMap:h,volumeNameMap:v,serviceIdByVolume:p},e.id);if("extension"===e.type)return(0,l.jsx)(aO,{item:e,project:n,serviceNameMap:h},e.id);if("databasePassword"===e.type)return(0,l.jsx)(aW,{item:e,project:n,environment:s,serviceNameMap:h},e.id);return null})}),m.hasNextPage&&(0,l.jsx)(T.$n,{variant:"outline",size:"sm",color:"gray",onClick:()=>m.fetchNextPage(),isLoading:m.isFetchingNextPage,children:"Fetch More"})]})},aR=e=>{var t,n;let{user:a,appliedAt:s}=e;return(0,l.jsxs)(eb.z,{align:"center",space:1,children:[(0,l.jsx)(al.e,{...a,size:"xxs"}),(0,l.jsx)("p",{className:"text-xs text-gray-500",children:null!=(n=null!=(t=a.username)?t:a.name)?n:a.email}),(0,l.jsx)("span",{className:"text-xs text-gray-500",children:"\xb7"}),(0,l.jsx)(aT.s,{className:"text-xs text-gray-500",children:null!=s?s:new Date})]})},aL={initial:{opacity:0},animate:{opacity:1},transition:{type:"spring",stiffness:700,damping:40}},aM=e=>{var t;let{patch:n,project:s,onOpen:r,isPeeking:o}=e,c=(0,k.numChangesInEnvironmentConfig)(n.patch),d=null!=(t=n.message)?t:"".concat(c," ").concat((0,ey.td)("change",c)),u=(0,i.useMemo)(()=>{var e;return Object.keys(null!=(e=n.patch.services)?e:{}).map(e=>{var t,l,a,r;let i=s.services.find(t=>t.id===e),o=null!=(l=null==(t=n.meta)?void 0:t.serviceNames)?l:{};return null!=(r=null!=(a=null==i?void 0:i.name)?a:o[e])?r:"<deleted service>"})},[s,n]),m=(0,i.useMemo)(()=>{var e;return Object.keys(null!=(e=n.patch.volumes)?e:{}).map(e=>{var t,l,a,r;let i=s.volumes.find(t=>t.id===e),o=null!=(l=null==(t=n.meta)?void 0:t.volumeNames)?l:{};return null!=(r=null!=(a=null==i?void 0:i.name)?a:o[e])?r:"<deleted volume>"})},[s,n]),x=(0,i.useMemo)(()=>[...u,...m],[u,m]),h=(0,i.useMemo)(()=>{var e;return Object.keys(null!=(e=n.patch.sharedVariables)?e:{}).length},[n]),{track:p}=(0,t5.j)(),{volumeInstances:g}=(0,a.md)(ai.Bo),v=(0,i.useMemo)(()=>{var e,t;if(!Object.values(null!=(e=n.patch.volumes)?e:{}).some(e=>e.isDeleted))return!1;for(let e of Object.keys(null!=(t=n.patch.volumes)?t:{})){let t=g.find(t=>t.volumeId===e);if(null==t?void 0:t.isPendingDeletion)return!0}return!1},[n]),[{user:j}]=(0,ev.Jd)();return(0,l.jsx)(eT.P.li,{layout:!o||"size",...aL,children:(0,l.jsxs)(eT.P.button,{onClick:()=>{p({action:"View",object:"Patch",properties:{patchId:n.id}}),r()},className:(0,X.xW)("px-3 py-4 grid gap-3 grid-cols-[auto_1fr,auto] items-center w-full rounded-md text-left","border hover:bg-gray-50 dark:hover:bg-gray-100 hover:border-gray-200 focus:outline-none focus-within:bg-pink-50",o?"bg-success-surface dark:bg-success-surface border-success-light":"bg-secondaryBg dark:bg-gray-50 border-gray-100"),name:"View Patch",animate:o?{backgroundColor:"var(--gray-50)",borderColor:"var(--gray-100)",transition:{duration:2,ease:"easeInOut"}}:{},children:[(0,l.jsx)(Z.In,{icon:$.oYt,size:"md",className:"text-gray-500"}),(0,l.jsxs)("div",{className:"grid gap-2.5",children:[(0,l.jsx)("p",{className:"text-sm text-gray-800 line-clamp-2 text-ellipsis",children:null!=n.message?(0,l.jsx)("span",{className:"font-semibold",children:n.message}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"font-semibold",children:d})," ",0===x.length&&h>0?(0,l.jsxs)(l.Fragment,{children:["across"," ",(0,l.jsx)("span",{className:"font-semibold",children:h})," ","shared ",(0,ey.td)("variable",h)]}):1===x.length?(0,l.jsxs)(l.Fragment,{children:["in ",(0,l.jsx)("span",{className:"font-semibold",children:x[0]})]}):(0,l.jsxs)(l.Fragment,{children:["across"," ",u.length>0&&(0,l.jsxs)("span",{className:"font-semibold",children:[u.length," ",(0,ey.td)("service",u.length)]}),u.length>0&&m.length>0&&(0,l.jsx)("span",{children:" and "}),m.length>0&&(0,l.jsxs)("span",{className:"font-semibold",children:[m.length," ",(0,ey.td)("volume",m.length)]})]})]})}),null!=n.message&&x.length>0&&(0,l.jsxs)("span",{className:"text-gray-500 text-xs",children:[u.length>0&&(0,l.jsxs)("span",{children:[u.length," ",(0,ey.td)("service",u.length)]}),u.length>0&&m.length>0&&(0,l.jsx)("span",{children:" and "}),m.length>0&&(0,l.jsxs)("span",{children:[m.length," ",(0,ey.td)("volume",m.length)]})," ","updated"]}),null!=n.appliedAt&&null!=n.appliedBy?(0,l.jsx)(aR,{user:n.appliedBy,appliedAt:n.appliedAt}):o&&null!=j?(0,l.jsx)(aR,{user:{avatar:j.avatar,email:j.email,id:j.id,name:j.name,username:j.username}}):null]}),(v||o)&&(0,l.jsx)(Z.In,{icon:$.bE2,className:"text-gray-500",size:"sm"})]})})},aP=e=>{var t,n,s;let{item:r,project:i,serviceIdByVolume:o,serviceNameMap:c,volumeNameMap:d}=e,u=(0,a.md)((0,I.CI)(i)),m=r.volumeId,x=o[null!=m?m:""],h=c[null!=x?x:""],p=d[null!=m?m:""],g=r.creatorId,{routes:v}=(0,es.c)(),{teamMembers:j}=(0,an.Q5)(i.teamId),[{members:y}]=(0,at.Ff)(i.id),f=[...null!=y?y:[],...null!=(t=j.data)?t:[]].find(e=>e.id===g),b=r.action,w={created:"text-blue",deleted:"text-grey"}[b];return(0,l.jsx)(eT.P.li,{layout:!0,...aL,children:(0,l.jsx)(eu.N,{...x?v.projectServiceBackups({environmentId:u,serviceId:x}):{},children:(0,l.jsxs)("div",{className:(0,X.xW)("px-4 py-4 grid items-center gap-4 grid-cols-[auto_1fr] w-full text-left rounded-md","hover:bg-gray-50 dark:hover:bg-gray-100 focus:outline-none focus-within:bg-pink-50"),children:[(0,l.jsx)(aq,{action:b}),(0,l.jsxs)("div",{className:"grid gap-2",children:[(0,l.jsx)("p",{className:(0,X.xW)("text-sm font-semibold line-clamp-2 text-ellipsis",null!=w?"".concat(w,"-800"):"text-gray-800"),children:null!=(n=null!=h?h:p)?n:"<deleted volume>"}),(0,l.jsxs)("p",{className:(0,X.xW)("text-sm",null!=w?"".concat(w,"-700"):"text-foreground"),children:["Backup ",b," ",g?"by ".concat(null!=(s=null==f?void 0:f.name)?s:"<deleted user>"):"on schedule"]}),(0,l.jsx)("p",{className:"text-xs text-gray-500",children:(0,l.jsx)(aT.s,{className:"text-xs text-gray-500",children:r.createdAt})})]})]})})})},az=e=>{var t;let{item:n,project:s,serviceNameMap:r}=e,i=(0,a.md)((0,I.CI)(s)),o=null==s.services.find(e=>e.id===n.serviceId),c=null!=(t=r[n.serviceId])?t:"<deleted service>",{routes:d}=(0,es.c)(),u=n.data.action,m={deployed:"text-green",created:"text-blue",redeployed:"text-blue",failed:"text-red",crashed:"text-red"}[u],x="redeployed"===n.creationAction?"Redeployment":"Deployment";return(0,l.jsx)(eT.P.li,{layout:!0,...aL,children:(0,l.jsx)(eu.N,{as:o?"div":void 0,...o?{}:d.projectServiceDeployments({environmentId:i,serviceId:n.serviceId,deploymentId:n.deploymentId}),children:(0,l.jsxs)("div",{className:(0,X.xW)("px-4 py-4 grid items-center gap-4 grid-cols-[auto_1fr] w-full text-left rounded-md",!o&&"hover:bg-gray-50 dark:hover:bg-gray-100 focus:outline-none focus-within:bg-pink-50"),children:[(0,l.jsx)(aq,{action:u}),(0,l.jsxs)("div",{className:"grid gap-2",children:[(0,l.jsx)("p",{className:(0,X.xW)("text-sm font-semibold line-clamp-2 text-ellipsis",null!=m?"".concat(m,"-800"):"text-gray-800"),children:c}),(0,l.jsx)("p",{className:(0,X.xW)("text-sm",null!=m?"".concat(m,"-700"):"text-foreground"),children:((e,t)=>{switch(t){case"deployed":return(0,l.jsxs)(l.Fragment,{children:[e," successful"]});case"oom_killed":return(0,l.jsxs)(l.Fragment,{children:[e," failed",(0,l.jsx)(ee.ae,{className:"mt-1",children:"Out of Memory (OOM)"})]});default:return(0,l.jsxs)(l.Fragment,{children:[e," ",t]})}})(x,u)}),(0,l.jsx)("p",{className:"text-xs text-gray-500",children:(0,l.jsx)(aT.s,{className:"text-xs text-gray-500",children:n.createdAt})})]})]})})})},aO=e=>{var t;let{item:n,project:s,serviceNameMap:r}=e,i=(0,a.md)((0,I.CI)(s)),o=null==s.services.find(e=>e.id===n.serviceId),c=null!=(t=r[n.serviceId])?t:"<deleted service>",{routes:d}=(0,es.c)(),u=n.action,m={added:"text-green",removed:"text-red"}[u];return(0,l.jsx)(eT.P.li,{layout:!0,...aL,children:(0,l.jsx)(eu.N,{as:o?"div":void 0,...o?{}:d.projectServiceData({environmentId:i,serviceId:n.serviceId}),children:(0,l.jsxs)("div",{className:(0,X.xW)("px-4 py-4 grid items-center gap-4 grid-cols-[auto_1fr] w-full text-left rounded-md",!o&&"hover:bg-gray-50 dark:hover:bg-gray-100 focus:outline-none focus-within:bg-pink-50"),children:[(0,l.jsx)(aq,{action:u}),(0,l.jsxs)("div",{className:"grid gap-2",children:[(0,l.jsx)("p",{className:(0,X.xW)("text-sm font-semibold line-clamp-2 text-ellipsis",null!=m?"".concat(m,"-800"):"text-gray-800"),children:c}),(0,l.jsxs)("p",{className:(0,X.xW)("text-sm",null!=m?"".concat(m,"-700"):"text-foreground"),children:["Extension “",n.extensionName,"” ",{added:"installed",removed:"uninstalled"}[u]]}),(0,l.jsx)("p",{className:"text-xs text-gray-500",children:(0,l.jsx)(aT.s,{className:"text-xs text-gray-500",children:n.createdAt})})]})]})})})},aU=()=>{let{routes:e}=(0,es.c)();return(0,l.jsxs)(eb.T,{as:"li",justify:"center",className:"my-4 mx-6 text-left rounded-lg",children:[(0,l.jsx)(ee.xC,{className:"leading-6 font-semibold mb-4",children:"No environment commits"}),(0,l.jsx)(ee.xC,{className:"leading-5 text-gray-500 max-w-lg mx-auto mb-6",children:"Changing service configuration or editing variables now stages changes. Apply them and they will show up here. Import all your variables using the"}),(0,l.jsx)(T.vx,{...e.docs({page:"/guides/staged-changes"}),variant:"outline",color:"pink",size:"sm",children:"View Docs"})]})},aF=(e,t)=>"".concat(Math.floor(Math.random()*(t-e+1)+e),"%"),aV=()=>{let{messageWidth:e,servicesWidth:t,userWidth:n}=(0,i.useMemo)(()=>({messageWidth:aF(75,90),servicesWidth:aF(80,99),userWidth:aF(30,70)}),[]);return(0,l.jsxs)("li",{className:"my-4 mx-6",children:[(0,l.jsx)(t4.g,{width:e,height:20}),(0,l.jsx)(t4.g,{width:t,height:18,className:"mt-1 mb-2"}),(0,l.jsx)(t4.g,{width:n,height:16})]})},aB={added:$.FWt,crashed:$.RIJ,failed:$.RIJ,restarted:$.RIJ,created:$.FWt,deleted:$.TBR,deployed:$.rAV,removed:$.TBR,updated:$.ffu,invited:$.gE4,paused:$.b7J,resumed:$.N3h,stopped:$.RIJ,started:$.rAV,slept:$.IPp,snapshoted:$.FWt,redeployed:$.e9t,oom_killed:$.RIJ,regenerated:$.e9t},a_={added:"text-blue-500",crashed:"text-red-500",failed:"text-red-500",restarted:"text-blue-500",created:"text-blue-500",deleted:"text-gray-500",deployed:"text-green-500",removed:"text-gray-500",updated:"text-blue-500",invited:"text-pink-500",paused:"text-yellow-500",resumed:"text-pink-500",stopped:"text-red-500",started:"text-green-500",snapshoted:"text-blue-500",redeployed:"text-blue-500",slept:"text-yellow-500",oom_killed:"text-red-500",regenerated:"text-blue-500"},aq=e=>{var t,n;let{action:a}=e,s=null!=(t=aB[a])?t:$.RIJ,r=null!=(n=a_[a])?n:"text-gray-600";return(0,l.jsx)(Z.In,{size:"md",icon:s,className:(0,X.xW)(r)})},aW=e=>{var t;let{item:n,project:a,environment:s,serviceNameMap:r}=e,{routes:i}=(0,es.c)(),o=null!=(t=r[n.serviceId])?t:"<deleted service>";n.databaseType.charAt(0).toUpperCase(),n.databaseType.slice(1);let c=null==a.services.find(e=>e.id===n.serviceId);return(0,l.jsx)(eT.P.li,{className:"hover:bg-gray-50 rounded",...aL,children:(0,l.jsx)(eu.N,{as:c?"div":void 0,...c?{}:i.projectServiceData({environmentId:s.id,serviceId:n.serviceId}),children:(0,l.jsxs)("div",{className:(0,X.xW)("px-4 py-[10px] grid items-center gap-4 grid-cols-[auto_1fr] w-full text-left rounded-md",!c&&"hover:bg-gray-50 dark:hover:bg-gray-100 focus:outline-none focus-within:bg-pink-50"),children:[(0,l.jsx)(aq,{action:n.action}),(0,l.jsxs)("div",{className:"grid gap-2",children:[(0,l.jsxs)("p",{className:"text-sm font-medium text-gray-900 mb-1",children:["Password regenerated for ",o]}),(0,l.jsx)("p",{className:"text-xs text-gray-500",children:(0,l.jsx)(aT.s,{className:"text-xs text-gray-500",children:n.createdAt})})]})]})})})},aK=i.forwardRef((e,t)=>{var n;let s=(0,i.useRef)(null),[r,o]=(0,i.useState)(null),c=(0,a.md)(x.T6),d=(0,a.md)(I.Zy),u=(0,l7.Ap)({removeDismissed:!0,refetchOnMount:!1,refetchOnWindowFocus:!1,staleTime:864e5}),m=!!(null==(n=u.data)?void 0:n.length),[h,p]=(0,g.N3)();(0,l9.w)(s,()=>{var e;s.current&&(null==(e=u.data)?void 0:e.length)&&o(s.current.getBoundingClientRect().height)});let v=(0,nv.a)(),j=(0,eE.z)("sm"),{query:y}=(0,es.c)(),f=(0,i.useMemo)(()=>{if("string"==typeof(null==y?void 0:y.patchId))return y.patchId},[y]),{patchToPeek:b}=(0,g.Ji)({environmentId:null==d?void 0:d.id});return v&&null!=c&&null!=d&&(!j||h||m)?(0,l.jsx)("div",{ref:t,className:(0,X.xW)("absolute bottom-0 z-[29] overflow-y-hidden pointer-events-none","w-auto -top-px left-0 right-0","sm:w-activity sm:top-[98px] sm:left-auto sm:right-6"),children:(0,l.jsxs)(eT.P.div,{initial:!!j&&{y:40},animate:{y:j||h||null==b?!j&&!h&&m&&r?"calc(100% - ".concat(42,"px - ").concat(r,"px)"):h?0:"calc(100% - ".concat(42,"px)"):"calc(100% - 160px)"},transition:{type:"tween",duration:j?.15:.2,ease:"easeInOut"},className:(0,X.xW)("absolute top-0 right-0 bottom-0 h-full grid grid-rows-[max-content,minmax(0,1fr)]","rounded-t-lg border-t border-l border-r border-gray-200 overflow-hidden pointer-events-auto","bg-background dark:bg-secondaryBg",!h&&m&&!j&&"grid-rows-[max-content,minmax(0,max-content)]","w-full","sm:w-full"),children:[(0,l.jsxs)("button",{onClick:()=>p(!h),className:"flex items-center py-2 px-4 w-full text-left",name:"Activity Feed",children:[(0,l.jsx)(Z.In,{icon:$.Ilq,className:"text-pink-500"}),(0,l.jsx)(ee.EY,{className:"ml-2",children:"Activity"}),(0,l.jsx)(Z.In,{icon:h?$.yQN:$.rXn,className:"ml-auto"})]}),(h||null!=f||m||null!=b)&&(0,l.jsx)(aD,{ref:s,project:c,environment:d,automatedMigrations:u,isOpen:h,patchId:f,patchToPeek:b})]},"activity")}):null});var aY=n(4858),aQ=n(47843),a$=n(44330),aG=n(58654);let aJ={plugin:a$.qZ,service:a$.OC,empty:a$.o8,volume:a$.TW},aX=e=>{var t,n;let{canvasStateLoading:s}=e,r=(0,a.md)(x.T6),o=(0,a.md)(I.Zy),c=(0,a.md)(U.vA),d=(0,a.md)(V.lR),{serviceInstances:u,volumeInstances:h}=(0,a.md)(ai.Bo),p=null!=(n=null==(t=(0,a.md)((0,m.z$)(null==o?void 0:o.id)))?void 0:t.data)?n:{},g=(0,i.useMemo)(()=>null==r||null==o?[]:(0,aG.B)({project:r,environment:o,serviceInstances:u,volumeInstances:h,volumeInstancesCurrentSizeMB:p,environmentConfig:c,stagedEnvironmentConfig:d}).filter(e=>{var t;return"service"!==e.type||!(null==(t=e.stagedServiceConfig)?void 0:t.isDeleted)}),[r,o,c]),v=a0(g,(0,i.useMemo)(()=>[],[])),j=(0,i.useMemo)(()=>(0,eV.Y)(),[]);return null==r||null==o||s?(0,l.jsx)(aZ,{}):(0,l.jsx)(aY.Ln,{children:(0,l.jsx)(aQ.w,{...{nodes:v,canvasDoc:j},children:(0,l.jsx)(aH,{children:g.map(e=>{let t=aJ[e.type];return null==t?null:(0,l.jsx)(t,{data:e},e.id)})})})})},aH=e=>{let{children:t}=e;return(0,l.jsx)("ul",{className:"w-full max-w-full px-5 gap-2 grid service-list",children:t})},aZ=()=>(0,l.jsx)(aH,{children:(0,l.jsx)(a$.Qo,{className:"border-t border-b border-gray-200"})}),a0=(e,t)=>(0,i.useMemo)(()=>{let n={};for(let t of e)n[t.id]=t;for(let e of null!=t?t:[]){let t={type:"service-group",...e};n[e.id]=t}return n},[e,t]);var a1=n(98888),a2=n(55979),a5=n(50655),a4=n(62190),a6=n(10605),a8=n(71778),a3=n(39303),a7=n(94702),a9=n(42643),se=n(37245),st=n(60299);let sn=(0,i.forwardRef)((e,t)=>{let{deployment:n,permissions:a}=e,{routes:s}=(0,es.c)(),r=(0,X.xW)(["border","border-gray-200","rounded-md","select-none","group","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-500",st.M[n.status]]),i=s.projectServiceDeployments({deploymentId:n.id});return(0,l.jsx)(eu.N,{className:r,"data-testid":"deployment-card",...i,children:(0,l.jsx)("div",{className:"m-1 z-10",children:(0,l.jsxs)(se.PE,{deployment:n,isOpaque:!0,ref:t,children:[(0,l.jsxs)("div",{className:"flex items-center gap-x-4",children:[(0,l.jsx)("div",{className:"flex flex-col items-start min-w-20",children:(0,l.jsx)(se.nW,{deployment:n})}),(0,l.jsx)(se.$,{deployment:n}),(0,l.jsx)(se.UC,{deployment:n})]}),(0,l.jsxs)("div",{className:"flex flex-row-reverse items-center gap-x-3",children:[a.Write&&(0,l.jsx)(se.En,{deployment:n}),(0,l.jsx)("div",{className:"group-hover:opacity-100 opacity-0 transition-opacity flex flex-row-reverse gap-x-3 focus-within:opacity-100",children:(0,l.jsx)(se.E0,{deployment:n,isDisabled:!a.Write})})]})]})})})});var sl=n(38922),sa=n(10529);let ss=e=>{let{deployment:t}=e,{routes:n}=(0,es.c)();return(0,l.jsxs)(eb.z,{className:"p-2 text-xs font-semibold text-gray-600",space:1,align:"center",children:[(0,l.jsx)("span",{children:"✨ The deployment configuration was automatically modified to ignore deprecated regions."}),(0,l.jsx)(eu.N,{variant:"underline",...n.projectServiceDeployments({deploymentId:t.id,hash:"details"}),children:"View details"})]})};function sr(e){let{deployment:t}=e,n=(0,a.Xr)(ae.I7),s=(0,i.useMemo)(()=>{var e,l,a;let s=null==(a=t.meta)||null==(l=a.serviceManifest)||null==(e=l.deploy)?void 0:e.multiRegionConfig;return!!s&&Object.keys(s).some(e=>{var t;let l=n(e);return null!=(t=null==l?void 0:l.railwayMetal)&&t})},[t.meta,n]),r=(0,i.useMemo)(()=>{var e,n,l,a;let s=null==(l=t.meta)||null==(n=l.serviceManifest)||null==(e=n.deploy)?void 0:e.multiRegionConfig;if(!s)return!1;let r=(null==(a=t.meta)?void 0:a.originalRegions)||[],i=Object.keys(s);if(r.length!==i.length)return!1;let o=[...r].sort(),c=[...i].sort();return o.every((e,t)=>e===c[t])},[t.meta]);return s||r?(0,l.jsx)(eb.T,{className:"p-2 text-xs text-gray-600 font-semibold",space:2,justify:"center",children:(0,l.jsxs)("div",{children:["✨ This deployment was initiated by Railway. Your service was",s?" automatically upgraded to use Railway Metal":" automatically redeployed","."," ",(0,l.jsx)(eu.N,{variant:"underline",href:s?"https://docs.railway.com/reference/metal-upgrade":"https://docs.railway.com/reference/deployments#railway-initiated-deployments",className:"font-light",onClick:e=>{e.stopPropagation()},children:"Learn more"})]})}):null}var si=n(82410);let so={[u.Uty.Building]:"border-blue-200 [&:has(>:focus-visible)]:ring-blue-500",[u.Uty.Crashed]:"border-red-200 [&:has(>:focus-visible)]:ring-red-500",[u.Uty.Deploying]:"border-blue-200 [&:has(>:focus-visible)]:ring-blue-500",[u.Uty.Failed]:"border-red-200 [&:has(>:focus-visible)]:ring-red-500",[u.Uty.Success]:"border-green-200 [&:has(>:focus-visible)]:ring-green-500",[u.Uty.Initializing]:"border-blue-200 [&:has(>:focus-visible)]:ring-blue-500",[u.Uty.Sleeping]:"border-yellow-200 [&:has(>:focus-visible)]:ring-yellow-500",[u.Uty.NeedsApproval]:"border-yellow-200 [&:has(>:focus-visible)]:ring-yellow-500"};function sc(e){var t,n,a,s;let{deployment:r,isFirstDeployment:i=!1,permissions:o}=e,{routes:c}=(0,es.c)(),{currentEvent:d,data:u,error:m,isComplete:x,isLoading:h,startedAt:p,hasDeploymentFailed:g,isSleeping:v}=(0,sl.J)(r,{isFirstDeployment:i}),j=Object.values((0,a4.hT)(r,i)).flatMap(e=>e),y=(0,X.xW)(["flex","flex-col","rounded-lg","overflow-hidden","border","border-gray-200","select-none","[&:has(>:focus-visible)]:ring-2 ",so[r.status]]),f=!a4.Dt.includes(r.status)&&!a4.vZ.includes(r.status)&&(0,a7.AX)(r.createdAt,a4.Q0),b=c.projectServiceDeployments({deploymentId:r.id,hash:(0,si.x)(r,d)}),w=!!(null==(n=r.meta)||null==(t=n.volumeMounts)?void 0:t.length);return(0,l.jsxs)("div",{className:y,"data-testid":"deployment-card",children:[(0,l.jsxs)(eu.N,{...b,className:"m-1 z-10 focus-visible:ring-0",children:[(null==(a=r.meta)?void 0:a.reason)==="migrate"&&r.serviceId&&!w?(0,l.jsx)(sr,{serviceId:r.serviceId,deployment:r}):(null==(s=r.meta)?void 0:s.deprecatedRegions)!=null?(0,l.jsx)(ss,{deployment:r}):null,(0,l.jsx)(sa.g,{deployment:r,permissions:o,currentEvent:d})]}),f&&(0,l.jsx)(se.bY,{currentEvent:d,deployment:r,events:j,error:m,isComplete:x,isLoading:h,map:u,startedAt:p,hasDeploymentFailed:g,isSleeping:v})]})}let sd=(0,S.tG)("@railway/deployments/history","history",void 0,{getOnInit:!0});function su(e){let{deployments:t,isLoading:n=!1,permissions:s,onEndReached:r}=e,{ref:o,inView:c}=(0,a9.Wx)(),[d,u]=(0,a.fp)(sd);return(0,i.useEffect)(()=>{c&&(null==r||r())},[c]),(0,l.jsx)(av.bL,{collapsible:!0,value:d,onValueChange:u,type:"single",children:(0,l.jsxs)(av.q7,{value:"history",children:[(0,l.jsxs)(av.l9,{className:"flex group items-center gap-x-2 text-foreground rounded focus-visible:ring-0 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:rounded-sm focus-visible:outline-pink-500 focus-visible:ring-foreground",disabled:n,children:[(0,l.jsx)(Z.In,{className:"group-rdx-state-open:rotate-90 group-rdx-state-closed:rotate-0 transition-transform",color:"currentColor",icon:$.c_$}),(0,l.jsx)("p",{className:"font-medium text-xs uppercase",children:"History"})]}),(0,l.jsxs)(av.UC,{className:"pt-4 flex flex-col gap-y-2 rdx-state-open:animate-accordion-slide-down rdx-state-closed:animate-accordion-slide-up",children:[t.filter(e=>{var t;return(null==(t=e.meta)?void 0:t.reason)!=="migrate"||"FAILED"!==e.status}).map((e,t)=>t||"FAILED"!==e.status?(0,l.jsx)(sn,{deployment:e,permissions:s},e.id):(0,l.jsx)(sc,{deployment:e,permissions:s},e.id)),(0,l.jsx)("div",{"aria-hidden":"true",ref:o})]})]})})}function sm(e){let t,{deployments:n,isFirstDeployment:a=!1,isLoading:s=!1,permissions:r,source:i,onDeployFromSource:o,serviceInstanceConfig:c}=e,{routes:d}=(0,es.c)(),u=(0,a8.dy)(),m=null!==(0,a2.PV)(c)||u.allowed||(null==u?void 0:u.message)!==em.RESOURCE_ACCESS_ERRORS.LIMITED_PLAN;return s?(0,l.jsx)(t4.g,{height:"129px",width:"100%",className:"inprogress-loading"}):(m&&((null==i?void 0:i.image)!=null?t=(0,l.jsxs)("span",{children:["Deploy the image ",(0,l.jsx)("b",{children:i.image})]}):(null==i?void 0:i.repo)!=null&&(t=(0,l.jsxs)("span",{children:["Deploy the repo ",(0,l.jsx)("b",{children:i.repo})]}))),0===n.length)?(0,l.jsxs)("div",{className:"bg-secondaryBg text-gray-500 text-sm grid gap-2 border border-dashed text-center items-center justify-center py-4 px-6 rounded-md",children:[(0,l.jsx)("p",{className:"text-center text-gray-500 text-sm",children:"There is no active deployment for this service."}),o&&t?(0,l.jsx)("div",{className:"flex items-center gap-2",children:(0,l.jsx)(T.$n,{onClick:o,size:"sm",variant:"ghost",children:t})}):m?(0,l.jsx)("p",{children:(0,l.jsx)(eu.N,{variant:"underline",...d.docs({page:"quick-start"}),children:"Make a deployment to get started →"})}):null]}):(0,l.jsx)("div",{className:"flex flex-col gap-y-2",children:n.map(e=>(0,l.jsx)(sc,{deployment:e,isFirstDeployment:a,permissions:r},e.id))})}function sx(e){let{deployment:t,permissions:n}=e,{routes:a}=(0,es.c)(),s=(0,X.xW)(["flex","flex-col","rounded-lg","overflow-hidden","border","select-none","border-yellow-200"]),r=a.projectServiceDeployments({deploymentId:t.id,hash:"details"});return(0,l.jsx)(eu.N,{className:s,"data-testid":"deployment-card",...r,children:(0,l.jsx)("div",{className:"m-1 z-10",children:(0,l.jsx)(sa.g,{deployment:t,permissions:n})})})}function sh(e){let{deployments:t,isLoading:n=!1,permissions:a}=e;return 0===t.length?null:(0,l.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,l.jsxs)(eb.z,{className:"text-yellow-600",children:[(0,l.jsx)(Z.In,{className:"mr-2",icon:$.hcu}),(0,l.jsx)(ee.EY,{children:"Deploy this commit from an external contributor?"})]}),t.map(e=>(0,l.jsx)(sx,{deployment:e,permissions:a},e.id))]})}var sp=n(33321),sg=n(90279),sv=n(29240);function sj(e){let{serviceInstanceConfig:t}=e,{routes:n}=(0,es.c)(),s=(0,sv.j)({serviceInstanceConfig:t}),r=(0,a.Xr)(ae.I7),o=(0,i.useMemo)(()=>s.map(e=>{let t=r(e);return(null==t?void 0:t.railwayMetal)?e:e+" (Legacy)"}),[s,r]);return(0,l.jsxs)("div",{className:"flex gap-x-2 items-center text-gray-300",children:[(0,l.jsx)(Z.In,{color:"currentColor",icon:$.sDd,size:"sm"}),(0,l.jsx)(eu.N,{title:o.join(", "),className:"text-sm text-nowrap hover:underline focus-visible:ring-0 focus-visible:outline-2 focus-visible:outline-offset-1 focus-visible:rounded-sm focus-visible:outline-pink-500",...n.projectServiceSettings({section:"deploy-region-config"}),children:o.length<=2?o.join(", "):o.length+" Regions"})]})}var sy=n(26602);function sf(e){let{serviceInstanceConfig:t}=e,{routes:n}=(0,es.c)(),{numReplicas:a}=(0,sy.r)({serviceInstanceConfig:t});return(0,l.jsxs)("div",{className:"flex gap-x-2 items-center text-gray-300",children:[(0,l.jsx)(Z.In,{color:"currentColor",icon:$.QRo,size:"sm"}),(0,l.jsxs)(eu.N,{className:"text-sm hover:underline focus-visible:ring-0 focus-visible:outline-2 focus-visible:outline-offset-1 focus-visible:rounded-sm focus-visible:outline-pink-500",...n.projectServiceSettings({section:"deploy-region-config"}),children:[a," ",(0,ey.td)("Replica",a)]})]})}var sb=n(99499),sw=n(87248),sN=n(49404);function sI(){let{graphqlClient:e}=(0,R.q)();return(0,sN.n)({mutationFn:async t=>await e.deploymentAckEvent({deploymentId:t.deploymentId,deploymentEventId:t.deploymentEventId})})}function sk(e){var t,n,s;let{migration:r,open:o,onOpenChange:c,onRevert:d}=e,[u,m]=(0,i.useState)(""),x=(0,a.Xr)(ae.I7),h=x(null!=(t=r.sourceVolumeInstance.region)?t:ae.s9),p=x(null!=(n=r.destVolumeInstance.region)?n:ae.s9),g="migrate"===r.reason,v=!(null==h?void 0:h.railwayMetal)&&!!(null==p?void 0:p.railwayMetal);return(0,l.jsx)(D.a.Root,{onOpenChange:c,open:o,title:"Revert migration",contentClasses:"max-w-lg max-h-[596px] !rounded-2xl",visuallyHideCloseButton:!0,children:(0,l.jsxs)(eb.T,{space:4,children:[(0,l.jsxs)("p",{children:["Reverting will take your service offline and restore a backup of your data from"," ",(0,l.jsxs)("span",{className:"font-medium",children:[new Intl.DateTimeFormat("en-US",{dateStyle:"medium",timeStyle:"short"}).format(new Date(null!=(s=r.completedAt)?s:0))," "]}),"to"," ",g&&v?"legacy Railway infrastructure":null==h?void 0:h.location,"."]}),g?(0,l.jsxs)(eb.T,{space:2,children:[(0,l.jsx)("p",{children:"Please provide a reason for reverting"}),(0,l.jsx)(ly.T,{label:{text:"Please provide a reason for reverting",hidden:!0},placeholder:"Why are you reverting? (required)",className:"min-h-24",value:u,onChange:e=>m(e.target.value)})]}):(0,l.jsxs)(eb.T,{space:2,children:[(0,l.jsx)("p",{className:"text-sm text-neutral-secondary font-medium",children:"The backup that will be restored"}),(0,l.jsx)(sC,{migration:r})]}),(0,l.jsxs)(eb.z,{justify:g&&v?"between":"end",align:"center",children:[g&&v&&(0,l.jsx)(eu.N,{variant:"underline",href:"https://docs.railway.com/reference/metal-upgrade",className:"text-sm font-light",children:"Learn more"}),(0,l.jsxs)(eb.z,{justify:"end",space:2,children:[(0,l.jsx)(T.$n,{variant:"outline",color:"gray",size:"sm",onClick:()=>{m(""),c(!1)},children:"Cancel"}),(0,l.jsx)(T.By,{variant:"primary",color:"red",size:"sm",onClick:()=>d(u||"Revert migration to ".concat(r.destVolumeInstance.region)),disabled:g&&""===u,children:"Revert migration"})]})]})]})})}function sC(e){var t,n;let{migration:s}=e,r=(0,a.Xr)(ae.kW);return(0,l.jsxs)("div",{className:"grid grid-cols-[auto,max-content] border-neutral rounded-2xl border py-3.5 px-6 text-sm font-medium",children:[(0,l.jsxs)("div",{className:"grid grid-cols-[max-content,auto] items-center gap-2",children:[(0,l.jsx)(Z.In,{icon:$.akk,size:"sm",className:"text-neutral-secondary"}),(0,l.jsxs)("div",{className:"truncate text-ellipsis flex items-center gap-2 w-full",children:[(0,l.jsx)("div",{children:s.sourceVolumeInstance.volume.name.replace(sS,"")}),(0,l.jsx)("div",{className:"text-neutral-secondary",children:r(null!=(t=s.sourceVolumeInstance.region)?t:ae.s9)})]})]}),(0,l.jsx)("div",{className:"text-neutral-secondary",children:new Intl.DateTimeFormat("en-US",{dateStyle:"short",timeStyle:"short"}).format(new Date(null!=(n=s.completedAt)?n:0))})]})}let sS=/\((.*)\)( - (.*))?$/,sT={historicalDeploys:[],inProgressDeploys:[],needsApprovalDeploys:[]};function sD(e){return a4.sp.includes(e.status)}function sA(e){var t,n,s,r,o,c,d,m;let{environment:x,project:g,service:v,serviceInstance:j,serviceInstanceConfig:y}=e,f=(0,a.md)(z.DM),{query:b}=(0,es.c)(),N=null!=(d=null==b?void 0:b.id)?d:null,{modalActions:I}=(0,P.U)(),{isLoading:k,isFetchingMoreDeployments:C,allDeployments:S,hasMoreDeployments:T,fetchMoreDeployments:D,invalidateProjectDeployments:E}=(0,p.z4)({projectId:g.id,environmentId:x.id,serviceId:v.id}),R=null==j?void 0:j.latestDeployment,{historicalDeploys:L,needsApprovalDeploys:M,inProgressDeploys:O}=function(e,t){let n=function(e,t){let n=null!=e.find(e=>e.id===t),{result:l}=(0,h.dq)(t,null!=t&&!n);return n||null==l.data?e:[...e,l.data]}(e,t);return(0,i.useMemo)(()=>{let{needsApprovalDeploys:e,inProgressDeploys:l}=n.sort((e,t)=>+(e.status===u.Uty.Failed)).reduce((e,t)=>{let n=t.status===u.Uty.Crashed||t.status===u.Uty.Failed,l=e.inProgressDeploys.map(e=>e.createdAt),a=(0,a7.ay)(l),s=!a||(0,a7.dS)(t.createdAt,a),r=n&&a&&s;return a4.Ag.includes(t.status)||r||n&&0===e.inProgressDeploys.length?{...e,inProgressDeploys:[t,...e.inProgressDeploys]}:t.status===u.Uty.NeedsApproval&&s?{...e,needsApprovalDeploys:[...e.needsApprovalDeploys,t]}:{...e}},sT);e.sort((e,t)=>(0,a7.dS)(e.createdAt,t.createdAt)?-1:1);let a=l.sort((e,t)=>{let n=e=>[u.Uty.Success,u.Uty.Crashed,u.Uty.Sleeping].includes(e.status)?-1:+!sD(e),l=n(e),a=n(t);return l!==a?l-a:(0,a7.dS)(e.createdAt,t.createdAt)?-1:1}).filter(e=>a4.Ag.includes(e.status));if(!a.length){let e=n.find(e=>e.id===t&&sD(e)||[u.Uty.Failed,u.Uty.Crashed].includes(e.status));e&&a.push(e)}let s=n.filter(t=>!a.some(e=>e.id===t.id)&&!e.some(e=>e.id===t.id));return s.push(...e.splice(1)),s.sort((e,t)=>(0,a7.dS)(e.createdAt,t.createdAt)?-1:1),{needsApprovalDeploys:e,historicalDeploys:s,inProgressDeploys:a}},[n])}(S,C||null==R?void 0:R.id),F=(0,a6.I)({projectId:g.id,environmentId:x.id,serviceId:v.id}),V=(null==(t=y.source)?void 0:t.image)!=null||(null==(n=y.source)?void 0:n.repo)!=null,{routes:B,navActions:_}=(0,es.c)();(0,w.bU)(()=>({text:"Service Deployments",value:"service-deployments",group:"Service",icon:$.azJ,subCommands:S.filter(e=>e.id!==N).map(e=>{var t;let n=e.id.substring(0,7),a=null!=(t=e.meta)?t:{};return{text:"".concat(n," - ").concat(null!=a.commitMessage?a.commitMessage:"railway up"),value:e.id,icon:()=>(0,l.jsx)(sb.L,{status:e.status}),action:()=>{_.push(B.projectServiceDeployments({deploymentId:e.id}))}}})}),[S,N]);let{tcpProxies:q}=(0,a3.M)({projectId:g.id,environmentId:x.id,serviceId:v.id,options:{enabled:(null==R?void 0:R.staticUrl)==null&&Object.keys(null!=(m=null==y||null==(s=y.networking)?void 0:s.tcpProxies)?m:{}).length>0}}),W=(0,a.md)(U.Af),K=null==W?void 0:W.volumeInstances.find(e=>e.serviceId===v.id),Y=V?async()=>{if(V)try{var e,t,n;let a=null!=(n=null==(e=y.source)?void 0:e.image)?n:null==(t=y.source)?void 0:t.repo,s=I.createToast((0,l.jsx)(A.y8,{variant:"neutral",title:"Deploying service",description:"Deploying service from ".concat(a)}));await F.deployFromSource({}),I.exitToast(s),I.createToast((0,l.jsx)(A.y8,{variant:"success",title:"Deployed service",description:"Deployed service from ".concat(a)}))}catch(e){I.createToast((0,l.jsx)(A.y8,{variant:"error",title:"There was an error deploying from source."}))}}:void 0,Q=1===(null!=S?S:[]).length,G=O.find(e=>a4.Ag.includes(e.status));return(0,l.jsxs)("div",{className:"flex flex-col gap-y-4 pb-8",children:[(0,l.jsx)(sL,{project:g,serviceInstanceConfig:y,className:"mb-5"}),(0,l.jsx)(sh,{deployments:M,isLoading:k,permissions:f}),K&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(sR,{invalidateProjectDeployments:E}),(0,l.jsx)(sE,{invalidateProjectDeployments:E}),(0,l.jsx)(sw.I,{volumeInstanceId:K.id,volumeInstanceExternalId:K.externalId})]}),(0,l.jsxs)("div",{className:"flex flex-col gap-y-4 sm:gap-0 sm:flex-row sm:justify-between sm:items-center",children:[(0,l.jsx)(sg.E,{deployment:null!=G?G:R,staticUrl:null==R?void 0:R.staticUrl,tcpProxies:q}),(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsx)(sp.S,{serviceInstanceConfig:y,serviceInstance:j}),(0,l.jsx)(sj,{serviceInstanceConfig:y}),(0,l.jsx)(sf,{serviceInstanceConfig:y})]})]}),(0,l.jsxs)(l.Fragment,{children:[!O.length&&(null==(o=L[0])||null==(r=o.meta)?void 0:r.failedReason)?(0,l.jsx)(ed.l,{variant:"warning",children:null==(c=L[0])?void 0:c.meta.failedReason}):null,(0,l.jsx)(sm,{deployments:O,isFirstDeployment:Q,serviceInstanceConfig:y,isLoading:k,onDeployFromSource:Y,source:y.source,permissions:f}),L.length>0&&(0,l.jsx)("div",{className:"mb-8",children:(0,l.jsx)(su,{deployments:L,isLoading:k,onEndReached:()=>{T&&D()},permissions:f})})]})]})}function sE(e){var t,n,s,r,i;let{invalidateProjectDeployments:o}=e,{track:c}=(0,t5.j)(),d=sI(),{serviceId:u}=(0,es.c)(),m=(0,l7.oI)({serviceId:null!=u?u:""}),x=(0,a.Xr)(ae.I7),{showModal:h,hideModal:p}=(0,L.h)(),{modalActions:g}=(0,P.U)(),{graphqlClient:v}=(0,R.q)(),j=(0,sN.n)({mutationFn(e){let{eventId:t,revertReason:n}=e;return v.volumeInstanceRevertMigration({eventId:t,revertReason:n})}}),y=null==(t=m.data)?void 0:t.filter(e=>"migrate"===e.reason&&!e.acknowledgedAt);if(!(null==y?void 0:y.length))return null;let f=y[0],b=x(null!=(r=f.sourceVolumeInstance.region)?r:ae.s9),w=!!(null==b||null==(s=b.deploymentConstraints)||null==(n=s.deprecationInfo)?void 0:n.isDeprecated),N=x(null!=(i=f.destVolumeInstance.region)?i:ae.s9),I=!(null==b?void 0:b.railwayMetal)&&!!(null==N?void 0:N.railwayMetal);return(0,l.jsx)(nB.n4,{children:(0,l.jsx)(ed.l,{icon:$.R2D,size:"xs",variant:"info",className:"border border-neutral rounded-lg py-2 bg-neutral-surface",children:(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 w-full justify-between text-center items-center sm:text-left",children:[(0,l.jsx)("div",{className:"text-foreground font-medium",children:I?(0,l.jsx)(l.Fragment,{children:"This service was automatically upgraded to Railway Metal"}):(0,l.jsx)(l.Fragment,{children:"This service was automatically redeployed by Railway"})}),(0,l.jsxs)("div",{className:"flex gap-2",children:[b!==N&&!w&&(0,l.jsx)(T.$n,{variant:"ghost",color:"gray",className:"font-medium shadow-sm p-3.5 text-nowrap text-neutral-secondary",size:"xs",onClick:async()=>{let e=y[0];h(sk,{migration:e,async onRevert(t){var n,l;let a;if(!u||!e.destVolumeInstance.region)return;await j.mutateAsync({eventId:e.id,revertReason:t}),c({action:"Revert",object:"Volume Migration",properties:{sourceRegion:null!=(n=e.sourceVolumeInstance.region)?n:null,destRegion:null!=(l=e.destVolumeInstance.region)?l:null,railwayInitiated:!0,reason:t||null}});let s=new Date;await Promise.allSettled(y.map(e=>d.mutateAsync({deploymentId:e.deploymentId,deploymentEventId:e.id})));let r=10;await new Promise(e=>{if(r--<=0){clearInterval(a),e(!0);return}a=setInterval(()=>{o().then(t=>{var n;(null==(n=t.data)?void 0:n.pages[0].deployments.edges.find(e=>new Date(e.node.createdAt)>s))&&(clearInterval(a),e(!0))})},6e3)}),await m.refetch(),p(sk)}})},children:"Something's wrong"}),(0,l.jsx)(T.By,{color:"gray",className:"bg-white dark:bg-black font-medium shadow-sm p-3.5 text-nowrap",size:"xs",onClick:async()=>{var e,t,n,a;let s=await Promise.allSettled(y.map(e=>d.mutateAsync({deploymentId:e.deploymentId,deploymentEventId:e.id})));c({action:"Ack",object:"Volume Migration",properties:{sourceRegion:null!=(n=null==(e=y[0])?void 0:e.sourceVolumeInstance.region)?n:null,destRegion:null!=(a=null==(t=y[0])?void 0:t.destVolumeInstance.region)?a:null,railwayInitiated:!0}}),s.filter(e=>"rejected"===e.status).length?g.createToast((0,l.jsx)(A.y8,{icon:$.X,variant:"error",title:"Error",description:"Failed to acknowledge all volume migration events."})):await m.refetch()},children:"Looks good"})]})]})})})}function sR(e){var t,n,s,r,i,o;let{invalidateProjectDeployments:c}=e,{track:d}=(0,t5.j)(),u=sI(),{serviceId:m}=(0,es.c)(),x=(0,l7.oI)({serviceId:null!=m?m:""}),h=(0,a.Xr)(ae.I7),{graphqlClient:p}=(0,R.q)(),g=(0,sN.n)({mutationFn(e){let{eventId:t,revertReason:n}=e;return p.volumeInstanceRevertMigration({eventId:t,revertReason:n})}}),v=(0,a.Xr)(ae.kW),{showModal:j,hideModal:y}=(0,L.h)(),{modalActions:f}=(0,P.U)(),b=null==(t=x.data)?void 0:t.slice(0,1).filter(e=>e.destVolumeInstance.serviceId===m)[0],w=null==(n=x.data)?void 0:n.filter(e=>"migrate"!==e.reason&&!e.acknowledgedAt);if(!b||!(null==w?void 0:w.length))return null;let N=h(null!=(s=b.sourceVolumeInstance.region)?s:ae.s9),I=h(null!=(r=b.destVolumeInstance.region)?r:ae.s9),k=!(null==N?void 0:N.railwayMetal)&&!!(null==I?void 0:I.railwayMetal),C=v(null!=(i=b.sourceVolumeInstance.region)?i:ae.s9),S=v(null!=(o=b.destVolumeInstance.region)?o:ae.s9);return(0,l.jsx)(nB.n4,{children:(0,l.jsx)(ed.l,{icon:$.R2D,size:"xs",variant:"info",className:"border border-neutral rounded-lg py-2 bg-neutral-surface",children:(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 w-full justify-between text-center items-center sm:text-left",children:[(0,l.jsx)("div",{className:"text-foreground font-medium",children:k&&C===S?(0,l.jsxs)(l.Fragment,{children:["This service was migrated to Railway Metal in"," ",S]}):k||C!==S?(0,l.jsxs)(l.Fragment,{children:["This service was migrated from"," ",(0,l.jsxs)("span",{children:[C," "]}),"to ",S]}):(0,l.jsxs)(l.Fragment,{children:["This service was migrated to a legacy region in"," ",S]})}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)(T.$n,{variant:"ghost",color:"gray",className:"font-medium p-3.5 text-nowrap text-neutral-secondary",size:"xs",onClick:async()=>{j(sk,{migration:b,async onRevert(e){var t,n;let l;if(!m||!b.destVolumeInstance.region)return;await g.mutateAsync({eventId:b.id,revertReason:e}),d({action:"Revert",object:"Volume Migration",properties:{sourceRegion:null!=(t=b.sourceVolumeInstance.region)?t:null,destRegion:null!=(n=b.destVolumeInstance.region)?n:null,railwayInitiated:!1,reason:e||null}});let a=new Date;await Promise.allSettled(w.map(e=>u.mutateAsync({deploymentId:e.deploymentId,deploymentEventId:e.id})));let s=10;await new Promise(e=>{if(s--<=0){clearInterval(l),e(!0);return}l=setInterval(()=>{c().then(t=>{var n;(null==(n=t.data)?void 0:n.pages[0].deployments.edges.find(e=>new Date(e.node.createdAt)>a))&&(clearInterval(l),e(!0))})},6e3)}),await x.refetch(),y(sk)}})},children:"Something's wrong"}),(0,l.jsx)(T.By,{color:"gray",className:"bg-white dark:bg-black font-medium shadow-sm p-3.5 text-nowrap",size:"xs",onClick:async()=>{var e,t;let n=await Promise.allSettled(w.map(e=>u.mutateAsync({deploymentId:e.deploymentId,deploymentEventId:e.id})));d({action:"Ack",object:"Volume Migration",properties:{sourceRegion:null!=(e=b.sourceVolumeInstance.region)?e:null,destRegion:null!=(t=b.destVolumeInstance.region)?t:null,railwayInitiated:!1}}),n.filter(e=>"rejected"===e.status).length?f.createToast((0,l.jsx)(A.y8,{icon:$.X,variant:"error",title:"Error",description:"Failed to acknowledge all volume migration events."})):await x.refetch()},children:"Looks good"})]})]})})})}let sL=e=>{let{project:t,serviceInstanceConfig:n,...a}=e,s=(0,a8.dy)(),r=(0,a8._e)(),i=(0,a2.PV)(n),{routes:o}=(0,es.c)(),c=!s.allowed&&s.message.includes("resources"),d=!s.allowed&&s.message===em.RESOURCE_ACCESS_ERRORS.TRIAL_EXPIRED;return null!=i&&(r.allowed||r.message===em.RESOURCE_ACCESS_ERRORS.ANONYMOUS_PROJECT)||s.allowed||s.message===em.RESOURCE_ACCESS_ERRORS.ANONYMOUS_PROJECT?null:(0,l.jsx)(lH,{showUpgradeCta:c,title:"Limited Access",message:s.message===em.RESOURCE_ACCESS_ERRORS.LIMITED_PLAN?(0,l.jsxs)("div",{className:"max-w-sm",children:["Your account is on a limited plan and can only deploy databases."," ",(0,l.jsx)(eu.N,{...o.workspacePlan({}),variant:"underline",children:"Upgrade your plan"}),(0,l.jsx)(tv.h,{y:5}),(0,l.jsx)(eu.N,{variant:"underline",href:"https://docs.railway.com/reference/pricing/free-trial#full-vs-limited-trial",children:"View limited free trial docs"})]}):c?(0,l.jsxs)(l.Fragment,{children:["Deployments have been removed because you have run out of resources.",(0,l.jsx)(eu.N,{...o.workspacePlan({}),variant:"underline",children:"Upgrade your plan to continue deploying."})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("p",{className:"my-2",children:s.message}),d&&(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(eu.N,{...o.workspacePlan({}),variant:"underline",children:"Upgrade your plan to continue deploying."})})]}),...a})};var sM=n(42873),sP=n(59613),sz=n(6670),sO=n.n(sz),sU=n(30595);let sF=e=>{var t;let{serviceInstance:n}=e;return null!=n&&null!=n.source&&null!=n.source.image&&Object.keys(null!=(t=n.volumeMounts)?t:{}).length>0},sV=["RAILWAY_PUBLIC_DOMAIN","RAILWAY_TCP_PROXY_DOMAIN"];var sB=n(90567),s_=n(38982),sq=n(5953),sW=n(69444),sK=n(79006),sY=n(65178),sQ=n(81009),s$=n(76933),sG=n(45047),sJ=n(17057),sX=n(18407);let sH=e=>{let{name:t,values:n,addVariable:a}=e;return(0,l.jsxs)(sX.Ff,{className:"text-gray-600 rounded",children:[(0,l.jsx)("div",{className:"text-sm font-mono truncate",children:t}),(0,l.jsxs)("div",{className:"mx-3 text-sm space-y-2 truncate",children:["Found in"," ",n.map(e=>{let{environmentName:t}=e;return t}).join(", ")]}),(0,l.jsx)(nB.n4,{children:(0,l.jsx)("div",{className:"flex items-center justify-end text-sm actions",children:(0,l.jsxs)(sJ.ms,{children:[(0,l.jsx)(sJ.Lk,{icon:$.GvN,title:"Variable actions",className:"p-1 pr-0"}),(0,l.jsx)(sJ.pm,{align:"end",children:n.map((e,n)=>{let{environmentName:s,environmentId:r}=e;return(0,l.jsx)(sJ.tJ,{onSelect:()=>a({name:t,environmentId:r}),children:(0,l.jsxs)("span",{children:["Import from ",(0,l.jsx)("strong",{children:s})]})},"".concat(r,"-").concat(t,"-").concat(n))})})]})})})]})};var sZ=n(8289);let s0=e=>{let{suggestedVariables:t,onAddVariables:n,hideSuggestedVariables:a}=e,{register:s,control:r,handleSubmit:i,formState:{errors:o}}=(0,ty.mN)({defaultValues:{variables:Object.entries(t).map(e=>{let[t,n]=e;return{name:t,value:n}})}}),{fields:c,remove:d}=(0,ty.jz)({control:r,name:"variables"});return(0,l.jsxs)(eb.T,{justify:"center",className:"text-center",children:[(0,l.jsx)(ee.EY,{className:"leading-6 font-medium mb-2",children:"Suggested Variables"}),(0,l.jsx)(ee.xC,{className:"leading-5 text-gray-500 mb-6",children:"We found some variables in your repo that you might need"}),(0,l.jsxs)(tx.lV,{enableBindings:!0,onSubmit:i(e=>{n(e.variables.reduce((e,t)=>{let{name:n,value:l}=t;return{...e,[n]:l}},{}))}),name:"Suggested Variables",children:[(0,l.jsx)("ul",{className:"space-y-3",children:c.map((e,t)=>{var n,a;return(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,l.jsx)(th.pd,{placeholder:"VARIABLE_NAME",...s("variables.".concat(t,".name"),{required:!0,pattern:e6.envVarRegex}),label:{text:"Name",hidden:!0},defaultValue:e.name,error:null!=o.variables&&(null==(n=o.variables[0])?void 0:n.name)!=null,className:"flex-grow"}),(0,l.jsx)(th.pd,{placeholder:"VALUE",...s("variables.".concat(t,".value")),label:{text:"Value",hidden:!0},defaultValue:e.value,error:null!=o.variables&&(null==(a=o.variables[0])?void 0:a.value)!=null,className:"flex-grow"}),(0,l.jsx)(T.K0,{type:"button",title:"Remove",icon:$.TBR,color:"red",onClick:()=>d(t),className:"min-w-[42px] min-h-[42px]"})]},e.id)})}),(0,l.jsxs)(eb.z,{align:"center",space:2,justify:"end",className:"mt-4",children:[(0,l.jsx)(T.$n,{type:"button",color:"gray",variant:"outline",onClick:a,children:"Hide"}),(0,l.jsx)(T.$n,{children:"Add All"})]})]})]})};var s1=n(62827);let s2=e=>{var t;let{project:n,environment:s,environmentConfig:r,service:o,serviceInstanceConfig:c,allowEditing:d}=e,u=(0,a.md)(z.mz),{routes:m,query:x}=(0,es.c)(),{isConfirmed:h}=(0,E.S)(),{track:p}=(0,t5.j)(),g=(0,a.md)((0,U.cs)({serviceId:o.id,environmentId:s.id})),{domainActions:v}=(0,a3.M)({projectId:n.id,environmentId:s.id,serviceId:o.id}),[j,y]=(0,i.useState)({name:"",value:""}),f=n.id,b=s.id,w=o.id,[N,I]=(0,i.useState)(!1),{phantomVariables:C,decryptPhantomVariable:S}=(e=>{let{projectId:t,environmentId:n,pluginId:l=null,serviceId:a=null}=e,{projectVariables:s,projectVariablesByEnvironment:r}=(0,tl.i$)({projectId:t}),o=(0,i.useMemo)(()=>{var e,t;let i=(null!=(t=s.data)?t:[]).filter(e=>e.id!==n).reduce((e,t)=>({...e,[t.id]:{environmentName:t.name,variables:t.variables.filter(e=>e.pluginId===l&&e.serviceId===a&&!e.isSealed)}}),{}),o=new Set(null==(e=r[n])?void 0:e.map(e=>e.name)),c={};for(let[e,{environmentName:t,variables:n}]of Object.entries(i))for(let l of n)o.has(l.name)||(null==c[l.name]&&(c[l.name]=[]),c[l.name].push({environmentId:e,environmentName:t}));return c},[s,r]),{graphqlClient:c}=(0,R.q)();return{phantomVariables:o,decryptPhantomVariable:async e=>{let{name:n,environmentId:s}=e,{unrenderedVariables:r}=await c.variables({projectId:t,environmentId:s,pluginId:l,serviceId:a});return r[n]}}})({projectId:f,environmentId:b,serviceId:w}),D=Object.entries(null!=(t=c.variables)?t:{}).filter(e=>{let[,t]=e;return null!=t}).map(e=>{let[t,n]=e;return{name:t,value:n.value,generator:n.generator,isSealed:n.isSealed}}),{order:A,setOrder:L}=(0,sW.R)(w),M=(0,i.useMemo)(()=>(0,e6.sortVariablesByOrder)({order:A,variables:D}),[A,D]),O=(0,i.useMemo)(()=>{let e={};return n.services.forEach(t=>{e[t.name]=t.id}),e},[n]),F=(0,i.useMemo)(()=>{let e={};return n.services.forEach(t=>{e[t.name]=t.id,e[t.id]=t.name}),e},[n]),{publicEgressReferences:V}=(e=>{let{environmentConfig:t,mapServiceNamesToIds:n}=e;return(0,i.useMemo)(()=>{let e=function(e,t){var n;let l={};return Object.entries(null!=(n=e.services)?n:{}).forEach(e=>{var n;let[a,s]=e;return Object.entries(null!=(n=s.variables)?n:{}).forEach(e=>{var n;let[s,r]=e,i="".concat(a,".").concat(s),o=(0,sP.replaceNamespaces)(null!=(n=null==r?void 0:r.value)?n:"",t);l[i]=o})}),l}(t,n);return{publicEgressReferences:(0,sP.findNestedReferences)(e,sV)}},[t,n])})({environmentConfig:r,mapServiceNamesToIds:O}),[B,_]=(0,sU.A)("@railway/suggestedVariables/project/".concat(f,"/").concat(w),{defaultValue:!0}),{suggestedVariables:{data:q}}=(e=>{let{projectId:t,environmentId:n,serviceId:l,enabled:a}=e,{graphqlClient:s}=(0,R.q)(),{result:r}=(0,er.W)(["suggestedVariables",t,n,l],async()=>{if(null==t||null==n||null==l)throw Error("No projectId or environmentId or serviceId");return(await s.serviceInstanceSuggestedVariables({environmentId:n,serviceId:l})).serviceInstanceSuggestedVariables},{enabled:a&&null!=t&&null!=n,refetchOnWindowFocus:!1});return{suggestedVariables:r}})({projectId:f,environmentId:b,serviceId:w,enabled:B&&!0===d&&0===M.length}),W=(e=>{let{serviceInstance:t}=e;return(0,i.useMemo)(()=>sF({serviceInstance:t}),[t])})({serviceInstance:c}),{variables:K,warnings:Y}=(0,s_.z)(),{upsertVariable:Q,upsertVariables:G,deleteVariable:J,promoteToSharedVariable:H,upsertVariablesFromObject:et,setVariablesFromObject:en,onUpdateVariableGenerator:el,onSealVariable:ea}=(0,sq.m)({projectId:f,environment:s,environmentConfig:r,serviceId:w}),ei=(0,eH.U7)({projectId:f,environmentId:b,serviceId:w,enabled:u}),{unrenderedVariables:eo,renderedVariables:ec}=ei,{unorderedSharedVariables:ed,variablesForAutocomplete:em,autocompleteOptions:ex,nameAutocompleteOptions:eh}=s7({project:n,serviceId:w,environmentConfig:r,...ei}),ep=(0,i.useMemo)(()=>null==eo?null:(0,e6.sortVariablesByOrder)({order:A,variables:Object.entries(eo).map(e=>{let[t,n]=e;return{name:t,value:n}})}).reduce((e,t)=>{let{name:n,value:l}=t;return{...e,[n]:l}},{}),[A,eo]),ev=(0,i.useMemo)(()=>(0,e6.sortVariablesByOrder)({order:A,variables:ed}),[A,ed]),[{suggestAddPluginRefVariable:ej},{dismissSuggestAddPluginRefVariable:ew}]=(e=>{let{serviceId:t,environmentConfig:n}=e,[l,a]=(0,sU.A)("@railway/suggestAddPluginRef/dismissed",{defaultValue:{}});return[{suggestAddPluginRefVariable:(0,i.useMemo)(()=>{var e;return Object.entries(null!=(e=n.services)?e:{}).filter(e=>{let[,t]=e;return sF({serviceInstance:t})}).length>0},[n])&&!l[t]},{dismissSuggestAddPluginRefVariable:()=>{a(e=>({...e,[t]:!0}))}}]})({serviceId:w,environmentConfig:r}),[eN,eI]=(0,i.useState)("string"==typeof x.addingVariable&&("string"==typeof x.openAutocomplete?"yesAndForceAutocomplete":"yes")),ek=(0,i.useMemo)(()=>{let e=new Map;for(let t of ev)M.some(e=>{var n,l;let a=null!=(l=null!=(n=null==e?void 0:e.value)?n:null==ep?void 0:ep[e.name])?l:"",s="".concat(tl.MS,".").concat(t.name);return e.name===t.name&&(0,sP.containsDirectReference)(a,s)})&&e.set(t.name,{...t,serviceId:null});return e},[ev,ep,M]),eC=e=>"${{".concat(tl.MS,".").concat(e,"}}"),eS=async e=>{let{name:t}=e;await Q({name:t,value:eC(t)})},eT=async e=>{let{name:t,value:n,isSealed:l}=e;if(("Port"===t||"port"==t)&&await h({cancelLabel:"No, leave it as is",confirmLabel:"Yep, change it to PORT",message:"Railway looks for the PORT variable name in all caps. Did you mean to add a PORT variable to the service?",theme:"info",title:"Did you mean PORT?"}))return eI(!1),Q({name:"PORT",value:n,isSealed:l});eI(!1),await Q({name:t,value:n,isSealed:l})},eD=async e=>{eI(!1),await G(e)},eA=async e=>{e.stopPropagation(),await G(ev.filter(e=>!ek.has(e.name)).map(e=>({name:e.name,value:eC(e.name)})))},eE=async e=>{let{name:t,environmentId:n}=e,l=await S({name:t,environmentId:n});await Q({name:t,value:l})},[eR,eL]=(0,i.useState)(!1),{modalActions:eM}=(0,P.U)(),eP=()=>{null!=ep&&eM.openModal((0,l.jsx)(eg.aF,{title:"Raw Environment Variable Editor",className:"md:min-w-[640px]",children:(0,l.jsx)(sZ.N,{variables:M.reduce((e,t)=>{var n;let{name:l,value:a,isSealed:s}=t;return{...e,[l]:{value:s?k.SECRET_VARIABLE_VALUE:null!=(n=null!=a?a:ep[l])?n:"",isSealed:s}}},{}),setVariables:async e=>{eL(!0),L(Object.keys(e)),await en({variables:e,existingDecryptedVariables:ep}),eL(!1)}})}))},[{suggestAddServiceDomain:ez}]=(0,sB.K)({serviceId:o.id});return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(eb.T,{space:4,className:"variables pb-12",children:[null!=w&&(0,l.jsx)(nB.n4,{children:(0,l.jsxs)(eb.T,{className:"border-b border-gray-100",children:[eN?(0,l.jsx)("div",{children:(0,l.jsx)(sG._x,{hideAutocompleteHint:!0,defaultValues:j,forceAutocomplete:"yesAndForceAutocomplete"===eN,onCancel:()=>eI(!1),nameAutocompleteOptions:eh,autocompleteOptions:ex,onAddVariable:eT,onAddMultipleVariables:eD,publicDomainSuggestion:ez,onClickDomainSuggestion:()=>{v.createServiceDomain({})},checkConflict:e=>{var t;return(null==(t=em.find(t=>t.name===e))?void 0:t.serviceId)===w}})},"form"):(0,l.jsxs)(eb.z,{align:"center",children:[(0,l.jsxs)("div",{className:"font-medium",children:[M.length>0?M.length:"No"," ",(0,ey.td)("Service Variable",M.length)]}),(0,l.jsxs)(eb.z,{align:"center",space:1,className:"ml-auto",children:[(0,l.jsx)(T.$n,{size:"sm",variant:N?"outline":"ghost",name:"Insert Shared Variable",icon:N?$.rXn:$.AUU,isLoading:eR,"aria-controls":"shared variables","aria-expanded":!!N&&"true",onClick:()=>{p({action:N?"Close":"Open",object:"Service Shared Variables"}),I(!N)},children:(0,l.jsx)("span",{className:"text-gray-600",children:N?"Close Shared Variables":"Shared Variable"})}),(0,l.jsx)(T.$n,{size:"sm",variant:"ghost",name:"Raw Service Variable Editor",icon:$.rTt,onClick:eP,isLoading:eR,disabled:null==ep,className:"hidden md:flex",children:(0,l.jsx)("span",{className:"text-gray-600",children:"Raw Editor"})}),(0,l.jsx)(T.$n,{size:"sm",name:"New Service Variable",variant:"outline",icon:$.FWt,onClick:()=>eI("yes"),className:"new-variable",children:"New Variable"})]})]}),(0,l.jsx)(eb.T,{className:"mt-6",children:(0,l.jsxs)(sQ.M,{isOpen:N,children:[0===ev.length&&(0,l.jsx)(s8,{onClose:()=>I(!1)}),0!==ev.length&&(0,l.jsxs)("div",{className:"rounded-md dark:bg-gray-100 bg-secondaryBg my-4",children:[(0,l.jsxs)(eb.z,{align:"center",className:"mx-4 py-3 border-b border-gray-100 dark:border-gray-200",children:[(0,l.jsxs)(ee.ax,{children:[ek.size," of"," ",ev.length," shared variables in use"]}),(0,l.jsx)("span",{"aria-hidden":!0,className:"mx-1",children:"\xb7"}),(0,l.jsx)(eu.N,{...m.projectSharedVariables({}),children:(0,l.jsx)(ee.xC,{className:"underline",children:"Edit Shared Variables"})}),(0,l.jsxs)(eb.z,{space:1,className:"ml-auto -mr-2",children:[(0,l.jsx)(T.$n,{onClick:eA,variant:"ghost",size:"sm",disabled:ek.size===ev.length,className:"text-sm whitespace-nowrap",children:"Add All"}),(0,l.jsx)(T.K0,{icon:$.X,onClick:()=>I(!1),title:"Close Shared Variables"})]})]}),(0,l.jsx)(eb.T,{className:"py-2",children:ev.map(e=>{var t,n,a;let s=ek.has(e.name);return(0,l.jsx)(tn._,{name:e.name,componentLeft:(0,l.jsx)(Z.In,{icon:s?$.Jlk:$.qzq,className:"text-gray-500"}),value:null!=(a=null==(t=(null!=(n=r.sharedVariables)?n:{})[e.name])?void 0:t.value)?a:null,onAdd:s?"added":eS,serviceId:w,serviceIdsAndNames:F},e.name)})})]})]})})]})}),(0,l.jsxs)(eb.T,{space:4,className:(0,X.xW)(eN&&"opacity-50"),children:[u&&(0,l.jsx)("div",{className:"border-b border-gray-100",children:(0,l.jsx)(s1.g,{onClick:e=>{let{name:t}=e;eI("yes"),y({name:"",value:"${{".concat(t,"}}")})},variables:null!=ec?ec:void 0})}),(0,l.jsxs)("div",{className:"grid gap-1",children:[!W&&ej&&(0,l.jsx)(s5,{setAddingVariable:eI,dismissSuggestAddPluginRefVariable:ew}),W&&(0,l.jsx)(s4,{serviceId:w}),0===M.length?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(s6,{onOpenBulkImport:eP}),B&&null!=q&&Object.keys(q).length>0&&Object.keys(q).length<=10&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(ef.c,{className:"my-8"}),(0,l.jsx)(s0,{suggestedVariables:q,onAddVariables:e=>et({variables:e}),hideSuggestedVariables:()=>_(!1)})]})]}):M.map(e=>{var t,n,a,s;let r=null!=(a=null!=(n=e.value)?n:(null!=ep?ep:{})[e.name])?a:null,i=(0,sP.findDirectNamespaceReference)(null!=r?r:"")===tl.MS,o=(0,sP.findReferences)(null!=r?r:"").length>0,c=V["".concat(w,".").concat(e.name)],u=W?K[e.name]:void 0,m=u?{title:u.title,description:"user"===u.type?Y.USER_CHANGE_WARNING:Y.PASSWORD_CHANGE_WARNING}:void 0;return(0,l.jsx)(eb.T,{space:1,children:(0,l.jsx)(tn._,{name:e.name,value:r,isStaged:(null==g||null==(t=g.variables)?void 0:t[e.name])!=null,renderedValue:null!=(s=(null!=ec?ec:{})[e.name])?s:null,autocompleteOptions:ex,componentLeft:(0,l.jsx)(s3,{variable:e,isSharedRef:i}),isSealed:e.isSealed,publicEndpointReferences:c,serviceId:w,serviceIdsAndNames:F,editWarning:m,...d?{onEdit:Q,onDelete:J,onSeal:e.isSealed?void 0:ea,generator:e.generator,onGeneratorUpdate:null==e.generator&&o?void 0:t=>el({name:e.name,generator:t}),onPromoteToShared:o||null==r?void 0:e=>{let{name:t}=e;return H({name:t,value:r})}}:{},className:"rounded"},e.name)},e.name)})]})]})]}),!c.isCreated&&d&&Object.keys(C).length>0&&(0,l.jsxs)("div",{className:"mt-8 phantom-variables",children:[(0,l.jsxs)(eb.z,{align:"center",space:3,children:[(0,l.jsx)(Z.In,{icon:$.kbL,size:"sm",className:"text-gray-600"}),(0,l.jsxs)(ee.zb,{children:[Object.keys(C).length," ",(0,ey.td)("Variable",Object.keys(C).length)," ","are included in other environments but missing in this one."]})]}),(0,l.jsx)(ef.c,{className:"mt-6 mb-3"}),Object.entries(C).map(e=>{let[t,n]=e;return(0,l.jsx)(sH,{name:t,values:n,addVariable:eE},t)})]})]})},s5=e=>{let{setAddingVariable:t,dismissSuggestAddPluginRefVariable:n}=e;return(0,l.jsxs)(ed.l,{icon:$.Ssj,size:"sm",className:"py-1 mb-4 flex items-center",children:[(0,l.jsxs)("p",{children:["Looking to connect a database? Add a"," ",(0,l.jsx)(T.z9,{variant:"underline",onClick:()=>{t("yesAndForceAutocomplete"),setTimeout(()=>t("yes"),0)},children:"Variable Reference"})]}),(0,l.jsx)(T.K0,{iconStyles:"text-gray-400",title:"Dismiss",icon:$.X,onClick:n,className:"ml-auto -mr-2"})]})},s4=e=>{let{serviceId:t}=e,[n,a]=(0,sU.A)("@railway/suggestConnectRef/dismissed",{defaultValue:{}});return n[t]?null:(0,l.jsxs)(ed.l,{icon:$.Ssj,size:"sm",className:"py-1 mb-4 flex items-center",children:[(0,l.jsxs)("p",{children:["Looking to connect this service to another? Add a"," ",(0,l.jsx)(eu.N,{variant:"underline",href:"https://docs.railway.com/develop/variables#reference-variables",children:"Variable Reference"})]}),(0,l.jsx)(T.K0,{iconStyles:"text-gray-400",title:"Dismiss",icon:$.X,onClick:()=>{a(e=>({...e,[t]:!0}))},className:"ml-auto -mr-2"})]})},s6=e=>{let{onOpenBulkImport:t}=e;return(0,l.jsxs)(eb.T,{space:1,justify:"center",className:"text-center py-14 rounded-lg border border-dashed border-gray-200",children:[(0,l.jsx)(ee.xC,{className:"leading-6 font-semibold",children:"No Environment Variables"}),(0,l.jsx)(nB.n4,{children:(0,l.jsxs)(ee.xC,{className:"leading-5 text-gray-500 max-w-lg mx-auto",children:["Import all your variables using the"," ",(0,l.jsx)(T.z9,{variant:"underline",onClick:t,children:"Raw Editor"})]})})]})},s8=e=>{let{onClose:t}=e,{routes:n}=(0,es.c)(),{colorMode:a}=(0,sK.DP)();return(0,l.jsxs)("div",{className:"relative rounded-md dark:bg-gray-50 bg-secondaryBg px-8 md:px-12 my-4 background-image[url(/illustrations/shared-variables-blurred-blob.svg)] bg-left-bottom bg-no-repeat",children:[(0,l.jsx)(T.K0,{icon:$.X,title:"Close",onClick:t,iconStyles:"text-gray-500",className:"absolute right-3 top-3"}),(0,l.jsxs)(eb.z,{justify:"center",align:"center",className:"mx-auto flex-wrap",children:[(0,l.jsx)("div",{className:"my-8 min-w-full md:min-w-0 md:mr-10 text-center",children:(0,l.jsx)(sO(),{src:"light"===a?"/illustrations/shared-variables-light.svg":"/illustrations/shared-variables-dark.svg",alt:"graph of shared variable pointed to multiple services",width:190,height:146})}),(0,l.jsxs)(eb.T,{space:2,className:"max-w-xl mb-8 md:mt-8 flex-1",children:[(0,l.jsx)(ee.ax,{className:"font-semibold",children:"Keep variables in sync across services"}),(0,l.jsxs)(ee.xC,{children:["Create a shared variable in"," ",(0,l.jsx)(eu.N,{...n.projectSharedVariables({}),variant:"underline",children:"Project Settings"})," ","or promote an existing service variable to a shared variable via the"," ",(0,l.jsx)(ee.R0,{children:"⋮"})," icon."]}),(0,l.jsxs)(eb.z,{className:"pt-2 flex-wrap",children:[(0,l.jsx)(nB.n4,{children:(0,l.jsx)(T.vx,{variant:"primary",color:"pink",size:"sm",...n.projectSharedVariables({}),className:"w-full md:w-auto",children:"Configure Shared Variables"})}),(0,l.jsx)(T.vx,{variant:"outline",color:"pink",size:"sm",...n.docs({page:"develop/variables#shared-variables"}),className:"my-3 md:my-0 md:ml-3 w-full md:w-auto",children:"View Docs"})]})]})]})]})},s3=e=>{let{variable:t,isSharedRef:n}=e,{routes:a}=(0,es.c)();return t.isSealed?(0,l.jsx)(s$.m,{side:"right",content:(0,l.jsx)(l.Fragment,{children:"This variable is sealed. You cannot view the value of sealed variables."}),children:(0,l.jsx)(Z.In,{icon:$.X_F,className:"text-gray-400",size:"sm"})}):n?(0,l.jsx)(s$.m,{side:"right",content:(0,l.jsxs)(l.Fragment,{children:["This variable is referencing a shared variable. You can configure"," ",(0,l.jsx)(eu.N,{variant:"underline",...a.projectSharedVariables({}),children:"shared variables in Project Settings"}),"."]}),children:(0,l.jsx)(Z.In,{icon:$.qzq,className:"text-gray-400",size:"sm"})}):null!=t.generator?(0,l.jsx)(s$.m,{side:"right",content:(0,l.jsxs)(l.Fragment,{children:["This variable is generated using a"," ",(0,l.jsx)(eu.N,{variant:"underline",...a.docs({page:"guides/create#template-variable-functions"}),children:"template variable function"}),"."]}),children:(0,l.jsx)(Z.In,{icon:$.G9Y,className:"text-gray-400",size:"sm"})}):(0,l.jsx)(Z.In,{icon:$.rTt,className:"text-gray-400",size:"sm"})};function s7(e){let{project:t,serviceId:n,environmentConfig:a,providedVariablesForEnvironment:s,renderedVariables:r}=e,o=(0,i.useMemo)(()=>{var e;return Object.entries(null!=(e=null==a?void 0:a.sharedVariables)?e:{}).filter(e=>{let[,t]=e;return null!=t}).map(e=>{let[t,n]=e;return{name:t,value:n.value}})},[null==a?void 0:a.sharedVariables]),c=(0,i.useMemo)(()=>{var e;let t=Object.entries(null!=(e=null==a?void 0:a.services)?e:{}).flatMap(e=>{var t;let[n,l]=e;return Object.entries(null!=(t=l.variables)?t:{}).map(e=>{let[t]=e;return{name:t,serviceId:n}})}),l=Object.entries(null!=s?s:{}).flatMap(e=>{let[t,n]=e;return Object.entries(null!=n?n:{}).map(e=>{let[n]=e;return{name:n,serviceId:t}})}),i=[...t,...o.map(e=>({...e,serviceId:null})),...l],c=e=>(0,sY.G)(e)?4:e.serviceId!=n?2:1;if(null!=n)for(let e of Object.keys(null!=r?r:{}))null==i.find(t=>t.name===e)&&e.match(/^railway_(tcp|public|private)_/i)&&i.push({serviceId:n,name:e});return i.sort((e,t)=>{let n=c(e),l=c(t);return l!==n?n-l:e.name.localeCompare(t.name)}),i},[s,r,o,n]);return{...(0,i.useMemo)(()=>{let e=[],a=[];for(let r of c){let i,o,c;if((0,sY.G)(r))i=tl.MS,o=$.qzq;else if(null!=r.serviceId&&r.serviceId!=n){var s;let e=null==t||null==(s=t.services)?void 0:s.find(e=>e.id===r.serviceId);if(null==e)continue;i=e.name,c=e.name,o=null!=e.icon?()=>(0,l.jsx)($.xfq,{src:e.icon}):$.rTt}else o=$.rTt;let d={icon:o,value:(0,sP.buildTemplateTag)({variableName:r.name,namespace:i}),numMatchStart:1,numMatchStop:1};e.push(d),o!==$.rTt&&a.push({hint:c,icon:o,valueOption:d,value:r.name,numMatchStart:0,numMatchStop:1})}return{autocompleteOptions:e,nameAutocompleteOptions:a}},[c]),variablesForAutocomplete:c,unorderedSharedVariables:o}}var s9=n(25390);let re=e=>{var t;e.backups.length&&e.backups.reduce((e,t)=>e.createdAt>t.createdAt?e:t,e.backups[0]);let n=null==(t=e.schedules)?void 0:t.map(e=>(0,a7.DY)(e.cron)).reduce((e,t)=>!e||t&&e.getTime()>t.getTime()?t:e,null);return e.isReadOnly?(0,l.jsx)("div",{className:"flex justify-between items-center",children:(0,l.jsx)("h1",{className:"font-medium text-xl",children:"Backups"})}):(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(n||e.canEditBackup||e.backups.length>0)&&(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(Z.In,{icon:$.zD7,size:"sm",className:"text-gray-400 dark:text-gray-500"}),(0,l.jsx)("span",{className:"text-gray-500 dark:text-gray-400 text-sm",children:n?(0,l.jsxs)(l.Fragment,{children:["Next backup ",(0,l.jsx)(aT.s,{className:"text-gray-900 dark:text-white font-medium",children:n})]}):"No backup schedule"})]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[e.canEditBackup&&(0,l.jsx)(T.$n,{variant:"ghost",color:"gray",size:"sm",className:"text-gray-500 font-medium dark:text-gray-400",onClick:e.onUpdateSchedule,children:"Edit schedule"}),e.canEditBackup&&(0,l.jsx)(T.$n,{variant:"outline",color:"gray",size:"sm",className:"font-medium",onClick:e.onCreateBackup,isLoading:e.isCreatingBackup,disabled:e.isCreatingBackup||e.isVolumeLocked,children:"New backup"})]})]})};var rt=n(94837);let rn=e=>{let t=e=>e<10?"0".concat(e):e,n=new Date(e);return"".concat(n.getUTCFullYear(),"-").concat(t(n.getUTCMonth()+1),"-").concat(t(n.getUTCDate())," ").concat(t(n.getUTCHours()),":").concat(t(n.getUTCMinutes())," UTC")},rl=e=>{if(0===e)return"< 1 MB";if(null==e)return"0 bytes";let t=1024*e*1024;return t>=0x10000000000?"".concat(Math.round(t/0x10000000000*100)/100," TB"):t>=0x40000000?"".concat(Math.round(t/0x40000000*100)/100," GB"):t>=1048576?"".concat((t/1048576).toFixed(0)," MB"):t>=1024?"".concat((t/1024).toFixed(0)," KB"):"".concat(t," bytes")},ra=e=>{let{backup:t,state:n,permissions:a,actions:s,schedules:r}=e,i=null==t.expiresAt,o=n.isRestoring||a.isVolumeLocked||!a.canEdit,c=()=>{if(!t.scheduleId)return"manual backup";if(r&&r.length>0){let e=r.find(e=>e.id===t.scheduleId);if(e)switch(e.kind){case u.lcj.Daily:return"daily backups";case u.lcj.Weekly:return"weekly backups";case u.lcj.Monthly:return"monthly backups"}}return"scheduled backups"};return(0,l.jsxs)(av.q7,{"data-testid":"backup",value:t.id,className:(0,X.xW)("group rounded-lg transition-all duration-100 border border-neutral-light hover:border-neutral","cursor-pointer",n.isCurrentlyRestoring?"bg-neutral-surface":"bg-background-secondary"),onMouseMove:s.onHover,onMouseLeave:s.onMouseOut,onClick:e=>{e.preventDefault(),e.stopPropagation(),s.onSelect(e)},children:[(0,l.jsx)(av.Y9,{className:"p-0.5",children:(0,l.jsx)("div",{className:(0,X.xW)("flex items-center gap-4 w-full px-3 py-3 transition-colors duration-100",n.isCurrentlyRestoring?"":n.isSelected?"bg-gray-50 dark:bg-[#1C1A28] rounded-md":"group-hover:bg-gray-50 dark:group-hover:bg-[#1C1A28] rounded-md"),children:n.isCurrentlyRestoring?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"flex-shrink-0",children:(0,l.jsx)(rt.k,{})}),(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsx)("div",{className:"flex items-center gap-2",children:(0,l.jsx)("span",{className:"text-neutral-secondary font-medium text-base tabular-nums",children:"Restoring..."})}),(0,l.jsxs)("div",{className:"flex items-center gap-1 text-sm text-secondary mt-1",children:[(0,l.jsx)(aT.s,{className:"tabular-nums",children:t.createdAt}),(0,l.jsxs)("span",{className:"tabular-nums",children:["via ",c()]}),(0,l.jsx)("span",{className:"opacity-60",style:{fontSize:"8px"},children:"•"}),(0,l.jsx)("span",{className:"tabular-nums",children:rl(t.referencedMB||0)})]})]})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(Z.In,{icon:$.akk,className:"text-gray-400 flex-shrink-0",size:"md"}),(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{className:"text-neutral-primary font-medium text-base tabular-nums",children:t.name}),i&&(0,l.jsx)(Z.In,{icon:$.c_I,className:"text-primary",size:"sm"})]}),(0,l.jsxs)("div",{className:"flex items-center gap-1 text-sm text-neutral-secondary mt-1",children:[(0,l.jsx)(aT.s,{className:"tabular-nums",children:t.createdAt}),(0,l.jsxs)("span",{className:"tabular-nums",children:["via ",c()]}),(0,l.jsx)("span",{className:"opacity-60",style:{fontSize:"8px"},children:"•"}),(0,l.jsx)("span",{className:"tabular-nums",children:rl(t.referencedMB||0)})]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2 flex-shrink-0",children:[!o&&(0,l.jsx)(T.$n,{variant:"outline",color:"gray",size:"sm",className:"font-medium opacity-0 group-hover:opacity-100 transition-all duration-200",onClick:e=>{e.stopPropagation(),s.onRestore()},children:"Restore"}),!o&&(0,l.jsxs)(sJ.ms,{children:[(0,l.jsx)(sJ.Lk,{icon:$.GvN,size:"sm",title:"Backup actions",className:"text-neutral-secondary w-8 h-8 hover:bg-neutral-surface-hover rounded opacity-0 group-hover:opacity-100 transition-all duration-100"}),(0,l.jsxs)(sJ.pm,{align:"end",children:[t.scheduleId&&!i?(0,l.jsx)(sJ.tJ,{onSelect:s.onLock,disabled:a.isVolumeLocked,children:(0,l.jsx)(ee.ax,{children:"Lock backup"})}):null,(0,l.jsx)(sJ.tJ,{onSelect:s.onDelete,className:"text-red-600",disabled:a.isVolumeLocked,children:(0,l.jsx)(ee.ax,{children:"Delete backup"})})]})]})]})]})})}),(0,l.jsx)(av.UC,{className:"px-4 pb-4 pt-2 border-t border-gray-200 dark:border-gray-600",children:(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-x-8 gap-y-3 text-sm",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-500 dark:text-gray-300",children:"Created"}),(0,l.jsx)("p",{className:"text-gray-900 dark:text-white font-medium mt-0.5 tabular-nums",children:rn(t.createdAt)})]}),!a.isReadOnly&&(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-500 dark:text-gray-300",children:"Method"}),(0,l.jsx)("p",{className:"text-gray-900 dark:text-white font-medium mt-0.5 tabular-nums",children:t.scheduleId?t.name:"Manual"})]}),t.expiresAt?(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-500 dark:text-gray-300",children:"Expires"}),(0,l.jsx)("p",{className:"text-gray-900 dark:text-white font-medium mt-0.5 tabular-nums",children:new Date(t.expiresAt).getTime()>Date.now()?(0,l.jsx)(aT.s,{className:"tabular-nums",children:t.expiresAt}):"Scheduled"})]}):null,(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-500 dark:text-gray-300",children:"Total size"}),(0,l.jsx)("p",{className:"text-gray-900 dark:text-white font-medium mt-0.5 tabular-nums",children:t.referencedMB?rl(t.referencedMB):"Unknown"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-500 dark:text-gray-300",children:"Incremental size"}),(0,l.jsx)("p",{className:"text-gray-900 dark:text-white font-medium mt-0.5 tabular-nums",children:t.usedMB?rl(t.usedMB):"No change"})]})]})})]})},rs=e=>{let{backupToRestore:t}=e;return(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("p",{className:"text-gray-900 dark:text-white",children:"Restoring will create a new volume containing all the data at the time of the backup."}),(0,l.jsx)("p",{className:"text-gray-900 dark:text-white",children:"The current volume will remain attached to the service."}),(0,l.jsxs)("div",{className:"pt-2",children:[(0,l.jsx)("p",{className:"text-neutral-secondary font-medium text-sm mb-3",children:"Backup that will be restored"}),(0,l.jsxs)("div",{className:"flex items-center justify-between px-4 py-2.5 bg-background dark:bg-secondaryBg rounded-xl border border-neutral-light",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)(Z.In,{icon:$.akk,className:"text-gray-400 dark:text-gray-500",size:"md"}),(0,l.jsx)("span",{className:"font-medium text-sm text-gray-900 dark:text-white",children:t?rn(t.createdAt):"Unknown"})]}),(0,l.jsx)("span",{className:"text-gray-500 dark:text-[#868593]",children:rl((null==t?void 0:t.referencedMB)||0)})]})]})]})},rr=e=>{let{graphqlClient:t}=(0,R.q)(),{result:n,invalidateQuery:l,queryKey:a}=(0,er.W)(["backups",e],async()=>{var n;return e?null!=(n=(await t.volumeInstanceBackupList({volumeInstanceId:e})).volumeInstanceBackupList)?n:[]:null},{enabled:null!=e}),s=(0,i.useMemo)(()=>{var e;return[...null!=(e=n.data)?e:[]].sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime())},[n.data]);return{backups:n,sortedBackups:s,invalidateBackups:l,queryKey:a,findBackupById:e=>s.find(t=>t.id===e)||null}};var ri=n(85133),ro=n(22248),rc=n(29221),rd=n(21531),ru=n.n(rd),rm=n(44661);let rx=[{type:u.lcj.Daily,label:"Daily",description:"Backed up every 24 hours, kept for 6 days."},{type:u.lcj.Weekly,label:"Weekly",description:"Backed up every 7 days, kept for 1 month."},{type:u.lcj.Monthly,label:"Monthly",description:"Backed up every 30 days, kept for 3 months."}],rh=e=>{let{volumeInstanceId:t,schedules:n,invalidateSchedules:a}=e,{modalActions:s}=(0,P.U)(),{graphqlClient:r}=(0,R.q)(),[o,c]=(0,i.useState)(!1),d=(null!=n?n:[]).map(e=>rx.find(t=>t.type===e.kind)).filter(e=>!!e),[u,m]=(0,i.useState)(d),x=d.length&&0===u.length,h=e=>u.some(t=>(null==t?void 0:t.type)===e.type),p=async()=>{let e=u.map(e=>e.type);if(!t||o||ru()(e,d.map(e=>e.type)))return void s.exitModal();c(!0);try{await r.volumeInstanceBackupScheduleUpdate({volumeInstanceId:t,kinds:e}),s.createToast((0,l.jsx)(A.y8,{title:"Schedule Saved",description:u.map(e=>e.label).join(", "),variant:"success",icon:$.Jlk}))}catch(e){s.createToast((0,l.jsx)(A.y8,{title:"Schedule Saving Failed",description:"".concat(u.map(e=>e.label).join(", ")||"Error",": ").concat(e.message),variant:"error",icon:$.X}))}finally{a(),c(!1),s.exitModal()}};return(0,l.jsx)(eg.aF,{title:"Edit Schedule",className:"w-No[460px]",children:(0,l.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,l.jsx)(eg.wt,{children:"Configure backup schedule"}),(0,l.jsx)(ee.EY,{className:"text-sm",children:"Run volume backups for your environment on a schedule."}),(0,l.jsxs)("div",{className:"flex flex-col gap-2 mb-6",children:[(0,l.jsx)(ee.EY,{className:"text-sm font-medium text-gray-600",children:"Available Schedules"}),rx.map(e=>(0,l.jsxs)(tx.JU,{htmlFor:e.type,className:(0,X.xW)("mb-0","flex items-center gap-6 px-6 py-4 rounded-lg","border","focus-within:border-blue-500 focus-within:ring-2 focus-within:ring-blue-500/10",h(e)?"bg-blue-50 border-blue-500":"border-gray-200"),children:[(0,l.jsx)(rm.S,{checked:h(e),id:e.type,value:"daily",size:"sm",onChange:()=>{h(e)?m(u.filter(t=>t.type!==e.type)):m([...u,e])}}),(0,l.jsxs)("div",{className:"flex flex-col select-none",children:[(0,l.jsxs)(ee.EY,{className:"text-gray-950 font-medium text-[14px]",children:[" ",e.label]}),(0,l.jsx)(ee.EY,{className:"text-gray-600 font-normal text-sm",children:e.description})]})]},e.type)),x?(0,l.jsx)(ed.l,{variant:"warning",hideIcon:!0,className:"text-sm",children:"No schedules selected. Scheduled backups will be turned off."}):null]}),(0,l.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,l.jsx)(T.$n,{variant:"outline",color:"gray",onClick:()=>s.exitModal(),children:"Cancel"}),(0,l.jsx)(T.$n,{isLoading:o,disabled:o,onClick:p,children:"Save schedule"})]})]})})},rp=e=>{var t,n;let{project:s,environment:r,service:o,volumeId:d,isReadOnly:x=!1,canvasAtoms:h}=e;(0,c.jE)();let{graphqlClient:p}=(0,R.q)(),v=(0,a.md)(z.mz),[j,y]=(0,i.useState)([]),{modalActions:f}=(0,P.U)(),I=(0,N.T7)(),k=(0,N.gq)(),{routes:C}=(0,es.c)(),S=(0,i.useRef)(null),{isPro:D}=(0,ej.hA)(),{openCommandPalette:L}=(0,w.oG)(),M=D&&v&&!x,{volumeInstances:O}=(0,a.md)((0,ai.zC)(r.id)),F=(0,a.md)(U.EQ),V=(0,a.md)((0,m.Om)(r.id)),B=o?(0,U.Zd)({config:F,serviceId:o.id}):null,_=null!=d?d:Object.keys(null!=(t=null==B?void 0:B.volumeMounts)?t:{})[0],q=O.find(e=>e.volumeId===_),W=null==q?void 0:q.id,{lockStatus:K,isLocked:Y}=(0,eR.db)({volumeInstanceId:null!=W?W:null}),{result:Q,invalidateQuery:G}=(0,er.W)(["schedules",W],async()=>W?(await p.volumeInstanceBackupScheduleList({volumeInstanceId:W})).volumeInstanceBackupScheduleList:null,{enabled:null!=W}),{backups:J,sortedBackups:X,invalidateBackups:H,queryKey:et,findBackupById:en}=rr(W);i.useEffect(()=>{J.data&&y(e=>e.filter(e=>{var t,n;return null!=(n=null==(t=J.data)?void 0:t.some(t=>t.id===e))&&n}))},[J.data]);let{isCreatingBackup:el,restoringBackupId:ea,onCreateBackup:ei,onDeleteBackup:eo,onRestoreBackup:em,onLockBackup:ex}=(e=>{let{volumeInstanceId:t,isLocked:n,canEditBackup:s,environment:r,canvasAtoms:o}=e,d=(0,a.md)(o.optimistic.nodesAtom),m=(0,a.Xr)(o.optimistic.createNodeAtom),x=(0,a.Xr)(o.optimistic.removeNodeAtom),{graphqlClient:h}=(0,R.q)(),{isConfirmed:p}=(0,E.S)(),v=(0,c.jE)(),{modalActions:j}=(0,P.U)(),{findBackupById:y,invalidateBackups:f}=rr(t),[b,w]=(0,i.useState)(null),[N,I]=(0,i.useState)(!1),[k,C]=(0,i.useState)(null),S=(0,a.Xr)(ri.eT),T=async()=>{if(!s||!t||n)return;b&&j.exitToast(b),I(!0);let e=j.createToast((0,l.jsx)(A.y8,{title:"Creating backup"}),0);w(e);try{await h.volumeInstanceBackupCreate({volumeInstanceId:t})}catch(t){j.exitToast(e),w(null),I(!1),j.createToast((0,l.jsx)(A.y8,{title:"Backup creation failed",description:t.message,variant:"error",icon:$.hcu}))}},D=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1?arguments[1]:void 0;if(!t||n||!a&&0===e.length)return;if(e.length>1){if(!await p({confirmLabel:"Delete Backups",input:"delete forever",message:"Are you sure you want to delete ".concat(e.length," backups? Deleted backups can't be recovered."),title:"Confirm Deletion of ".concat(e.length," Backups"),type:"input"}))return}else if(a){let e=y(a);if(e&&!await p({confirmLabel:"Delete Backup",input:"delete forever",message:"Are you sure you want to delete backup from ".concat(rn(e.createdAt),"? Deleted backups can't be recovered."),title:"Confirm Backup Deletion",type:"input"}))return}b&&j.exitToast(b);let s=j.createToast((0,l.jsx)(A.y8,{title:"Deleting backup"}),0);w(s);try{a?await h.volumeInstanceBackupBatchDelete({volumeInstanceId:t,volumeInstanceBackupIds:[a]}):e.length>0&&await h.volumeInstanceBackupBatchDelete({volumeInstanceId:t,volumeInstanceBackupIds:e})}catch(e){j.exitToast(s),w(null),j.createToast((0,l.jsx)(A.y8,{title:"Backup deletion failed",description:e.message,variant:"error",icon:$.hcu}))}},L=async e=>{if(!s||!t||n)return;let a=y(e);if(!await p({confirmLabel:"Restore",theme:"info",message:(0,l.jsx)(rs,{backupToRestore:a}),title:"Restore backup"}))return;C(e);let r=(0,ro.Nz)("volume",e);m({id:r,name:"Restoring backup...",createdAt:Date.now(),isPending:!0,type:"volume"});try{await h.volumeInstanceBackupRestore({volumeInstanceId:t,volumeInstanceBackupId:e})}catch(e){C(null),x(r),j.createToast((0,l.jsx)(A.y8,{title:"Backup restoration failed",description:e.message,variant:"error",icon:$.hcu}))}let i=()=>{v.invalidateQueries()};setTimeout(i,1e3),setTimeout(i,3e3),setTimeout(i,8e3)},M=async e=>{if(!s||!t||n)return;let a=j.createToast((0,l.jsx)(A.y8,{title:"Locking backup"}),0);try{await h.volumeInstanceBackupLock({volumeInstanceId:t,volumeInstanceBackupId:e}),f(),j.createToast((0,l.jsx)(A.y8,{title:"Locked backup",variant:"success",icon:$.Jlk}))}catch(e){j.createToast((0,l.jsx)(A.y8,{title:"Locking backup failed",description:e.message,variant:"error",icon:$.hcu}))}finally{j.exitToast(a)}};return(0,eP.R)(u.KRm,{variables:t?{volumeInstanceId:t}:null,onError:e=>{b&&(j.exitToast(b),w(null),I(!1),j.createToast((0,l.jsx)(A.y8,{title:"Backup operation failed",description:"There was an error processing your backup request. Please try again.",variant:"error",icon:$.hcu})))},dependencies:[b,k],onNext:e=>{var t;let{data:n}=e;if(b&&j.exitToast(b),w(null),I(!1),v.invalidateQueries({queryKey:(0,g.mi)(null!=(t=null==r?void 0:r.id)?t:"")}),f(),null==n?void 0:n.backups)if(null!=n.backups.deletedAt)n.backups.error?j.createToast((0,l.jsx)(A.y8,{title:"Backup deletion failed",description:n.backups.error,variant:"error",icon:$.hcu})):j.createToast((0,l.jsx)(A.y8,{title:"Backup deleted successfully",variant:"success",icon:$.Jlk}));else if(n.backups.isRestoration){if(v.invalidateQueries(),k)for(let[e]of Object.entries(d))(0,ro.sl)(e)===k&&x(e);n.backups.error?(j.createToast((0,l.jsx)(A.y8,{title:"Backup restoration failed",description:n.backups.error,variant:"error",icon:$.hcu})),C(null)):(C(null),n.backups.restoredVolumeInstanceId&&k&&S({volumeInstanceId:n.backups.restoredVolumeInstanceId,backupId:k,restoredAt:Date.now()}),j.createToast((0,l.jsx)(A.y8,{title:"Backup restored successfully",description:"A new unmounted volume has been created. Use the command palette to mount it to a service.",variant:"success",icon:$.Jlk})))}else if(n.backups.error){let e=n.backups.error.includes("Unable to allocate volume with that size");j.createToast((0,l.jsx)(A.y8,{title:"Backup creation failed",description:n.backups.error,variant:"error",icon:$.hcu,actionTitle:e?"Learn more":void 0,href:e?"https://station.railway.com/feedback/volume-backups-e599f60e":void 0}),n.backups.error.length>120?1e4:void 0)}else j.createToast((0,l.jsx)(A.y8,{title:"Backup created successfully",description:n.backups.name,variant:"success",icon:$.Jlk}))},disabled:null===t}),{isCreatingBackup:N,restoringBackupId:k,onCreateBackup:T,onDeleteBackup:D,onRestoreBackup:L,onLockBackup:M}})({volumeInstanceId:W,isLocked:Y,canEditBackup:M,environment:r,canvasAtoms:h}),{activeElementId:eh,setActiveElementId:ep}=(e=>{let{tableGridRef:t,selected:n,sortedBackups:l,setSelected:a,selectBackup:s}=e,[r,o]=(0,i.useState)(null),c=l.findIndex(e=>e.id===r),d=()=>{var e,t;o(null!=(t=null==(e=l[0])?void 0:e.id)?t:null)},u=()=>null!=t.current&&0===n.length,m=e=>{if(e.preventDefault(),!u())return;if(null===c)return void d();let t=c+1;if(t<l.length){var n,a;o(null!=(a=null==(n=l[t])?void 0:n.id)?a:null)}},x=e=>{if((0,rc._0)(e)||(e.preventDefault(),!u()))return;if(null===c)return void d();let t=c-1;if(t>=0){var n,a;o(null!=(a=null==(n=l[t])?void 0:n.id)?a:null)}};return(0,i.useEffect)(()=>{let e=(0,b.Ay)(window,{j:m,k:x,ArrowDown:m,ArrowUp:x,ArrowRight:m,ArrowLeft:x,Escape:()=>{a([]),o(null)},Enter:()=>{var e,t,a,r;if(n.length>0){(null==(e=l[n[0]])?void 0:e.id)&&s(null==(t=l[n[0]])?void 0:t.id);return}null!=c&&(null==(a=l[c])?void 0:a.id)&&s(null==(r=l[c])?void 0:r.id)}});return()=>e()},[n,c,l]),{activeElementId:r,setActiveElementId:o}})({tableGridRef:S,selected:j,setSelected:y,sortedBackups:X,selectBackup:e=>{if(j.includes(e))return void y(t=>t.filter(t=>t!==e));if(0===j.length)y([e]);else if(I){var t;let n=null!=(t=X.findIndex(t=>t.id===e))?t:0,l=[...j.map(e=>X.findIndex(t=>t.id===e))].filter(e=>null!=e).sort((e,t)=>e-t)[0],a=[];for(let e=Math.min(n,l);e<=Math.max(n,l);e+=1)a.push(e);y(a.map(e=>{var t;return null==(t=X[e])?void 0:t.id}))}else k?j.includes(e)?y(t=>t.filter(t=>t!==e)):y(t=>[...t,e]):y([e])}}),eg=()=>{W&&M&&f.openModal((0,l.jsx)(rh,{invalidateSchedules:G,volumeInstanceId:W,schedules:Q.data}))},ev=D?null:(0,l.jsxs)("div",{title:"Upgrade to Pro to enable Backups",children:[(0,l.jsx)(tv.h,{y:4}),(0,l.jsx)(ed.l,{variant:"primary",size:"sm",className:"mb-3 gap-3 ",children:(0,l.jsxs)("div",{className:"flex items-center justify-between gap-2 w-full flex-wrap",children:[(0,l.jsx)("p",{children:"Backups are only available for customers on the Pro plan."}),(0,l.jsx)(eu.N,{...C.workspacePlan({}),children:(0,l.jsx)("span",{className:"mr-1 underline",children:"More information"})})]})})]});return V?W?(0,l.jsxs)("div",{children:[ev,(0,l.jsxs)("div",{className:"flex flex-col gap-y-4 mb-4 relative",children:[(0,l.jsx)(re,{backups:null!=(n=J.data)?n:[],canEditBackup:M,schedules:Q.data,onCreateBackup:ei,onCreateSchedule:()=>{eg()},onUpdateSchedule:eg,isCreatingBackup:el,isReadOnly:x,isVolumeLocked:Y}),J.isLoading||J.error||0!==X.length?null:(0,l.jsxs)("div",{className:"flex flex-col justify-center items-center pt-8 ",children:[(0,l.jsx)(Z.In,{icon:$.zD7,size:"40",className:"text-gray-600 mb-5"}),(0,l.jsx)(ee.QO,{children:"No Backups"}),(0,l.jsx)(ee.zb,{children:"This service's volume does not have any backups."}),M&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(tv.h,{y:4}),(0,l.jsx)(T.$n,{onClick:ei,disabled:Y,children:"Create Backup"})]})]})]}),(0,l.jsx)(eD.N,{children:X.length>0&&j.length>0&&(0,l.jsx)(eT.P.div,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},exit:{opacity:0,y:16},transition:{duration:.1,ease:s9.vT},className:"flex justify-center items-center absolute bottom-8 left-6 right-0 z-10",children:(0,l.jsxs)("div",{className:"bg-gray-800 dark:bg-gray-200 rounded-full text-white flex items-center justify-start pl-4 pr-2 py-1 shadow-md",children:[(0,l.jsx)("p",{className:"text-center mr-6",children:j.length>0&&"".concat(j.length," ").concat((0,ey.td)("backup",j.length)," selected")}),(0,l.jsxs)("div",{className:"flex",children:[(0,l.jsx)(T.K0,{title:"Delete Backup",icon:$.TBR,hidden:0===j.length||Y,onClick:()=>eo(j),iconStyles:"text-white",className:"hover:bg-transparent hover:border-none"}),(0,l.jsx)(T.K0,{title:"Dismiss selection",icon:$.X,hidden:0===j.length,onClick:()=>{y([])},iconStyles:"text-white",className:"hover:bg-transparent hover:border-none"})]})]})})}),J.isLoading?(0,l.jsx)(ec.m6,{className:"mt-20"}):J.error?(0,l.jsxs)("div",{className:"mt-10 text-red-500 flex flex-row justify-center",children:[(0,l.jsx)(Z.In,{icon:$.Jpz}),"\xa0",(0,l.jsxs)(ee.Bv,{className:"-mt-1",children:["Unable to list backups: ",J.error.message]})]}):X.length>0?(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(av.bL,{className:"w-full select-none space-y-2",type:"multiple",ref:S,children:X.map(e=>{let t={id:e.id,name:rn(e.createdAt),createdAt:e.createdAt,expiresAt:e.expiresAt,usedMB:e.usedMB,referencedMB:e.referencedMB,scheduleId:e.scheduleId},n={isFocused:eh==e.id,isSelected:j.includes(e.id),isRestoring:null!==ea||(null==q?void 0:q.state)!==u.sDj.Ready,isCurrentlyRestoring:e.id===ea};return(0,l.jsx)(ra,{backup:t,state:n,permissions:{canEdit:M,isReadOnly:x,isVolumeLocked:Y},actions:{onLock:()=>ex(e.id),onRestore:()=>em(e.id),onDelete:()=>eo(j,e.id),onSelect:t=>{t.shiftKey&&y(t=>t.includes(e.id)?t.filter(t=>t!==e.id):[...t,e.id])},onHover:()=>ep(e.id),onMouseOut:()=>ep(null)},schedules:Q.data},e.id)})})}):null]}):(0,l.jsx)("div",{className:"flex flex-col justify-center items-center pt-8 border border-dashed border-gray-200 rounded-lg p-8",children:(0,l.jsx)("p",{className:"text-gray-500 text-sm",children:"No volume instance found for this service"})}):(0,l.jsx)("div",{className:"flex flex-col justify-center items-center pt-8",children:(0,l.jsx)(ec.m6,{})})},rg=e=>{var t,n;let{state:a,createDrive:s}=e,{modalActions:r}=(0,P.U)(),[o,c]=(0,ei.b)(),{register:d,control:u,handleSubmit:m,formState:{errors:x}}=(0,ty.mN)(),[h,p]=(0,i.useState)(!1),g=async e=>{try{c(null),p(!0),await (null==s?void 0:s({directory:e.directory,object:JSON.parse(e.object),drive:e.drive})),r.createToast((0,l.jsx)(A.y8,{variant:"success",title:"".concat(a.titleCase(a.concepts.drive)," successfully added!")})),r.exitModal()}catch(e){c(e.message)}p(!1)};return(0,l.jsx)(tx.lV,{onSubmit:m(g),name:"Add ".concat(a.concepts.drive),className:"space-y-4 md:min-w-96",children:(0,l.jsxs)(eb.T,{space:5,children:[(0,l.jsxs)(eg.wt,{children:["Add ",a.concepts.drive]}),null!=o&&(0,l.jsx)(ee.yn,{children:o}),(0,l.jsx)(th.pd,{...d("drive",{required:!0,minLength:2,maxLength:128}),label:"".concat(a.concepts.drive," name"),error:null!=x.drive}),a.requiresInitialValue?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(th.pd,{...d("directory",{required:!0,minLength:2,maxLength:128}),label:"".concat(a.concepts.directory," name"),error:null!=x.directory}),(0,l.jsx)(ty.xI,{name:"object",control:u,rules:{required:!0},defaultValue:JSON.stringify(null!=(n=null==(t=a.defaults)?void 0:t.object)?n:{}),render:e=>{let{field:{onChange:t,value:n}}=e;return(0,l.jsxs)(eb.T,{children:[(0,l.jsxs)(th.JU,{children:[a.titleCase(a.concepts.object)," (json)"]}),(0,l.jsx)(tp.i,{value:JSON.parse(n),onChange:e=>t(e),editorStyles:{margin:0}}),null!=x.object&&(0,l.jsx)(ee.ax,{className:"text-red-400",children:"Required"})]})}})]}):void 0,(0,l.jsxs)(eb.z,{justify:"end",space:3,children:[(0,l.jsx)(T.$n,{type:"button",color:"gray",onClick:()=>r.exitModal(),children:"Cancel"}),(0,l.jsxs)(T.jn,{type:"submit",isLoading:h,children:["Add ",a.concepts.drive]})]})]})})},rv=e=>{let[,t]=iy(),[n,a]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{if(!n)return;let e=setTimeout(()=>a(!1),500);return()=>clearTimeout(e)},[n]),(0,l.jsx)($.e9t,{...e,className:(0,X.xW)(e.className,"refresh ".concat(n?"animate-spin":"")),onClick:()=>{a(!0),t.refresh()}})};var rj=n(40774),ry=n(67214),rf=n(40302);let rb=()=>{let{graphqlClient:e}=(0,R.q)(),{result:t,invalidateQuery:n}=(0,er.W)(["all-platform-feature-flags"],async()=>(await e.allPlatformFeatureFlags()).allPlatformFeatureFlags),l=(0,i.useMemo)(()=>t.data?new Map(t.data.map(e=>[e.flag,e])):new Map,[t.data]);return{flags:t.data,isLoading:t.isLoading,error:t.error,isEnabled:e=>{var t;let n=l.get(e);return null!=(t=null==n?void 0:n.status)&&t},getFlagStatus:e=>l.get(e),invalidateQuery:n}};var rw=n(3149),rN=n(28812),rI=n(19031),rk=n(93874);let rC=e=>{let{value:t,onChange:n,onSubmit:a,placeholder:s="SELECT * FROM ...",autoFocus:r=!1,databaseType:o="postgres",tables:c=[],className:d=""}=e,u=(0,i.useRef)(null),m=(0,i.useRef)(null),{colorMode:x}=(0,sK.DP)(),h="dark"===x,p=(0,i.useMemo)(()=>c,[c]);return(0,i.useEffect)(()=>{if(!u.current)return;m.current&&(m.current.destroy(),m.current=null);let e=(()=>{switch(o){case"mysql":return rj.hi;case"postgres":return rj.Rv;default:return rj.I$}})(),l=(()=>{if(0===p.length)return{};let e={};return p.forEach(t=>{e[t]=[]}),e})(),i=[rw.Lz.updateListener.of(e=>{e.docChanged&&n(e.state.doc.toString())}),rw.Lz.domEventHandlers({keydown:(e,t)=>(("ArrowUp"===e.key||"ArrowDown"===e.key||"ArrowLeft"===e.key||"ArrowRight"===e.key)&&e.stopPropagation(),!1)}),rw.Lz.lineWrapping,rw.Lz.theme({"&":{fontSize:"14px",border:h?"1px solid rgb(55, 65, 81)":"1px solid rgb(229, 231, 235)",borderRadius:"0.375rem"},".cm-content":{padding:"12px 16px",minHeight:"44px",fontFamily:"Menlo, Monaco, Courier New, monospace",lineHeight:"20px"},".cm-selectionBackground":{backgroundColor:"rgba(59, 130, 246, 0.3) !important"},".cm-selected":{backgroundColor:"rgba(59, 130, 246, 0.3) !important"},".cm-tooltip.cm-tooltip-autocomplete":{backgroundColor:h?"#1a1b26":"#ffffff",border:h?"1px solid #414868":"1px solid #e5e7eb",borderRadius:"0.375rem",boxShadow:h?"0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.1)":"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)"},".cm-tooltip.cm-tooltip-autocomplete > ul":{backgroundColor:h?"#1a1b26":"#ffffff",color:h?"#c0caf5":"#374151",borderRadius:"0.375rem",maxHeight:"200px",overflowY:"auto"},".cm-tooltip.cm-tooltip-autocomplete > ul > li":{padding:"6px 12px",cursor:"pointer",borderRadius:"0.25rem",margin:"2px 4px",display:"flex",alignItems:"center",gap:"8px"},".cm-tooltip.cm-tooltip-autocomplete > ul > li[aria-selected]":{backgroundColor:h?"#414868":"#dbeafe",color:h?"#c0caf5":"#1e40af"}}),(0,rI.b6)(),rf.Nb.highest(rw.w4.of([{key:"Enter",run:e=>{if("active"===(0,rN.DH)(e.state))return(0,rN.$w)(e),(0,rN.N)(e),!0;if(a){let t=e.dom.closest("form");if(t){let e=new Event("submit",{bubbles:!0,cancelable:!0});t.dispatchEvent(e)}else a()}return!0}}])),rw.w4.of([...rI.pw,...rI.cL,...rN.Bc,{key:"Tab",run:e=>"active"===(0,rN.DH)(e.state)?(0,rN.$w)(e):(0,rN.rB)(e)},{key:"Space",run:e=>{e.dispatch({changes:{from:e.state.selection.main.head,insert:" "},selection:{anchor:e.state.selection.main.head+1}});let t=e.state.selection.main.head+1;return t<e.state.doc.length||setTimeout(()=>(0,rN.rB)(e),0),!0}}]),(0,rj.ll)({dialect:e,schema:l,upperCaseKeywords:!0}),(0,ry.SG)(),(0,rN.wm)(),(0,rN.yU)({activateOnTyping:!0,maxRenderedOptions:8,closeOnBlur:!0,defaultKeymap:!0,activateOnCompletion:()=>!0}),h?rk.PP:rk.tN,(0,rw.qf)(s)],c=rf.$t.create({doc:t,extensions:i}),d=new rw.Lz({state:c,parent:u.current});return m.current=d,r&&d.focus(),()=>{d.destroy()}},[h,o,p,s]),(0,l.jsx)("div",{ref:u,className:d})},rS=e=>{var t,n;let{onShowResults:a,initialQuery:s}=e,[r,o]=iy(),[c,d]=(0,i.useState)(s||""),[m,x]=(0,ei.b)(),{modalActions:h}=(0,P.U)(),[p,g]=(0,i.useState)(null),{isConfirmed:v}=(0,E.S)(),[j,y]=(0,i.useState)(!1),{track:f}=(0,t5.j)(),{isEnabled:b}=rb(),[w,N]=(0,i.useState)(!1),I=(0,i.useMemo)(()=>r.directoryNames.data||[],[r.directoryNames.data]),k=(0,i.useMemo)(()=>{var e;return"SELECT * FROM ".concat((null==(e=r.directoryNames.data)?void 0:e[0])||"table_name")},[null==(t=r.directoryNames.data)?void 0:t[0]]);if(!1===b(u.UkX.EnableRawSqlQueries))return null;if(!o.runRawQuery)return(0,l.jsx)("div",{className:"p-4",children:(0,l.jsx)(ee.ae,{children:"Raw SQL queries are not supported for this database type."})});let C=async()=>{try{if(g(null),""===c.trim()||(e=>{for(let t of t1)if(e.includes(t))return!0;return!1})(c)&&!await v({message:"Looks like you're doing a destructive action. Please confirm to proceed.",title:"Are you sure?"}))return;y(!0);let{query:e,wasLimited:t}=((e,t)=>{try{let n=rf.$t.create({doc:e,extensions:[(0,rj.ll)()]}),l=(0,ry.mv)(n),a=!1,s=!1;if(l.iterate({enter(e){("SelectStatement"===e.name||"Statement"===e.name)&&n.doc.sliceString(e.from,e.to).toLowerCase().includes("select")&&(s=!0),("Limit"===e.name||"LimitClause"===e.name)&&(a=!0)}}),s&&!a){let n=e.trim(),l=n.endsWith(";")?n.slice(0,-1):n;return{query:"".concat(l," LIMIT ").concat(t),wasLimited:!0}}return{query:e,wasLimited:!1}}catch(n){if(!/\bLIMIT\b/i.test(e)&&e.toLowerCase().includes("select"))return{query:"".concat(e," LIMIT ").concat(t),wasLimited:!0};return{query:e,wasLimited:!1}}})(c,100),n=await o.runRawQuery({query:e});N(t),f({action:"Submit",object:"DataUI Raw Query",properties:{query:e,autoLimited:t}}),g(n),a&&a(n,c,t),h.createToast((0,l.jsx)(A.y8,{variant:"success",title:"Query ran successfully"}))}catch(e){x(e.message)}y(!1)};return(0,l.jsx)(tx.lV,{onSubmit:C,enableBindings:!0,children:(0,l.jsxs)(eb.T,{space:3,children:[(0,l.jsxs)("div",{className:"flex space-x-3 items-center",children:[(0,l.jsx)("div",{className:"flex-1",children:(0,l.jsx)(rC,{value:c,onChange:d,onSubmit:C,placeholder:k,autoFocus:!0,databaseType:r.databaseType,tables:I})}),(0,l.jsx)(T.$n,{isLoading:j,disabled:""===c.trim()||j,children:"Run query"})]}),null!=m&&(0,l.jsx)(ee.yn,{children:m}),!a&&null==p&&!j&&(0,l.jsx)("div",{className:"mt-12 text-center px-6",children:(0,l.jsx)("div",{className:"max-w-md mx-auto",children:(0,l.jsxs)("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 p-8",children:[(0,l.jsx)("svg",{className:"mx-auto h-16 w-16 mb-6 text-gray-400 dark:text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2 2m16-7l-3.5 3.5-4-4L8 16l-1.5-1.5"})}),(0,l.jsx)(ee.EY,{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Ready to query your data"}),(0,l.jsxs)(ee.ae,{className:"mb-6 leading-relaxed",children:["Write a SQL query above to explore your"," ",r.databaseType.toUpperCase()," database. Results will appear here when you run a query."]}),(0,l.jsxs)("div",{className:"space-y-2 text-left bg-white dark:bg-gray-900/50 rounded-md p-4 border",children:[(0,l.jsx)("div",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 mb-3",children:"\uD83D\uDCA1 Quick tips:"}),(0,l.jsxs)("div",{className:"text-xs text-gray-600 dark:text-gray-400 space-y-1",children:[(0,l.jsxs)("div",{children:["• Press"," ",(0,l.jsx)("kbd",{className:"px-1.5 py-0.5 bg-gray-100 dark:bg-gray-800 rounded text-xs",children:"Space"})," ","for autocomplete suggestions"]}),(0,l.jsxs)("div",{children:["• Press"," ",(0,l.jsx)("kbd",{className:"px-1.5 py-0.5 bg-gray-100 dark:bg-gray-800 rounded text-xs",children:"Enter"})," ","to run your query"]}),(0,l.jsxs)("div",{children:["• Available tables:"," ",(null==(n=r.directoryNames.data)?void 0:n.join(", "))||"Loading..."]})]})]})]})})}),!a&&null!=p&&(0,l.jsx)(eb.T,{className:"mt-5",children:"mysql"===r.databaseType?(0,l.jsx)(rA,{response:p.raw}):"postgres"===r.databaseType?(0,l.jsx)(rD,{response:p.raw}):(0,l.jsxs)(l.Fragment,{children:["Query response is not supported for ",r.databaseType]})})]})})},rT=e=>{let{value:t,field:n,fields:a}=e,[{formatValue:s}]=iy(),r=a.find(e=>e.name===n);if(null==r)return null;let i="number"==typeof t?t:s(t,r.dataTypeID);return(0,l.jsx)(t8.xC,{children:(0,l.jsx)("span",{title:null!=i?i.toString():i,children:i})})},rD=e=>{var t;let{response:n}=e,{page:a,setPage:s,totalPages:r,visibleItems:i}=t2(null!=(t=n.rows)?t:[],5);return 0===i.length?(0,l.jsxs)("div",{children:[(0,l.jsx)(eT.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,ease:"easeOut"},children:(0,l.jsx)(t8.J6,{children:(0,l.jsxs)(t8.XI,{children:[(0,l.jsx)(t8.D1,{children:(0,l.jsxs)(t8.fI,{children:[(0,l.jsx)(t8.A3,{children:"No Results"}),(0,l.jsx)(t8.A3,{className:"text-right",children:"0 rows"})]})}),(0,l.jsx)(t8.vc,{children:(0,l.jsxs)(t8.fI,{children:[(0,l.jsx)(t8.xC,{children:(0,l.jsx)("span",{className:"text-gray-500 italic",children:"Query returned no rows"})}),(0,l.jsx)(t8.xC,{})]})})]})})}),(0,l.jsx)("div",{className:"flex items-center justify-start mt-2",children:(0,l.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"0 rows"})})]}):i.length>0?(0,l.jsxs)("div",{children:[(0,l.jsx)(eT.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,ease:"easeOut"},children:(0,l.jsx)(t8.J6,{children:(0,l.jsxs)(t8.XI,{children:[(0,l.jsx)(t8.D1,{children:(0,l.jsx)(t8.fI,{children:Object.keys(i[0]).map(e=>(0,l.jsx)(t8.A3,{children:e},e))})}),(0,l.jsx)(t8.vc,{children:i.map((e,t)=>(0,l.jsx)(t8.fI,{children:Object.keys(e).map(t=>(0,l.jsx)(rT,{field:t,value:e[t],fields:n.fields},t))},t))})]})})}),(0,l.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,l.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[n.rows.length," row",1!==n.rows.length?"s":""]}),(0,l.jsx)("div",{className:"flex-1 flex justify-center",children:(0,l.jsx)(t8.$o,{canPreviousPage:a>0,canNextPage:a+1<r,pageIndex:a,totalPages:r,gotoPage:s,previousPage:()=>s(a-1),nextPage:()=>s(a+1)})}),(0,l.jsx)("div",{className:"w-16"})," "]})]}):(0,l.jsx)("pre",{children:JSON.stringify(n,null,2)})},rA=e=>{let{response:t}=e,n=Array.isArray(t[0]),{page:a,setPage:s,totalPages:r,visibleItems:i}=t2(n?t[0]:[],5);if(!n)return(0,l.jsx)("pre",{children:JSON.stringify(t[0],null,2)});let o=t[0];return 0===o.length?(0,l.jsxs)("div",{className:"mt-5",children:[(0,l.jsx)(eT.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,ease:"easeOut"},children:(0,l.jsx)(t8.J6,{children:(0,l.jsxs)(t8.XI,{children:[(0,l.jsx)(t8.D1,{children:(0,l.jsxs)(t8.fI,{children:[(0,l.jsx)(t8.A3,{children:"No Results"}),(0,l.jsx)(t8.A3,{className:"text-right",children:"0 rows"})]})}),(0,l.jsx)(t8.vc,{children:(0,l.jsxs)(t8.fI,{children:[(0,l.jsx)(t8.xC,{children:(0,l.jsx)("span",{className:"text-gray-500 italic",children:"Query returned no rows"})}),(0,l.jsx)(t8.xC,{})]})})]})})}),(0,l.jsx)("div",{className:"flex items-center justify-start mt-2",children:(0,l.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"0 rows"})})]}):(0,l.jsxs)("div",{className:"mt-5",children:[(0,l.jsx)(eT.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,ease:"easeOut"},children:(0,l.jsx)(t8.J6,{children:(0,l.jsxs)(t8.XI,{children:[(0,l.jsx)(t8.D1,{children:(0,l.jsx)(t8.fI,{children:Object.keys(i[0]).map(e=>(0,l.jsx)(t8.A3,{children:e},e))})}),(0,l.jsx)(t8.vc,{children:i.map((e,n)=>(0,l.jsx)(t8.fI,{children:Object.keys(e).map(n=>(0,l.jsx)(rT,{field:n,value:e[n],fields:t.fields},n))},n))})]})})}),(0,l.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,l.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[o.length," row",1!==o.length?"s":""]}),(0,l.jsx)("div",{className:"flex-1 flex justify-center",children:(0,l.jsx)(t8.$o,{canPreviousPage:a>0,canNextPage:a+1<r,pageIndex:a,totalPages:r,gotoPage:s,previousPage:()=>s(a-1),nextPage:()=>s(a+1)})}),(0,l.jsx)("div",{className:"w-16"})," "]})]})},rE=e=>{let{response:t,query:n,onBack:a,onNewQuery:s,wasLimited:r}=e,[o]=iy(),{isEnabled:c}=rb(),d=(0,i.useRef)(null),[m,x]=(0,i.useState)(!1),[h,p]=(0,i.useState)(r||!1);return((0,i.useEffect)(()=>{let e=e=>{if("Escape"===e.key){let n=document.activeElement;if(!n||"INPUT"!==n.tagName&&"TEXTAREA"!==n.tagName)if(e.preventDefault(),e.stopPropagation(),m)a();else{var t;null==(t=d.current)||t.focus(),x(!0)}}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[m,a]),(0,i.useEffect)(()=>{let e=()=>{x(!1)},t=d.current;if(t)return t.addEventListener("blur",e),()=>t.removeEventListener("blur",e)},[]),!1===c(u.UkX.EnableRawSqlQueries))?(a(),null):(0,l.jsxs)(eb.T,{space:2,children:[(0,l.jsxs)("div",{className:"relative flex items-center justify-center mb-2 mt-5",children:[(0,l.jsx)(T.$n,{ref:d,variant:"ghost",size:"sm",onClick:a,className:"absolute left-0 top-0 p-2 transition-colors ".concat(m?"bg-gray-100 border-gray-100":""),children:(0,l.jsx)($.nkM,{size:16})}),(0,l.jsx)(ee.EY,{children:"Query"})]}),(0,l.jsx)(rS,{onShowResults:(e,t,n)=>{p(n||!1),s(e,t,n)},initialQuery:n}),h&&(0,l.jsx)(ed.l,{variant:"info",className:"mb-2",children:(0,l.jsxs)(ee.EY,{className:"text-sm",children:["Query results limited to ",100," rows for performance. Add your own LIMIT clause to control the number of results."]})}),(0,l.jsx)(eb.T,{children:"mysql"===o.databaseType?(0,l.jsx)(rA,{response:t.raw}):"postgres"===o.databaseType?(0,l.jsx)(rD,{response:t.raw}):(0,l.jsxs)(l.Fragment,{children:["Query response is not supported for ",o.databaseType]})})]})},rR=()=>{var e,t;let[n,s]=iy(),[{featureFlags:r}]=(0,ev.Jd)(),{isEnabled:o}=rb(),c=n.data.data,d=(0,a.md)(z.DM),m=(0,a.md)(I.Zy),[x,h]=(0,i.useState)([]),[p,g]=(0,ei.b)(),{routes:v,navActions:j}=(0,es.c)(),y=(0,N.T7)(),f=(0,N.gq)(),k=(0,i.useRef)(null),{isConfirmed:C}=(0,E.S)(),S=(0,i.useRef)(null),[D,A]=(0,i.useState)(null),[R,L]=(0,i.useState)(null),M=d.Write,P=(0,i.useMemo)(()=>{var e;return nY()(null!=(e=n.directoryNames.data)?e:[],[e=>e.toLowerCase()]).filter(e=>null==D||""==D.trim()||e.toLowerCase().includes(D.toLowerCase()))},[n.directoryNames.data,D]),O=o(u.UkX.EnableRawSqlQueries)&&r.includes(u.Fev.RawSqlQueries);(0,i.useEffect)(()=>{null!=D&&""!==D.trim()&&(0===P.length?h([]):1===P.length&&h([0]))},[D,P]),(0,w.bU)(()=>({value:"db-directory-create",text:"New ".concat(n.concepts.directory),icon:$.FWt,highlighted:!0,group:"Data",keybinding:"C",isAvailable:()=>M,action:async()=>{j.push(v.projectPluginView({environmentId:null==m?void 0:m.id,view:"data",query:{state:"create-table"}}))}}),[j,M]),(0,w.bU)(()=>({text:"Generate dummy data",value:"generateDBDummyData",category:"Data",group:"Data",icon:$.KqI,highlighted:!0,isAvailable:()=>{var e;return(null!=n.directoryNames.data||null==n.concepts.directory)&&!(null==(e=n.directoryNames.data)?void 0:e.length)},action:async()=>{try{await s.generateDummyData()}catch(e){g(e.message),tu.A.log("Error generating dummy data",e)}}}),[c,n.directoryNames.data]),(0,w.bU)(()=>({value:"db-directory-filter",text:"Filter ".concat(n.concepts.directoryPlural),icon:$.dJT,group:"Data",keybinding:"/",highlighted:!0,isAvailable:()=>0===x.length,action:()=>{A(""),setTimeout(()=>{var e;return null==(e=S.current)?void 0:e.focus()},0)}}),[x]);let U=s.deleteDirectory?async()=>{if(0!==P.length&&0!==x.length&&await C({confirmLabel:"Delete",message:1===x.length?"Are you sure you want to delete the table ".concat(P[x[0]],"?"):"Are you sure you want to delete ".concat(x.length," ").concat((0,ey.td)("table",x.length),"?"),title:"Delete ".concat(n.concepts.directory)}))try{s.deleteDirectory?(await Promise.all(x.map(e=>{var t;return null==(t=s.deleteDirectory)?void 0:t.call(s,{directory:P[e]})})),h([]),g(null)):g("Unable to delete directory for this database")}catch(e){g(e.message)}}:void 0;(0,w.bU)(()=>({value:"db-delete-directory",text:"Delete ".concat(n.concepts.directory),icon:$.TBR,highlighted:!0,group:"Data",keybinding:"D",isAvailable:()=>x.length>0&&null!=U,action:()=>null==U?void 0:U()}),[x]);let F=e=>{0!==P.length&&j.push(v.projectPluginView({environmentId:null==m?void 0:m.id,view:"data",query:{state:"table",table:e}}))},{activeElement:V,setActiveElement:B}=(e=>{let{tableGridRef:t,selected:n,sortedDirectoryNames:l,setSelected:a,selectDirectory:s}=e,[r,o]=(0,i.useState)(null),c=(0,nj.l)(),d=(0,i.useMemo)(()=>c.width<1024?4:5,[c]),u=()=>{o(0)},m=()=>null!=t.current&&0===n.length;return(0,i.useEffect)(()=>{let e=(0,b.Ay)(window,{ArrowDown:e=>{if(e.preventDefault(),!m())return;if(null==r)return void u();let t=r+d;t>=l.length&&(t=l.length-1),o(t)},ArrowUp:e=>{if(e.preventDefault(),!m())return;if(null===r)return void u();let t=r-d;t<0?o(null):o(t)},ArrowRight:e=>{if(e.preventDefault(),!m())return;if(null===r)return void u();let t=r+1;t<l.length&&o(t)},ArrowLeft:e=>{if(e.preventDefault(),!m())return;if(null===r)return void u();let t=r-1;t>=0&&o(t)},Escape:()=>{a([]),o(null)},Enter:()=>{if(n.length>0)return void s(l[n[0]])}});return()=>e()},[n,r,l]),{activeElement:r,setActiveElement:o}})({tableGridRef:k,selected:x,setSelected:h,sortedDirectoryNames:P,selectDirectory:F});if(null==n.directoryNames||n.directoryNames.isLoading)return(0,l.jsx)(ec.m6,{});if(R)return(0,l.jsx)(rE,{response:R.response,query:R.query,wasLimited:R.wasLimited,onBack:()=>L(null),onNewQuery:(e,t,n)=>{L({response:e,query:t,wasLimited:n})}});let _=null!=(e=n.concepts.directory)?e:"directory",q=null!=(t=n.concepts.directoryPlural)?t:"".concat(_,"s");return 0===P.length&&null==D?(0,l.jsxs)("div",{className:"flex flex-col justify-center items-center pt-8",children:[n.runRawQuery&&O&&(0,l.jsx)("div",{className:"mb-6 w-full max-w-4xl",children:(0,l.jsx)(rS,{onShowResults:(e,t,n)=>{L({response:e,query:t,wasLimited:n})}})}),(0,l.jsxs)(ee.QO,{children:["You have no ",q]}),M&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(tv.h,{y:4}),(0,l.jsxs)(T.vx,{...v.projectPluginView({environmentId:null==m?void 0:m.id,view:"data",query:{state:"create-table"}}),scroll:!1,className:"create-table-link no-tables",children:["Create ",_]}),(0,l.jsx)(tv.h,{y:4}),(0,l.jsx)(ee.ae,{children:"or"})]}),(0,l.jsx)(tv.h,{y:4}),(0,l.jsx)(eu.N,{variant:"underline",...v.docs({page:"databases/database-view"}),className:"read-the-docs-link no-tables",children:"Read the docs"})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{onClick:()=>h([]),className:"flex flex-col flex-grow relative",children:[(0,l.jsxs)("div",{className:"relative flex items-center justify-center mb-8 mt-5",children:[(0,l.jsxs)(ee.EY,{children:[n.titleCase(q)," ",x.length>0&&"(".concat(x.length," ").concat((0,ey.td)(_,x.length)," selected)")]}),(0,l.jsxs)(eb.z,{space:2,align:"center",className:"absolute right-0 top-0",children:[U?(0,l.jsx)(T.K0,{title:"Delete table",icon:$.TBR,hidden:0===x.length,onClick:e=>{e.stopPropagation(),U()}}):void 0,(0,l.jsx)(T.K0,{title:"Refresh tables",icon:rv,className:"refresh-tables"})]})]}),n.runRawQuery&&O&&(0,l.jsx)("div",{className:"mb-6 -mt-4",children:(0,l.jsx)(rS,{onShowResults:(e,t,n)=>{L({response:e,query:t,wasLimited:n})}})}),null!=D&&(0,l.jsx)("div",{className:"hidden md:block absolute top-7 right-0",children:(0,l.jsx)(eT.P.div,{initial:{y:-10,opacity:0},animate:{y:0,opacity:1},children:(0,l.jsx)(th.pd,{value:D,onChange:e=>A(e.target.value),label:{text:"Filter",hidden:!0},placeholder:"Filter",name:"filter",autoFocus:!0,ref:S,onKeyDown:e=>{"Escape"===e.key&&A(null)},className:"h-6 text-sm"})})}),n.directoryNames.isError||null!=p&&(0,l.jsx)(ee.yn,{children:null!=p?p:"Error loading tables"}),P.length>0?(0,l.jsx)(eT.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,ease:"easeOut"},children:(0,l.jsx)(rP,{isSelecting:f||y,ref:k,children:P.map((e,t)=>(0,l.jsx)(rL,{name:e,isSelected:x.includes(t),isFocused:V===t,index:t,onHover:()=>B(t),onClick:()=>((e,t)=>{if(0!==P.length){if(!f&&!y||!M)return void F(e);(e=>{if(0===x.length)h([e]);else if(y){let t=[...x].sort((e,t)=>e-t)[0],n=[];for(let l=Math.min(e,t);l<=Math.max(e,t);l+=1)n.push(l);h(n)}else f&&(x.includes(e)?h(t=>t.filter(t=>t!==e)):h(t=>[...t,e]))})(t)}})(e,t)},e))})}):(0,l.jsx)(ee.xC,{className:"text-center my-8",children:"No tables here"})]}),M&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(tv.h,{y:5}),(0,l.jsx)("div",{className:"flex justify-end",children:(0,l.jsxs)(T.vx,{variant:"primary",...v.projectPluginView({environmentId:null==m?void 0:m.id,view:"data",query:{state:"create-table"}}),className:"create-table",children:["Create ",_]})})]})]})},rL=e=>{let{name:t,isSelected:n,isFocused:a,onHover:s,onClick:r}=e;return(0,l.jsx)(eT.P.div,{animate:a?"hover":"",variants:{hover:{scale:1.05}},children:(0,l.jsxs)(rM,{isSelected:n,isFocused:a,onMouseMove:s,onClick:e=>{e.preventDefault(),e.stopPropagation(),r()},children:[(0,l.jsx)(Z.In,{icon:$.PEP,size:"2xl",className:"text-blue-600"}),(0,l.jsx)(tv.h,{y:3}),(0,l.jsx)(ee.EY,{title:t,className:"text-center overflow-hidden overflow-ellipsis max-w-full",children:t})]})})},rM=i.forwardRef((e,t)=>{let{isSelected:n,isFocused:a,...s}=e;return(0,l.jsx)("div",{ref:t,className:(0,X.xW)("flex flex-col items-center","p-2 rounded cursor-pointer stroke-current",n&&"bg-gray-200",a&&"bg-gray-200",s.className),...s})}),rP=i.forwardRef((e,t)=>{let{isSelecting:n,...a}=e;return(0,l.jsx)("div",{ref:t,className:(0,X.xW)("grid gap-x-2 gap-y-4","grid-cols-[repeat(auto-fill,_minmax(140px,_1fr))]",n&&"select-none",a.className),...a})});var rz=function(e){return e.Columns="Columns",e.Json="Json",e.KeyValue="KeyValue",e}({});let rO=e=>{let{object:t,primaryKey:n}=e;if(!t||!n)return;let l=t[n]?t[n].toString():null;if(null==l)throw Error("No PRIMARY KEY. Please set one in order to be able to edit/delete.");return l},rU=ty.xI,rF=e=>{let{primaryKey:t,object:n,onUpdateObject:a,setIsSaving:s,setError:r,setShowSaved:i}=e,o=t&&a?async e=>{try{s(!0);let l=rO({object:n,primaryKey:t});await a({id:l,data:e}),i(!0)}catch(e){r(e.message)}s(!1)}:void 0;return n?(0,l.jsx)("div",{className:"m-5 mr-7",children:(0,l.jsx)(tp.i,{value:n,onChange:o,autoFocus:!0})}):null},rV=e=>{let{type:t,name:n,value:a,onChange:s,onDelete:r,onAdd:o,inserting:c,errored:d}=e;(0,i.useEffect)(()=>{"hash"===t&&s({}),("set"===t||"list"===t)&&s([]),"string"===t&&s("")},[t]);let u=(e,t)=>{Array.isArray(a)&&(a[t]=e,s(a))},[m,x]=(0,i.useState)(null),[h,p]=(0,i.useState)("right"),g=o?async(e,t)=>{t&&await p(t),x(e)}:void 0,v=o?async(e,t)=>{await o({id:n,type:e,data:t,side:h}),x(null)}:void 0;return("set"===t&&(null==a?void 0:a.includes(m))&&(d=!0),Array.isArray(a))?(0,l.jsxs)(l.Fragment,{children:[a.map((e,s)=>(0,l.jsxs)(eb.z,{children:["list"===t?(0,l.jsx)("span",{className:"min-w-3 mr-3 mt-2",children:s}):void 0,(0,l.jsx)(th.pd,{value:null!=e?e:void 0,onChange:e=>u(e.target.value,s),disabled:("list"===t||"set"===t)&&!c,autoComplete:"off",label:{text:"Value",hidden:!0},error:d,onKeyDown:e=>{"Enter"===e.key&&e.preventDefault()},className:"max-w-none"}),(0,l.jsx)("div",{className:"w-6 h-6 ml-2",children:r&&!c&&("set"===t||0===s||s+1===a.length)?(0,l.jsx)(T.K0,{icon:$.TBR,title:"Delete",onClick:()=>r({type:t,id:n,data:"set"===t?e:s})}):void 0})]},s)),null!=m&&v?(0,l.jsxs)(eb.z,{children:[(0,l.jsx)("div",{className:"w-6 h-3 mr-2 -ml-2 mt-1",children:(0,l.jsx)(T.K0,{className:"w-6",icon:$.FWt,title:"Add",onClick:()=>v(t,m)})}),(0,l.jsx)(th.pd,{value:m,onChange:e=>x(e.target.value),autoComplete:"off",label:{text:"Value",hidden:!0},error:d,onKeyDown:e=>{"Enter"===e.key&&e.preventDefault()},className:"max-w-none"}),(0,l.jsx)("div",{className:"w-6 h-6 ml-2",children:(0,l.jsx)(T.K0,{icon:$.X,title:"Cancel",onClick:()=>x(null)})})]}):g?(0,l.jsx)("div",{children:"list"===t?(0,l.jsxs)(eb.z,{children:[(0,l.jsx)(T.$n,{className:"mr-2",onClick:()=>g("","left"),children:"Add Left"}),(0,l.jsx)(T.$n,{onClick:()=>g("","right"),children:"Add Right"})]}):(0,l.jsx)(T.$n,{onClick:()=>g(""),children:"Add"})}):null]}):"object"==typeof a?(0,l.jsxs)(l.Fragment,{children:[Object.entries(null!=a?a:{}).map((e,a)=>{let[s,i]=e;return(0,l.jsxs)(eb.z,{children:[(0,l.jsx)("span",{className:"w-3 mr-3 mt-2",children:a}),(0,l.jsx)("div",{children:(0,l.jsx)(th.pd,{value:s,className:"mr-3",disabled:!0,label:{text:"Key",hidden:!0},onKeyDown:e=>{"Enter"===e.key&&e.preventDefault()}})}),(0,l.jsx)(th.pd,{value:i,onChange:e=>u(e.target.value,s),autoComplete:"off",disabled:!0,label:{text:"Value",hidden:!0},error:d,onKeyDown:e=>{"Enter"===e.key&&e.preventDefault()},className:"max-w-none"}),(0,l.jsx)("div",{className:"w-6 h-6 ml-2",children:r&&!c?(0,l.jsx)(T.K0,{icon:$.TBR,title:"Delete",onClick:()=>r({type:t,id:n,data:s})}):void 0})]},s)}),null!=m&&v&&"object"==typeof m?(0,l.jsxs)(eb.z,{children:[(0,l.jsx)("div",{className:"w-6 h-3 mr-1.5 -ml-2 mt-1",children:(0,l.jsx)(T.K0,{className:"w-6",icon:$.FWt,title:"Add",onClick:()=>v(t,m)})}),(0,l.jsx)("div",{children:(0,l.jsx)(th.pd,{value:m.key,onChange:e=>x({...m,key:e.target.value}),autoComplete:"off",label:{text:"Value",hidden:!0},error:d,onKeyDown:e=>{"Enter"===e.key&&e.preventDefault()},className:"mr-3"})}),(0,l.jsx)(th.pd,{value:m.value,onChange:e=>x({...m,value:e.target.value}),autoComplete:"off",label:{text:"Value",hidden:!0},error:d,onKeyDown:e=>{"Enter"===e.key&&e.preventDefault()},className:"max-w-none"}),(0,l.jsx)("div",{className:"w-6 h-6 ml-2",children:(0,l.jsx)(T.K0,{icon:$.X,title:"Cancel",onClick:()=>x(null)})})]}):g?(0,l.jsx)("div",{children:(0,l.jsx)(T.$n,{onClick:()=>g({key:"",value:""}),children:"Add"})}):null]}):"string"==typeof a?(0,l.jsx)(th.pd,{value:null!=a?a:void 0,onChange:e=>s(e.target.value),autoComplete:"off",label:{text:"Value",hidden:!0},error:d,onKeyDown:e=>{"Enter"===e.key&&e.preventDefault()},className:"max-w-none"}):null},rB=e=>{let{inserting:t,kind:n,primaryKey:a,propertyNames:s,propertyTypes:r,object:o,isJsonPropertyType:c,formatValue:d,types:u,titleCase:m,concepts:x,onSetTTL:h,onUpdateObject:p,onRemoveFromObject:g,onAddToObject:v,open:j,setIsSaving:y,isSaving:f,propertyTypeLookup:w,setError:N,showSaved:I,setShowSaved:k,exit:C,name:S,type:D,ttl:A,setInserting:E}=e,[R,L]=(0,i.useState)(A);(0,i.useEffect)(()=>{L(A)},[A]);let M=(0,i.useMemo)(()=>/^-?\d+$/.test(R),[R]),{register:P,watch:z,getValues:O,handleSubmit:U,control:F,reset:V,formState:{errors:B,isValid:_}}=(0,ty.mN)({defaultValues:{key:S,type:null!=D?D:typeof o,value:o}}),q=z("value"),W=z("type"),K=z("key"),[Y,Q]=(0,i.useState)(!1),G=(0,i.useMemo)(()=>(!t||"string"===W)&&!ru()(o,q),[o,q]),J=(0,i.useCallback)(async e=>{if(G&&p){try{y(!0),await p({data:e,id:K}),k(!0),E(!1)}catch(e){N(e.message)}y(!1)}},[G,q]);(0,i.useEffect)(()=>{j&&o&&V({key:K,type:D,value:o})},[j,o]),(0,i.useEffect)(()=>{let e=(0,b.Ay)(window,{Enter:()=>{J(O())},"$mod+Enter":()=>{J(O())},"$mod+S":e=>{e.preventDefault(),J(O())},Escape:async()=>{C()}});return()=>e()},[J,C]);let X=h?()=>{M&&h(K,parseInt(R)),Q(!1)}:void 0;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"w-full",children:t?void 0:(0,l.jsx)(l.Fragment,{children:Y?(0,l.jsx)("div",{className:"-ml-2 mr-4 float-right",children:(0,l.jsx)(lj.n1,{autoFocus:!0,contain:!0,children:(0,l.jsx)(tx.lV,{enableBindings:!0,onSubmit:X,onCancel:()=>{Q(!1),L(A)},name:"Expire Redis Key",children:(0,l.jsxs)(eb.z,{children:[(0,l.jsx)(th.JU,{className:"mt-1 mr-2",children:"TTL"}),(0,l.jsx)(th.pd,{placeholder:"seconds",label:{text:"Expiration Seconds",hidden:!0},value:R,onChange:e=>L(e.target.value),error:!M,style:{maxWidth:100},className:"h-8"}),(0,l.jsx)(T.K0,{icon:$.X,onClick:()=>{Q(!1),L(A)},title:"Cancel",type:"button",className:"mr-3"}),(0,l.jsx)(T.K0,{icon:$.Jlk,disabled:!M||!X,onClick:()=>null==X?void 0:X(),title:"Submit",type:"submit"})]})})})}):(0,l.jsx)("div",{className:"float-right -mt-5 mr-3 cursor-pointer",onClick:()=>Q(!0),children:"-1"!=="".concat(R)&&R?"expires in ".concat(R,"s"):"no expiry"})})}),(0,l.jsx)(tx.lV,{onSubmit:U(J),name:"Edit",className:"overflow-y-auto px-4",children:(0,l.jsxs)(eb.T,{space:5,children:[["key","type"].map((e,n)=>(0,l.jsxs)(eb.T,{space:2,children:[(0,l.jsx)(th.JU,{className:"mb-0 text-foreground font-medium",children:e}),"type"===e?u?(0,l.jsx)(ty.xI,{name:e,control:F,render:t=>{let{field:{onChange:n,value:a}}=t;return(0,l.jsx)(tg.l,{name:e,value:a,onChange:n,label:{text:e,hidden:!0},options:u})}}):void 0:(0,l.jsx)(th.pd,{...P(e),autoComplete:"off",disabled:"key"===e&&!t,label:{text:"Value",hidden:!0},error:null!=B[e],onKeyDown:e=>{"Enter"===e.key&&e.preventDefault()},className:"max-w-none"})]},e)),(0,l.jsxs)(eb.T,{space:2,children:[(0,l.jsx)(th.JU,{className:"mb-0 text-foreground font-medium",children:"value"}),(0,l.jsx)(ty.xI,{name:"type",control:F,render:e=>{let{field:{value:n}}=e;return(0,l.jsx)(ty.xI,{name:"value",control:F,render:e=>{let{field:{onChange:a,value:s}}=e;return(0,l.jsx)(rV,{name:K,inserting:t,type:n,errored:null!=B.value,value:s,onChange:a,onDelete:g,onAdd:v})}})}})]},"value"),(0,l.jsxs)(eb.z,{space:3,align:"center",className:"pb-8",children:[(0,l.jsx)(T.$n,{variant:"primary",color:"gray",onClick:C,className:"cancel-edit-row",autoFocus:!0,children:"Cancel"}),G&&(0,l.jsx)(T.$n,{disabled:!p||f||!_,className:"save-edit-row",children:f?(0,l.jsx)(ec.Rh,{}):"Save"}),I&&(0,l.jsx)("div",{className:"pl-2",children:(0,l.jsx)(Z.In,{icon:$.Jlk,size:"lg",color:"success",initial:{y:-10,scale:0},animate:{y:0,scale:1}})})]})]})})]})},r_=e=>{let{kind:t,primaryKey:n,propertyNames:a,propertyTypes:s,object:r,isJsonPropertyType:o,formatValue:c,titleCase:d,concepts:u,onUpdateObject:m,open:x,setIsSaving:h,isSaving:p,propertyTypeLookup:g,setError:v,showSaved:j,setShowSaved:y,exit:f}=e,w=(0,i.useMemo)(()=>Object.entries(null!=r?r:{}).reduce((e,t,n)=>{let[l,a]=t;return{...e,[l]:null==a?null:!c||!s||o(s[n])?JSON.stringify(a,null,2):c(a,s[n])}},{}),[r]),{register:N,control:I,watch:k,getValues:C,handleSubmit:S,reset:D,formState:{errors:A,isValid:E}}=(0,ty.mN)({defaultValues:w}),R=k(),L=(0,i.useMemo)(()=>Object.entries(w).some(e=>{let[t,n]=e;return n!==R[t]}),[w,R]),M=(0,i.useCallback)(async e=>{if(!L||!n||!m)return;let t=Object.entries(e).reduce((e,t)=>{let[n,l]=t;return{...e,[n]:""===l?null:l}},{});try{h(!0);let e=rO({object:r,primaryKey:n});await m({data:t,id:e}),y(!0)}catch(e){v(e.message)}h(!1)},[L,R]);return((0,i.useEffect)(()=>{x&&w&&D(w)},[x,w]),(0,i.useEffect)(()=>{let e=(0,b.Ay)(window,{Enter:()=>{M(C())},"$mod+Enter":()=>{M(C())},"$mod+S":e=>{e.preventDefault(),M(C())},Escape:async()=>{f()}});return()=>e()},[M,f]),s&&a&&r)?(0,l.jsx)(tx.lV,{onSubmit:S(M),name:"Edit",className:"overflow-y-auto px-4",children:(0,l.jsxs)(eb.T,{space:5,children:[null==a?void 0:a.map((e,t)=>{var n;return(0,l.jsxs)(eb.T,{space:2,children:[(0,l.jsx)(th.JU,{className:"mb-0 text-foreground font-medium",children:e}),o(s[t])?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(rU,{name:e,control:I,rules:{validate:e=>(0,nH.j)(e)},render:e=>{let{field:{onChange:t,value:n,name:a}}=e;return(0,l.jsx)(nZ.t,{language:"json",name:a,value:n,onChange:t,onKeyDown:e=>{e.metaKey&&"Enter"===e.key?e.preventDefault():"Enter"===e.key?e.stopPropagation():"Tab"===e.key&&e.preventDefault()},error:null!=A[a],styles:{minHeight:"100px"}})}}),g?(0,l.jsx)("small",{className:"text-xs text-gray-600",children:g[s[t]]}):void 0]}):(0,l.jsx)(th.pd,{...N(e),autoComplete:"off",label:{text:"Value",hidden:!0},error:null!=A[e],onKeyDown:e=>{"Enter"===e.key&&e.preventDefault()},className:"max-w-none",hint:null!=(n=(null!=g?g:{})[s[t]])?n:"Type: ".concat(s[t])})]},e)}),(0,l.jsxs)(eb.z,{space:3,align:"center",className:"pb-8",children:[(0,l.jsx)(T.$n,{variant:"primary",color:"gray",onClick:f,className:"cancel-edit-row",autoFocus:!0,children:"Cancel"}),L&&(0,l.jsx)(T.$n,{disabled:!m||p||!E,className:"save-edit-row",children:p?(0,l.jsx)(ec.Rh,{}):"Save"}),j&&(0,l.jsx)("div",{className:"pl-2",children:(0,l.jsx)(Z.In,{icon:$.Jlk,size:"lg",color:"success",initial:{y:-10,scale:0},animate:{y:0,scale:1}})})]})]})}):null},rq=e=>{var t,n;let[a,s]=(0,i.useState)(!1),[r,o]=(0,i.useState)(!1),[c,d]=(0,ei.b)(),[u,m]=(0,e8.E)(!1,4e3),{isConfirmed:x}=(0,E.S)(),{modalActions:h}=(0,P.U)(),[p,g]=(0,i.useState)(e.inserting);(0,i.useEffect)(()=>{g(e.inserting)},[e.inserting]);let v=e.kind===rz.KeyValue?e.object.key:rO({object:e.object,primaryKey:e.primaryKey}),[j,y]=(0,i.useState)(v);(0,i.useEffect)(()=>{y(v)},[v]);let f="object"==typeof e.object?e.object.type:null,[b,w]=(0,i.useState)(f);(0,i.useEffect)(()=>{w(f)},[f]);let{result:N,invalidateQuery:I}=(0,er.W)(["db","object",!!e.onGetObject,e.object,j],async()=>e.onGetObject&&null!=j?await e.onGetObject(j):e.object,{refetchInterval:8e3}),k=e.primaryKey&&e.onDeleteObject?async()=>{if(e.primaryKey&&e.onDeleteObject&&await x({confirmLabel:"Delete",message:"Are you sure you want to delete this ".concat(e.concepts.object,"? Deleting this ").concat(e.concepts.object," is permanent and cannot be undone."),title:"Delete ".concat(e.concepts.object)})){try{o(!0);let t=e.kind===rz.KeyValue?j:rO({object:N.data,primaryKey:e.primaryKey});await e.onDeleteObject(t),I(),h.createToast((0,l.jsx)(A.y8,{variant:"success",title:"".concat(e.titleCase(e.concepts.object)," successfully deleted")})),C()}catch(e){d(e.message)}o(!1)}}:void 0,C=()=>{g(e.inserting),y(v),w(f),I(),e.onOpenChange(!1)},S=e.onUpdateObject?async t=>{if(e.onUpdateObject)try{await e.onUpdateObject(t),g(!1),y(t.id),I()}catch(e){d(e.message)}}:void 0,D=e.onRemoveFromObject?async t=>{let{type:n,id:l,data:a}=t;if(e.onRemoveFromObject)try{await e.onRemoveFromObject({type:n,id:l,data:a}),I()}catch(e){d(e.message)}}:void 0,R=e.onAddToObject?async t=>{let{id:n,type:l,data:a,side:s}=t;if(e.onAddToObject){w(l);try{await e.onAddToObject({id:n,type:l,data:a,side:s}),g(!1),y(n),I()}catch(e){d(e.message)}}}:void 0,L=r||N.isLoading;return(0,l.jsx)(n0.w.Root,{open:e.open,onOpenChange:C,closable:!0,hideCloseButton:!0,children:(0,l.jsxs)(eb.T,{className:"w-[600px] py-4 grid gap-4 grid-rows-[auto_minmax(0,1fr)] h-screen overflow-y-hidden",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)(eb.z,{align:"center",justify:"between",className:"px-4",children:[(0,l.jsxs)(ee.lD,{as:"h2",children:[p?"Add":"Edit"," ",e.concepts.object]}),(0,l.jsxs)(eb.z,{space:2,align:"center",children:[L?(0,l.jsx)(ec.Rh,{}):p?void 0:(0,l.jsx)(T.K0,{icon:$.TBR,title:"Delete",disabled:a||r||!k,onClick:k}),(0,l.jsx)(T.K0,{icon:$.X,title:"Close",onClick:C})]})]}),null!=c&&(0,l.jsx)(ee.yn,{children:c}),N.isError&&(0,l.jsx)(ee.yn,{children:null!=(n=null==(t=N.error)?void 0:t.message)?n:"Error"})]}),(0,l.jsx)("div",{className:"overflow-y-auto",children:L?(0,l.jsx)(ec.m6,{width:"100px",height:"21px",className:"justify-self-end"}):e.kind===rz.Columns?(0,l.jsx)(r_,{...e,object:N.data,exit:C,isSaving:a,setIsSaving:s,setError:d,showSaved:u,setShowSaved:m,onUpdateObject:S}):e.kind===rz.KeyValue?(0,l.jsx)(rB,{...e,setInserting:g,inserting:p,name:j,type:b,ttl:e.object.ttl,object:N.data,exit:C,isSaving:a,setIsSaving:s,setError:d,showSaved:u,setShowSaved:m,onRemoveFromObject:D,onAddToObject:R,onUpdateObject:S}):(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(rF,{...e,object:N.data,exit:C,isSaving:a,setIsSaving:s,setError:d,showSaved:u,setShowSaved:m,onUpdateObject:S})})})]})})},rW=e=>{var t,n;let{directory:a,createProperty:s,types:r,constraints:o,concepts:c}=e,[d,u]=(0,ei.b)(),[m,x]=(0,i.useState)(!1),{modalActions:h}=(0,P.U)(),{control:p,register:g,handleSubmit:v,formState:{errors:j}}=(0,ty.mN)();if(!s)return null;let y=async e=>{try{var t;u(null),x(!0),await s({name:e.name,default:e.default?e.default:void 0,type:e.type.value,constraint:null==(t=e.constraint)?void 0:t.value}),h.createToast((0,l.jsx)(A.y8,{variant:"success",title:"Column ".concat(e.name," added to ").concat(a)})),h.exitModal()}catch(e){u(e.message)}x(!1)};return(0,l.jsxs)(eb.T,{space:6,children:[(0,l.jsx)(eg.wt,{children:"Insert column"}),null!=d&&(0,l.jsx)(ee.yn,{children:d}),(0,l.jsx)(nB.n4,{message:"You do not have permission to create a property",children:(0,l.jsxs)(tx.lV,{onSubmit:v(y),enableBindings:!0,name:"Insert ".concat(null!=(t=c.property)?t:"property"),className:"space-y-5",children:[(0,l.jsx)(tx.D0,{label:"Name",...g("name",{required:!0,minLength:2,maxLength:128}),placeholder:"name",error:null!=j.name,autoFocus:!0}),(0,l.jsx)(ty.xI,{name:"type",control:p,rules:{required:!0,validate:e=>{let{value:t}=e;return""!==t.trim()}},render:e=>{let{field:{onChange:t,value:n}}=e;return(0,l.jsx)(nC,{searchItems:r,label:"Type",onChange:e=>t(e[0]),error:null!=j.type,placeholder:"text",allowCustomValue:!0})}}),(0,l.jsx)(ty.xI,{name:"default",control:p,render:e=>{let{field:{onChange:t,value:n,name:a}}=e;return(0,l.jsx)(th.pd,{value:n,onChange:t,name:a,label:"Default",placeholder:"No default",error:null!=j.default})}}),o?(0,l.jsx)(ty.xI,{name:"constraint",control:p,render:e=>{let{field:{onChange:t,value:n}}=e;return(0,l.jsx)(nC,{searchItems:o,defaultValues:null!=n?[n]:void 0,label:"Constraint",onChange:e=>t(e[0]),error:null!=j.constraint,placeholder:"No constraint"})}}):void 0,(0,l.jsxs)(eb.z,{justify:"end",space:4,children:[(0,l.jsx)(T.$n,{type:"button",onClick:()=>h.exitModal(),color:"gray",children:"Cancel"}),(0,l.jsxs)(T.jn,{isLoading:m,children:["Add ",null!=(n=c.property)?n:"property"]})]})]})})]})};function rK(){let e=(0,nx._)(["flex flex-col flex-grow"]);return rK=function(){return e},e}function rY(){let e=(0,nx._)(["relative flex items-center justify-center"]);return rY=function(){return e},e}function rQ(){let e=(0,nx._)(["flex flex-col justify-between flex-grow mt-5"]);return rQ=function(){return e},e}function r$(){let e=(0,nx._)(["flex justify-end pt-2"]);return r$=function(){return e},e}function rG(){let e=(0,nx._)(["flex flex-col items-center text-center"]);return rG=function(){return e},e}let rJ=e=>{let{value:t}=e;return t?(0,l.jsx)("div",{className:"cursor-pointer w-ful",children:JSON.stringify(t,null,2)}):(0,l.jsx)("span",{})},rX=e=>{let[,t]=iy(),[n,a]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{if(!n)return;let e=setTimeout(()=>a(!1),500);return()=>clearTimeout(e)},[n]),(0,l.jsx)($.e9t,{...e,className:(0,X.xW)(e.className,"refresh ".concat(n?"animate-spin":"")),onClick:()=>{a(!0),t.refresh()}})},rH=()=>{let[{data:e,selectedDirectoryName:t,concepts:n},{createDirectory:a}]=iy();if(e.isError||a&&null==t){var s,r;return(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(ee.yn,{children:null!=(r=null==(s=e.error)?void 0:s.message)?r:"Error loading ".concat(n.directory)})})}return e.isLoading?(0,l.jsx)(ec.m6,{}):null==e.data?(0,l.jsx)(r0,{directoryName:t}):(0,l.jsx)(rZ,{directory:e.data,selectedDirectoryName:t})},rZ=e=>{var t,n,s,r,o;let{directory:c,selectedDirectoryName:d}=e,{routes:u}=(0,es.c)(),[{page:m,totalPages:x,formatValue:h,isJsonPropertyType:p,concepts:g,pageSize:v,propertyTypeLookup:j,defaults:y,titleCase:f,kind:I,types:k,constraints:C,directoryNames:S},D]=iy(),[R,M]=(0,ei.b)(),[O,U]=(0,i.useState)(!1),[F,V]=(0,i.useState)(!1),[B,_]=(0,i.useState)(null!=(n=null==y?void 0:y.object)?n:{}),[q,W]=(0,i.useState)([]),K=(0,N.T7)(),Y=(0,N.gq)(),{isConfirmed:Q}=(0,E.S)(),G=(0,i.useRef)(null),J=(0,a.md)(z.mz),{modalActions:X}=(0,P.U)(),{showModal:H}=(0,L.h)(),et=()=>{D.changePage(m-1)},en=()=>{D.changePage(m+1)};(0,w.bU)(()=>({value:"db-create-object",text:"New ".concat(g.object),icon:$.FWt,highlighted:!0,group:"Data",keybinding:"C",isAvailable:()=>!O&&J,action:async()=>em()}),[O,J]);let el=D.removeFromObject?async e=>{let{type:t,id:n,data:l}=e;D.removeFromObject&&await D.removeFromObject({type:t,id:n,data:l})}:void 0,ea=D.addToObject?async e=>{let{id:t,type:n,data:l,side:a}=e;D.addToObject&&await D.addToObject({id:t,type:n,data:l,side:a})}:void 0,er=c.primaryKey?async e=>{let{data:t,id:n}=e;c.primaryKey&&await D.updateObject({property:c.primaryKey,id:n,data:t})}:void 0,eo=c.primaryKey?async e=>{await D.deleteObjects({ids:Array.of(e)})}:void 0,ed=D.setTTL?async(e,t)=>{D.setTTL&&await D.setTTL({id:e,ttl:t})}:void 0,eu=D.object?async e=>{var t,n;return null!=(n=await (null==(t=D.object)?void 0:t.call(D,{id:e})))?n:null}:void 0,em=()=>{if(J)if(I===rz.KeyValue){var e;H(rq,{inserting:!0,kind:I,concepts:g,titleCase:f,types:k,propertyTypes:c.propertyTypes,propertyNames:c.propertyNames,primaryKey:c.primaryKey,propertyTypeLookup:j,isJsonPropertyType:p,formatValue:h,object:null!=(e=null==y?void 0:y.object)?e:{},onGetObject:eu,onDeleteObject:eo,onSetTTL:ed,onRemoveFromObject:el,onAddToObject:ea,onUpdateObject:er})}else U(!0),setTimeout(()=>{var e;null==(e=G.current)||e.focus()},0)},ex=async e=>{if(!F){try{V(!0),await D.createObject({properties:null!=e?e:B}),M(null),_({}),U(!1)}catch(e){M(e.message)}V(!1)}},eh=c.primaryKey?async()=>{if(0!==q.length&&c.primaryKey&&await Q({confirmLabel:"Delete",message:"Are you sure you want to delete ".concat(q.length," ").concat(1===q.length?g.object:g.objectPlural,"? Deleting ").concat(1===q.length?g.object:g.objectPlural," is permanent and cannot be undone."),title:"Delete ".concat(g.object)}))try{let e=q.map(e=>{var t;return c.objects[e][null!=(t=c.primaryKey)?t:""].toString()});await D.deleteObjects({ids:e}),X.createToast((0,l.jsx)(A.y8,{variant:"success",title:"".concat(e.length," ").concat(g.objectPlural," successfully deleted")})),M(null),W([])}catch(e){M(e.message)}}:void 0,ep=null!=(s=g.property)?s:"property",ev=D.createProperty?async()=>{null==c&&D.createProperty||X.openModal((0,l.jsx)(eg.aF,{title:"Insert ".concat(ep),children:(0,l.jsx)(rW,{directory:c.name,constraints:C,concepts:g,createProperty:D.createProperty,types:k})}))}:null;(0,w.bU)(()=>({text:"Generate dummy data",value:"generateDBDummyData",category:"Data",group:"Data",icon:$.KqI,highlighted:!0,isAvailable:()=>null==g.directory&&!c.objects.length,action:async()=>{try{await D.generateDummyData()}catch(e){M(e.message)}}}),[c.objects.length]),(0,w.bU)(()=>({value:"db-delete-object",text:"Delete ".concat(g.object),icon:$.TBR,highlighted:!0,group:"Data",keybinding:"D",isAvailable:()=>q.length>0&&null!=eh,action:()=>null==eh?void 0:eh()}),[q]),(0,w.bU)(()=>({value:"db-insert-property",text:"Insert ".concat(ep),category:"Data",isAvailable:()=>null!=ev,action:()=>null==ev?void 0:ev()}));let ej=e=>{let t=q.includes(e);if(Y)t?W(t=>t.filter(t=>t!==e)):W(t=>[...t,e]);else if(K){var n;let t=null!=(n=[...q].sort((e,t)=>e-t)[0])?n:e,l=[];for(let n=Math.min(e,t);n<=Math.max(e,t);n+=1)l.push(n);W(l)}else{let t=c.objects[e];H(rq,{inserting:!1,kind:I,concepts:g,titleCase:f,types:k,propertyTypes:c.propertyTypes,propertyNames:c.propertyNames,primaryKey:c.primaryKey,propertyTypeLookup:j,isJsonPropertyType:p,formatValue:h,object:t,onGetObject:eu,onDeleteObject:eo,onSetTTL:ed,onUpdateObject:er,onRemoveFromObject:el,onAddToObject:ea})}},{activeElement:ey,setActiveElement:ef}=(e=>{let{pageSize:t,page:n,isInserting:l,selectedObjects:a,setSelectedObjects:s,directory:r,gotoPrevPage:o,gotoNextPage:c,onClickObject:d}=e,[u,m]=(0,i.useState)(null),{routes:x,navActions:h}=(0,es.c)(),{sidePanels:p,modals:g}=(0,P.U)(),v=()=>0===a.length&&0!==r.objectsCount;return(0,i.useEffect)(()=>{if(l||p.length>0||g.length>0)return;let e=(0,b.Ay)(window,{ArrowDown:e=>{if(e.preventDefault(),!v())return;if(null==u)return void m(0);let l=u+1;t*n+l>=r.objectsCount||(l===t&&(c(),l=0),m(l))},ArrowUp:e=>{if(e.preventDefault(),!v()||null==u)return;let l=u-1;l<0&&(0===n?l=null:(o(),l=t-1)),m(l)},Escape:()=>{u||a.length>0?(m(null),s([])):h.push(x.projectPluginView({view:"data"}))},Enter:()=>{null!=u&&d(u)}});return()=>e()},[r,a,u,n,t,l,p]),{activeElement:u,setActiveElement:m}})({page:m,pageSize:v,gotoNextPage:en,gotoPrevPage:et,selectedObjects:q,setSelectedObjects:W,isInserting:O,directory:c,onClickObject:ej});return(0,l.jsxs)(r1,{onClick:()=>{W([])},className:"mt-5",children:[(0,l.jsxs)(r2,{children:[(0,l.jsx)(r5,{position:"left",children:S.data?(0,l.jsx)(T.sh,{icon:$.nkM,scroll:!1,...u.projectPluginView({view:"data"})}):void 0}),(0,l.jsxs)(ee.EY,{children:[null!=(r=null!=d?d:g.objectPlural)?r:"".concat(g.object,"s")," ",q.length>0&&"(selected ".concat(q.length," ").concat(1===q.length?g.object:g.objectPlural,")")]}),(0,l.jsxs)(r5,{position:"right",children:[(0,l.jsx)(T.K0,{icon:$.TBR,hidden:0===q.length||!eh,onClick:eh,title:"Delete",color:"pink",className:"delete-row"}),0===q.length&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(T.K0,{icon:rX,title:"Refresh table",color:"pink"}),ev?(0,l.jsx)(T.$n,{onClick:ev,title:"Insert ".concat(ep),variant:"ghost",size:"sm",className:"text-pink-500",children:(0,l.jsxs)(eb.z,{align:"center",children:[(0,l.jsx)(Z.In,{icon:$.O3j,className:"mr-1"}),"Add ",ep]})}):void 0]})]})]}),(0,l.jsx)(tv.h,{y:2}),(0,l.jsxs)(r4,{children:[null!=R&&(0,l.jsx)(ee.yn,{className:"mt-2",children:R}),(0,l.jsxs)(t8.J6,{children:[(0,l.jsxs)(t8.XI,{isSelecting:Y||K,children:[c.propertyNames?(0,l.jsx)(t8.D1,{children:(0,l.jsx)(t8.fI,{children:c.propertyNames.map(e=>(0,l.jsx)(t8.A3,{children:e},e))})}):void 0,(0,l.jsxs)(t8.vc,{children:[c.objects.map((e,t)=>{var n,a;return(0,l.jsx)(t8.fI,{className:q.includes(t)?"selected":"",isActive:t===ey,onMouseMove:()=>ef(t),children:null!=(a=null==(n=c.propertyNames)?void 0:n.map((n,a)=>{let s=e[n],r="number"!=typeof s&&h&&c.propertyTypes?h(s,c.propertyTypes[a]):s;return(0,l.jsx)(t8.xC,{onClick:e=>{e.preventDefault(),e.stopPropagation(),ej(t)},children:(0,l.jsx)("span",{title:null!=r?r.toString():r,children:r})},n)}))?a:I===rz.Json?(0,l.jsx)(t8.xC,{onClick:e=>{e.preventDefault(),e.stopPropagation(),ej(t)},children:(0,l.jsx)(rJ,{value:e})}):void 0},t)}),O&&(0,l.jsx)(t8.fI,{isInserting:!0,className:"inserting",children:null!=(o=null==(t=c.propertyNames)?void 0:t.map((e,t)=>(0,l.jsx)(t8.xC,{children:(0,l.jsx)(th.pd,{ref:0===t?G:null,autoFocus:0===t,placeholder:"DEFAULT",label:{text:"Value",hidden:!0},onKeyDown:e=>{e.keyCode===np.HP.enter?ex():e.keyCode===np.HP.escape&&U(!1)},onChange:t=>{let n=t.target.value;_(t=>({...t,[e]:n}))}})},e)))?o:(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(tp.i,{value:B,onEdit:_,hideControls:!0,autoFocus:!0})})})]})]}),null!=c&&0===c.objects.length&&!O&&(0,l.jsx)(r8,{children:(0,l.jsxs)(ee.QO,{className:"py-8",children:["This ",g.directory," is empty"]})})]}),(0,l.jsx)(r6,{space:3,children:O?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(T.$n,{variant:"primary",color:"gray",onClick:()=>{U(!1),_({})},disabled:F,className:"cancel-insert-row",children:"Cancel"}),(0,l.jsx)(T.$n,{onClick:()=>ex(),disabled:F,className:"insert-row",children:F?(0,l.jsx)(ec.Rh,{}):"Insert"})]}):(0,l.jsx)(l.Fragment,{children:J&&(0,l.jsxs)(T.$n,{variant:"outline",size:"sm",onClick:()=>{em()},className:"add-row mb-3",children:["Add ",g.object]})})}),c.objects.length>0&&(0,l.jsx)(t8.$o,{canPreviousPage:m>0,canNextPage:m+1<x,pageIndex:m,totalPages:x,gotoPage:D.changePage,previousPage:et,nextPage:en})]})]})},r0=e=>{let{directoryName:t}=e,{routes:n}=(0,es.c)();return(0,l.jsxs)(r8,{children:[(0,l.jsx)(tv.h,{y:5}),(0,l.jsxs)(ee.QO,{children:[(0,l.jsx)(ee.EY,{color:"primary",children:t})," not found"]}),(0,l.jsx)(tv.h,{y:4}),(0,l.jsx)(T.vx,{...n.projectPluginView({}),scroll:!1,children:"Go back"})]})},r1=X.qy.div(rK()),r2=X.qy.div(rY()),r5=(0,X.DR)(eb.z)(e=>["absolute top-0 flex items-center","left"===e.position?"left-0":"right-0"]),r4=X.qy.div(rQ()),r6=(0,X.DR)(eb.z)(r$()),r8=X.qy.div(rG());function r3(){let e=(0,nx._)(["\n  grid gap-x-2 gap-y-1 mt-4\n  grid-cols-[repeat(4,_1fr)_44px]\n"]);return r3=function(){return e},e}let r7=()=>{var e,t,n,a;let[{concepts:s,defaults:r,kind:o,types:c,titleCase:d,constraints:u,requiresInitialValue:m},{createDirectory:x}]=iy(),{routes:h,navActions:p}=(0,es.c)(),[g,v]=(0,i.useState)(!1),[j,y]=(0,i.useState)(null),[f,b]=(0,i.useState)(null!=(t=null==r?void 0:r.object)?t:{}),w=null!=(n=s.property)?n:"property",{control:N,register:I,handleSubmit:k,formState:{errors:C}}=(0,ty.mN)({defaultValues:{properties:null!=(a=null==r?void 0:r.properties)?a:[]}}),{fields:S,append:D,remove:A}=(0,ty.jz)({control:N,name:"properties"}),E=async e=>{if(x){try{var t,n,l;y(null),v(!0),await x({directory:e.directoryName,object:f,properties:null!=(n=null==(t=e.properties)?void 0:t.map(e=>{var t;return{name:e.name,type:e.type.value,constraint:null==(t=e.constraint)?void 0:t.value}}))?n:[]}),b(null!=(l=null==r?void 0:r.object)?l:{}),p.push(h.projectPluginView({view:"data"}))}catch(e){y(e.message)}v(!1)}};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(ee.EY,{className:"mt-5 mb-4 text-center",children:["Create ",s.directory]}),null!=j&&(0,l.jsx)(ee.yn,{children:j}),(0,l.jsx)(nB.n4,{message:"You do not have permission to create a ".concat(s.directory),children:(0,l.jsxs)(tx.lV,{enableBindings:!0,onCancel:()=>{var e;null==(e=document.activeElement)||e.blur()},onSubmit:k(E),name:"Create ".concat(d(s.directory)),children:[(0,l.jsx)(tx.D0,{label:"".concat(s.directory," name"),...I("directoryName",{required:"Database name is required",minLength:{value:1,message:"Name must be at least 1 character long"},maxLength:{value:100,message:"Name cannot exceed 100 characters"}}),placeholder:"my-".concat(s.directory),error:(null==(e=C.directoryName)?void 0:e.message)?C.directoryName.message:!!C.directoryName,autoFocus:!0,className:"max-w-xs"}),o===rz.Columns?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(r9,{children:[(0,l.jsxs)(ee.ae,{children:[w," name"]}),(0,l.jsx)(ee.ae,{children:"type"}),(0,l.jsx)(ee.ae,{children:"default"}),u?(0,l.jsx)(ee.ae,{children:"constraints"}):void 0,(0,l.jsx)(ee.ae,{style:{maxWidth:20}}),S.map((e,t)=>(0,l.jsxs)(i.Fragment,{children:[(0,l.jsx)(ty.xI,{name:"properties.".concat(t,".name"),control:N,rules:{required:!0},render:e=>{var n;let{field:{onChange:a,value:s,name:r}}=e;return(0,l.jsx)(th.pd,{value:s,onChange:a,name:r,placeholder:"my-".concat(w),label:{text:"".concat(w," name"),hidden:!0},error:null!=C.properties&&null!=C.properties[t]&&(null==(n=C.properties[t])?void 0:n.name)!=null})}}),(0,l.jsx)(ty.xI,{name:"properties.".concat(t,".type"),control:N,rules:{required:!0,validate:e=>{let{value:t}=e;return""!==t.trim()}},render:e=>{var n;let{field:{onChange:a,value:s}}=e;return(0,l.jsx)(nC,{searchItems:c,label:{text:"Type",hidden:!0},defaultValues:[s],allowCustomValue:!0,onChange:e=>a(e[0]),error:null!=C.properties&&null!=C.properties[t]&&(null==(n=C.properties[t])?void 0:n.type)!=null})}}),(0,l.jsx)(ty.xI,{name:"properties.".concat(t,".default"),control:N,render:e=>{var n;let{field:{onChange:a,value:s,name:r}}=e;return(0,l.jsx)(th.pd,{value:s,onChange:a,name:r,label:{text:"Default",hidden:!0},placeholder:"no default",error:null!=C.properties&&null!=C.properties[t]&&(null==(n=C.properties[t])?void 0:n.default)!=null})}}),u?(0,l.jsx)(ty.xI,{name:"properties.".concat(t,".constraint"),control:N,render:e=>{var n;let{field:{onChange:a,value:s}}=e;return(0,l.jsx)(nC,{searchItems:u,defaultValues:null!=s?[s]:void 0,onChange:e=>a(e[0]),label:{text:"Constraint",hidden:!0},error:null!=C.properties&&null!=C.properties[t]&&(null==(n=C.properties[t])?void 0:n.constraint)!=null})}}):void 0,(0,l.jsx)(T.K0,{icon:$.X,onClick:()=>A(t),title:"Delete ".concat(w),type:"button",hidden:S.length<=1})]},e.id))]}),(0,l.jsx)("div",{className:"mt-4",children:(0,l.jsxs)(T.$n,{size:"sm",color:"blue",onClick:()=>{var e;return c.length?D({name:"",type:null!=(e=null==r?void 0:r.property)?e:c[0]}):null},type:"button",children:["Add ",w]})})]}):o===rz.Json&&m?(0,l.jsx)("div",{className:"mt-2",children:(0,l.jsx)(tp.i,{value:f,onEdit:b,hideControls:!0,autoFocus:!0})}):void 0,(0,l.jsxs)(eb.z,{justify:"end",className:"mt-8",children:[(0,l.jsx)(T.vx,{variant:"primary",...h.projectPluginView({view:"data"}),scroll:!1,className:"cancel-create-table",children:"Cancel"}),(0,l.jsx)(tv.h,{x:3}),(0,l.jsx)(T.$n,{type:"submit",disabled:g,className:"create-table",children:g?(0,l.jsx)(ec.Rh,{}):"Create"})]})]})})]})},r9=X.qy.div(r3());var ie=n(66467);let it=e=>{let{searchQuery:t,onSearchChange:n}=e,a=(0,i.useRef)(null);return(0,i.useEffect)(()=>{a.current&&a.current.focus()},[]),(0,l.jsx)(th.pd,{ref:a,value:t,onChange:e=>n(e.target.value),placeholder:"Search extensions...",label:{text:"Search Extensions",hidden:!0},size:"sm",icon:$.vji,suffix:t?(0,l.jsx)(T.K0,{onClick:()=>{var e;n(""),null==(e=a.current)||e.focus()},title:"Clear search",icon:$.X,variant:"ghost",size:"xs"}):void 0,className:"py-2"})},il={initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:5,scale:.95},transition:{type:"tween",duration:.25,ease:"easeInOut"}},ia=(0,i.forwardRef)((e,t)=>{let{extension:n,onInstall:a,onUninstall:s,canWrite:r,isLoading:i=!1,isInstalled:o=!1}=e,c=async()=>{await a()},d=async()=>{await s()};return(0,l.jsx)(eT.P.div,{ref:t,layout:!0,...il,className:"p-4 bg-white dark:bg-[#1c1a28] hover:bg-gray-50 dark:hover:bg-background transition-colors",children:(0,l.jsxs)(eb.z,{justify:"between",align:"center",children:[(0,l.jsx)(eb.z,{space:3,align:"start",className:"flex-1",children:(0,l.jsxs)(eb.T,{space:1,className:"flex-1",children:[(0,l.jsxs)(eb.z,{space:2,align:"center",children:[(0,l.jsx)(ee.EY,{className:"font-medium text-gray-900 dark:text-white",children:n.name}),(0,l.jsxs)("div",{className:"rounded-full border border-gray-200 dark:bg-[#201f2d] text-xs px-1.5",children:["v",n.installedVersion||n.defaultVersion]})]}),n.comment&&(0,l.jsx)(ee.zb,{className:"text-sm text-gray-600 dark:text-gray-500",children:n.comment})]})}),(0,l.jsx)(s$.m,{side:"top",content:(0,l.jsx)(l.Fragment,{children:"Write permission required"}),disabled:r,children:o?(0,l.jsx)(T.$n,{onClick:d,variant:"ghost",color:"gray",size:"sm",icon:$.TBR,isLoading:i,disabled:i||!r,children:"Uninstall"}):(0,l.jsx)(T.$n,{onClick:c,variant:"outline",color:"gray",size:"sm",icon:$.f5X,isLoading:i,disabled:i||!r,children:"Install"})})]})})});ia.displayName="ExtensionCard";let is=e=>{let{title:t,extensions:n,onInstall:a,onUninstall:s,loadingExtensions:r,isInstalled:i=!1,canWrite:o}=e;return 0===n.length?null:(0,l.jsxs)(eb.T,{space:3,children:[t&&(0,l.jsx)(ee.EY,{className:"text-sm text-gray-600 dark:text-white",children:t}),(0,l.jsx)("div",{className:"border border-gray-300 dark:border-gray-200 rounded-lg overflow-hidden divide-y divide-gray-300 dark:divide-gray-200",children:(0,l.jsx)(eD.N,{mode:"popLayout",children:n.map(e=>(0,l.jsx)(ia,{extension:e,onInstall:t=>a(e.name,t),onUninstall:()=>s(e.name),isLoading:r.has(e.name),isInstalled:i||null!=e.installedVersion,canWrite:o},e.name))})})]})};var ir=n(36693);let ii=e=>{let{searchQuery:t,hasExtensionResults:n}=e,a=""!==t.trim()&&!n,{templates:s}=(0,ir.Y)(a),r=(0,i.useMemo)(()=>(null==s?void 0:s.data)&&Array.isArray(s.data)&&t.trim()&&!n?new ie.A(s.data,{threshold:.1,keys:[{name:"name",weight:2},{name:"tags",weight:1.5},{name:"category",weight:1.5},{name:"description",weight:1}],includeScore:!0,isCaseSensitive:!1,ignoreLocation:!0,minMatchCharLength:2,findAllMatches:!0}).search(t).map(e=>e.item).slice(0,3):[],[null==s?void 0:s.data,t,n]);return a&&(null==s?void 0:s.isLoading)?(0,l.jsxs)("div",{className:"flex items-center justify-center py-4",children:[(0,l.jsx)(ec.Rh,{}),(0,l.jsx)(ee.EY,{className:"ml-2 text-gray-500",children:"Searching templates..."})]}):0===r.length?null:(0,l.jsxs)(eb.T,{space:2,className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[(0,l.jsxs)("div",{className:"text-center mb-3",children:[(0,l.jsx)(ee.EY,{className:"font-medium",children:"Looking for a template instead?"}),(0,l.jsx)(ee.xC,{className:"mt-1",children:"These templates might help you get started:"})]}),(0,l.jsx)(eb.T,{space:2,children:r.map(e=>(0,l.jsx)(eT.P.div,{...il,className:"border border-gray-300 dark:border-gray-600 rounded-lg p-3 background hover:bg-white/5 dark:hover:bg-white/5 transition-colors",children:(0,l.jsxs)(eb.z,{justify:"between",align:"center",children:[(0,l.jsxs)(eb.z,{space:2,align:"center",className:"flex-1",children:[(0,l.jsx)(Z.Ik,{template:e.code,className:"w-5 h-5"}),(0,l.jsxs)(eb.T,{space:1,className:"flex-1",children:[(0,l.jsx)(ee.EY,{className:"font-medium",children:e.name}),e.description&&(0,l.jsx)(ee.zb,{className:"text-sm",children:e.description})]})]}),(0,l.jsx)(T.$n,{onClick:()=>{window.open("https://railway.com/template/".concat(e.code),"_blank")},variant:"outline",size:"sm",color:"gray",icon:$.f5X,children:"Deploy"})]})},e.id))})]})},io=()=>{var e,t,n,s,r;let o=(0,a.md)(z.mz),[c]=iy(),[d,u]=(0,i.useState)(""),[m,x]=(0,i.useState)(""),{handleInstallExtension:h,handleUninstallExtension:p,loadingExtensions:g}=(()=>{let[e,t]=iy(),{modalActions:n}=(0,P.U)(),{graphqlClient:a}=(0,R.q)(),{isConfirmed:s}=(0,E.S)(),[r,o]=(0,i.useState)(new Set);return{handleInstallExtension:async(r,i)=>{o(e=>new Set(e).add(r));try{try{let t=await a.getSQLExtensionDependencies({environmentId:e.environmentId,serviceId:e.serviceId,databaseType:e.databaseType,extension:r});if(t.sqlExtensionDependencies&&t.sqlExtensionDependencies.length>0&&!await s({title:"Extension Dependencies",message:'Installing "'.concat(r,'" requires these dependencies: ').concat(t.sqlExtensionDependencies.map(e=>'"'.concat(e,'"')).join(", "),". They will be installed automatically. Do you want to continue?"),confirmLabel:"Install",theme:"info"}))return}catch(e){console.warn("Failed to check dependencies:",e)}let o=n.createToast((0,l.jsx)(A.y8,{variant:"neutral",title:"Installing extension",description:"Installing ".concat(r,"...")}),0);try{var c,d;let e=await (null==(c=t.installExtension)?void 0:c.call(t,{extension:r,version:i}));n.exitToast(o);let a="";if(e&&"object"==typeof e&&"installedDependencies"in e)if(e.installedDependencies.length>0){let t=[...e.installedDependencies,r];a="Successfully installed: ".concat(t.join(", "),".")}else a="Successfully installed: ".concat(r,".");else a="".concat(r," has been installed successfully.");n.createToast((0,l.jsx)(A.y8,{variant:"success",title:"Extension installed",description:a})),null==(d=t.refreshExtensions)||d.call(t)}catch(e){throw n.exitToast(o),n.createToast((0,l.jsx)(A.y8,{variant:"error",title:"Failed to install extension",description:e.message||"An unexpected error occurred."})),e}}finally{o(e=>{let t=new Set(e);return t.delete(r),t})}},handleUninstallExtension:async r=>{o(e=>new Set(e).add(r));try{let o=await a.getSQLExtensionDependents({environmentId:e.environmentId,serviceId:e.serviceId,databaseType:e.databaseType,extension:r});if(o.sqlExtensionDependents&&o.sqlExtensionDependents.length>0)return void await s({title:"Cannot Uninstall Extension",message:'The "'.concat(r,'" extension cannot be uninstalled because "').concat(o.sqlExtensionDependents.join('", "'),'" ').concat(1===o.sqlExtensionDependents.length?"depends":"depend"," on it. Uninstall ").concat(1===o.sqlExtensionDependents.length?"this extension":"these extensions"," first."),confirmLabel:"Got it",cancelLabel:"Cancel",theme:"info"});if(!await s({title:"Uninstall Extension",message:'Are you sure you want to uninstall "'.concat(r,'"?'),confirmLabel:"Uninstall",theme:"danger"}))return;let d=n.createToast((0,l.jsx)(A.y8,{variant:"neutral",title:"Uninstalling extension",description:"Uninstalling ".concat(r,"...")}),0);try{var i,c;await (null==(i=t.uninstallExtension)?void 0:i.call(t,{extension:r})),n.exitToast(d),n.createToast((0,l.jsx)(A.y8,{variant:"success",title:"Extension uninstalled",description:"".concat(r," has been uninstalled successfully.")})),null==(c=t.refreshExtensions)||c.call(t)}catch(e){throw n.exitToast(d),n.createToast((0,l.jsx)(A.y8,{variant:"error",title:"Failed to uninstall extension",description:e.message||"An unexpected error occurred."})),e}}catch(e){e.message&&!e.message.includes("depend on it")&&n.createToast((0,l.jsx)(A.y8,{variant:"error",title:"Failed to check dependencies",description:e.message||"An unexpected error occurred."}))}finally{o(e=>{let t=new Set(e);return t.delete(r),t})}},loadingExtensions:r}})(),v=(null==(e=c.extensions)?void 0:e.data)||[],j=null!=(s=null==(t=c.extensions)?void 0:t.isLoading)&&s,y=null==(n=c.extensions)?void 0:n.error;(0,i.useEffect)(()=>{let e=setTimeout(()=>{x(d)},200);return()=>clearTimeout(e)},[d]);let f=(0,i.useMemo)(()=>m.trim()?new ie.A(v,{threshold:.1,keys:[{name:"name",weight:4},{name:"comment",weight:1}],includeScore:!0,isCaseSensitive:!1,ignoreLocation:!0,minMatchCharLength:1,findAllMatches:!0}).search(m).map(e=>e.item):v,[v,m]);if(j)return(0,l.jsx)(eb.T,{space:4,className:"py-6",children:(0,l.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,l.jsx)(ec.Rh,{})})});if(y)return(0,l.jsx)(eb.T,{space:4,className:"py-6",children:(0,l.jsx)("div",{className:"text-center py-8",children:(0,l.jsxs)(ee.EY,{className:"text-red-600",children:["Failed to load extensions: ",y.message]})})});let b=v.filter(e=>e.installedVersion),w=null!=(r=null==f?void 0:f.filter(e=>!e.installedVersion))?r:[];return(0,l.jsxs)(eb.T,{space:6,className:"py-4",children:[(0,l.jsx)(is,{title:"".concat(b.length," Extension").concat(1!==b.length?"s":""," installed"),extensions:b,onInstall:h,onUninstall:p,loadingExtensions:g,isInstalled:!0,canWrite:o}),(0,l.jsxs)(eb.T,{space:3,children:[(0,l.jsxs)(ee.EY,{className:"text-sm text-gray-600 dark:text-white",children:[w.length," Extension",1!==w.length?"s":""," available"]}),(0,l.jsx)(it,{searchQuery:d,onSearchChange:u}),(0,l.jsx)(is,{title:"",extensions:w,onInstall:h,onUninstall:p,loadingExtensions:g,isInstalled:!1,canWrite:o})]}),!(null==f?void 0:f.length)&&""===m.trim()&&(0,l.jsx)("div",{className:"text-center py-8",children:(0,l.jsx)(ee.EY,{children:"No extensions available."})}),!(null==f?void 0:f.length)&&""!==m.trim()&&(0,l.jsxs)(eb.T,{space:8,className:"py-2",children:[(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsxs)(ee.EY,{children:["No extensions found matching “",m,"”."]}),(0,l.jsx)(ee.xC,{className:"mt-2",children:"Try adjusting your search terms."})]}),(0,l.jsx)(ii,{searchQuery:m,hasExtensionResults:!!(null==f?void 0:f.length)})]})]})},ic=()=>{var e;let t=(0,a.md)(z.mz),[n,s]=iy(),{isConfirmed:r}=(0,E.S)(),{graphqlClient:o}=(0,R.q)(),{modalActions:d}=(0,P.U)(),u=(0,c.jE)(),[m,x]=(0,i.useState)(!1),[h,p]=(0,i.useState)(!1),[v,j]=(0,i.useState)(null),[y,f]=(0,i.useState)(!1),[b,w]=(0,i.useState)(null),[N,I]=(0,i.useState)(null),C=N||n.envs||{},S=(null==(e=n.getConnectionInfo)?void 0:e.call(n,C))||{},D=(e=>{switch(e.toLowerCase()){case"postgres":return"Postgres";case"mysql":return"MySQL";case"mongo":return"Mongo";case"redis":return"Redis";default:return null}})(n.databaseType),L=(0,a2.uV)(D,C),M=null,O="";try{switch(M=(e=>{var t,n,l,a;let{variables:s,databaseType:r}=e;if("redis"===r){let e=k.redisEnvSchema.parse(s);return{variable:null!=e.REDIS_PUBLIC_URL?"REDIS_URL":"REDIS_PRIVATE_URL",url:null!=(t=e.REDIS_PUBLIC_URL)?t:e.REDIS_URL}}if("mongo"===r){let e=k.mongoEnvSchema.parse(s);return{variable:null!=e.MONGO_PUBLIC_URL?"MONGO_URL":"MONGO_PRIVATE_URL",url:null!=(n=e.MONGO_PUBLIC_URL)?n:e.MONGO_URL}}if("mysql"===r){let e=k.mysqlEnvSchema.parse(s);return{variable:null!=e.MYSQL_PUBLIC_URL?"MYSQL_URL":"MYSQL_PRIVATE_URL",url:null!=(l=e.MYSQL_PUBLIC_URL)?l:e.MYSQL_URL}}if("postgres"===r){let e=k.postgresEnvSchema.parse(s);return{variable:null!=e.DATABASE_PUBLIC_URL?"DATABASE_URL":"DATABASE_PRIVATE_URL",url:null!=(a=e.DATABASE_PUBLIC_URL)?a:e.DATABASE_URL}}throw Error("Unknown database type ".concat(r))})({variables:C,databaseType:n.databaseType}).url,n.databaseType){case"postgres":O="psql";break;case"mysql":O="mysql";break;case"mongo":O="mongosh";break;case"redis":O="redis-cli";break;default:O="cli"}}catch(e){}let U={...S,password:b||S.password},F=async()=>{let e="redis"===n.databaseType;if(await r({confirmLabel:"Regenerate Password",message:(0,l.jsxs)(eb.T,{space:3,children:[(0,l.jsxs)(ee.EY,{children:["This will create a new password for user"," ",(0,l.jsx)("strong",{children:U.username||"database user"}),"."]}),(0,l.jsxs)(eb.T,{space:2,children:[(0,l.jsx)(ee.EY,{className:"font-medium",children:"What will happen:"}),(0,l.jsxs)("ul",{className:"space-y-1 ml-4",children:[(0,l.jsxs)("li",{className:"flex items-start gap-2",children:[(0,l.jsx)("span",{className:"text-green-500 mt-0.5",children:"✓"}),(0,l.jsx)("span",{children:"New secure password will be generated"})]}),(0,l.jsxs)("li",{className:"flex items-start gap-2",children:[(0,l.jsx)("span",{className:"text-green-500 mt-0.5",children:"✓"}),(0,l.jsx)("span",{children:"Environment variables will be updated automatically"})]}),e&&(0,l.jsxs)("li",{className:"flex items-start gap-2",children:[(0,l.jsx)("span",{className:"text-blue-500 mt-0.5",children:"↻"}),(0,l.jsx)("span",{children:"The service will be redeployed to apply the new password"})]}),(0,l.jsxs)("li",{className:"flex items-start gap-2",children:[(0,l.jsx)("span",{className:"text-amber-500 mt-0.5",children:"⚠"}),(0,l.jsx)("span",{children:"External applications will need the new password to reconnect"})]})]})]}),(0,l.jsx)(ee.EY,{className:"text-sm text-gray-600 dark:text-gray-400",children:"This is a safe operation that won't affect your database data, but external applications will need to be updated with the new password."})]}),theme:"info",title:"Regenerate Database Password"})){if(!n.serviceId)return void d.createToast((0,l.jsx)(A.y8,{variant:"error",title:"Cannot reset password",description:"No service ID found"}));x(!0);try{let e=await o.databasePasswordReset({input:{environmentId:n.environmentId,serviceId:n.serviceId,databaseType:n.databaseType}});if(e.databasePasswordReset){let{newPassword:t,updatedVariables:a}=e.databasePasswordReset;w(t),I(a),p(!0),f(!0),setTimeout(()=>{f(!1)},5e3),s.refresh(),u.invalidateQueries({queryKey:(0,g.mi)(n.environmentId)}),d.createToast((0,l.jsx)(A.y8,{variant:"success",title:"Password regenerated successfully",description:"The database password has been updated successfully."}))}}catch(e){d.createToast((0,l.jsx)(A.y8,{variant:"error",title:"Failed to regenerate password",description:"Please try again."}))}finally{x(!1)}}},V=(e,t)=>{t&&(navigator.clipboard.writeText(t),j(e),setTimeout(()=>j(null),2e3))};return U.username?(0,l.jsxs)(eb.T,{space:4,className:"py-4",children:[(0,l.jsx)("div",{className:"overflow-hidden rounded-lg border border-gray-200 dark:border-gray-300",children:(0,l.jsxs)("table",{className:"min-w-full",children:[(0,l.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-900/50",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Username"}),(0,l.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Password"}),(0,l.jsx)("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"})]})}),(0,l.jsx)("tbody",{className:"bg-white dark:bg-secondaryBg divide-y divide-gray-200 dark:divide-gray-700",children:(0,l.jsxs)("tr",{className:"h-[80px]",children:[(0,l.jsx)("td",{className:"px-4 py-4 w-[150px] min-w-[150px]",children:(0,l.jsx)("div",{className:"flex items-center gap-2",children:(0,l.jsx)(ee.EY,{className:"font-mono text-sm",children:U.username||"N/A"})})}),(0,l.jsx)("td",{className:"px-4 py-4",children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("div",{className:"font-mono text-sm whitespace-pre flex-1 max-h-[15vh]",children:h?(0,l.jsx)("div",{className:"whitespace-pre-wrap break-all p-2 border rounded -ml-2 max-h-[15vh] overflow-y-auto",children:U.password}):(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("div",{className:"py-[0.55rem]",children:"••••••••••••"}),U.password&&(0,l.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,l.jsx)(T.K0,{icon:h?$.X_F:$.kU3,size:"xs",variant:"ghost",onClick:()=>p(!h),title:h?"Hide password":"Show password"}),(0,l.jsx)(T.K0,{icon:$.QRo,size:"xs",variant:"ghost",onClick:()=>V("password",U.password),title:"Copy password"})]})]})}),h&&(0,l.jsxs)("div",{className:"flex whitespace-nowrap flex-nowrap justify-end space-x-0.5",children:[(0,l.jsx)(T.K0,{icon:h?$.X_F:$.kU3,size:"xs",variant:"ghost",onClick:()=>p(!h),title:h?"Hide password":"Show password"}),(0,l.jsx)(T.K0,{icon:$.QRo,size:"xs",variant:"ghost",onClick:()=>V("password",U.password),title:"Copy password"})]}),(0,l.jsxs)("div",{className:"flex items-center min-w-[160px]",children:["password"===v&&(0,l.jsx)(ee.EY,{className:"text-xs text-green-600 dark:text-green-400",children:"Copied!"}),y&&(0,l.jsx)(ee.EY,{className:"text-xs text-amber-600 dark:text-amber-400 animate-in fade-in-0 zoom-in-95 duration-300",children:"New password generated!"})]})]})}),(0,l.jsx)("td",{className:"px-4 py-4 w-[140px] min-w-[140px] text-right",children:(0,l.jsx)(s$.m,{side:"top",content:(0,l.jsx)(l.Fragment,{children:"Write permission required"}),disabled:t,children:(0,l.jsx)(T.$n,{variant:"outline",size:"sm",onClick:F,disabled:m||!U.password||!t,className:"inline-flex items-center gap-1.5",children:m?(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(ec.Rh,{className:"w-3 h-3"}),"Regenerating..."]}):(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)($.e9t,{className:"w-3 h-3"}),"Regenerate"]})})})})]})})]})}),(0,l.jsxs)("div",{children:[(0,l.jsx)(ee.zb,{className:"text-xs",children:"Note: Regenerating the password will update environment variables and break existing external connections until they use the new password."}),"redis"===n.databaseType?(0,l.jsx)(ee.zb,{className:"text-xs",children:"Note: Redis services will be redeployed automatically."}):null]}),M&&L&&(0,l.jsxs)(eb.T,{space:4,className:"mt-6",children:[(0,l.jsx)(ed.l,{size:"sm",variant:"info",children:"Connecting over the public network causes Egress costs."}),(0,l.jsx)(e7,{secrets:[L.secret],label:(0,l.jsx)(l.Fragment,{children:"Connection URL"}),text:M}),(0,l.jsx)(e7,{secrets:[L.secret],label:(0,l.jsxs)(l.Fragment,{children:["Raw ",(0,l.jsx)(ee.R0,{children:O})," command"]}),text:L.command})]})]}):(0,l.jsx)(eb.T,{space:4,className:"py-4",children:(0,l.jsx)(eb.T,{space:1,children:(0,l.jsx)(ee.zb,{className:"text-sm",children:"No credentials available for this database"})})})},id={16:"bool",20:"int8",21:"int2",23:"int4",25:"text",114:"json",700:"float4",701:"float8",790:"money",1042:"bpchar",1043:"varchar",1082:"date",1083:"time",1114:"timestamp",1184:"timestamptz",2950:"uuid",3802:"jsonb"},iu=e=>"json"===id[e]||"jsonb"===id[e],im={kind:rz.Columns,types:tH,constraints:[{value:"PRIMARY KEY",text:"Primary Key"},{value:"NOT NULL",text:"Not NULL"},{value:"UNIQUE",text:"Unique"}],concepts:{drive:"database",object:"row",directory:"table",property:"column"},defaults:{property:{value:"text",text:"text"},properties:[{name:"id",type:{text:"serial",value:"serial"},constraint:{text:"Primary Key",value:"PRIMARY KEY"}}]},actions:{directories:async(e,t)=>(await e.getSQLTableNames({...t,databaseType:"postgres"})).sqlTableNames,createDirectory:async(e,t)=>{await e.createSQLTable({...t,name:t.directory,columns:t.properties,databaseType:"postgres"})},deleteDirectory:async(e,t)=>{if(!t.directory)throw Error("no table found");await e.deleteSQLTable({...t,name:t.directory,databaseType:"postgres"})},objects:async(e,t)=>{if(!t.directory)throw Error("no tablefound");let n=(await e.getSQLTable({...t,name:t.directory,databaseType:"postgres"})).sqlTable;return{propertyNames:n.columnNames,propertyTypes:n.columnTypes,primaryKey:n.primaryKey,objects:n.rows,objectsCount:n.totalRows,name:n.name}},createObject:async(e,t)=>{if(!t.directory)throw Error("no table found");let n=Object.entries(t.properties).map(e=>{let[t,n]=e;return{name:t,value:n}}).filter(e=>{let{value:t}=e;return""!==t.trim()});await e.insertSQLRow({...t,columns:n,tableName:t.directory,databaseType:"postgres"})},updateObject:async(e,t)=>{if(!t.directory)throw Error("no table found");await e.updateSQLRow({...t,tableName:t.directory,pKeyValue:t.id,pKey:t.property,databaseType:"postgres"})},deleteObjects:async(e,t)=>{if(!t.directory)throw Error("no table found");await e.deleteSQLRows({...t,tableName:t.directory,rows:t.ids,databaseType:"postgres",columnName:t.property})},createProperty:async(e,t)=>{if(!t.directory)throw Error("no table found");await e.insertSQLColumn({...t,tableName:t.directory,column:{name:t.name,type:t.type,default:t.default,constraint:t.constraint},databaseType:"postgres"})},generateDummyData:async(e,t)=>{await e.dummyDataSQL({...t,databaseType:"postgres"})},getExtensions:async(e,t)=>(await e.getSQLExtensions({...t,databaseType:"postgres"})).sqlExtensions||[],installExtension:async(e,t)=>(await e.sqlExtensionInstall({...t,databaseType:"postgres"})).sqlExtensionInstall,uninstallExtension:async(e,t)=>{await e.sqlExtensionUninstall({...t,databaseType:"postgres"})},runRawQuery:async(e,t)=>(await e.runRawQuery({...t,databaseType:"postgres"})).sqlRawQueryRun},formatValue:(e,t)=>null==e?"":"timestamp"===id[t]?ea()(e).format("YYYY-MM-DD HH:mm:ss"):"date"===id[t]?ea()(e).format("YYYY-MM-DD"):iu(t)?JSON.stringify(e):"time"===id[t]?ea()(e).format("HH:mm:ss"):e.toString(),isJsonPropertyType:iu,propertyTypeLookup:id,getConnectionInfo:e=>({username:e.PGUSER,password:e.PGPASSWORD})},ix={1:"boolean (tinyint)",3:"integer (mediumint)",5:"float",7:"timestamp",8:"integer (bigint)",10:"date",12:"datetime",245:"json",252:"blob",253:"varstring",254:"string"},ih=e=>"json"===ix[e],ip={kind:rz.Columns,concepts:{drive:"database",object:"row",directory:"table",property:"column"},types:tZ,constraints:[{value:"PRIMARY KEY",text:"Primary Key"},{value:"NOT NULL",text:"Not NULL"},{value:"UNIQUE",text:"Unique"}],defaults:{property:{value:"text",text:"text"},properties:[{name:"id",type:{text:"serial",value:"serial"},constraint:{text:"Primary Key",value:"PRIMARY KEY"}}]},actions:{directories:async(e,t)=>(await e.getSQLTableNames({...t,databaseType:"mysql"})).sqlTableNames,createDirectory:async(e,t)=>{await e.createSQLTable({...t,name:t.directory,columns:t.properties,databaseType:"mysql"})},deleteDirectory:async(e,t)=>{await e.deleteSQLTable({...t,name:t.directory,databaseType:"mysql"})},objects:async(e,t)=>{if(!t.directory)throw Error("no tablefound");let n=(await e.getSQLTable({...t,name:t.directory,databaseType:"mysql"})).sqlTable;return{propertyNames:n.columnNames,propertyTypes:n.columnTypes,primaryKey:n.primaryKey,objects:n.rows,objectsCount:n.totalRows,name:n.name}},createObject:async(e,t)=>{if(!t.directory)throw Error("no tablefound");let n=Object.entries(t.properties).map(e=>{let[t,n]=e;return{name:t,value:n}}).filter(e=>{let{value:t}=e;return""!==t.trim()});await e.insertSQLRow({...t,columns:n,tableName:t.directory,databaseType:"mysql"})},updateObject:async(e,t)=>{if(!t.directory)throw Error("no tablefound");await e.updateSQLRow({...t,tableName:t.directory,pKeyValue:t.id,pKey:t.property,databaseType:"mysql"})},deleteObjects:async(e,t)=>{if(!t.directory)throw Error("no tablefound");await e.deleteSQLRows({...t,tableName:t.directory,rows:t.ids,databaseType:"mysql",columnName:t.property})},createProperty:async(e,t)=>{if(!t.directory)throw Error("no tablefound");await e.insertSQLColumn({...t,tableName:t.directory,column:{name:t.name,type:t.type,default:t.default,constraint:t.constraint},databaseType:"mysql"})},generateDummyData:async(e,t)=>{await e.dummyDataSQL({...t,databaseType:"mysql"})},runRawQuery:async(e,t)=>(await e.runRawQuery({...t,databaseType:"mysql"})).sqlRawQueryRun},formatValue:(e,t)=>null==e?"":"timestamp"===ix[t]?ea()(e).format("YYYY-MM-DD HH:mm:ss"):"date"===ix[t]?ea()(e).format("YYYY-MM-DD"):ih(t)?JSON.stringify(e):"datetime"===ix[t]?ea()(e).format("YYYY-MM-DD HH:mm:ss"):e.toString(),isJsonPropertyType:ih,propertyTypeLookup:ix,getConnectionInfo:e=>({username:e.MYSQLUSER,password:e.MYSQLPASSWORD})},ig={kind:rz.Json,requiresInitialValue:!0,concepts:{drive:"database",directory:"collection",object:"document"},defaults:{drive:k.DEFAULT_MONGO_DATABASE,object:{hello:"world"}},actions:{createDrive:async(e,t)=>{await e.insertMongoDocument({environmentId:t.environmentId,serviceId:t.serviceId,database:t.drive,name:t.directory,data:t.object})},drives:async(e,t)=>(await e.getMongoDatabaseNames(t)).mongoDatabaseNames,directories:async(e,t)=>(await e.getMongoCollectionNames({...t,database:t.drive})).mongoCollectionNames,generateDummyData:async(e,t)=>{await e.generateMongoDummyData({...t,database:t.drive})},createDirectory:async(e,t)=>{if(!t.object)throw Error("No object");await e.insertMongoDocument({database:t.drive,name:t.directory,...t,data:t.object})},deleteDirectory:async(e,t)=>{await e.deleteMongoCollection({...t,name:t.directory,database:t.drive})},createObject:async(e,t)=>{if(!t.directory)throw Error("no tablefound");await e.insertMongoDocument({database:t.drive,name:t.directory,data:t.properties,...t})},updateObject:async(e,t)=>{if(!t.directory)throw Error("no tablefound");delete t.data._id,await e.updateMongoDocument({...t,database:t.drive,id:t.id,name:t.directory})},deleteObjects:async(e,t)=>{if(!t.directory)throw Error("no tablefound");for(let n of t.ids)await e.deleteMongoDocument({environmentId:t.environmentId,serviceId:t.serviceId,database:t.drive,id:n,name:t.directory})},objects:async(e,t)=>{if(!t.directory)throw Error("no tablefound");let n=(await e.getMongoCollection({...t,database:t.drive,name:t.directory})).mongoCollectionData;return{name:n.name,objects:n.data,objectsCount:n.count,primaryKey:"_id"}}},isJsonPropertyType:()=>!0,getConnectionInfo:e=>({username:e.MONGOUSER,password:e.MONGOPASSWORD})},iv={kind:rz.KeyValue,types:[{value:"string",tags:["string"]},{value:"set",tags:["set"]},{value:"list",tags:["queue"]},{value:"hash",tags:["hash"]}].map(function(e){let{value:t,text:n,tags:l}=e;return{value:t,text:null!=n?n:t,tags:l}}),concepts:{drive:"database",object:"key value pair"},defaults:{object:""},actions:{addToObject:async(e,t)=>{if("set"===t.type&&"string"==typeof t.data)await e.addRedisSet({...t,key:t.id,values:[t.data]});else if("list"===t.type&&"string"==typeof t.data)await e.pushRedisList({...t,side:t.side,key:t.id,values:[t.data]});else if("hash"===t.type&&"object"==typeof t.data)await e.setRedisHash({...t,key:t.id,values:{[t.data.key]:t.data.value}});else throw Error("Unable to add to object: type does not match typeof data")},removeFromObject:async(e,t)=>{if("set"===t.type&&"string"==typeof t.data)await e.removeRedisSet({...t,key:t.id,values:[t.data]});else if("list"===t.type&&"number"==typeof t.data)await e.popRedisList({...t,side:0===t.data?"left":"right",key:t.id});else if("hash"===t.type&&"string"==typeof t.data)await e.deleteRedisHash({...t,key:t.id,values:[t.data]});else throw Error("Unable to remove from object: type does not match typeof data")},updateObject:async(e,t)=>{let n=t.data.key,l=t.data.type,a=t.data.value;if("set"===l)throw Error("unable to edit set, try inserting/removing elements");if("list"===l)throw Error("unable to edit list, try inserting/removing elements");if("hash"===l)throw Error("unable to edit hash, try inserting/removing elements");await e.setRedisString({...t,key:n,value:a})},createObject:async(e,t)=>{let n=t.properties.key;if(!n)throw Error("no key");await e.setRedisString({...t,key:n,value:t.properties})},deleteObjects:async(e,t)=>{for(let n of t.ids)await e.deleteRedisKey({...t,key:n})},object:async(e,t)=>(await e.getRedisData({key:t.id,...t})).redisGetKey,objects:async(e,t)=>{let n=(await e.scanRedisKeys({...t})).redisScanKeys;return{objects:n.keys.map(e=>({key:e.name,type:e.type,ttl:e.ttl})),objectsCount:n.count,cursor:n.cursor,propertyNames:["key","type","ttl"],primaryKey:"key"}},setTTL:async(e,t)=>{await e.setRedisExpire({...t,key:t.id})},generateDummyData:async(e,t)=>{await e.generateRedisDummyData(t)}},isJsonPropertyType:()=>!1,getConnectionInfo:e=>({username:e.REDISUSER,password:e.REDISPASSWORD})},ij=(0,i.createContext)([{},{}]),iy=()=>(0,i.useContext)(ij),ib=e=>{var t,n,a,s,r,o,c;let d,{envs:u,project:m,environment:x,serviceId:h,databaseUIType:p,children:g,loadingComponent:v,failedToConnect:j,logsEnabled:y}=e,{graphqlClient:f}=(0,R.q)(),{query:b}=(0,es.c)(),[w,N]=(0,i.useState)(0),[I]=(0,i.useState)(10),[k,C]=(0,i.useState)([0]),{isConfirmed:S}=(0,E.S)(),T=p.toLowerCase();switch(p){case"Postgres":d=im;break;case"MySQL":d=ip;break;case"Mongo":d=ig;break;case"Redis":d=iv}let D="string"==typeof b.table?b.table:null,A=m.id,L=x.id;(0,i.useEffect)(()=>{N(0),C([0])},[D]);let[M,P]=(0,i.useState)(null!=(a=null==(t=d.defaults)?void 0:t.drive)?a:null),z={environmentId:L,serviceId:h,databaseType:T,drive:M,directory:D},{result:O,cancelQuery:U,setQuery:F,invalidateQuery:V}=(0,er.W)(["db","directoryNames",M,L,h],async()=>d.actions.directories?await d.actions.directories(f,z):null,{enabled:null!=M||!d.actions.drives,retry:!0,refetchInterval:8e3}),{result:B,invalidateQuery:_}=(0,er.W)(["db","objects",M,D,L,w,I],async()=>{let e=await d.actions.objects(f,{limit:I,offset:w*I,cursor:k[w],...z});return C(t=>({...t,[w+1]:e.cursor})),e},{enabled:!d.actions.createDirectory||null!=D,refetchInterval:8e3}),{result:q,invalidateQuery:W}=(0,er.W)(["db","extensions",L,h],async()=>d.actions.getExtensions?await d.actions.getExtensions(f,z):[],{enabled:null!=d.actions.getExtensions,refetchInterval:8e3}),{result:K,cancelQuery:Y,setQuery:Q,invalidateQuery:$}=(0,er.W)(["db","driveNames",z.environmentId,z.serviceId],async()=>{if(!d.actions.drives)return null;let e=await d.actions.drives(f,z);return!e.includes(M)&&e.length&&(P(e[0]),V(),_()),e},{enabled:null!=d.actions.drives,refetchInterval:8e3}),{resetPluginEnvs:G}=tr({projectId:A,environmentId:L}),J={...z,projectId:A,databaseType:T,titleCase:e=>"".concat(e.slice(0,1).toUpperCase()).concat(e.slice(1).toLowerCase()),envs:u,selectedDirectoryName:D,selectedDriveName:M,viewState:"string"==typeof b.state?b.state:"",page:w,totalPages:Math.ceil((null!=(s=null==(n=B.data)?void 0:n.objectsCount)?s:0)/I),pageSize:I,concepts:{objectPlural:"".concat(d.concepts.object,"s"),directoryPlural:"".concat(null!=(r=d.concepts.directory)?r:d.concepts.object,"s"),drivePlural:"".concat(d.concepts.drive,"s"),propertyPlural:"".concat(d.concepts.property,"s"),...d.concepts},driveNames:K,directoryNames:O,data:B,extensions:q,formatValue:d.formatValue,isJsonPropertyType:d.isJsonPropertyType,logsEnabled:y,propertyTypeLookup:d.propertyTypeLookup,getConnectionInfo:d.getConnectionInfo,defaults:d.defaults,types:d.types,constraints:d.constraints,kind:d.kind,requiresInitialValue:d.requiresInitialValue,runRawQuery:!!d.actions.runRawQuery},X={refresh:()=>{$(),V(),_(),W()},selectDrive:e=>{P(e),V(),_()},createDrive:d.actions.createDrive?async e=>{Y(),await d.actions.createDrive(f,{...z,...e}),Q([...K.data||[],e.drive]),P(e.drive),$(),V(),_()}:void 0,createDirectory:d.actions.createDirectory?async e=>{U(),await d.actions.createDirectory(f,{...z,...e}),F([...O.data||[],e.directory]),V(),_()}:void 0,deleteDirectory:d.actions.deleteDirectory?async e=>{var t;U(),F((null!=(t=O.data)?t:[]).filter(t=>t!==e.directory)),await d.actions.deleteDirectory(f,{...z,...e}),V()}:void 0,createProperty:d.actions.createProperty?async e=>{await d.actions.createProperty(f,{...z,...e}),_()}:void 0,createObject:async e=>{await d.actions.createObject(f,{...z,...e}),_()},deleteObjects:async e=>{await d.actions.deleteObjects(f,{...z,...e,property:B.data.primaryKey}),_()},removeFromObject:d.actions.removeFromObject?async e=>{await d.actions.removeFromObject(f,{...z,...e}),_()}:void 0,addToObject:d.actions.addToObject?async e=>{await d.actions.addToObject(f,{...z,...e}),_()}:void 0,updateObject:async e=>{await d.actions.updateObject(f,{...z,...e}),_()},object:d.actions.object?async e=>await d.actions.object(f,{...z,...e}):void 0,setTTL:d.actions.setTTL?async e=>{await d.actions.setTTL(f,{...z,...e}),_()}:void 0,generateDummyData:async()=>{await S({confirmLabel:"Generate",message:"Are you sure you want to generate dummy data within this database?",theme:"info",title:"Generate Data"})&&(await d.actions.generateDummyData(f,z),V(),_())},changePage:e=>N(e),refreshExtensions:d.actions.getExtensions?()=>W():void 0,installExtension:d.actions.installExtension?async e=>{let t=await d.actions.installExtension(f,{...z,...e});return W(),t}:void 0,uninstallExtension:d.actions.uninstallExtension?async e=>{await d.actions.uninstallExtension(f,{...z,...e}),W()}:void 0,runRawQuery:d.actions.runRawQuery?async e=>{let t=await d.actions.runRawQuery(f,{...z,...e});return $(),V(),_(),W(),t}:void 0};return(0,l.jsx)(ij.Provider,{value:[J,X],children:O.isError||K.isError||B.isError?null!=j?(0,l.jsx)(l.Fragment,{children:j}):(0,l.jsx)(l.Fragment,{children:null!=(c=null!=(o=K.error)?o:O.error)?c:B.error}):(O.isLoading||K.isLoading)&&v?(0,l.jsx)(l.Fragment,{children:v}):(0,l.jsx)(l.Fragment,{children:g})})},iw=()=>{var e;let t,n=(0,a.md)(z.mz),[s,{createDirectory:r,selectDrive:i,createDrive:o,refreshExtensions:c}]=iy(),{modalActions:d}=(0,P.U)(),{routes:u}=(0,es.c)();if((0,a.md)(I.Zy),!n)return(0,l.jsx)(ts.e,{});switch(s.databaseType){case"postgres":t=im;break;case"mysql":t=ip;break;case"mongo":t=ig;break;case"redis":t=iv}"extensions"===s.viewState&&c||s.viewState;let m=t.actions.directories?(0,l.jsx)(rR,{}):(0,l.jsx)(rH,{}),x=!1;return"create-table"===s.viewState&&t.actions.createDirectory?(x=!0,m=(0,l.jsx)(r7,{})):"table"===s.viewState?(x=!0,m=(0,l.jsx)(rH,{})):"extensions"===s.viewState&&c?m=(0,l.jsx)(io,{}):"credentials"===s.viewState&&(m=(0,l.jsx)(ic,{})),(0,l.jsxs)(eb.T,{space:1,children:[r&&x&&s.driveNames.data?(0,l.jsxs)(l.Fragment,{children:[o?(0,l.jsxs)(eb.z,{align:"center",space:3,justify:"between",className:"max-w-xs",children:[(0,l.jsx)(th.JU,{children:s.concepts.drive}),(0,l.jsx)(T.K0,{title:"Add ".concat(s.concepts.drive),icon:$.f5w,onClick:()=>{var e;o&&d.openModal((0,l.jsx)(eg.aF,{title:"Add ".concat(null!=(e=s.concepts.drive)?e:"drive"),children:(0,l.jsx)(rg,{state:s,createDrive:o})}))}})]}):void 0,s.concepts.drive?(0,l.jsxs)(eb.z,{align:"center",space:3,className:"max-w-xs",children:[(0,l.jsx)("div",{className:"w-full",children:(0,l.jsx)(tg.l,{label:{text:s.concepts.drive,hidden:!0},options:s.driveNames.data.map(e=>({value:e})),value:null!=(e=s.selectedDriveName)?e:void 0,onChange:e=>i(e),size:"sm"})}),s.driveNames.isFetching&&(0,l.jsx)(ec.Rh,{})]}):void 0]}):void 0,m]})};var iN=n(79931);function iI(){let e=(0,nx._)(["\n  relative pb-3 text-sm text-foreground opacity-40\n  data-[state=active]:opacity-100\n  data-[state=active]:font-semibold\n  focus:outline-none focus-visible:outline-pink-500\n"]);return iI=function(){return e},e}function ik(){let e=(0,nx._)(["flex justify-center md:justify-between items-start border-b border-gray-200 mt-1 mb-6 cursor-pointer"]);return ik=function(){return e},e}function iC(){let e=(0,nx._)(["focus:outline-none focus-visible:outline-pink-500"]);return iC=function(){return e},e}function iS(){let e=(0,nx._)(["\n  absolute bottom-0 w-full h-px bg-foreground\n"]);return iS=function(){return e},e}let iT=e=>{let{serviceName:t,rawCommandName:n,databaseUIType:a,variables:s,className:r}=e,i=(0,a2.uV)(a,s),{showModal:o}=(0,L.h)();return null==i?null:(0,l.jsx)(ed.l,{size:"sm",icon:$.dmT,className:(0,X.xW)(r),children:(0,l.jsxs)("div",{className:"flex items-center justify-between gap-4 w-full",children:[(0,l.jsxs)("p",{className:"text-sm",children:["Connect to ",t]}),(0,l.jsx)(T.$n,{variant:"outline",color:"pink",size:"xs",onClick:()=>void(null!=i&&o(iA,{connectCommand:i,rawCommandName:n,serviceName:t,variables:s,databaseUIType:a})),name:"Connect to Database",children:"Connect"})]})})},iD={Private:"Private Network",Public:"Public Network"};function iA(e){let{open:t,onOpenChange:n,serviceName:a,rawCommandName:s,variables:r,databaseUIType:o,connectCommand:c}=e,{variable:d,url:u}=(e=>{var t,n,l,a;let{variables:s,databaseUIType:r}=e;if("Redis"===r){let e=k.redisEnvSchema.parse(s);return{variable:null!=e.REDIS_PUBLIC_URL?"REDIS_URL":"REDIS_PRIVATE_URL",url:null!=(t=e.REDIS_PUBLIC_URL)?t:e.REDIS_URL}}if("Mongo"===r){let e=k.mongoEnvSchema.parse(s);return{variable:null!=e.MONGO_PUBLIC_URL?"MONGO_URL":"MONGO_PRIVATE_URL",url:null!=(n=e.MONGO_PUBLIC_URL)?n:e.MONGO_URL}}if("MySQL"===r){let e=k.mysqlEnvSchema.parse(s);return{variable:null!=e.MYSQL_PUBLIC_URL?"MYSQL_URL":"MYSQL_PRIVATE_URL",url:null!=(l=e.MYSQL_PUBLIC_URL)?l:e.MYSQL_URL}}if("Postgres"===r){let e=k.postgresEnvSchema.parse(s);return{variable:null!=e.DATABASE_PUBLIC_URL?"DATABASE_URL":"DATABASE_PRIVATE_URL",url:null!=(a=e.DATABASE_PUBLIC_URL)?a:e.DATABASE_URL}}throw Error("Unknown database type ".concat(r))})({variables:r,databaseUIType:o}),[m,x]=(0,i.useState)(iD.Private);return(0,l.jsx)(D.a.Root,{open:t,onOpenChange:n,title:"Connect to ".concat(a),titleClasses:"bg-background dark:bg-secondaryBg",contentClasses:"min-h-[538px]",onAfterClose:()=>{x(iD.Private)},children:(0,l.jsx)(eb.T,{className:"w-[720px]",children:(0,l.jsx)("div",{className:"bg-background dark:bg-secondaryBg rounded-b-lg",children:(0,l.jsxs)(tT.bL,{defaultValue:iD.Private,children:[(0,l.jsx)(iL,{children:(0,l.jsxs)(eb.z,{space:6,align:"center",className:"relative",children:[(0,l.jsx)(tT.l9,{value:iD.Private,onClick:()=>x(iD.Private),asChild:!0,children:(0,l.jsxs)(iR,{children:[(0,l.jsx)("span",{children:iD.Private}),m===iD.Private&&(0,l.jsx)(iP,{layoutId:"active-tab",initial:!1,transition:{type:"spring",stiffness:500,damping:30}})]})}),(0,l.jsx)(tT.l9,{value:iD.Public,onClick:()=>x(iD.Public),asChild:!0,children:(0,l.jsxs)(iR,{children:[(0,l.jsx)("span",{children:iD.Public}),m===iD.Public&&(0,l.jsx)(iP,{layoutId:"active-tab",className:"text-pink-500",initial:!1,transition:{type:"spring",stiffness:500,damping:30}})]})})]})}),(0,l.jsx)(iM,{value:iD.Private,children:(0,l.jsxs)("ol",{className:"relative border-s border-gray-200 mx-4",children:[(0,l.jsxs)("li",{className:"flex items-center mb-8 ms-4",children:[(0,l.jsx)(eb.T,{center:!0,className:"absolute w-8 h-8 rounded-full border -start-4 bg-background text-sm",children:"1"}),(0,l.jsx)(ee.EY,{className:"ml-3",children:"Create a new variable in the service you want to connect to this database."})]}),(0,l.jsxs)("li",{className:"flex items-start w-full mb-6 ms-4",children:[(0,l.jsx)(eb.T,{center:!0,className:"absolute w-8 h-8 rounded-full border -start-4 bg-background text-sm",children:"2"}),(0,l.jsxs)(eb.T,{space:3,className:"ml-3 mt-1 w-full",children:[(0,l.jsx)(ee.EY,{children:"Assign it the following value:"}),(0,l.jsx)(e3.$,{textToCopy:"${{ ".concat(a,".").concat(d," }}"),children:"${{ ".concat(a,".").concat(d," }}")})]})]}),(0,l.jsxs)("li",{className:"mb-8 ms-4 flex items-center",children:[(0,l.jsx)(eb.T,{center:!0,className:"absolute w-8 h-8 rounded-full border -start-4 bg-background text-sm",children:"3"}),(0,l.jsx)(ee.EY,{className:"ml-3",children:"Use the variable in your application code."})]})]})}),(0,l.jsx)(iM,{value:iD.Public,children:(0,l.jsxs)(eb.T,{space:6,children:[(0,l.jsx)(ed.l,{size:"sm",variant:"info",children:"Connecting over the public network causes Egress costs."}),(0,l.jsx)(e7,{secrets:[c.secret],label:(0,l.jsx)(l.Fragment,{children:"Connection URL"}),text:u,openLink:u}),(0,l.jsx)(e7,{secrets:[c.secret],label:(0,l.jsxs)(l.Fragment,{children:["Raw ",(0,l.jsx)(ee.R0,{children:s})," command"]}),text:c.command}),(0,l.jsx)(e7,{label:(0,l.jsxs)(l.Fragment,{children:["Railway CLI ",(0,l.jsx)(ee.R0,{children:"connect"})," command"]}),text:"railway connect ".concat(iE(a))})]})})]})})})})}let iE=e=>e.includes(" ")?'"'.concat(e,'"'):e,iR=X.qy.span(iI()),iL=(0,X.DR)(tT.B8)(ik()),iM=(0,X.DR)(tT.UC)(iC()),iP=(0,X.DR)(eT.P.div)(iS()),iz={Postgres:"psql",MySQL:"mysql",Redis:"redis-cli",Mongo:"mongo"},iO=e=>{let{service:t,databaseUIType:n,variables:s}=e,[r,{refreshExtensions:i}]=iy(),{routes:o}=(0,es.c)(),c=(0,a.md)(I.Zy),[{featureFlags:d}]=(0,ev.Jd)(),m="extensions"===r.viewState&&i&&d.includes(u.Fev.ExtensionsTab)?"extensions":"credentials"===r.viewState&&d.includes(u.Fev.CredentialsTab)?"credentials":"tables",x=o.projectServiceData({environmentId:null==c?void 0:c.id,serviceId:t.id}),h=[{text:r.titleCase(r.concepts.directoryPlural||"Tables"),link:x,active:"tables"===m}];return i&&d.includes(u.Fev.ExtensionsTab)&&h.push({text:"Extensions",link:{...x,query:{...x.query,state:"extensions"}},active:"extensions"===m}),d.includes(u.Fev.CredentialsTab)&&h.push({text:"Credentials",link:{...x,query:{...x.query,state:"credentials"}},active:"credentials"===m}),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(iT,{serviceName:t.name,rawCommandName:iz[n],databaseUIType:n,variables:null!=s?s:{}}),h.length>1&&(0,l.jsx)(iN.o,{tabs:h,className:"mt-4"}),(0,l.jsx)(iw,{})]})},iU=e=>{var t,n;let{project:s,environment:r,service:o,serviceInstance:c,databaseUIType:d}=e,m=(0,a.md)(z.mz),x=(0,a.md)((0,U.cs)({serviceId:o.id,environmentId:r.id})),h=null==c?void 0:c.latestDeployment,[g,v]=(0,i.useState)(null==x?void 0:x.isCreated);(0,i.useEffect)(()=>{g&&v(null==h||(null==x?void 0:x.isCreated))},[g,h,x]);let{variables:j,variablesResult:y}=(0,eH.U7)({projectId:s.id,environmentId:r.id,serviceId:o.id,enabled:m,refetchInterval:g?1500:void 0}),f=(0,a6.I)({projectId:s.id,environmentId:r.id,serviceId:o.id}),{enabled:b,requiredVariables:w}=(0,a2.T9)(d,null!=j?j:{}),{modalActions:N}=(0,P.U)(),{deployments:I}=(0,p.z4)({projectId:s.id,environmentId:r.id,serviceId:o.id}),k=null==I||null==(n=I.pages[0])||null==(t=n.activeDeployments.edges.find(e=>e.node.status===u.Uty.Success))?void 0:t.node,C=null==h&&null!=f.deployFromSource?async()=>{try{let e=N.createToast((0,l.jsx)(A.y8,{variant:"neutral",title:"Deploying database"}));await f.deployFromSource({}),N.exitToast(e),N.createToast((0,l.jsx)(A.y8,{variant:"success",title:"Deployed database"}))}catch(e){N.createToast((0,l.jsx)(A.y8,{variant:"error",title:"There was an error deploying the database."}))}}:void 0;return g?(0,l.jsx)(iF,{databaseUIType:d}):!y.isLoading&&b&&k?(0,l.jsx)("div",{children:(0,l.jsx)(ib,{logsEnabled:!0,project:s,environment:r,databaseUIType:d,serviceId:o.id,envs:j,loadingComponent:(0,l.jsx)(iV,{databaseUIType:d,loadingVariables:y.isLoading,hasRequiredVariables:b,requiredVariables:w,activeDeploy:k,latestDeploy:h,loadingConnection:!0}),failedToConnect:(0,l.jsx)(iV,{databaseUIType:d,loadingVariables:y.isLoading,variables:j,hasRequiredVariables:b,requiredVariables:w,activeDeploy:k,latestDeploy:h,failedConnection:!0}),children:(0,l.jsx)(iO,{service:o,databaseUIType:d,variables:null!=j?j:{}})})}):(0,l.jsx)(iV,{databaseUIType:d,loadingVariables:y.isLoading,hasRequiredVariables:b,requiredVariables:w,activeDeploy:k,latestDeploy:h,deployFromSource:C})},iF=e=>{let{databaseUIType:t}=e;return(0,l.jsxs)(eb.T,{children:[(0,l.jsxs)(ee.f_,{as:"h2",children:[t," DB"]}),(0,l.jsxs)("div",{className:"flex items-center gap-3 bg-gray-50 rounded-lg p-4 w-full mt-4",children:[(0,l.jsx)(ec.Rh,{className:"text-gray-500"}),(0,l.jsxs)("p",{className:"text-sm text-gray-500",children:["The ",t," database is being created..."]})]})]})},iV=e=>{let{databaseUIType:t,loadingVariables:n,hasRequiredVariables:a,requiredVariables:s,variables:r,loadingConnection:i,failedConnection:o,deployFromSource:c,latestDeploy:d,activeDeploy:m}=e,{routes:x}=(0,es.c)(),h=(0,a2.uV)(t,null!=r?r:{}),p=Object.keys(null!=r?r:{}).find(e=>e.toLowerCase().includes("host")),g=(null!=r?r:{})[null!=p?p:""];return(0,l.jsxs)(eb.T,{children:[(0,l.jsxs)(eb.T,{space:2,children:[(0,l.jsxs)(ee.f_,{as:"h2",children:[t," DB"]}),(0,l.jsx)(ee.zb,{children:"A custom interface into your database"})]}),(0,l.jsxs)("ul",{className:"mt-6 space-y-4",children:[(0,l.jsx)("li",{className:"flex gap-4 items-start",children:m||(null==d?void 0:d.status)!==u.Uty.Initializing&&(null==d?void 0:d.status)!==u.Uty.Building&&(null==d?void 0:d.status)!==u.Uty.Deploying?m?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(Z.In,{icon:$.rAV,className:(0,X.xW)("text-green-500")}),(0,l.jsxs)(eb.T,{space:2,className:"w-full",children:[(0,l.jsx)(ee.EY,{children:"Deployment Online"}),(0,l.jsx)(ee.xC,{className:"",children:"This service has an active deployment"})]})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(Z.In,{icon:$.Jpz,className:(0,X.xW)("mt-1 text-red-500")}),(0,l.jsxs)(eb.T,{space:2,className:"w-full",children:[(0,l.jsx)(ee.EY,{children:"Deployment Online"}),(0,l.jsxs)("div",{className:"grid gap-3 bg-gray-50 rounded-lg p-4 w-full",children:[(0,l.jsx)("p",{className:"text-sm text-gray-500",children:"This service requires a deployment to be online"}),null==m&&null!=c&&(0,l.jsx)(T.$n,{onClick:c,size:"sm",className:"max-w-max",children:"Deploy database"})]})]})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(ec.Rh,{}),(0,l.jsxs)(eb.T,{space:2,className:"w-full",children:[(0,l.jsx)(ee.EY,{children:"Deployment Online"}),(0,l.jsx)(ee.xC,{className:"",children:"The database is being deployed..."})]})]})}),(0,l.jsx)("li",{className:"flex gap-4 items-start",children:n?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(ec.Rh,{}),(0,l.jsx)(ee.EY,{children:"Required Variables"})]}):a?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(Z.In,{icon:$.rAV,className:(0,X.xW)("text-green-500")}),(0,l.jsxs)(eb.T,{space:2,className:"w-full",children:[(0,l.jsx)(ee.EY,{children:"Required Variables"}),(0,l.jsx)(ee.xC,{className:"",children:"This service has all the necessary variables that this UI uses to connect to the database."})]})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(Z.In,{icon:$.Jpz,className:(0,X.xW)("mt-1 text-red-500")}),(0,l.jsxs)(eb.T,{space:2,className:"w-full",children:[(0,l.jsx)(ee.EY,{children:"Required Variables"}),(0,l.jsxs)(ee.xC,{className:"p-4 bg-gray-50 rounded-lg w-full",children:[(0,l.jsx)("p",{children:"Ensure that the following variables are configured"}),(0,l.jsx)("ul",{className:"mt-2 list-disc ml-4",children:s.map(e=>(0,l.jsx)("li",{children:(0,l.jsx)("span",{className:"font-mono text-pink-600",children:e})},e))})]}),(0,l.jsx)(T.vx,{...x.projectServiceVariables({}),size:"sm",className:"max-w-max",variant:"outline",children:"Configure Variables"})]})]})}),(0,l.jsx)("li",{className:"flex gap-4 items-start",children:i?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(ec.Rh,{}),(0,l.jsx)(ee.EY,{children:"Database Connection"})]}):o?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(Z.In,{icon:$.Jpz,className:(0,X.xW)("mt-1 text-red-500")}),(0,l.jsxs)(eb.T,{space:2,className:"w-full",children:[(0,l.jsx)(ee.EY,{children:"Database Connection"}),(0,l.jsx)(ee.xC,{className:"max-w-lg",children:"We are unable to connect to the database over the public network."}),(0,l.jsx)(ee.xC,{className:"max-w-lg",children:"Can you connect using this command?"}),null!=h&&null!=r&&(0,l.jsx)(e7,{secrets:[h.secret],text:h.command}),(null==g||""===g.trim())&&(0,l.jsxs)(eb.T,{space:3,children:[(0,l.jsx)(ed.l,{variant:"warning",children:"The Railway UI connects to databases over the public network and requires a TCP proxy setup."}),(0,l.jsx)(T.vx,{...x.projectServiceSettings({}),size:"sm",className:"max-w-max",variant:"outline",children:"Configure TCP Proxy"})]})]})]}):null})]})]})};var iB=n(73935),i_=n(97589),iq=n(10137),iW=n(13486),iK=n(21507),iY=n(52846);function iQ(e){let{execution:t}=e,{deploymentMeta:n}=t,a=t.status===u.FZy.Exited,s=t.status===u.FZy.Crashed,r=t.status===u.FZy.Running,i=t.status===u.FZy.Skipped;return(0,l.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,l.jsx)("p",{className:"text-sm text-foreground truncate max-w-48",children:function(e){let t=(0,iK.c5)(e);return"GitHub"===t?e.commitMessage:"Docker"===t&&e.image?(0,iK.o6)(e.image):"railway up"}(n)}),r&&(0,l.jsxs)("div",{className:"border border-black/[.075] flex items-center gap-x-[2px] dark:border-white/[.075] rounded-2xl py-[3px] pl-[6px] pr-3",children:[(0,l.jsx)(Z.In,{className:"text-green-400",icon:()=>(0,l.jsx)(ec.Rh,{size:16,thickness:3})}),(0,l.jsx)("p",{className:"text-foreground text-xs",children:"Running..."})]}),a&&(0,l.jsx)("div",{className:"ml-[9px] h-2 w-2 my-[10px] bg-green-400 rounded-full"}),s&&(0,l.jsx)("div",{className:"ml-[9px] h-2 w-2 my-[10px] bg-red-400 rounded-full"}),i&&(0,l.jsxs)("div",{className:"border border-black/[.075] flex items-center gap-x-2 dark:border-white/[.075] rounded-2xl py-1 pl-2 px-3",children:[(0,l.jsx)("div",{className:"h-2 w-2 bg-gray-400 rounded-full"}),(0,l.jsx)("p",{className:"text-gray-500 text-xs",children:"Previous execution still running"})]})]})}function i$(e){let{execution:t}=e;return(0,l.jsxs)("p",{className:"text-sm tabular-nums",children:[(0,l.jsx)(iY.d,{timeStyle:"narrow",children:t.createdAt})," ",(0,l.jsxs)("span",{className:"text-gray-500",children:["(",(0,l.jsx)(aT.s,{timeStyle:"narrow",children:t.createdAt}),")"]})]})}function iG(e){let{execution:t}=e;return(0,l.jsxs)("p",{className:"text-sm tabular-nums",children:[(0,l.jsx)(iY.d,{timeStyle:"narrow",startedAt:t.createdAt,finishedAt:t.completedAt})," ",(0,l.jsxs)("span",{className:"text-gray-500",children:["(",(0,l.jsx)(aT.s,{timeStyle:"narrow",allowPreferredFormat:!1,children:t.completedAt}),")"]})]})}function iJ(e){var t;let{execution:n,returnTo:a}=e,{routes:s}=(0,es.c)();return(0,l.jsxs)(eu.N,{className:"border-b border-b-black/[.075] flex gap-x-10 items-center py-2 transition-colors w-full dark:border-b-white/[.075] hover:bg-secondaryBg",...s.projectServiceDeployments({deploymentId:n.deploymentId,start:n.createdAt,end:null!=(t=n.completedAt)?t:void 0,...a?{returnTo:a}:{}}),children:[(0,l.jsx)("div",{className:"flex flex-1 items-center text-gray-500 text-sm tabular-nums",children:(0,l.jsxs)("p",{children:[(0,l.jsx)(ek.g,{dateStyle:"short",timeStyle:!1,children:n.createdAt})," ","–"," ",(0,l.jsx)(ek.g,{dateStyle:!1,timeStyle:"short",children:n.createdAt})]})}),(0,l.jsx)("div",{className:"flex-[3]",children:(0,l.jsx)(iQ,{execution:n})}),(0,l.jsxs)("div",{className:"flex flex-1 gap-x-2 items-center",children:[n.completedAt&&(0,l.jsx)(iG,{execution:n}),!n.completedAt&&(0,l.jsx)(i$,{execution:n})]})]})}function iX(){return(0,l.jsx)("div",{className:"border-b border-b-black/[.075] dark:border-b-white/[.075] py-2 w-full",children:(0,l.jsx)(t4.g,{height:24,width:"100%"})})}function iH(){let e=Array.from(Array(10).keys());return(0,l.jsx)("div",{className:"flex flex-col",children:e.map(e=>(0,l.jsx)(iX,{},e))})}function iZ(e){var t,n,a;let{latestDeployment:s,returnTo:r}=e,{query:{data:i,isLoading:o,fetchNextPage:c}}=(0,iW.f)({deployment:s}),d=null!=(a=null==i?void 0:i.pages.flatMap(e=>{var t,n;return null==(n=e.deploymentInstanceExecutions)||null==(t=n.edges)?void 0:t.map(e=>e.node)}))?a:[];if(o)return(0,l.jsx)(iH,{});let u=null==i?void 0:i.pages[i.pages.length-1];return(0,l.jsxs)("div",{className:"flex flex-col",children:[0===d.length&&(0,l.jsx)("div",{className:"bg-secondaryBg border border-dashed border-gray-20 flex items-center justify-center rounded-lg py-8 w-full",children:(0,l.jsx)("p",{className:"text-gray-950 text-sm",children:"There are no previous executions for this service."})}),d.length>0&&d.map(e=>(0,l.jsx)(iJ,{execution:e,returnTo:r},e.id)),!!(null==u||null==(n=u.deploymentInstanceExecutions)||null==(t=n.pageInfo)?void 0:t.hasNextPage)&&(0,l.jsx)(T.$n,{size:"xs",color:"gray",name:"Load More Logs",isLoading:o,onClick:()=>{c()},children:"Load More"})]})}let i0={[u.Uty.Building]:"border-blue-200",[u.Uty.Crashed]:"border-red-200",[u.Uty.Deploying]:"border-blue-200",[u.Uty.Failed]:"border-red-200",[u.Uty.Success]:"border-green-200",[u.Uty.Initializing]:"border-blue-200",[u.Uty.Sleeping]:"border-yellow-200"};function i1(e){var t;let{isDisabled:n=!1,serviceInstance:a,serviceInstanceConfig:s}=e,{graphqlClient:r}=(0,R.q)(),{modalActions:i}=(0,P.U)(),{routes:o}=(0,es.c)(),d=(0,c.jE)(),u=null==(t=s.deploy)?void 0:t.cronSchedule,m=(0,i_.w)(s),x=(0,iq.$$)(u),{mutate:h,isPending:p}=(0,sN.n)({mutationFn:async e=>r.deploymentInstanceExecutionCreate(e),onError:()=>{i.createToast((0,l.jsx)(A.y8,{description:"We were unable to start your cron execution. If this error persist, please contact support.",title:"Failed to invoke cron execution",variant:"error"}))},async onSuccess(){i.createToast((0,l.jsx)(A.y8,{description:"Your cron execution has been invoked, and will run immediately.",title:"Cron execution started",variant:"success"})),a&&(await new Promise(e=>setTimeout(e,750)),d.refetchQueries({queryKey:(0,iW.I)(a.environmentId,a.serviceId)}))}}),g=async()=>{let e=null==a?void 0:a.id;e&&h({input:{serviceInstanceId:e}})};return null==x?null:(0,l.jsxs)("div",{className:"border border-gray-200 bg-background p-4 flex items-center gap-x-4 rounded-lg",children:[(0,l.jsx)(Z.In,{className:"text-gray-500",icon:$.VvS}),(0,l.jsx)("div",{className:"w-[1px] h-8 bg-black/[.075] dark:bg-white/[.075]"}),(0,l.jsxs)("p",{className:"text-sm text-gray-500 tabular-nums",children:["Next run"," ",(0,l.jsx)("span",{className:"text-sm font-medium text-gray-950 [font-feature-settings: 'tnum']",children:m})]}),(0,l.jsx)("div",{className:"w-[1px] h-8 bg-black/[.075]  dark:bg-white/[.075]"}),(0,l.jsxs)("p",{className:"text-sm text-gray-500",children:["Runs"," ",(0,l.jsx)("span",{className:"text-sm font-medium text-gray-950",children:x})]}),(0,l.jsxs)("div",{className:"justify-end flex flex-1 gap-x-2",children:[(0,l.jsx)(T.vx,{...o.projectServiceSettings({section:"deploy-cron-schedule"}),color:"gray",size:"sm",variant:"ghost",children:"Edit schedule"}),(0,l.jsx)(T.$n,{color:"gray",onClick:g,disabled:p||n,size:"sm",variant:"outline",children:"Run now"})]})]})}function i2(e){var t,n;let{serviceInstance:s,serviceInstanceConfig:r}=e,i=(0,a.md)(z.DM),{routes:o}=(0,es.c)(),c=null==s||null==(t=s.latestDeployment)?void 0:t.id,{result:d}=(0,h.dq)(c,null!=c),u=null==d?void 0:d.data,m=(0,X.xW)(["flex","flex-col","rounded-lg","overflow-hidden","border","border-gray-200","select-none",u&&i0[u.status]]),x=o.projectServiceDeployments({deploymentId:null!=(n=null==u?void 0:u.id)?n:void 0});return(0,l.jsxs)("div",{className:"flex flex-col gap-y-6 pb-8",children:[(0,l.jsx)(i1,{isDisabled:!u,serviceInstance:s,serviceInstanceConfig:r}),(0,l.jsxs)("div",{className:"flex flex-col gap-y-6",children:[u&&(0,l.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("p",{className:"font-medium text-gray-950",children:"Current Deployment"}),(0,l.jsx)(eu.N,{className:"text-sm text-gray-500 hover:underline",...o.projectServiceDeployments({}),children:"Deployment history"})]}),(0,l.jsx)(eu.N,{className:m,...x,children:(0,l.jsx)("div",{className:"m-1 z-10",children:(0,l.jsx)(sa.g,{deployment:u,permissions:i})})})]}),u&&(null==s?void 0:s.serviceId)&&(0,l.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,l.jsx)("p",{className:"font-medium text-gray-950",children:"Recent Executions"}),(0,l.jsx)(iZ,{latestDeployment:u,returnTo:"cron-schedule"})]}),!u&&(0,l.jsx)("div",{className:"bg-secondaryBg border border-dashed border-gray-20 flex items-center justify-center rounded-lg py-8 w-full",children:(0,l.jsx)("p",{className:"text-gray-950 text-sm",children:"There is no active deployment for this service."})})]})]})}var i5=n(4254);let i4=e=>{var t;let{serviceId:n,deploymentId:s,canvasAtoms:r}=e,o=(0,a.md)(x.T6),c=(0,a.md)(I.Zy),d=(0,a.md)((0,J.lU)(n)),u=(0,a.md)(U.vA),h=(0,a.md)(m.oI),p=(0,a.md)((0,ai.m5)(n)),g=(0,a.md)((0,U.KI)({environmentId:null!=(t=null==c?void 0:c.id)?t:null,serviceId:n})),{routes:v,navActions:j,isTemplateCreatePage:y}=(0,es.c)();return((0,i.useEffect)(()=>{!h||Object.values(g).length||p||j.replace(y?v.templateCreate({}):v.project({}))},[g,p,h]),null!=o&&null!=c&&null!=d&&h)?(0,l.jsx)(i6,{project:o,environment:c,environmentConfig:u,service:d,serviceInstanceConfig:g,serviceInstance:p,deploymentId:s,canvasAtoms:r}):(0,l.jsx)(eJ.P2,{})},i6=e=>{var t,n,s;let{project:r,environment:o,environmentConfig:c,service:d,serviceInstanceConfig:u,serviceInstance:m,deploymentId:x,canvasAtoms:h}=e,p=(0,a2.PV)(u),{tabs:g,currentTab:v}=(e=>{var t,n;let{serviceInstance:l,serviceInstanceConfig:s,isCronJob:r,databaseUIType:o,enableBackups:c}=e,[{user:d}]=(0,ev.Jd)(),{routes:u,projectId:m,serviceId:x}=(0,es.c)(),h=(0,a.md)(I.KE),p=(0,k.isFunctionService)(s),g=(0,a.md)((0,i5.KS)(p?{serviceInstanceId:null!=(n=null!=(t=null==l?void 0:l.id)?t:x)?n:""}:{serviceInstanceId:""}));return(0,a1.B)((0,i.useMemo)(()=>{let e={"Cron Runs":{enabled:r,route:u.projectServiceSchedule({environmentId:h})},Deployments:{enabled:!0,route:u.projectServiceDeployments({environmentId:h})},"Source Code":{enabled:p,route:u.projectServiceSourceCode({environmentId:h}),badge:g},Data:{enabled:null!=o,route:u.projectServiceData({environmentId:h})},Backups:{enabled:c,route:u.projectServiceBackups({environmentId:h})},Variables:{enabled:!0,route:u.projectServiceVariables({environmentId:h})},Metrics:{enabled:!0,route:u.projectServiceMetrics({environmentId:h})},Settings:{enabled:!0,route:u.projectServiceSettings({environmentId:h})}};return(null==d?void 0:d.isAdmin)&&(e.Admin={enabled:!0,route:u.projectServiceAdmin({environmentId:h})}),e},[d,m,h,x,o,r,c,g,p]))})({serviceInstance:m,serviceInstanceConfig:u,isCronJob:(null==(t=u.deploy)?void 0:t.cronSchedule)!=null,databaseUIType:p,enableBackups:Object.keys(null!=(n=u.volumeMounts)?n:{}).length>0}),j=(0,eX.tF)();(0,eQ.pO)(j&&null==x);let{updateServiceName:y,updateServiceIcon:f}=(0,a5.w)(d.id),b=v;"Data"!==b||p||(b="Deployments");let[w,N]=(0,i.useState)(v);null!==b&&w!==b&&N(b),null===v&&(b=w),(0,i.useEffect)(()=>{if("Settings"===b&&window.location.hash){let e=window.location.hash.replace("#","");setTimeout(()=>{let t=document.getElementById(e);null==t||t.scrollIntoView({behavior:"smooth",block:"center"})},250)}},[b]);let{serviceIcon:C,serviceName:S}=(0,aj.W)(d,null==u?void 0:u.source),T=null==r||null==o||null==d,D="Deployments"===String(b),A=!D&&"Source Code"===b;return(0,l.jsxs)(eJ.lD,{title:S,icon:C,tabs:g,className:"service-tabs",contentClassName:A?"h-full !overflow-hidden !p-0":void 0,onTitleEdit:y,iconUrl:null!=(s=null==d?void 0:d.icon)?s:"",onIconEdit:f,children:[T&&(0,l.jsx)(ec.m6,{}),!T&&(0,l.jsxs)(l.Fragment,{children:[!D&&"Cron Runs"===b&&(0,l.jsx)(i2,{serviceInstance:m,serviceInstanceConfig:u}),(D||null==b)&&(0,l.jsx)(sA,{project:r,environment:o,serviceInstanceConfig:u,serviceInstance:m,service:d}),!D&&"Source Code"===b&&(0,l.jsx)(i5.E$,{project:r,serviceId:d.id,environmentId:o.id,serviceInstance:m,serviceInstanceConfig:u,autoFocus:!0}),"Metrics"===b&&(0,l.jsx)(l8,{project:r,environment:o,serviceId:d.id}),"Data"===b&&null!=p&&(0,l.jsx)(iU,{project:r,environment:o,service:d,serviceInstance:m,databaseUIType:p}),"Variables"===b&&(0,l.jsx)(s2,{project:r,environment:o,environmentConfig:c,service:d,serviceInstanceConfig:u,allowEditing:!0}),"Backups"===b&&h&&(0,l.jsx)(rp,{project:r,environment:o,service:d,canvasAtoms:h}),"Settings"===b&&(0,l.jsx)(iB.H,{project:r,environment:o,service:d}),"Admin"===String(b)&&(0,l.jsx)(sM.Br,{projectId:r.id,environmentId:o.id,serviceId:d.id})]})]})};var i8=n(76488),i3=n(63774),i7=n(27644),i9=n(79060);let oe=e=>{var t,n;let{inProjectTemplateConfig:{config:s,template:r,isDeploying:o}}=e,c=(0,a.md)(x.T6),d=(0,a.md)(I.Zy),u=(0,a.md)(z.DM),{navActions:m}=(0,es.c)(),h=(0,eX.tF)();(0,eQ.pO)(h);let{image:p,name:g}=r,{templateConfigActions:v}=(0,eY.a)(),{gitHubReposAccessAvailable:j,gitHubReposAccessAvailableIsLoading:y,gitHubReposAccessAvailableToAll:f}=(0,i8.HR)(null!=(t=s.services)?t:{}),b=(0,i.useMemo)(()=>null!=p?()=>(0,l.jsx)($.xfq,{src:p}):$.xA9,[p]),w=(()=>{let e=(0,i.useRef)(null);return(0,i.useEffect)(()=>{if(e.current){let t=e.current.querySelector("input");t&&t.focus()}},[]),e})(),N=(0,i.useRef)(null),{numServicesMissingVariables:k}=(0,i.useMemo)(()=>{var e,t,n;let l=0,a=new Set;for(let[n,r]of Object.entries(null!=(e=s.services)?e:{})){let e=Object.values(null!=(t=r.variables)?t:{}).filter(e=>{let t=!!(null==e?void 0:e.defaultValue)||(null==e?void 0:e.value);return!(null==e?void 0:e.isOptional)&&!t});l+=+(e.length>0),e.length>0&&a.add(n)}let r=nY()(Object.keys(null!=(n=s.services)?n:{}),[e=>+!a.has(e),e=>{var t,n,l;return null!=(l=null==(t=(null!=(n=s.services)?n:{})[e])?void 0:t.name)?l:e}],["asc","asc"]);return null==N.current&&(N.current=r),{numServicesMissingVariables:l}},[s]),C=k>0||!f;(0,as.Z)({"$mod+Enter":()=>{C||v.deployTemplate()}},[C]);let{routes:S}=(0,es.c)();return null==c||null==d||null==u?(0,l.jsx)(eJ.P2,{}):(0,l.jsx)(eJ.lD,{title:g,link:S.templateDetails({code:r.code}),icon:b,action:(0,l.jsx)(l.Fragment,{children:f?(0,l.jsxs)(T.$n,{size:"sm",color:C?"gray":"pink",disabled:C,isLoading:o||y,onClick:()=>{v.deployTemplate()},children:[o?"Deploying":"Deploy Template",(0,l.jsxs)("span",{className:"hidden xl:inline text-xs font-medium text-pink-100 dark:text-pink-800 ml-1",children:[np.iR,"Enter"]})]}):(0,l.jsx)(T.$n,{size:"sm",color:"gray",onClick:()=>{m.replace(S.project({})),v.discardTemplateConfiguration()},children:"Remove Template"})}),children:(0,l.jsxs)("div",{className:"pb-8",ref:w,children:[(0,l.jsxs)("div",{className:"flex items-center gap-4 justify-between w-full mb-6",children:[k>0?(0,l.jsxs)("p",{className:"text-red-600",children:["Variable values missing for ",k," ",(0,ey.td)("service",k)]}):y?(0,l.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,l.jsx)(Z.In,{icon:ec.Rh,className:"text-grey-500"}),(0,l.jsx)("p",{className:"text-sm text-grey-600",children:"Trying to access repository"})]}):f?(0,l.jsx)("p",{className:"text-green-600",children:"Template is ready to deploy"}):(0,l.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,l.jsx)(Z.In,{icon:$.hcu,className:"text-red-500"}),(0,l.jsx)(eb.T,{children:(0,l.jsx)("p",{className:"text-sm text-red-600",children:"Railway can't access a repository in this template. Please ensure it exists and that you have access to it"})})]}),(0,l.jsx)(T.$n,{variant:"ghost",color:"gray",size:"sm",className:"text-gray-600",onClick:()=>{m.replace(S.project({})),v.discardTemplateConfiguration()},children:"Remove Template"})]}),(0,l.jsx)("div",{className:"grid gap-4",children:(null!=(n=N.current)?n:[]).map(e=>{var t,n;let a=(null!=(n=s.services)?n:{})[e];return null==a?null:(0,l.jsx)(ot,{serviceConfig:a,hasAccessToGitHubRepo:null==(t=j[e])?void 0:t.hasAccess,setVariableValue:(t,n)=>{v.setServiceVariableValue({serviceId:e,variableName:t,value:n})},project:c,environmentId:d.id,permissions:u},e)})})]})})},ot=e=>{var t,n,s;let{serviceConfig:r,setVariableValue:o,hasAccessToGitHubRepo:c,project:d,environmentId:u,permissions:m}=e,{preConfiguredVariables:x,requiredNonDefaultVariables:h,missingVariables:p}=(0,i.useMemo)(()=>{var e;let t=[],n=[],l=[];for(let[a,s]of Object.entries(null!=(e=r.variables)?e:{}))null!=s&&(s.isOptional||s.defaultValue?n.push(a):(t.push(a),s.value||s.defaultValue||l.push(a)));return{requiredNonDefaultVariables:t,preConfiguredVariables:n,missingVariables:l}},[r]),g=p.length>0,v=(null==(t=r.source)?void 0:t.image)!=null,[j,y]=(0,i.useState)(""),f=e=>{var t;return{...(null!=(t=r.variables)?t:{})[e],name:e}},b=(0,i.useMemo)(()=>null!=r.icon?()=>(0,l.jsx)($.xfq,{src:r.icon}):v?$.azJ:$.gqo,[v,r.icon]),w=(0,i.useMemo)(()=>{var e;return(0,em.parseGitUrl)((null==(e=r.source)?void 0:e.repo)?(0,k.getTemplateRepoUrl)(r.source.repo):"")},[null==(n=r.source)?void 0:n.repo]),N=d.id,I=(0,eH.U7)({projectId:N,environmentId:u,enabled:m.Write}),{autocompleteOptions:C}=s7({project:d,environmentConfig:(0,a.md)(U.vA),...I});return(0,l.jsxs)("div",{className:(0,X.xW)("border rounded-xl overflow-hidden",!g&&!0===c&&"border-green-200",(g||!1===c)&&"border-red-200"),children:[(0,l.jsxs)("header",{className:"flex items-center justify-between gap-4 px-6 py-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsx)(Z.In,{icon:b,size:"xl",className:"text-gray-500"}),(0,l.jsxs)("div",{className:"",children:[(0,l.jsx)(ee.TT,{children:r.name}),(null==(s=r.source)?void 0:s.image)?(0,l.jsx)("p",{children:r.source.image}):w?(0,l.jsx)(eu.N,{href:w.href,className:"hover:underline",children:(0,l.jsxs)(ee.ax,{children:[w.repo,null!=w.branch&&"/".concat(w.branch)]})}):void 0]})]}),p.length>0?(0,l.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,l.jsx)(Z.In,{icon:$.RIJ,className:"text-red-500"}),(0,l.jsxs)("p",{className:"text-sm text-red-600",children:[p.length," ",(0,ey.td)("variable",p.length)," needed"]})]}):void 0===c?(0,l.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,l.jsx)(Z.In,{icon:ec.Rh,className:"text-grey-500"}),(0,l.jsx)("p",{className:"text-sm text-grey-600",children:"Trying to access repository"})]}):c?(0,l.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,l.jsx)(Z.In,{icon:$.rAV,className:"text-green-500"}),(0,l.jsx)("p",{className:"text-sm text-green-600",children:"Ready to be deployed"})]}):(0,l.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,l.jsx)(Z.In,{icon:$.Jpz,className:"text-red-500"}),(0,l.jsx)(eb.T,{children:(0,l.jsx)("p",{className:"text-sm text-red-600",children:"Unable to access GitHub repository"})})]})]}),(0,l.jsx)("div",{className:"",children:h.map(e=>(0,l.jsx)(on,{variable:f(e),setVariableValue:o,autocompleteOptions:C},e))}),x.length>0&&(0,l.jsx)(i9.Z,{title:(0,l.jsxs)("p",{className:"text-sm",children:[x.length," pre-configured environment"," ",(0,ey.td)("variable",x.length)]}),children:x.map(e=>(0,l.jsx)(on,{variable:f(e),setVariableValue:o,autocompleteOptions:C},e))})]})},on=e=>{var t,n;let{variable:a,setVariableValue:s,autocompleteOptions:r}=e,o=!a.isOptional&&!a.defaultValue&&!a.value,[c]=(0,i.useState)(()=>(0,ey.Du)("Secret variable value")),d=(0,i.useRef)(null);return(0,l.jsxs)("div",{className:"grid gap-6 grid-cols-[20px_minmax(0px,1fr)_minmax(0px,1fr)] w-full px-6 py-4 odd:bg-secondaryBg items-center",children:[o?(0,l.jsx)(Z.In,{icon:$.RIJ,className:"text-red-500",size:"md"}):!a.isOptional&&a.value?(0,l.jsx)(Z.In,{icon:$.Jlk,className:"text-green-500",size:"md"}):(0,l.jsx)("div",{}),(0,l.jsxs)("div",{className:(0,X.xW)("grid gap-0.5 break-all",!a.description&&"items-center"),children:[(0,l.jsx)("p",{className:"text-sm font-mono font-semibold",children:a.name}),a.description&&(0,l.jsx)("div",{className:"dark:prose-invert prose-sm max-w-none break-words text-gray-500",children:(0,l.jsx)(i3.f,{inline:!0,children:a.description})})]}),(0,l.jsx)(i7.T,{ref:d,autocompleteOptions:r,onChange:e=>{s(a.name,e)},value:null!=(n=null!=(t=a.value)?t:a.defaultValue)?n:"",onSubmit:()=>{}})]})};var ol=n(73742),oa=n(94554),os=n(84662);let or=(0,S.Iz)(e=>(0,C.eU)(t=>{var n;let l=t(x.T6);return null==l?null:null!=(n=l.volumes.find(t=>t.id===e))?n:null}));(0,C.eU)(e=>{let t=e(O._V);return null==t?null:e(or(t))});var oi=n(17771),oo=n(50380),oc=n(82511);let od=e=>{var t;let{volumeInstanceId:n,value:a,onChange:s,onEdit:r,validate:o,isStaged:c,disabled:d}=e,[u,m]=(0,i.useState)(!1),x=(0,i.useRef)(null),h=((e,t)=>{let{data:n}=(0,oc.E)(e);return(0,i.useMemo)(()=>{var e;let l=Array.from(new Set(null!=(e=null==n?void 0:n.map(e=>e.mountPath))?e:[]));return t?l.filter(e=>e!==t):l},[n,t])})(n,a),{data:p}=(0,oc.E)(n);(0,i.useEffect)(()=>{let e=e=>{x.current&&!x.current.contains(e.target)&&m(!1)};return u?document.addEventListener("mousedown",e):document.removeEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[u]);let g=u&&(null==p?void 0:p.filter(e=>e.mountPath!==a).length),[v,j]=(0,i.useState)(!1);return(0,l.jsxs)("div",{className:"relative",ref:x,children:[(0,l.jsx)(tB.j,{value:a,onChange:s,onEdit:r,validate:o,isStaged:c,disabled:d,name:"mount-path",onUpdateDirty:j,className:(0,X.xW)(h.length>0&&"pr-10"),label:{text:"Mount path",hidden:!0},autoComplete:u?"off":void 0}),!v&&h.length>0&&(0,l.jsx)("div",{className:(0,X.xW)("absolute right-0 top-0 bottom-0 flex items-center pr-2 cursor-pointer z-10"),onClick:e=>{e.preventDefault(),e.stopPropagation(),m(!u)},children:(0,l.jsx)("div",{className:(0,X.xW)("p-1 rounded transition-colors",u?"bg-gray-100 dark:bg-gray-200":"hover:bg-gray-100 dark:hover:bg-gray-200"),children:(0,l.jsx)($.BZB,{className:(0,X.xW)("w-5 h-5 transition-colors",u?"text-gray-600 dark:text-gray-600":"text-gray-400 hover:text-gray-600 dark:text-gray-600 dark:hover:text-gray-600")})})}),g&&(0,l.jsx)("div",{className:"absolute top-full left-0 right-0 mt-1 bg-background dark:bg-secondaryBg border border-gray-200/50 dark:border-gray-700/30 rounded-md shadow-lg z-[9999] max-h-48 overflow-y-auto",children:null==p||null==(t=p.filter(e=>e.mountPath!==a))?void 0:t.map(e=>(0,l.jsxs)("div",{className:"px-4 py-3 hover:bg-secondaryBg dark:hover:bg-background cursor-pointer flex items-center justify-between",onMouseDown:t=>{var n;t.preventDefault(),n=e.mountPath,m(!1),s&&s(n)},children:[(0,l.jsx)(s$.m,{content:e.mountPath,children:(0,l.jsx)("div",{className:"text-gray-600 dark:text-gray-400 truncate pr-2",children:e.mountPath})}),(0,l.jsx)("div",{className:"text-xs text-gray-400 dark:text-gray-500 ml-2 flex-shrink-0",children:(0,l.jsx)(aT.s,{children:e.updatedAt})})]},e.id))})]})};var ou=n(89088);let om=/[^0-9]/g,ox=e=>{let{activeThresholds:t,threshold:n,onSave:a,onCancel:s,isNew:r}=e,[o,c]=(0,i.useState)(null!=n?"".concat(n):n),d="".concat(n)!==o||r,u=(0,i.useMemo)(()=>{if(null==o)return;let e=parseInt(o);return t.includes(e)&&d?"Threshold already configured":isNaN(e)?"Invalid threshold, must be an integer":e>100?"Invalid threshold, max is 100%":e<80?"Invalid threshold, min is 80%":void 0},[t,o]);return(0,l.jsxs)("div",{children:[(0,l.jsxs)(eb.z,{className:"mx-4 my-3",children:[(0,l.jsxs)(eb.z,{className:"grow",children:[(0,l.jsx)("div",{className:"w-20",children:(0,l.jsx)(th.pd,{label:{text:"Threshold",hidden:!0},value:"".concat(o),onChange:e=>{c(e.target.value.replaceAll(om,""))},suffix:"%"})}),u?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(Z.In,{className:"text-yellow-600 ml-5 mr-1 mt-2.5",icon:$.R2D}),(0,l.jsx)(ee.ax,{className:"text-yellow-600 mt-2.5",children:u})]}):void 0]}),d?(0,l.jsx)(Z.In,{className:"".concat(u?"":"cursor-pointer"," mr-2 mt-2"),icon:$.Jlk,onClick:()=>{!u&&a&&null!=o&&a(parseInt(o))}}):void 0,(0,l.jsx)(Z.In,{className:"cursor-pointer mt-2",icon:$.X,onClick:s})]}),(0,l.jsx)("hr",{className:"mt-2"})]})};var oh=n(53649),op=n(9954),og=n(85610);let ov=()=>(0,l.jsx)(ed.l,{variant:"primary",size:"sm",className:"mb-3 gap-3 ",children:(0,l.jsxs)("div",{className:"flex items-center justify-between gap-2 w-full flex-wrap",children:[(0,l.jsx)("p",{children:"Larger volumes are only available on paid plans."}),(0,l.jsxs)(eu.N,{url:"https://railway.com/workspace/plans",className:"block group",children:[(0,l.jsx)("span",{className:"mr-1 group-hover:underline",children:"Learn More"}),(0,l.jsx)($.lth,{})]})]})}),oj=[{id:"mount-volume-path",group:"Connection",render:e=>{var t,n,s;let{volume:r,volumeInstance:i,connectedService:o,connectedServiceConfig:c,permissions:d}=e,u=(0,F.y3)(),m=(0,a.md)(V.lR),[{user:x}]=(0,ev.Jd)();if(null==o||null==c)return null;let h=null!=(s=(null!=(n=c.volumeMounts)?n:{})[r.id].mountPath)?s:"";return(0,l.jsxs)(tF.XY,{children:[(0,l.jsxs)(tF.O5,{children:[(0,l.jsx)(tF.fA,{children:"Mount Path"}),(0,l.jsxs)(tF.$0,{children:["Directory that this volume is mounted to in"," ",(0,l.jsx)("b",{children:o.name})]})]}),(0,l.jsx)(od,{disabled:!d.Read,value:h,isStaged:(null==m||null==(t=m.services)?void 0:t[o.id])!=null,validate:e=>(0,em.validateVolumeMountPath)(e),onChange:e=>{var t;let n=u.getVolumeInstanceConfig(r.id),l=null!=(t=null==n?void 0:n.region)?t:ae.s9,a=u.getServiceInstanceConfig(o.id),s=(0,os.BN)(a);u.stageEnvironmentChanges({payload:(0,k.newEnvironmentConfig)(u.getStagedChanges()).updateService(o.id,{volumeMounts:{[r.id]:{mountPath:e}},deploy:{multiRegionConfig:{[s]:null,[l]:{numReplicas:1}}}}).build()})},volumeInstanceId:null==i?void 0:i.id})]})},isAvailable:e=>{let{connectedService:t,connectedServiceConfig:n}=e;return null!=t&&null!=n}},{id:"mount-volume",group:"Connection",render:e=>{let{project:t,volume:n}=e,{modalActions:a}=(0,P.U)(),{openCommandPalette:s}=(0,w.oG)();return(0,op.n)(n.id,void 0),(0,l.jsxs)(tF.XY,{children:[(0,l.jsxs)(tF.O5,{children:[(0,l.jsx)(tF.fA,{children:"Connect to Service"}),(0,l.jsx)(tF.$0,{children:"Mount the volume to a directory inside a service"})]}),(null==t?void 0:t.services)&&t.services.length>0?(0,l.jsx)(T.$n,{name:"Mount to service",className:"max-w-max",size:"md",variant:"outline",onClick:()=>{a.openModal((0,l.jsx)(oh.z,{volumeId:n.id}))},children:"Mount to service"}):(0,l.jsx)(ed.l,{variant:"warning",children:"No services available to mount the volume to."})]})},isAvailable:e=>{let{connectedServiceConfig:t}=e;return null==t||!Object.keys(t).length}},{id:"size-volume-size",group:"Size",render:e=>{var t,n;let{project:a,volume:s,volumeInstance:r,volumeInstanceConfig:i,stagedVolumeInstanceConfig:o}=e,{isConfirmed:c}=(0,E.S)(),{openCommandPalette:d}=(0,w.oG)(),u=(0,og.FD)(s.id,null!=(t=i.sizeMB)?t:1),m=async()=>{null!=u&&await c({confirmLabel:"Resize",input:"I want to resize the volume",message:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(ee.EY,{children:"This will restart the service during the resize operation. Please note that volumes cannot be downsized once expanded."}),(0,l.jsx)(ee.EY,{className:"mt-2",children:"You will choose the new size in the next step."})]}),title:"Resize Volume",type:"input"})&&d(u)},{isFree:x}=(0,ej.hA)();return(0,l.jsxs)(tF.XY,{children:[(0,l.jsxs)(tF.O5,{children:[(0,l.jsx)(tF.fA,{children:"Volume Size"}),(0,l.jsx)(tF.$0,{children:"The maximum size of the volume. You are only charged for the amount of data stored."})]}),(0,l.jsxs)(eb.T,{space:4,children:[(0,l.jsxs)(eb.z,{align:"center",space:4,className:"w-full",children:[(0,l.jsx)(tF.FE,{className:"flex-grow w-full",isStaged:(null==o?void 0:o.sizeMB)!=null,children:(0,og.Xb)(null!=(n=i.sizeMB)?n:1,2)}),null!=u&&(0,l.jsx)(T.$n,{variant:"outline",color:"gray",onClick:()=>m(),disabled:x,children:"Grow"})]}),x&&(0,l.jsx)(ov,{})]})]})},isAvailable:e=>{let{isVolumeInstanceBeingCreated:t}=e;return!t}},{id:"region-volume-region",group:"Region",render:e=>{var t;let{volumeInstance:n,volumeInstanceConfig:s}=e,r=(0,a.Xr)(ae.I7);return(0,l.jsxs)(tF.XY,{children:[(0,l.jsxs)(tF.O5,{children:[(0,l.jsx)(tF.fA,{children:"Volume Region"}),(0,l.jsx)(tF.$0,{children:"The region where the volume is stored."})]}),(null==n?void 0:n.state)===u.sDj.Migrating&&(0,l.jsx)(ed.l,{variant:"info",size:"xs",className:"shadow-sm py-3 px-4 mb-2",hideIcon:!0,children:(0,l.jsxs)(eb.z,{space:3,children:[(0,l.jsx)(Z.In,{icon:ec.Rh,size:"sm"}),(0,l.jsx)(ee.ax,{children:"Migrating the volume to a new region..."})]})}),(0,l.jsxs)(eb.T,{children:[(0,l.jsx)(ee.EY,{className:"bg-gray-50 border-none w-full rounded-lg leading-6 min-h-[44px] my-0 py-2 px-3 ",children:(0,ae.sn)(r(null!=(t=s.region)?t:ae.s9))}),(0,l.jsx)(ee.ax,{className:"text-gray-600 mt-3",children:"Volumes follow their associated service regions."})]})]})}},{id:"volume-alert",group:"Alerts",render:e=>{var t;let{volumeInstanceConfig:n,volume:a,project:s}=e,{routes:r}=(0,es.c)(),o=(0,os.BY)(),{isPro:c}=(0,ej.hA)(),[d,u]=(0,i.useState)(null),m=(0,i.useMemo)(()=>{var e,t;let l=Object.entries(null!=(t=null==(e=n.alerts)?void 0:e.usage)?t:{}).filter(e=>{let[,t]=e;return null!=t}).map(e=>{let[t]=e;return(0,k.parseVolumeInstanceUsageAlertThreshold)(t)}).filter(e=>null!=e);return l.sort((e,t)=>t-e),l},[null==(t=n.alerts)?void 0:t.usage]),x=c&&m.length>0,h=async e=>{e?await p(k.DEFAULT_VOLUME_ALERT_THRESHOLDS.map(e=>({threshold:e,state:!0}))):await p(m.map(e=>({threshold:e,state:!1})))},p=async e=>{await o.toggleAlerts({volumeId:a.id,alerts:e})},g=async e=>{c&&(await p([{threshold:e,state:!0}]),u(null))},v=async(e,t)=>{c&&await p([{threshold:e,state:!1},{threshold:t,state:!0}])},j=async e=>{c&&await p([{threshold:e,state:!1}])};return(0,l.jsxs)(tF.XY,{title:c?void 0:"Upgrade to Pro to enable Volume Usage Alerts",children:[(0,l.jsxs)(tF.O5,{className:"mb-4",children:[(0,l.jsx)(tF.fA,{children:"Usage Alert"}),(0,l.jsx)(tF.$0,{children:"Usage thresholds to emit an alarm for. When an enabled threshold is breached an email will be sent and the project's webhooks will be called."})]}),(0,l.jsx)(ou.N,{id:"volume-usage-alert-enabled",disabled:!c,checked:x,size:"sm",onCheckedChange:h,className:"group",children:"Enable alerts"}),x?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(ee.xC,{className:"mt-4 font-bold",children:"Alert Thresholds"}),(0,l.jsx)("hr",{className:"mt-2"}),m.map(e=>(0,l.jsx)(ox,{activeThresholds:m,threshold:e,onSave:t=>v(e,t),onCancel:()=>j(e)},e)),null!=d?(0,l.jsx)(ox,{isNew:!0,activeThresholds:m,threshold:d,onSave:g,onCancel:()=>u(null)}):void 0,(0,l.jsx)(T.$n,{size:"sm",variant:"outline",icon:$.f5w,color:"gray",disabled:!c,className:"mt-2",onClick:()=>{c&&u("".concat(90))},children:"Add Alert"})]}):void 0,!c&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(tv.h,{y:4}),(0,l.jsx)(ed.l,{variant:"primary",size:"sm",className:"mb-3 gap-3 ",children:(0,l.jsx)("div",{className:"flex items-center justify-between gap-2 w-full flex-wrap",children:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("p",{children:"Alerts are only available for Teams on the Pro plan."}),(0,l.jsx)(eu.N,{...r.workspacePlan({}),children:(0,l.jsx)("span",{className:"mr-1 underline",children:"More information"})})]})})})]})]})}},{id:"volume-copy-env",group:"Data",render:e=>{let{project:t,volumeInstance:n,environment:a}=e,{isConfirmed:s}=(0,E.S)(),{modalActions:r}=(0,P.U)(),o=(0,os.BY)(),[c,d]=(0,i.useState)(t.environments[0]),u=t.environments.filter(e=>e.id!==a.id),m=async()=>{if(null!=c&&null!=n&&null!=n.serviceId&&await s({confirmLabel:"Restore",input:"restore from environment",message:"Are you sure you want to restore the contents of ".concat(c.name," to this volume? This will overwrite the current data in the volume."),title:"Restore data from another environment",type:"input"}))try{r.createToast((0,l.jsx)(A.y8,{title:"Triggered volume restore",variant:"success"})),await o.copyVolumeToEnvironment({serviceId:n.serviceId,sourceEnvironmentId:c.id,destinationEnvironmentId:n.environmentId,destinationVolumeInstanceId:n.id})}catch(e){r.createToast((0,l.jsx)(A.y8,{title:"Failed to restore volume",description:e.message,variant:"error"}))}};return(0,l.jsxs)(tF.XY,{children:[(0,l.jsxs)(tF.O5,{children:[(0,l.jsx)(tF.fA,{children:"Restore Data"}),(0,l.jsx)(tF.$0,{children:"Restore data from a volume in another environment. This will overwrite the current data in the volume."})]}),(0,l.jsxs)(tF.FE,{className:(0,X.xW)("flex items-center justify-between gap-4 py-0"),children:[(0,l.jsx)(eb.z,{align:"center",space:2,className:"w-full",children:(0,l.jsx)(tg.l,{label:{text:"Environment",hidden:!0},name:"environment",parentStyles:"w-full",selectStyles:"border-none",value:c.id,disabled:!1,onChange:e=>{d(u.find(t=>t.id===e))},error:!0,options:u.map(e=>({value:e.id,text:e.name}))})}),(0,l.jsx)(T.$n,{type:"button",variant:"outline",size:"xs",color:"gray",disabled:!1,onClick:m,className:"max-w-max",children:"Restore"})]})]})},isAvailable:e=>{let{project:t,connectedService:n}=e;return!!n&&(null==n?void 0:n.featureFlags.includes(u.kGL.CopyVolumeToEnvironment))&&t.environments.length>1}},{id:"danger-wipe-volume",group:"Danger",render:e=>{let{volumeInstance:t,environment:n,permissions:a}=e,{modalActions:s}=(0,P.U)(),{isConfirmed:r}=(0,E.S)(),o=(0,os.BY)(),[c,d]=(0,i.useState)("idle"),u=async()=>{if(null==t||!await r({confirmLabel:"Wipe",input:"wipe volume and delete data",message:(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("div",{children:["Are you sure you want to delete all the contents of this volume, including its backups, in the ",n.name," environment?"]}),(0,l.jsx)("div",{children:"This will temporarily take the service it's attached to offline."})]}),title:"Wipe volume and any existing backups",type:"input"}))return;let e=s.createToast((0,l.jsx)(A.y8,{title:"Triggered volume instance wipe",variant:"success"}));d("loading");try{await o.wipeVolumeInstance({volumeInstanceId:t.id}),s.createToast((0,l.jsx)(A.y8,{title:"Volume instance wipe complete",variant:"success"}))}catch(e){s.createToast((0,l.jsx)(A.y8,{title:"Failed to wipe volume",description:e.message,variant:"error"}))}finally{s.exitToast(e),d("idle")}};return(0,l.jsxs)(tF.XY,{children:[(0,l.jsxs)(tF.O5,{children:[(0,l.jsx)(tF.fA,{className:"text-red-500",children:"Wipe Volume"}),(0,l.jsxs)(tF.$0,{className:"text-red-600",children:["Wiping the volume will delete ",(0,l.jsx)("b",{children:"all data"})," of the volume in the current environment, including the ",(0,l.jsx)("b",{children:"backups"})]})]}),(0,l.jsx)(oo.V,{message:"Only workspace admins can wipe volumes",showTooltip:!a.Admin,children:(0,l.jsx)(T.$n,{color:"red",size:"sm",onClick:()=>u(),disabled:!a.Admin,isLoading:"loading"===c,className:"max-w-max mt-4 font-bold",children:"Wipe volume"})})]})},isAvailable:e=>{let{isVolumeInstanceBeingCreated:t}=e;return!t}},{id:"danger-delete-volume",group:"Danger",render:e=>{var t;let{volume:n,connectedServiceConfig:a,permissions:s}=e,{navActions:r,routes:i}=(0,es.c)(),{modalActions:o}=(0,P.U)(),c=(0,os.BY)(),d=async()=>{try{r.replace(i.project({})),await c.deleteVolume({volumeId:n.id})}catch(e){o.createToast((0,l.jsx)(A.y8,{title:"Failed to delete volumes",description:e.message,variant:"error"}))}},u=(null==a||null==(t=a.deploy)?void 0:t.requiredMountPath)!=null;return(0,l.jsxs)(tF.XY,{children:[(0,l.jsxs)(tF.O5,{children:[(0,l.jsx)(tF.fA,{className:"text-red-500",children:"Delete Volume"}),(0,l.jsxs)(tF.$0,{className:"text-red-600",children:["Deleting the volume will ",(0,l.jsx)("b",{children:"permanently delete"})," all data inside the volume, as well as stop all deploys in the connected service"]})]}),u&&(0,l.jsx)(ed.l,{variant:"info",children:"The service this volume is connected to requires a volume. In order to remove this volume, you will have to delete the service first."}),(0,l.jsx)(oo.V,{message:u?"Cannot delete volume required by connected service":"Only workspace admins can delete volumes",showTooltip:!s.Admin||u,children:(0,l.jsx)(T.$n,{color:"red",size:"sm",disabled:!s.Admin||u,onClick:d,className:"max-w-max mt-6 font-bold",children:"Delete Volume"})})]})}}],oy=e=>{let{project:t,volume:n,connectedService:s,connectedServiceConfig:r,environment:o}=e,c=(0,a.md)(z.DM),[{isBeta:d}]=(0,ev.Jd)(),u=(0,a.md)(ai.yQ),m=(0,a.md)(U.E0),x={environment:o,project:t,volume:n,volumeInstance:u,volumeInstanceConfig:m,stagedVolumeInstanceConfig:(0,a.md)(U.wp),permissions:c,connectedService:s,connectedServiceConfig:r,isVolumeInstanceBeingCreated:(null==m?void 0:m.isCreated)===!0},h=oj.filter(e=>null==e.isAvailable||e.isAvailable(x)).filter(e=>!e.isBeta||d);return(0,l.jsx)("div",{className:"relative -mx-5 -mt-8 md:-mx-12",children:(0,l.jsx)("div",{className:"relative grid gap-16 grid-cols-1 lg:grid-cols-[1fr_auto]",children:(0,l.jsx)("div",{className:"grid gap-16 mx-6 sm:mx-12 mt-12 pb-12 border-l-none sm:border-l-2 border-black border-opacity-[8%] dark:border-white dark:border-opacity-[8%]",children:oi.E.map(e=>{let t=h.filter(t=>t.group===e);return 0===t.length?(0,l.jsx)(i.Fragment,{},e):(0,l.jsx)(tF.X4,{group:e,children:(0,l.jsx)(l.Fragment,{children:t.map(e=>{let t=e.render;return(0,l.jsx)(t,{...x},e.id)})})},e)})})})})};var of=n(82048),ob=n(49863);let ow=e=>{var t,n,s;let{volumeInstance:r,connectedServiceConfig:i,connectedServiceId:o,volumeInstanceConfig:c}=e,d=(0,a.md)(x.T6),m=null==d||null==(t=d.environments.find(e=>e.id===r.environmentId))?void 0:t.name,h=null==d||null==(n=d.services.find(e=>e.id===r.serviceId))?void 0:n.name;return(0,l.jsxs)(eb.T,{className:(0,X.xW)("px-4 py-4 my-4 border rounded-lg",r.state===u.sDj.Ready&&"border-green-400",r.state===u.sDj.Error&&"border-red-400",r.state===u.sDj.Migrating&&"border-blue-400"),children:[(0,l.jsx)(eb.z,{space:2,children:(0,l.jsx)(ee.mM,{children:" Current volume instance"})}),(0,l.jsxs)(eb.T,{children:[(0,l.jsx)(ob.q7,{name:"Environment",value:m}),(0,l.jsx)(ob.q7,{name:"Service",value:h}),(0,l.jsx)(ob.q7,{name:"Volume Instance ID",value:r.id}),(0,l.jsx)(ob.q7,{name:"External ID",value:r.externalId}),(0,l.jsx)(ob.q7,{name:"State",value:r.state}),(0,l.jsx)(ob.q7,{name:"Mount Path",value:null==(s=(0,k.getVolumeMountFromServiceConfig)(i,r.volumeId))?void 0:s.mountPath}),(0,l.jsx)(ob.q7,{name:"Capacity",value:"".concat(c.sizeMB," Mb")}),(0,l.jsx)(ob.q7,{name:"Current Size",value:"".concat(r.currentSizeMB.toFixed(2)," Mb")}),r.stacker&&(0,l.jsx)(ob.q7,{name:"Stacker IP",value:r.stacker}),(0,l.jsx)(ob.q7,{name:"Region",value:c.region}),(0,l.jsx)(ob.q7,{name:"Environment ID",value:r.environmentId}),(0,l.jsx)(ob.q7,{name:"Service ID",value:o}),r.cephInfo&&(0,l.jsx)(of.n,{flipped:!0,title:(0,l.jsx)(eb.z,{space:2,align:"center",children:(0,l.jsx)("span",{children:"Ceph info"})}),className:"w-full",children:(0,l.jsxs)(eb.T,{children:[(0,l.jsx)(ob.q7,{name:"Instance ID",value:r.cephInfo.instanceId}),(0,l.jsx)(ob.q7,{name:"Cluster ID",value:r.cephInfo.clusterId}),(0,l.jsx)(ob.q7,{name:"Zone",value:r.cephInfo.zone}),(0,l.jsx)(ob.q7,{name:"Namespace",value:r.cephInfo.namespace}),(0,l.jsx)(ob.q7,{name:"Image Spec",value:r.cephInfo.imageSpec}),(0,l.jsx)(ob.q7,{name:"Size in Bytes",value:r.cephInfo.sizeInBytes.toString()}),(0,l.jsx)(ob.q7,{name:"Status",value:r.cephInfo.status}),(0,l.jsx)(ob.q7,{name:"Source Snapshot ID",value:r.cephInfo.sourceSnapshotId}),(0,l.jsx)(ob.q7,{name:"Created At",value:r.cephInfo.createdAt}),(0,l.jsx)(ob.q7,{name:"Updated At",value:r.cephInfo.updatedAt})]})})]})]},r.id)},oN=e=>{let{volume:t}=e;return(0,l.jsx)(eb.T,{className:(0,X.xW)("px-4 py-4 my-4 border rounded-lg"),children:(0,l.jsxs)(eb.T,{children:[(0,l.jsx)(ee.mM,{children:"Volume Info"}),(0,l.jsx)(ob.q7,{name:"Name",value:"".concat(t.name)}),(0,l.jsx)(ob.q7,{name:"ID",value:t.id}),(0,l.jsx)(ob.q7,{name:"Project ID",value:"".concat(t.projectId)}),(0,l.jsx)(ob.q7,{name:"Created at",value:"".concat(t.createdAt)})]})},t.id)},oI=e=>{var t,n,s;let{volume:r,volumeInstanceConfig:i,connectedServiceId:o,connectedServiceConfig:c}=e,d=(0,a.md)(I.KE),{result:u}=(e=>{let{graphqlClient:t}=(0,R.q)(),{result:n}=(0,er.W)(["admin-volume-instance-info",e],async()=>await t.adminVolumeInstancesForVolume({volumeId:e}));return{result:n}})(r.id),m=((null==(t=u.data)?void 0:t.adminVolumeInstancesForVolume)||[]).find(e=>e.environmentId===d);return(0,l.jsxs)(eb.T,{space:8,className:"pb-12",children:[(0,l.jsx)(oN,{volume:r}),m?(0,l.jsx)(ow,{volumeInstance:m,volumeInstanceConfig:i,connectedServiceId:o,connectedServiceConfig:c},m.id):u.isLoading?(0,l.jsx)(ec.m6,{}):u.isError?(0,l.jsx)(ee.yn,{children:null!=(s=null==(n=u.error)?void 0:n.message)?s:"Unable to load volume instance"}):(0,l.jsx)(l.Fragment,{})]})};var ok=n(43263);let oC=e=>{let{project:t,environment:n,volume:a,canvasAtoms:s}=e;return(0,l.jsxs)("div",{children:[(0,l.jsx)(ed.l,{variant:"info",className:"mb-3",children:(0,l.jsx)("div",{className:"flex items-center gap-3",children:(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"font-medium",children:"Volume is unmounted"}),(0,l.jsx)("p",{className:"text-sm mt-1",children:"You can view existing backups but cannot create new ones."})]})})}),(0,l.jsx)(rp,{project:t,environment:n,service:null,volumeId:a.id,isReadOnly:!0,canvasAtoms:s})]})},oS=e=>{var t,n,s,r;let{volumeId:i,canvasAtoms:o}=e,[{user:c}]=(0,ev.Jd)(),d=(0,a.md)(x.T6),u=(0,a.md)(I.Zy),h=(0,a.md)(or(i)),p=(0,a.md)(U.vA),g=(0,a.md)((0,ai.VS)(i)),v=(0,a.md)((0,U.xL)({environmentId:null!=(s=null==u?void 0:u.id)?s:null,volumeId:i})),j=null!=(r=null==(t=(0,a.md)((0,m.z$)(null==u?void 0:u.id)))?void 0:t.data)?r:{},y=null==(n=(0,l7.gP)().data)?void 0:n.find(e=>e.destVolumeInstance.id===(null==g?void 0:g.id));return((0,w.bU)(()=>({value:"open-volume-instance-migration-temporal-".concat(null==g?void 0:g.id),text:"Open Volume Migration Workflows in Temporal",icon:$.GrD,group:"Admin",action:()=>{var e;g&&window.open((0,ol.Ej)({volumeInstanceId:null!=(e=null==y?void 0:y.sourceVolumeInstance.id)?e:g.id}))},isAvailable:()=>(null==c?void 0:c.isAdmin)||!1}),[null==c?void 0:c.isAdmin,null==g?void 0:g.id]),null==d||null==u||null==h)?(0,l.jsx)(eJ.P2,{}):(0,l.jsx)(oT,{project:d,environment:u,environmentConfig:p,volume:h,volumeInstanceConfig:v,volumeInstance:g,currentSizeMB:g?j[g.id]:null,canvasAtoms:o})},oT=e=>{let{project:t,environment:n,environmentConfig:s,volume:r,volumeInstanceConfig:o,volumeInstance:c,currentSizeMB:d,canvasAtoms:m}=e,x=(0,k.getServiceConnectedToVolume)({config:s,volumeId:r.id}),h=null==x,{tabs:p,currentTab:g}=(e=>{let{project:t,isVolumeUnmounted:n}=e,[{user:l}]=(0,ev.Jd)(),{routes:s,projectId:r,serviceId:o}=(0,es.c)(),c=(0,a.md)(I.KE),d={Metrics:{enabled:!0,route:s.projectVolumeMetrics({environmentId:c})},Backups:{enabled:n,route:s.projectVolumeBackups({environmentId:c})},Settings:{enabled:!0,route:s.projectVolumeSettings({environmentId:c})},Admin:{enabled:(null==l?void 0:l.isAdmin)||!1,route:s.projectVolumeAdmin({environmentId:c})}};return(0,a1.B)((0,i.useMemo)(()=>d,[l,r,o,n]))})({project:t,isVolumeUnmounted:h}),[{user:v}]=(0,ev.Jd)(),j=(0,eX.tF)();(0,eQ.pO)(j);let y=(0,i.useRef)(g);(0,i.useEffect)(()=>{null!=g&&(y.current=g)},[g]);let{commitStagedChanges:f}=Y(n.id),{updateVolumeInstances:b,updateVolume:w}=(0,os.BY)(),N=t.services.find(e=>e.id===x),C=(0,a.md)((0,U.KI)({serviceId:null!=x?x:null,environmentId:n.id})),S=async()=>{await b({volumeId:r.id,serviceId:x,state:u.sDj.Ready})},D=(0,a.md)(V.iy),A=(0,a.md)(V.lR),E=(0,i.useMemo)(()=>{var e,t,n;if(null==x)return!1;let l=null==A||null==(e=A.services)?void 0:e[x];return null!=l&&((null==(t=l.deploy)?void 0:t.region)!=null||(null==(n=l.deploy)?void 0:n.multiRegionConfig)!=null)},[A,x]);return(0,l.jsxs)(eJ.lD,{title:r.name,icon:$.akk,tabs:p,className:"volume-tabs",onTitleEdit:e=>w({volumeId:r.id,name:e}),resource:"volume",children:[(null==c?void 0:c.state)===u.sDj.Error&&(0,l.jsx)(ed.l,{hideIcon:!0,variant:"danger",className:"mb-8",children:(0,l.jsxs)("div",{className:"w-full flex flex-col lg:flex-row lg:justify-between lg:items-center gap-4",children:[(0,l.jsxs)(eb.z,{space:4,className:"lg:items-center",children:[(0,l.jsx)(Z.In,{icon:$.hcu}),(0,l.jsxs)(eb.T,{children:[(0,l.jsx)(ee.EY,{className:"font-medium",children:"Volume migration failed."}),(0,l.jsx)(ee.ax,{children:"There was an error migrating your volume to the new region."})]})]}),(0,l.jsxs)(eb.z,{space:2,className:"ml-8 lg:ml-0",children:[(null==v?void 0:v.isAdmin)?(0,l.jsx)(T.$n,{color:"red",size:"sm",onClick:S,children:"Reset state (Admin-only)"}):(0,l.jsx)(T.vx,{href:oa.KX,size:"sm",variant:"outline",color:"gray",children:"Get Help"}),E&&(0,l.jsx)(T.$n,{size:"sm",isLoading:D===u.oSY.Applying,onClick:()=>f({message:"Retry migration"}),children:"Try again"})]})]})}),(0,l.jsx)(sw.I,{className:"mb-8",volumeInstanceId:null==c?void 0:c.id,volumeInstanceExternalId:null==c?void 0:c.externalId}),((null==c?void 0:c.state)===u.sDj.Migrating||(null==c?void 0:c.state)===u.sDj.MigrationPending)&&(null==v?void 0:v.isAdmin)&&(0,l.jsx)(eb.z,{className:"w-full items-start mb-5",children:(0,l.jsx)(T.$n,{color:"red",size:"sm",className:"ml-2",onClick:S,children:"Reset state to Ready"})}),null==t||null==n||null==r||null==o?(0,l.jsx)(ec.m6,{}):(0,l.jsxs)(l.Fragment,{children:["Settings"===y.current&&(0,l.jsx)(oy,{project:t,environment:n,volume:r,connectedService:N,connectedServiceConfig:C}),"Metrics"===y.current&&(0,l.jsx)(ok.Qz,{project:t,environment:n,volume:r,volumeInstance:c,volumeInstanceConfig:o,connectedService:N,currentSizeMB:d}),"Backups"===y.current&&h&&m&&(0,l.jsx)(oC,{project:t,environment:n,volume:r,canvasAtoms:m}),"Admin"===y.current&&(0,l.jsx)(oI,{volume:r,volumeInstanceConfig:o,connectedServiceId:x,connectedServiceConfig:null!=C?C:void 0})]})]})};var oD=n(13780),oA=n(49852);let oE=e=>{let{messages:t}=e,n=(0,a.md)(x.T6);return 0===t.length?null:(0,l.jsx)("div",{className:"flex flex-col gap-1 justify-center w-full min-w-0",children:t.slice(0,1).map((e,t)=>{let a=(e=>{var t,l;if(!e.resourceId||!e.resourceType||!n)return null;if("volume"===e.resourceType){let l=null==(t=n.volumes)?void 0:t.find(t=>t.id===e.resourceId);return(null==l?void 0:l.name)||null}if("service"===e.resourceType){let t=null==(l=n.services)?void 0:l.find(t=>t.id===e.resourceId);return(null==t?void 0:t.name)||null}return null})(e);return(0,l.jsxs)(eT.P.div,{initial:{y:10,opacity:0},animate:{y:0,opacity:1},className:"opacity-90 text-xs whitespace-nowrap overflow-hidden text-ellipsis max-w-full animate-shimmer bg-gradient-to-r from-pink-700 via-pink-500 to-pink-700 bg-[length:200%_100%] bg-clip-text text-transparent",children:[(0,l.jsx)("span",{className:"",children:e.message}),a?(0,l.jsx)("span",{className:"ml-1",children:a}):e.resourceType?(0,l.jsx)("span",{className:"ml-1",children:e.resourceType}):null]},e.resourceId)})})},oR=e=>{let{environmentId:t,...n}=e,s=(0,a.md)((0,V.D7)(t)),r=(0,a.md)((0,V.SJ)(t)),i=(0,F.aQ)(t),o=(0,a.md)(O.Sr),c=(0,a.md)((0,m.Om)(t)),d=(0,a.md)((0,U.w$)(t)),{commitStagedChanges:u}=Y(t),[{user:x}]=(0,ev.Jd)(),{hideModal:h}=(0,L.h)(),p=null!=o?"Merge changes from ".concat(o.environmentName," into ").concat(o.destinationEnvironmentName):void 0;return(0,l.jsx)(aC,{...n,isLoading:!c,environmentId:t,patch:s,commitChanges:e=>{u({message:e})},message:p,originalEnvironmentConfig:null!=d?d:(0,k.emptySerializedEnvironment)(),patchStatus:r,editableMessage:!0,user:x,onSetPathIgnored:e=>{let t=(0,k.ignorePathsInConfig)({config:i.getStagedChanges(),ignoredPaths:[e]});0===(0,k.numChangesInEnvironmentConfig)(t)&&h(oR),i.stageEnvironmentChanges({payload:t,syncingState:null!=o?o:void 0})}})},oL=e=>{let{environmentId:t}=e,n=(0,a.md)(z.mz),s=(0,a.md)((0,V.SJ)(t)),r=(0,a.md)((0,V.d1)(t)),o=(0,a.md)((0,V.xJ)(t)),c=(0,a.md)(O.Sr),d=(0,a.md)((0,V.B)(t)),{commitStagedChanges:m,discardStagedChanges:x}=Y(t),h=(0,a.md)(eL(t)),p=(null==d?void 0:d.id)?Array.from(h.values()).filter(e=>e.patchId===d.id):[],{modals:g}=(0,P.U)(),{showModal:v,isModalOpen:j}=(0,L.h)(),y=g.length>0,f=(0,eE.z)("lg"),b=(0,oD.Z)(1e3),w=(0,eW.o)(y,1e3),I=(0,eW.o)(j,1e3),[k,C,S]=(0,oA.y)({scale:1.05});(0,i.useEffect)(()=>{if(s===u.oSY.Committed)return void S();!b||w||I||s!==u.oSY.Staged||S()},[r,s,S]);let D=(0,N.mX)("Alt"),A=oM(s);if(0===r||y||!n||s===u.oSY.Committed)return null;let E=s===u.oSY.Applying;return(0,l.jsxs)(eT.P.div,{className:(0,X.xW)("flex flex-col gap-2 justify-center min-h-[52px] border border-pink-200 bg-[#FAF6FD] dark:bg-[#130b19] rounded-md z-20","px-4 py-4","xl:px-4 xl:py-2 xl:min-w-[420px] xl:max-w-[620px]","staged-changes-banner-shadow",E&&"staged-changes-banner-shadow-pulse"),initial:f?{y:"50%"}:{y:"-100%"},animate:{y:0,...k},children:[(0,l.jsxs)("div",{className:(0,X.xW)("flex justify-between items-center gap-4 w-full","md:flex-row","lg:flex-col","xl:flex-row"),children:[(0,l.jsx)("div",{className:(0,X.xW)("flex flex-col justify-center gap-2"),children:s===u.oSY.Applying?(0,l.jsxs)(ee.ax,{className:"font-medium text-pink-500 flex items-center gap-2 whitespace-nowrap",children:[(0,l.jsx)(ec.Rh,{}),"Applying ",r," ",(0,ey.td)("change",r)]}):null!=c?(0,l.jsxs)(ee.ax,{className:"font-medium text-pink-600",children:["Merge ",r," ",(0,ey.td)("change",r)," ","from ",c.environmentName]}):(0,l.jsxs)(ee.ax,{className:"font-medium text-pink-600",children:["Apply ",r," ",(0,ey.td)("change",r)]})}),s===u.oSY.Staged?(0,l.jsxs)(eb.z,{space:2,children:[(0,l.jsx)(T.$n,{name:"View change details",variant:"outline",color:"gray",size:"sm",onClick:()=>{v(oR,{environmentId:t})},children:"Details"}),(0,l.jsxs)(T.$n,{name:"Deploy changes",size:"sm","data-testid":"apply-changes",disabled:!o,onClick:()=>{m({skipDeploys:D})},children:["Deploy"," ",(0,l.jsx)("span",{className:"hidden xl:inline text-xs font-medium text-pink-100 dark:text-pink-800 ml-1",children:"⇧+Enter"})]}),(0,l.jsxs)(sJ.ms,{children:[(0,l.jsx)(sJ.Lk,{icon:$.GvN,title:"Staged changes actions",size:"sm",className:"text-gray-500"}),(0,l.jsx)(sJ.pm,{align:"end",children:(0,l.jsx)(sJ.tJ,{name:"Discard changes",onSelect:()=>{x({})},children:"Discard Changes"})})]})]}):s===u.oSY.Applying&&A?(0,l.jsx)(oE,{messages:p}):null]}),(null==d?void 0:d.lastAppliedError)&&s===u.oSY.Staged&&(0,l.jsxs)("div",{className:"text-xs text-red-500 flex items-center gap-2",children:[(0,l.jsx)(Z.In,{icon:$.hcu,size:"sm"}),null==d?void 0:d.lastAppliedError]})]})},oM=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3,[n,l]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{if(e===u.oSY.Applying){l(!1);let e=setTimeout(()=>{l(!0)},t);return()=>clearTimeout(e)}l(!1)},[e,t]),n},oP="sm:grid-cols-[0px_100%] lg:grid-cols-[1fr_70%] xl:grid-cols-[1fr_minmax(auto,_920px)] 2xl:grid-cols-[1fr_minmax(auto,_1024px)] 3xl:grid-cols-[1fr_minmax(auto,_1200px)]";var oz=n(9157);let oO=e=>{let{isServiceOpen:t,groupBreadcrumbs:n,currentGroupId:s}=e,r=(0,a.md)(I.KE),i=(0,a.md)(V.zn),{modals:o}=(0,P.U)(),c=(0,nv.a)();return!(0,eW.o)(c,300)||o.length>0||null==r?null:(0,l.jsx)("div",{className:(0,X.xW)("canvas-overlay","absolute top-0","hidden lg:grid items-start justify-center mt-6 w-full","starting:opacity-0 opacity-100 transition-opacity duration-200 delay-300",t?oP:"grid-cols-1"),children:(0,l.jsx)("div",{className:"flex justify-center",children:i>0?(0,l.jsx)(eT.P.div,{layout:!0,className:"z-50",exit:{transition:{duration:0}},children:(0,l.jsx)(oL,{environmentId:r})}):null==n||t?null:(0,l.jsx)(oU,{groupBreadcrumbs:n,currentGroupId:s})})})},oU=e=>{let{groupBreadcrumbs:t,currentGroupId:n}=e,{routes:a}=(0,es.c)(),{performCollapseGroup:s}=(0,oz.m)();return 0===t.length?null:(0,l.jsx)("div",{className:"flex items-center gap-3 text-sm text-gray-500 font-medium z-10 select-none starting:opacity-0 opacity-100 transition-opacity duration-200",children:t.map((e,r)=>(0,l.jsxs)(i.Fragment,{children:[(0,l.jsx)(eu.N,{className:(0,X.xW)(e.isActive&&"text-foreground"),...a.project({groupId:e.groupId}),onClick:l=>{r===t.length-2&&(l.preventDefault(),s({navigatingFromGroup:n,navigatingToGroup:e.groupId}))},children:e.groupName},e.groupId),(0,l.jsx)("span",{children:r<t.length-1&&"/"})]},r))})};var oF=n(13728);let oV=()=>{let{modalActions:e}=(0,P.U)();return(0,l.jsx)("div",{className:"hidden lg:block",children:(0,l.jsx)(T.$n,{icon:$.BKt,variant:"outline",color:"gray",onClick:()=>e.openModal((0,l.jsx)(oF.f,{})),className:"px-4 bg-background border-b-0 rounded-b-none active:scale-100",children:"Set up your project locally"})})},oB=()=>{let{routes:e}=(0,es.c)(),[,t]=(0,g.N3)();return(0,l.jsxs)(eb.z,{align:"center",justify:"between",space:4,className:"py-4 px-5",children:[(0,l.jsx)(T.$n,{icon:$.Ilq,size:"sm",color:"gray",onClick:()=>t(!0),children:"Activity"}),(0,l.jsx)(T.vx,{icon:$.wB_,size:"sm",color:"gray",...e.projectSettings({}),children:"Settings"})]})},o_=()=>{let{isCommandPaletteOpen:e,openCommandPalette:t}=(0,w.oG)(),{track:n}=(0,t5.j)(),s=(0,a.md)(V.zn),r=(0,a.md)(I.KE);return e||null==r?null:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"lg:hidden fixed left-6 bottom-6 z-50",children:(0,l.jsx)(eD.N,{children:s>0&&(0,l.jsx)(oL,{environmentId:r})})}),(0,l.jsx)("button",{onClick:()=>{t(),n({action:"Click",object:"Mobile Command Palette"})},className:(0,X.xW)("sm:hidden","fixed right-4 bottom-4 z-50 w-14 h-14 flex items-center justify-center text-white rounded-full","focus:outline-none focus-visible:ring-2 focus-visible:ring-pink-500"),style:{background:"linear-gradient(145.33deg, #6B15C1 3.57%, #A915C1 87.06%)"},children:(0,l.jsx)(Z.In,{icon:$.esB})})]})},oq=e_()(()=>Promise.all([n.e(4966),n.e(1899),n.e(9824),n.e(8893)]).then(n.bind(n,58893)),{loadableGenerated:{webpack:()=>[58893]},ssr:!1}),oW=e=>{var t,n;let{groupId:s,parentGroupId:r,groupPath:o,isTop:c,projectCanvasState:d,animationEnabled:u}=e,[m,h]=(0,i.useState)(null),{routes:p,pathname:g,serviceId:v,volumeId:j,pluginId:y,templateServiceId:f,query:b,isInProjectTemplateConfig:w}=(0,es.c)(),N=g===p.project({}).url,I=c&&(null!=v||null!=j||null!=y||null!=f||w);(0,eQ.ph)(s,r,!I&&c);let k=I&&"string"==typeof b.id?b.id:null,C=(0,a.md)(x.T6),{canvasRenderDimensions:S,canvasRef:T,servicePaneRef:D}=oK(I),{templateConfiguration:A}=(0,eY.a)(),E="root"===s||null==s,{cliSetupForProject:R}=(0,eq.f)(),L=null!=C&&null!=(t=R[C.id])&&t,M=null!=(n=null!=v?v:y)?n:j,P=((e,t,n)=>(0,i.useMemo)(()=>1===t.length?null:t.map(t=>{if("root"===t)return{groupId:null,groupName:"All Services"};let l=n.groups.find(e=>e.id===t);return null==l||null==l.name?null:{groupId:l.id,groupName:l.name,isActive:l.id===e}}).filter(Boolean),[t,n.groups,e]))(null!=s?s:null,o,d);return(0,l.jsxs)("div",{className:(0,X.xW)("nested-canvas","block sm:grid grid-cols-[minmax(0px,_1fr)] grid-rows-[auto_1fr] md:grid-rows-[initial] max-w-full relative","sm:grid-rows-1 sm:overflow-x-hidden","md:px-0",oP),children:[(0,l.jsxs)(e$.F,{largerOrEqualTo:"sm",alternativeChild:N&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(oB,{}),(0,l.jsx)(aX,{canvasStateLoading:d.isLoading})]}),children:[c&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(oO,{isServiceOpen:I,groupBreadcrumbs:P,currentGroupId:s}),E&&(0,l.jsx)("div",{className:"fixed px-6 bottom-0 w-full z-[9] grid grid-cols-3 items-end",children:!L&&N&&(0,l.jsx)(oV,{})})]}),(0,l.jsx)("div",{className:"canvas-container absolute inset-0 grid",ref:T,children:(0,l.jsx)(oq,{renderDimensions:S,projectCanvasState:d,groupId:"root"===s?void 0:s,parentGroupId:r,selectedNodeId:null!=M?M:void 0,onCanvasInit:e=>h(e.canvasAtoms),canvasAtoms:m})})]}),c&&E&&(0,l.jsx)(eD.N,{initial:!1,children:(0,l.jsx)(aK,{})}),(0,l.jsxs)(eJ.rU,{ref:D,className:(0,X.xW)(!I&&"select-none pointer-events-none"),children:[(0,l.jsx)(eD.N,{initial:!1,children:I&&(0,l.jsxs)(eJ.w5,{isBehind:null!=k,disableTransition:!u,children:[null!=v&&(0,l.jsx)(i4,{serviceId:v,deploymentId:k,canvasAtoms:m},"service-view-".concat(v)),null!=j&&(0,l.jsx)(oS,{volumeId:j,canvasAtoms:m},"volume-view-".concat(j)),null!=y&&(0,l.jsx)(l3,{},"plugin-view-".concat(y)),w&&null!=A&&(0,l.jsx)(oe,{inProjectTemplateConfig:A})]})}),(0,l.jsx)(eD.N,{initial:!1,children:null!=k&&(0,l.jsx)(eJ.w5,{animateFromTop:!0,isInFront:!0,disableTransition:!u,children:(0,l.jsx)(eG.K,{deploymentId:k,showBackLink:!0,isLoadingProject:null==C})})})]}),(0,l.jsx)(o_,{})]},"nested-canvas-".concat(s))},oK=e=>{let[t,n]=(0,eK.B)(),[l,a]=(0,eK.B)(),[s]=(0,g.N3)(),r=e?l.width:0,o=(0,eW.o)(t.width-(e?r:320*!!s)-0,0);return{canvasRenderDimensions:(0,i.useMemo)(()=>({width:o,height:t.height}),[o,t.height]),canvasRef:n,servicePaneRef:a}},oY=e=>{let{children:t}=e,n=(0,a.md)(x.YX),{projectId:s,routes:r,pathname:o}=(0,es.c)(),c=o===r.project({}).url,{query:d}=(0,eA.useRouter)(),h=null!=d.groupId?d.groupId:null,p=(e=>{let{graphqlClient:t}=(0,R.q)(),{isSudoMode:n,isLoading:l}=(0,ej.hA)(),s=(0,a.md)(x.K8),r=(0,i.useMemo)(()=>(0,eV.Y)(),[e]),{provider:o,hasSynced:c}=((e,t)=>{let[n,l]=(0,i.useState)(!1),[a,s]=(0,i.useState)(null),r=Math.floor((Math.random()+1)*6e4),o=Math.floor(1e3*Math.random())+9e3;return(0,i.useEffect)(()=>{let n=!1,a=new eU.$R(eF.p.yjsWebsocket(),e,t,{maxBackoffTime:r,maxBackoffIntervalOnSuccessfulConnects:o});return a.on("sync",e=>{n||l(t=>t||e)}),s(a),()=>{var e;n=!0,null==(e=a.ws)||e.close(),a.disconnect(),a.destroy()}},[e,t]),{provider:a,hasSynced:n}})("project/".concat(e),r.doc),[d,u]=(0,i.useState)([]),[m,h]=(0,i.useState)({}),[{user:p}]=(0,ev.Jd)(),[g,v]=(0,i.useState)(!1);(0,i.useEffect)(()=>{if(!c)return;r.undoManager.clear();let e=!1,t=()=>{if(e)return;let t={};r.getAllGroups().forEach((e,n)=>{t[n]=e}),u(Object.values(t)),v(!0)},n=r.observeGroups(t);t();let l=()=>{if(e)return;let t={};r.getAllGroupRefs().forEach((e,n)=>{t[n]=e}),h(t)},a=r.observeGroupRefs(l);return l(),()=>{e=!0,n(),a()}},[r,c]);let j=((e,t,n,l,a)=>{let[s,r]=(0,i.useState)([]);return(0,i.useEffect)(()=>{let s=a&&(null==e?void 0:e.awareness);if(!s)return;if(null==t||null==n||n||l)return void s.setLocalState(null);let i=!1,o=()=>{var e,n,l,a;if(i)return;let o=s.getStates(),c=!1;for(let n of o.values())if((null==(e=n.user)?void 0:e.id)===t.id){c=!0;break}c||s.setLocalStateField("user",{id:t.id,name:null!=(l=null!=(n=t.name)?n:t.username)?l:t.email,avatar:null!=(a=t.avatar)?a:void 0});let d=[...(o=s.getStates()).values()];r(d.filter((e,t)=>{let{user:n}=e;return n&&d.findIndex(e=>{var t;return(null==(t=e.user)?void 0:t.id)===n.id})===t}))};return s.on("change",o),o(),()=>{i=!0,s.off("change",o),s.setLocalState(null)}},[a,null==t?void 0:t.id,n,l,e]),s})(o,p,n,l,c);return{canvasDoc:r,isLoading:!c||!g,groups:d,groupRefs:m,createGroup:(0,M.n)(s,async n=>(await t.groupCreate({input:{name:n.name,projectId:e,isCollapsed:n.isCollapsed}})).groupCreate),present:j}})(null!=s?s:"<unknown>");(0,a.Xr)(eO.Tp)(p.canvasDoc),(()=>{let e=(0,a.md)(I.KE),t=(0,a.Xr)(ez(e)),n=(0,a.md)(z.mz);(0,eP.R)(u.beG,{variables:{environmentId:null!=e?e:"",decryptPatchVariables:n},disabled:null==e,dependencies:[e],onError:()=>{},onNext:async e=>{var n,l;t(null!=(l=null==(n=e.data)?void 0:n.environmentStagedPatch)?l:null)}}),(e=>{let t=(0,a.md)((0,V.d1)(e)),n=(0,a.Xr)(eM(e));(0,eP.R)(u.kSN,{variables:{environmentId:null!=e?e:""},disabled:null==e||""===e||0===t,dependencies:[e],onError:()=>{},onNext:e=>{var t;(null==(t=e.data)?void 0:t.environmentPatchProgress)&&n(e.data.environmentPatchProgress)}})})(e)})(),(0,eR.HL)();let g=(0,a.md)(x.KY),v=(0,a.md)(m.oI),j=g&&v&&!p.isLoading,y=(0,eE.z)("md"),f=(0,i.useMemo)(()=>{if(p.isLoading||null==h||y)return["root"];let e=[],t=h;for(;null!=t;){let n=p.groups.find(e=>e.id===t);(null==n?void 0:n.isCollapsed)&&e.push(t),t=p.groupRefs[t]}return e.push("root"),e.reverse()},[p,h,y]);return n?(0,l.jsx)(H.M,{className:"pb-10 md:pb-80"}):(0,l.jsxs)("div",{className:"relative w-full h-full grid grid-cols-1 grid-rows-[minmax(0,1fr)] overflow-hidden",children:[(0,l.jsx)(o$,{isMobile:y,initial:!1,children:t&&!c&&(0,l.jsx)("div",{className:(0,X.xW)("metro-children","col-start-1 col-end-3 row-start-1","z-40 min-w-full h-full","md:px-6 md:overflow-y-hidden md:mx-0"),children:t},"children")}),(0,l.jsx)(o$,{isMobile:y,initial:!1,children:f.map((e,t)=>{let n="root"===e,a=e===f[f.length-1],s=e===f[f.length-2],r=n?null:f[t-1],i=f.slice(0,t+1),o=n?"root":s?"behind":a?"top":"hidden";return(0,l.jsx)(oQ,{groupId:e,variant:o,isRootTop:1===f.length,isMobile:y,isTop:a,animationEnabled:j,children:(0,l.jsx)(oW,{groupId:e,groupPath:i,parentGroupId:r,isTop:a,projectCanvasState:p,animationEnabled:j})},e)})})]})},oQ=e=>{let{groupId:t,variant:n,isRootTop:a,isMobile:s,isTop:r,animationEnabled:i,children:o}=e,c="root"===n;return(0,l.jsxs)("div",{id:"stack-container-".concat(t),...r?{role:"region"}:{inert:!0,"aria-hidden":"true"},className:(0,X.xW)("col-start-1 row-start-1 relative grid stack-container",!c&&"mx-0 mb-0 mt-4 bg-secondaryBg dark:bg-background rounded-lg",c&&"z-0",i&&("behind"===n||"hidden"===n)&&"transition-transform duration-[0.2s] ease-out","top"===n&&"scale-100 translate-y-0","behind"===n&&"scale-[.98] translate-y-[-16px]","hidden"===n&&"scale-[.98] translate-y-[-12px]","shadow-nestedCanvasShadow"),children:[o,c&&!a&&(0,l.jsx)(eT.P.div,{className:"absolute inset-0 bg-black bg-opacity-[0.16]",initial:{opacity:0},animate:{opacity:1},"aria-hidden":!0})]})},o$=e=>{let{children:t,isMobile:n,initial:a}=e;return n?(0,l.jsx)(i.Fragment,{children:t}):(0,l.jsx)(eD.N,{initial:a,children:t})},oG=e=>{let{children:t,...n}=e,s=(0,a.md)(G.AP),r=(0,a.md)(I.KE),k=(0,a.md)(J.f3),C=(0,a.md)(x.YX),S=(0,i.useRef)(null);return!function(e){let t=(0,i.useRef)(""),n=(0,i.useRef)(e),l=(0,c.jE)(),s=(0,i.useSyncExternalStore)(y,f,f),[r,o]=(0,i.useState)(0),b=(0,a.md)(v.iv),w=(0,i.useCallback)(()=>{if(!e||!s)return()=>{};n.current!==e&&(t.current=""),n.current=e;let a=!1,r=b.subscribe({query:(0,d.y)(u.ttV),variables:{environmentId:null!=e?e:""}},{next(n){let{data:a}=n;a&&(t.current&&t.current!==a.canvasInvalidation.id&&(l.refetchQueries({type:"active",queryKey:(0,m.l4)({environmentId:e}),fetchStatus:"idle"}),l.refetchQueries({type:"active",queryKey:[p.Id],fetchStatus:"idle"}),l.refetchQueries({type:"active",queryKey:[h.pN],fetchStatus:"idle"}),l.refetchQueries({type:"active",queryKey:[x.xl],fetchStatus:"idle"}),l.refetchQueries({type:"active",queryKey:[g.ME],fetchStatus:"idle"})),t.current=a.canvasInvalidation.id)},error(){},complete(){"visible"!==document.visibilityState||a||o(e=>e+1)}});return()=>{a=!0,r()}},[l,e,s,b,r]);(0,i.useSyncExternalStore)(w,j,j)}(r),(()=>{let{commitStagedChanges:e}=Y((0,a.md)(I.KE)),t=(0,N.mX)("Alt"),{isCommandPaletteOpen:n}=(0,w.oG)();(0,i.useEffect)(()=>{if(n)return;let l=(0,b.Ay)(window,{"Shift+Enter":n=>{n.preventDefault(),n.stopPropagation(),e({skipDeploys:t})},"Alt+Shift+Enter":t=>{t.preventDefault(),t.stopPropagation(),e({skipDeploys:!0})}});return()=>{l()}},[n,e,t])})(),(0,l.jsxs)(en.YS,{globalBannerSlotRef:S,seo:{title:null!=k?k:s},children:[(0,l.jsx)(oX,{}),(0,l.jsxs)("div",{className:(0,X.xW)("grid min-h-screen sm:max-h-screen bg-secondaryBg dark:bg-background","grid-rows-[auto_auto_auto_minmax(0px,_1fr)]"),children:[(0,l.jsx)("div",{ref:S}),(0,l.jsx)(et.g,{}),(0,l.jsx)(eC,{}),C?(0,l.jsx)(H.M,{className:"pb-10 md:pb-80"}):(0,l.jsx)(o.tH,{FallbackComponent:oJ,children:(0,l.jsx)(oY,{children:t})})]})]})},oJ=()=>(0,l.jsxs)("div",{className:(0,X.xW)("flex flex-col justify-center items-center mb-20 md:mb-60"),children:[(0,l.jsx)(Z.In,{icon:$.Jpz,size:"4xl",className:"mb-8"}),(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)(ee.hE,{className:"mb-2",children:"Oh no! Looks like the page derailed"}),(0,l.jsx)(ee.lD,{className:"mb-8 font-medium",children:"Try refreshing the page or contact support."})]}),(0,l.jsx)(T.vx,{href:"https://station.railway.com/",className:"max-w-max",children:"Contact support"})]});function oX(){return(0,l.jsx)(r(),{children:(0,l.jsx)("style",{children:"\n          body {\n            background-color: var(--secondaryBg);\n          }\n\n          html.dark body {\n            background-color: var(--background);\n          }\n        "})})}},5953:(e,t,n)=>{n.d(t,{m:()=>j});var l=n(50979),a=n(1508),s=n(59613),r=n(64162),i=n(81154),o=n(16436),c=n.n(o),d=n(88887),u=n(77505),m=n(72287),x=n(18731),h=n(65178),p=n(72898),g=n(66767),v=n(71144);let j=e=>{let{projectId:t,environment:n,environmentConfig:o,pluginId:j=null,serviceId:f=null}=e,{track:b}=(0,v.j)(),w=n.id,N=(0,m.aQ)(n.id),I=(0,i.md)((0,x.yH)(w)),k=async e=>{let t=Object.entries(e).reduce((e,t)=>{let[n,l]=t;return{...e,[n]:l?{...l,value:l.value?(0,s.collapseFunctions)(l.value):l.value}:null}},{});if(null!=f)await N.stageServiceChanges({serviceId:f,payload:{variables:t}});else{let e=(0,r.newEnvironmentConfig)(N.getStagedChanges()).updateSharedVariables(t).build();await N.stageEnvironmentChanges({payload:e})}},{modalActions:C}=(0,u.U)(),S=e=>t=>{C.createToast((0,l.jsx)(d.y8,{title:"Error ".concat(e,": ").concat(t.message),variant:"error"}))},T=(0,p.F)(I,async e=>{await k(y(e))},S("Upserting variables")),D=(0,p.F)(I,async e=>{let{name:n}=e;null!=t&&null!=w&&(b({action:"Delete",object:(0,h.G)({pluginId:j,serviceId:f})?"Shared Variable":"Variable"}),await k({[n]:null}))},S("Deleting variable")),A=(0,p.F)(I,async e=>{let{names:n,serviceMap:l}=e;if(null==t||null==w)return;let a=[],s=[];for(let e in l)l[e]?a.push(e):s.push(e);let i=(0,r.newEnvironmentConfig)(N.getStagedChanges());for(let e of n){let t="${{".concat(g.MS,".").concat(e,"}}");for(let n of a)i.updateService(n,{variables:{[e]:{value:t}}});for(let t of s)i.updateService(t,{variables:{[e]:null}})}await N.stageEnvironmentChanges({payload:i.build()})},S("Configure shared variable")),E=(0,p.F)(I,async e=>{let{name:t,value:n}=e;if(null==f)return;let l=n.trim(),a="${{".concat(g.MS,".").concat(t,"}}");b({action:"Promote",object:"variable"}),await N.stageEnvironmentChanges({payload:(0,r.newEnvironmentConfig)(N.getStagedChanges()).updateSharedVariables({[t]:{value:l}}).updateService(f,{variables:{[t]:{value:a}}}).build()})},S("Promoting variable")),R=(0,p.F)(I,async e=>{let{variables:t}=e,n=Object.entries(t).reduce((e,t)=>{let[n,l]=t;return{...e,[n]:{value:l}}},{});await k(n)},S("Adding variables")),L=(0,p.F)(I,async e=>{var t,n,l;let{variables:s,existingDecryptedVariables:i}=e,d=null==o?void 0:o.sharedVariables;null!=f&&(d=null==(n=(0,r.getServiceFromEnvironmentConfig)(o,f))?void 0:n.variables);let u=Object.keys(null!=d?d:{}).reduce((e,t)=>({...e,[t]:null}),{}),m=(0,a.stripMetadataFromVariablesWithMetadata)(s),x=c()({},u,m),h=null!=(l=null==(t=(0,r.getServiceFromEnvironmentConfig)(N.getStagedChanges(),f))?void 0:t.variables)?l:{};for(let[e,t]of Object.entries(x))(null==t?void 0:t.value)!=null&&null!=i&&null==h[e]&&(i[e]===t.value||t.value===r.SECRET_VARIABLE_VALUE)&&delete x[e];0!==Object.keys(x).length&&await k(x)},S("Setting variables"));return{upsertVariable:e=>{let{name:t,value:n,isSealed:l}=e;return T([{name:t,value:n,isSealed:l}])},upsertVariables:T,deleteVariable:D,upsertVariablesFromObject:R,setVariablesFromObject:L,promoteToSharedVariable:E,configureSharedVariables:A,onUpdateVariableGenerator:(0,p.F)(I,async e=>{let{name:t,generator:n}=e;await k({[t]:{generator:n}})},S("Updating variable generator")),onSealVariable:(0,p.F)(I,async e=>{let{name:t}=e;await k({[t]:{isSealed:!0}})},S("Sealing variable"))}},y=e=>e.reduce((e,t)=>{let{name:n,value:l,isSealed:a}=t;return e[n]={value:l,...a?{isSealed:a}:{}},e},{})},15887:(e,t,n)=>{n.d(t,{e:()=>s});var l=n(50979),a=n(82660);let s=()=>(0,l.jsx)(a.l,{variant:"warning",children:"You are not authorized to view the contents of this section."})},31089:(e,t,n)=>{n.d(t,{N:()=>i});var l=n(50979),a=n(64124),s=n.n(a),r=n(37590);let i=s()(()=>Promise.all([n.e(7473),n.e(577)]).then(n.bind(n,90577)),{loadableGenerated:{webpack:()=>[90577]},ssr:!1,loading:()=>(0,l.jsx)(r.g,{width:"100%",height:"42px"})});s()(()=>Promise.all([n.e(7473),n.e(577)]).then(n.bind(n,90577)),{loadableGenerated:{webpack:()=>[90577]},ssr:!1})},42873:(e,t,n)=>{n.d(t,{LY:()=>T,Br:()=>A});var l=n(50979),a=n(4766),s=n(25963),r=n(55850),i=n(97865),o=n(72898);let c=e=>{let{graphqlClient:t}=(0,r.q)(),n=["admin-service-instance-limit-override",e.projectId,e.environmentId,e.serviceId],{result:l}=(0,i.W)(n,async()=>await t.serviceInstanceLimitOverride({serviceId:e.serviceId,environmentId:e.environmentId}));return{result:l,setServiceInstanceLimitOverride:(0,o.n)(n,async e=>(await t.adminSetServiceInstanceLimitOverride(e)).adminSetServiceInstanceLimitOverride),removeServiceInstanceLimitOverride:(0,o.n)(n,async e=>(await t.adminRemoveServiceInstanceLimitOverride(e)).adminRemoveServiceInstanceLimitOverride)}};var d=n(93208),u=n(77505),m=n(95907),x=n(42419),h=n(95662),p=n(25586),g=n(36609),v=n(31089),j=n(98579),y=n(49863);function f(e){let{environmentId:t,serviceId:n}=e,[{privateNetworks:{data:a}}]=(0,p.$)({environmentId:t});return(0,l.jsx)(h.T,{children:null==a?void 0:a.map(e=>(0,l.jsx)(w,{privateNetwork:e,environmentId:t,serviceId:n},e.publicId))})}let b=e=>{let{name:t,values:n}=e;return(0,l.jsxs)(h.z,{className:"gap-4",align:"start",children:[(0,l.jsx)(y.Pz,{children:(0,l.jsxs)(x.zb,{className:"mt-3.5",children:[t," (",n.length,")"]})}),(0,l.jsx)(h.T,{space:0,className:"w-3/4 min-h-0 max-h-96 overflow-y-auto",children:n.map(e=>(0,l.jsx)(y.Du,{className:"w-full !mb-[-10px] h-15 shrink-0",children:(0,l.jsx)(v.N,{children:e})},e))})]})},w=e=>{let{privateNetwork:t,environmentId:n,serviceId:a}=e,[{privateNetworkEndpoint:{data:s}}]=(0,j.u)({privateNetworkId:t.publicId,environmentId:n,serviceId:a}),r="".concat(t.dnsName,".internal"),i="".concat(null==s?void 0:s.dnsName,".").concat(r);return(0,l.jsx)(h.T,{className:(0,g.xW)("px-4 py-4 my-4 border rounded-lg"),children:(0,l.jsxs)(h.T,{children:[(0,l.jsx)(x.mM,{children:t.name}),(0,l.jsx)(y.q7,{name:"Network public ID",value:t.publicId}),(0,l.jsx)(y.q7,{name:"NID",value:t.networkId.toString(16).padStart(8,"0")}),s&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(y.q7,{name:"Endpoint public ID",value:s.publicId}),(0,l.jsx)(y.q7,{name:"Endpoint dns",value:i}),(0,l.jsx)(b,{name:"IPv6 addresses",values:s.privateIps})]})]})})};var N=n(82048),I=n(31754),k=n(61259),C=n(86954),S=n(88887);(0,a.bytesInGigaByte)(64);let T={CPU:64,MEMORY_BYTES:(0,a.bytesInGigaByte)(128)},D=e=>{var t,n,r,i,o,m,x,p,g,v,j,y,f,b,w,N;let{config:T,...D}=e,{setServiceInstanceLimitOverride:A,removeServiceInstanceLimitOverride:E}=c(D),[R,L]=(0,s.useState)(null!=(b=null==T||null==(n=T.containers)||null==(t=n.cpu)?void 0:t.toString())?b:""),[M,P]=(0,s.useState)((null==T||null==(r=T.containers)?void 0:r.memoryBytes)?(0,a.bytesToGigaBytes)(T.containers.memoryBytes).toString():""),[z,O]=(0,s.useState)(null!=(w=null==T||null==(o=T.containers)||null==(i=o.pidLimit)?void 0:i.toString())?w:""),[U,F]=(0,s.useState)(null!=(N=null==T||null==(m=T.deploys)?void 0:m.replicas)?N:null),[V,B]=(0,s.useState)(!1),[_,q]=(0,s.useState)(!1),{modalActions:W}=(0,u.U)(),{isConfirmed:K}=(0,d.S)(),Y=async()=>{var e,t,n,s;let r=R?parseFloat(R):null,i=M?parseFloat(M):null,o=z?parseInt(z):null;if(null!==o&&o<1)return void W.createToast((0,l.jsx)(S.y8,{variant:"error",title:"Invalid PID Limit",description:"PID limit must be at least 1."}));if(null!==o&&o>1e5)return void W.createToast((0,l.jsx)(S.y8,{variant:"error",title:"Invalid PID Limit",description:"PID limit cannot exceed 100,000 processes."}));if(null!==U){let s=Math.floor(a.MAX_TOTAL_CPU/U),o=Math.floor(a.MAX_TOTAL_MEMORY_GB/U);if(U>50&&(!r||!i))return void W.createToast((0,l.jsx)(S.y8,{variant:"error",title:"CPU and Memory Required",description:"For ".concat(U," replicas, you must specify CPU and memory limits. Maximum allowed: ").concat(s," vCPU and ").concat(o," GB per replica.")}));let c=null!=(n=null!=r?r:null==T||null==(e=T.containers)?void 0:e.cpu)?n:8,d=null!=i?i:(null==T||null==(t=T.containers)?void 0:t.memoryBytes)?(0,a.bytesToGigaBytes)(T.containers.memoryBytes):8,u=U*c,m=U*d;if(u>a.MAX_TOTAL_CPU)return void W.createToast((0,l.jsx)(S.y8,{variant:"error",title:"Invalid Configuration",description:"Total CPU usage (".concat(U," replicas \xd7 ").concat(c," vCPU = ").concat(u," vCPU) exceeds the maximum limit of ").concat(a.MAX_TOTAL_CPU," vCPU. Maximum allowed: ").concat(s," vCPU per replica.")}));if(m>a.MAX_TOTAL_MEMORY_GB)return void W.createToast((0,l.jsx)(S.y8,{variant:"error",title:"Invalid Configuration",description:"Total memory usage (".concat(U," replicas \xd7 ").concat(d," GB = ").concat(m," GB) exceeds the maximum limit of ").concat(a.MAX_TOTAL_MEMORY_GB," GB. Maximum allowed: ").concat(o," GB per replica.")}))}if(i&&i>32&&!await K({title:"Warning!",message:"You're increasing the max memory of this service to "+"".concat(M," GB. Please confirm with platform on-call that ")+"this is safe to do before proceeding."})||o&&o>1e4&&!await K({title:"High PID Limit Warning",message:"You're setting the PID limit to ".concat(o," processes. ")+"This is significantly higher than the default (1000). Please confirm this is intentional."})||!await K({title:"Are you sure?",message:"This will apply the custom limits to the service instance forever and ever."}))return;let c={...r||i||o?{containers:{...r&&{cpu:r},...i&&{memoryBytes:(0,a.bytesInGigaByte)(i)},...o&&{pidLimit:o}}}:{},...null!==U&&{deploys:{replicas:U}}};B(!0);try{await A({input:{serviceId:D.serviceId,environmentId:D.environmentId,config:c}}),W.createToast((0,l.jsx)(S.y8,{variant:"success",title:"Success!",description:"Service instance limit updated"}))}catch(e){W.createToast((0,l.jsx)(S.y8,{variant:"error",title:"Error!",description:null!=(s=e.message)?s:"There was an issue updating the service instance limit."}))}B(!1)},Q=async()=>{if(await K({message:"This will remove all service-specific limit overrides. The service will use plan defaults.",title:"Are you sure?"})){q(!0);try{await E({input:{serviceId:D.serviceId,environmentId:D.environmentId}}),L(""),P(""),O(""),F(null),W.createToast((0,l.jsx)(S.y8,{variant:"success",title:"Success!",description:"All service-specific limit overrides have been removed."}))}catch(t){var e;W.createToast((0,l.jsx)(S.y8,{variant:"error",title:"Error!",description:null!=(e=t.message)?e:"There was an issue resetting the service instance limit."}))}q(!1)}};return(0,s.useEffect)(()=>{var e,t,n,l,s,r,i,o,c,d,u,m;L(null!=(d=null==T||null==(n=T.admin)||null==(t=n.containers)||null==(e=t.cpu)?void 0:e.toString())?d:"");let x=null==T||null==(s=T.admin)||null==(l=s.containers)?void 0:l.memoryBytes;P(x?(0,a.bytesToGigaBytes)(x).toString():""),O(null!=(u=null==T||null==(o=T.admin)||null==(i=o.containers)||null==(r=i.pidLimit)?void 0:r.toString())?u:""),F(null!=(m=null==T||null==(c=T.deploys)?void 0:c.replicas)?m:null)},[null==T||null==(p=T.admin)||null==(x=p.containers)?void 0:x.cpu,null==T||null==(v=T.admin)||null==(g=v.containers)?void 0:g.memoryBytes,null==T||null==(y=T.admin)||null==(j=y.containers)?void 0:j.pidLimit,null==T||null==(f=T.deploys)?void 0:f.replicas]),(0,l.jsx)(k.lV,{className:"space-y-8",onSubmit:Y,children:(0,l.jsxs)(h.T,{space:4,children:[(0,l.jsx)(C.pd,{type:"number",name:"cpu",label:"CPU",placeholder:"Leave empty for plan default",value:R,onChange:e=>L(e.target.value)}),(0,l.jsx)(C.pd,{type:"number",name:"memory",label:"Memory (GB)",placeholder:"Leave empty for plan default",value:M,onChange:e=>P(e.target.value)}),(0,l.jsx)(C.pd,{type:"number",name:"pidLimit",label:"PID Limit",placeholder:"Leave empty for plan default (1000)",value:z,onChange:e=>O(e.target.value),min:1,max:1e5}),(0,l.jsx)(C.pd,{type:"number",name:"replicas",label:"Replica Limit",placeholder:"Leave empty for plan default",value:null!=U?U:"",onChange:e=>F(e.target.value?parseInt(e.target.value):null)}),(0,l.jsxs)(h.z,{align:"center",justify:"end",space:2,children:[(0,l.jsx)(I.$n,{type:"button",variant:"outline",color:"red",size:"sm",onClick:Q,disabled:_,isLoading:_,children:"Remove All Overrides"}),(0,l.jsx)(I.$n,{type:"submit",size:"sm",disabled:V,isLoading:V,className:"max-w-max",children:"Update"})]})]})})},A=e=>{var t,n;let{result:a}=c(e);return(0,l.jsxs)(h.T,{space:8,className:"pb-12",children:[(0,l.jsx)(N.n,{title:"Service Instance Limits",defaultOpen:!0,children:(0,l.jsx)(D,{...e,config:null!=(n=null==(t=a.data)?void 0:t.serviceInstanceLimitOverride)?n:null})}),(0,l.jsx)(N.n,{title:"Private Networking",defaultOpen:!0,children:(0,l.jsx)(f,{...e})}),(0,l.jsx)(N.n,{title:"Containers",defaultOpen:!0,children:(0,l.jsx)(m.$,{...e})})]})}},45047:(e,t,n)=>{n.d(t,{_x:()=>I,vZ:()=>k});var l=n(50979),a=n(1508),s=n(59613),r=n(25963),i=n(42113),o=n(93208),c=n(70375),d=n(2551),u=n(36609),m=n(32357);n(40148);var x=n(82660),h=n(31754);n(44661);var p=n(61259),g=n(13077),v=n(86954),j=n(47654),y=n(95662),f=n(42419),b=n(70740),w=n(27644);function N(e){let{isMobile:t=!1,onClickDomainSuggestion:n}=e;return(0,l.jsx)(x.l,{className:"items-center",variant:"info",children:(0,l.jsxs)("div",{className:"flex flex-1 items-center justify-between",children:[(0,l.jsx)("p",{className:t?"text-xs":"text-sm",children:"You must add a domain before you reference it!"}),(0,l.jsx)(h.$n,{className:"text-blue-700 bg-blue-50",color:"blue",onClick:n,size:"xs",variant:"outline",children:(0,l.jsxs)("p",{className:t?"text-xs":"text-sm",children:[t&&"Add",!t&&"Add a domain"]})})]})})}let I=e=>{let{autocompleteOptions:t,nameAutocompleteOptions:n,onAddVariable:c,onAddMultipleVariables:x,onCancel:g,checkConflict:j,hideAutocompleteHint:I,onClickDomainSuggestion:k,forceAutocomplete:C=!1,publicDomainSuggestion:S=!1,defaultValues:T={name:"",value:""},...D}=e,[A,E]=(0,r.useState)(!1),{handleSubmit:R,control:L,watch:M,setValue:P,reset:z}=(0,i.mN)({defaultValues:T}),[O,U]=r.useState(0),F=M(),{isConfirmed:V}=(0,o.S)(),B=async e=>{var t;let{name:n,value:l}=e;(!(null!=(t=null==j?void 0:j(n))&&t)||await V({confirmLabel:"Overwrite",message:"Updating this variable will overwrite another with the same name. Are you sure you want to do this?",title:"Variable overwrite detected"}))&&(U(e=>e+1),z(),await c({name:n,value:l}))},_=(0,r.useMemo)(()=>(0,s.findReferences)(F.value),[F.value]),q=(0,r.useCallback)(async e=>{let t=(0,a.parseEnvContents)(e.clipboardData.getData("text"));if(0===Object.keys(t).length)return;e.preventDefault();let n=[];for(let[e,{value:l}]of Object.entries(t))n.push({name:e,value:l});await x(n),U(e=>e+1),z()},[]),W=()=>{E(!1),null==k||k()},K=(0,r.useRef)(null),Y=(0,r.useRef)(null);return(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsxs)(p.lV,{ref:K,name:"Add Variable",trackingProperties:{containsSharedReference:_.some(e=>e.includes(".")),containsLocalReference:_.some(e=>!e.includes("."))},enableBindings:!0,...D,onSubmit:R(B),className:(0,u.xW)(D.className,"grid auto-rows-auto md:grid-cols-[1fr_1fr_auto] gap-2"),children:[(0,l.jsx)(y.T,{className:"w-full md:w-auto lg:flex-grow",children:(0,l.jsx)(i.xI,{name:"name",control:L,defaultValue:"",rules:{required:!1},render:e=>{let{field:{onChange:t}}=e;return null==n?(0,l.jsx)(v.pd,{autoFocus:!0,onChange:t,onPaste:q,placeholder:"VARIABLE_NAME",label:{text:"Variable Name",hidden:!0},size:"sm",value:F.name}):(0,l.jsx)(m.j,{id:"variable-value",autoFocus:!0,size:"sm",placeholder:"VARIABLE_NAME",options:n,onPaste:q,behavior:"replace",minQueryLength:5,includeFullMatch:!0,defaultOpen:C,label:{text:"Variable Name",hidden:!0},icon:d.yQN,iconText:"Add Reference",overflowHint:"Filter Database or Shared Variables",onChange:t,onSelect:e=>{var t;null==(t=Y.current)||t.focus(),P("value",e.valueOption.value)},value:F.name,onSubmit:()=>{var e;null==(e=K.current)||e.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))}})}})}),(0,l.jsxs)(y.T,{className:"w-full",children:[(0,l.jsx)(i.xI,{name:"value",control:L,defaultValue:"",rules:{required:!1,validate:b.G},render:e=>{let{field:{onChange:n},fieldState:{error:a}}=e;return(0,l.jsx)(w.T,{ref:Y,name:"variable-value",autocompleteOptions:t,onChange:e=>{let t=!!e.match(/^\$\{\{railway_pu/i);S&&A!==t&&E(t),n(e)},value:F.value,error:null==a?void 0:a.message,onSubmit:()=>{var e;null==(e=K.current)||e.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))}})}}),!I&&(0,l.jsxs)(f.ae,{children:["Press ",(0,l.jsx)(f.Uz,{children:"/"})," to autocomplete template variables"]})]}),(0,l.jsx)("div",{className:"block md:hidden",children:A&&k&&(0,l.jsx)(N,{isMobile:!0,onClickDomainSuggestion:W})}),(0,l.jsxs)(y.z,{space:2,children:[(0,l.jsx)(h.$n,{size:"sm",type:"submit",icon:d.Jlk,disabled:0===F.name.length,className:"w-full md:max-w-max",children:"Add"}),null!=g&&(0,l.jsx)(h.$n,{size:"sm",type:"button",color:"gray",onClick:g,className:"w-full md:max-w-max",children:"Cancel"})]})]},O),A&&k&&(0,l.jsx)("div",{className:"hidden md:block mt-4",children:(0,l.jsx)(N,{onClickDomainSuggestion:W})})]})},k=()=>{let{routes:e}=(0,c.c)();return(0,l.jsxs)(y.T,{space:4,children:[(0,l.jsxs)(f.zb,{children:["Sealed variable (",(0,l.jsx)(g.In,{icon:d.X_F,size:"sm",className:"!inline-block"}),") values will never be displayed. They are not visible in the UI or via the API."," ",(0,l.jsx)(j.N,{variant:"underline",...e.docs({}),children:"Learn more"})]}),(0,l.jsx)(f.EY,{children:"Once sealed you will not have access to the value. This change cannot be undone. Are you sure you want to seal this variable?"})]})}},49863:(e,t,n)=>{n.d(t,{BN:()=>g,Du:()=>h,Pz:()=>x,q7:()=>p});var l=n(86739),a=n(50979),s=n(36609),r=n(31089),i=n(95662),o=n(42419);function c(){let e=(0,l._)(["\nflex flex-col align-middle justify-center overflow-scroll\n"]);return c=function(){return e},e}function d(){let e=(0,l._)(["w-1/3"]);return d=function(){return e},e}function u(){let e=(0,l._)(["w-3/4"]);return u=function(){return e},e}let m=s.qy.div(c()),x=(0,s.DR)(m)(d()),h=(0,s.DR)(m)(u()),p=e=>{let{name:t,value:n}=e;return(0,a.jsxs)(i.z,{className:"gap-4 w-full",children:[(0,a.jsx)(x,{children:(0,a.jsx)(o.zb,{children:t})}),(0,a.jsx)(h,{children:(0,a.jsx)(r.N,{children:n})})]})},g=e=>{let{container:t}=e;return(0,a.jsxs)(i.T,{className:(0,s.xW)("px-4 py-4 my-4 border rounded-lg","running"===t.status&&"border-green-400"),children:[(0,a.jsxs)(i.T,{children:[(0,a.jsx)(i.z,{space:2,children:(0,a.jsx)(o.mM,{children:"Info"})}),(0,a.jsx)(p,{name:"ID",value:t.id}),(0,a.jsx)(p,{name:"Host",value:t.host}),(0,a.jsx)(p,{name:"Image",value:t.image}),(0,a.jsx)(p,{name:"Status",value:t.status}),(0,a.jsx)(p,{name:"Runtime",value:t.runtime})]}),(0,a.jsxs)(i.T,{children:[(0,a.jsx)(o.mM,{children:"Labels"}),t.labels.map(e=>{let{key:t,value:n}=e;return(0,a.jsx)(p,{name:t,value:n},t)})]})]},t.id)}},58654:(e,t,n)=>{n.d(t,{B:()=>r});var l=n(64162),a=n(2888),s=n(18946);let r=e=>{var t,n,r,o,c,d,u;let{project:m,environment:x,serviceInstances:h,volumeInstances:p,volumeInstancesCurrentSizeMB:g,environmentConfig:v,stagedEnvironmentConfig:j,servicesThatWillBeDeployed:y,optimisticNodes:f={}}=e,b=(0,l.sortedObjectEntries)(null!=(t=v.services)?t:{}),w=m.plugins.filter(e=>e.containers.find(e=>e.environmentId===x.id&&!e.deletedAt)).map(e=>({type:"plugin",id:e.id,plugin:e,pluginItem:a.Gg[e.name]})),N={},I=Object.keys(null!=(n=v.volumes)?n:{}),k=new Set((0,l.getServicesFromConfig)(v,{skipDeleted:!0}).flatMap(e=>{var t;return Object.keys(null!=(t=e.volumeMounts)?t:{}).filter(t=>{var n,l;return(null==(n=(null!=(l=e.volumeMounts)?l:{})[t])?void 0:n.mountPath)!=null})}));for(let e of I){let t=m.volumes.find(t=>t.id===e);if(null==t)continue;let n=p.find(e=>e.volumeId===t.id);if(null==n?void 0:n.isPendingDeletion)continue;let l=(null!=(r=v.volumes)?r:{})[e];null!=l&&(N[e]={type:"volume",id:e,volume:t,currentSizeMB:n?g[n.id]:null,volumeInstance:n,volumeInstanceConfig:l,width:s.n7,height:s.gE})}let C=Object.values(N).filter(e=>!k.has(e.id)),S=Object.values(f).map(e=>"volume"===e.type?{type:"volume",id:e.id,volume:{id:e.id,name:e.name,createdAt:new Date(e.createdAt).toISOString(),projectId:m.id},volumeInstance:void 0,volumeInstanceConfig:{sizeMB:1e3,isDeleted:!1,isCreated:!1},currentSizeMB:null,isPending:e.isPending,width:s.n7,height:s.gE,draggable:!1}:null).filter(e=>null!==e),T=[];for(let[e,t]of b){let n=null!=(c=(0,l.getServiceFromEnvironmentConfig)(j,e))?c:void 0,a=m.services.find(t=>t.id===e);if(null==a)continue;let r=h.find(t=>t.serviceId===e),x=null!=(d=null==r?void 0:r.latestDeployment)?d:void 0,p=Object.keys(null!=(u=t.volumeMounts)?u:{}).filter(e=>{var n,l;return(null==(n=(null!=(l=t.volumeMounts)?l:{})[e])?void 0:n.mountPath)!=null}),g=p.length?p[0]:void 0,v=null==g||t.isDeleted?void 0:N[g];null!=v&&(v.serviceInstance=t,v.connectedServiceId=e);let f=0;null!=v&&(f+=1),(null==(o=t.deploy)?void 0:o.cronSchedule)!=null&&(f+=1),i(t)&&(f+=1);let b=s.WM+s.gE*f,w={type:"service",id:a.id,service:a,serviceInstance:r,serviceInstanceConfig:t,stagedServiceConfig:n,latestDeploy:x,volumeNode:v,width:s.n7,height:b,willBeDeployedWithStagedChanges:null==y?void 0:y.includes(a.id)};T.push(w)}let D=[...w,...T,...C,...S];return 0===D.length&&D.push({type:"empty",id:"empty",draggable:!1}),D},i=e=>{var t,n;return!e.isDeleted&&((null==(t=e.deploy)?void 0:t.numReplicas)!=null&&e.deploy.numReplicas>1||(null==(n=e.deploy)?void 0:n.multiRegionConfig)!=null&&Object.values(e.deploy.multiRegionConfig).reduce((e,t)=>{var n;return e+(null!=(n=null==t?void 0:t.numReplicas)?n:0)},0)>1)}},63774:(e,t,n)=>{n.d(t,{f:()=>i});var l=n(50979);n(25963);var a=n(20512),s=n(969),r=n(43514);let i=e=>{let{children:t,className:n,inline:i=!1}=e;return(0,l.jsx)(a.o,{remarkPlugins:[r.A],rehypePlugins:[s.A],className:n,components:i?{p:"span",h1:"span",h2:"span",h3:"span",h4:"span",h5:"span",h6:"span",ul:"span",ol:"span",li:"span",blockquote:"span"}:void 0,children:t})}},69444:(e,t,n)=>{n.d(t,{R:()=>a});var l=n(30595);let a=e=>{let[t,n]=(0,l.A)("".concat(e,"-variables-order"),{defaultValue:[]});return{order:t,setOrder:n}}},70740:(e,t,n)=>{n.d(t,{G:()=>a});var l=n(12725);let a=e=>{if(e.length>l.MAX_LENGTHS.VARIABLE_VALUE)return"Variable value exceeds maximum length of ".concat(l.MAX_LENGTHS.VARIABLE_VALUE)}},75612:(e,t,n)=>{n.d(t,{Z:()=>a});var l=n(25963);let a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];(0,l.useEffect)(()=>{let t=e();t&&t.then(()=>{}).catch(()=>{})},t)}},80991:(e,t,n)=>{n.d(t,{B8:()=>C,Kf:()=>j,N0:()=>T,Zk:()=>y,ck:()=>k});var l=n(86739),a=n(50979),s=n(13077),r=n(25963),i=n(95662),o=n(67906),c=n(42419),d=n(37321),u=n(2551),m=n(30921),x=n(36609);function h(){let e=(0,l._)(["\n  flex flex-grow overflow-x-auto space-x-4 pb-2\n"]);return h=function(){return e},e}function p(){let e=(0,l._)(["\n  flex flex-col min-w-80 py-2 border border-gray-200 rounded-sm\n"]);return p=function(){return e},e}function g(){let e=(0,l._)(["\n  flex items-center justify-between opacity-60 px-2 h-8\n"]);return g=function(){return e},e}function v(){let e=(0,l._)(["m-0 p-0 overflow-y-auto"]);return v=function(){return e},e}let j=e=>{let{path:t,pathClickable:n,onClickPath:l,children:s}=e,i=(0,r.useRef)(null);return(0,r.useEffect)(()=>{var e,t;null==(t=i.current)||t.scrollTo({left:(null==(e=i.current)?void 0:e.clientWidth)*5,behavior:"smooth"})},[t]),(0,a.jsxs)("div",{className:"flex flex-col flex-grow gap-1",children:[(0,a.jsxs)(d.F,{largerOrEqualTo:"sm",children:[(0,a.jsx)(f,{path:t,pathClickable:n,onClickPath:(e,t)=>{null!=l&&n&&l(e,t)}}),(0,a.jsx)(o.h,{y:2})]}),(0,a.jsx)(w,{ref:i,children:s})]})},y=e=>{let{title:t,panelActions:n,children:l}=e;return(0,a.jsxs)(N,{children:[(0,a.jsxs)(I,{children:[(0,a.jsx)(c.EY,{className:"overflow-ellipsis overflow-hidden whitespace-nowrap",children:t}),null!=n&&n]}),(0,a.jsx)(o.h,{y:2}),l]})},f=e=>{let{path:t,pathClickable:n,onClickPath:l}=e;return(0,a.jsx)(i.z,{space:3,children:t.map((e,s)=>(0,a.jsxs)(r.Fragment,{children:[(0,a.jsx)(b,{title:e,clickable:n,onClick:t=>{t.preventDefault(),l(e,s)},children:e}),s<t.length-1&&(0,a.jsx)("div",{children:"/"})]},s))})},b=(0,x.Wp)("a")(()=>[],e=>({maxWidth:240,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",cursor:e.clickable?"pointer":"default","&:hover":{textDecoration:e.clickable?"underline":"none"}})),w=x.qy.div(h()),N=x.qy.div(p()),I=x.qy.div(g()),k=e=>{let{onClick:t,selected:n,style:l,children:r}=e;return(0,a.jsxs)(S,{selected:n,onClick:t,selectable:null!=t,style:l,children:[(0,a.jsx)(c.EY,{className:"overflow-ellipsis overflow-hidden",children:r}),null!=t&&(0,a.jsx)(s.In,{icon:u.c_$})]})},C=(0,x.DR)(m._m)(v()),S=(0,x.Wp)("li")(e=>["flex items-center justify-between p-2",e.selectable?"cursor-pointer hover:bg-gray-200":"cursor-default",e.selected&&e.selectable?"bg-gray-200":"bg-transparent"]),T=(0,x.Wp)("div")(e=>["flex items-center justify-between p-2 rounded-none w-auto cursor-pointer",e.selected?"bg-gray-200 text-foreground":"bg-transparent text-gray-500","hover:bg-gray-200 opacity-100"],{height:41})},82048:(e,t,n)=>{n.d(t,{n:()=>x});var l=n(86739),a=n(50979),s=n(25963),r=n(2551),i=n(13077),o=n(95662),c=n(42419),d=n(36609);function u(){let e=(0,l._)(["\n  w-full focus:outline-none focus-visible:opacity-60 hover:opacity-60\n"]);return u=function(){return e},e}let m=0,x=e=>{let{title:t,flipped:n,defaultOpen:l,isOpen:u,onChange:x,children:p,coloredIcon:g,...v}=e,[j,y]=(0,s.useState)(l),f=(0,s.useMemo)(()=>"accordion-".concat(m++),[]);return u=null!=u?u:j,(0,a.jsxs)("div",{...v,children:[(0,a.jsx)(h,{type:"button","aria-controls":f,"aria-expanded":!!u&&"true",onClick:()=>{y(!u),x&&x(!u)},children:(0,a.jsxs)(o.z,{className:"w-full h-11",align:"center",children:[n&&(0,a.jsx)(i.In,{icon:u?r.Hsy:r.FWt,className:(0,d.xW)(g&&"fill-current text-pink-600",n&&"mr-2")}),(0,a.jsx)(c.EY,{className:(0,d.xW)("text-md text-left",n&&"font-medium",u&&"font-semibold"),children:t}),!n&&(0,a.jsx)(i.In,{icon:u?r.Hsy:r.FWt,className:g?"fill-current text-pink-600":""})]})}),(0,a.jsx)("div",{className:"py-2 w-auto",id:f,hidden:!u,children:p})]})},h=d.qy.button(u())},89633:(e,t,n)=>{n.d(t,{E:()=>S,I:()=>D});var l=n(86739),a=n(50979),s=n(2551),r=n(25963),i=n(36609),o=n(94662),c=n(31754),d=n(19391),u=n(86954),m=n(8718),x=n(50253),h=n.n(x),p=n(75749),g=n(47654),v=n(13077),j=n(70375),y=n(80374),f=n(45479),b=n(30595),w=n(94702),N=n(81154),I=n(15857),k=n(36725);function C(){let e=(0,l._)(["text-xs font-medium text-gray-600 mb-2"]);return C=function(){return e},e}let S={start:null,end:null},T=[{label:"15 mins",value:"15 minutes ago"},{label:"1 hour",value:"1 hour ago"},{label:"3 hours",value:"3 hours ago"},{label:"1 day",value:"1 day ago"},{label:"3 days",value:"3 days ago"},{label:"1 week",value:"1 week ago"},{label:"3 weeks",value:"3 weeks ago"},{label:"1 month",value:"1 month ago"},{label:"2 months",value:"2 month ago"},{label:"3 months",value:"3 months ago"}],D=e=>{var t;let{contextStart:n,contextEnd:l,activeDateRange:o,dateRange:c,setDateRange:x,setActiveDateRange:g,retentionDays:v}=e,[j,y]=(0,r.useState)(!1),[f,b]=(0,r.useState)(!1),[N,I]=(0,r.useState)(null);(0,r.useEffect)(()=>{var e,t,n,l;((null==(e=o.start)?void 0:e.getTime())!==(null==(t=c.start)?void 0:t.getTime())||(null==(n=o.end)?void 0:n.getTime())!==(null==(l=c.end)?void 0:l.getTime()))&&I(null)},[o]);let C="";null!=o.start&&null!=o.end?C="".concat((0,k.k)(o.start)," - ").concat((0,k.k)(o.end)):null!=o.start&&null==o.end?C="".concat((0,w.xg)(o.start)," ago"):((null==(t=o.start)?void 0:t.getTime())===0||null==o.start)&&null==o.end&&(C="All time");let S=(0,r.useMemo)(()=>n?l?(0,w.Kg)(n)+" - "+(0,w.Kg)(l):(0,w.Kg)(n):null!=N?N:C,[o,N,n]),[D,P]=(0,r.useState)(null),[z,O]=(0,r.useState)(null);((e,t)=>{(0,r.useEffect)(()=>{function n(n){e.some(e=>null==e?void 0:e.contains(n.target))||t()}return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},e)})([z,D],()=>{y(!1)}),(0,r.useEffect)(()=>{if(null!=D)return(0,m.Ay)(D,{Escape:()=>{y(!1)},Enter:e=>{e.preventDefault(),e.stopPropagation(),y(!1);let t=R(null!=N?N:"");null!=t&&(x(t),g(t))}})},[D,x,g,y,N]);let{positionStyles:U}=(0,r.useMemo)(()=>{let e=null==D?void 0:D.getBoundingClientRect();if(null==e)return{};let t=Math.min(600,window.innerHeight-e.bottom-30);return{positionStyles:{top:"".concat(e.bottom,"px"),left:"".concat(e.left,"px"),width:"".concat(e.width,"px"),maxHeight:"".concat(t,"px")}}},[D,j]),F=e=>{null==D||D.focus(),b(!1),y(!1),I(e);let t=R(e);null!=t&&(x(t),g(t))},V=(0,r.useMemo)(()=>L(v,N?R(N):o),[v,N,o]),{validTimeOptions:B}=(0,r.useMemo)(()=>{let e=[],t=[];for(let n of T)L(v,R(n.value))?t.push(n):e.push(n);return{validTimeOptions:e,upgradeTimeOptions:t}},[v]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.pd,{ref:P,error:!n&&f,warning:!n&&V,autoComplete:"off",icon:n?s.B1E:s.zD7,size:"sm",className:"min-w-[300px] tabular-nums",value:S,label:{text:"Date range",hidden:!0},onChange:e=>(e=>{b(!1),I(e);let t=R(e);if(null==t)return void b(!0);x(t)})(e.target.value),onMouseDown:()=>{y(e=>!e)}}),j&&(0,a.jsx)(d.b,{"aria-hidden":!0,children:(0,a.jsx)("div",{ref:O,style:U,className:(0,i.xW)("fixed z-20 mt-0.5","bg-background shadow-md dark:bg-gray-100 rounded border border-gray-200 overflow-hidden"),children:(0,a.jsxs)("div",{className:"p-4",children:[f&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-xs text-red-600",children:"Range input is invalid"}),(0,a.jsx)(p.c,{className:"!my-5 dark:border-gray-200"})]}),(0,a.jsx)(E,{children:"Relative Time"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2 w-full",children:B.map(e=>(0,a.jsx)(A,{label:e.label,value:e.value,onChange:F},e.label))}),(0,a.jsx)(p.c,{className:"!my-5 dark:border-gray-200"}),(0,a.jsx)(E,{children:"Time Range"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2 w-full tabular-nums",children:["".concat(h()().subtract(2,"day").format("MMM DD")," - ").concat(h()().subtract(1,"day").format("MMM DD")),"2h ago - 1h ago","yesterday 12am - today 12am"].map(e=>(0,a.jsx)(A,{label:e,value:e,onChange:F},e))}),(0,a.jsx)(M,{retentionDays:v,isPastRetention:V})]})})})]})},A=e=>{let{disabled:t,label:n,value:l,onChange:s,color:r="gray"}=e;return(0,a.jsx)(c.$n,{disabled:t,variant:"outline",size:"xs",color:r,className:"font-mono dark:hover:border-gray-300",onClick:()=>null==s?void 0:s(l),children:n})},E=i.qy.h2(C()),R=e=>{if(""===e||e.match(/all time/i))return{start:new Date(0),end:null};let t=e=>{var t,n,l;let a=e.split("-"),s=null==(t=a[0])?void 0:t.trim(),r=null!=(l=null==(n=a[1])?void 0:n.trim())?l:null,i=o._U(null!=s?s:""),c=!r||/live/i.test(r)?null:o._U(null!=r?r:"");return s&&!i||r&&!c?null:{start:i,end:c}},n=t(e);return n?n:t(e.replace(/(\d+)\s*(m)(?!o)/gi,"$1 minutes ago").replace(/(\d+)\s*h/gi,"$1 hours ago").replace(/(\d+)\s*d/gi,"$1 days ago").replace(/(\d+)\s*w/gi,"$1 weeks ago").replace(/(\d+)\s*mo/gi,"$1 months ago").replace(/(\d+)\s*y/gi,"$1 years ago"))},L=(e,t)=>null!=e&&(null==t?void 0:t.start)!=null&&t.start<h()().subtract((e+.5)*24,"hour").toDate(),M=e=>{let{retentionDays:t,isPastRetention:n}=e,{routes:l}=(0,j.c)(),r=(0,N.md)(I.T6),[o,d]=(0,b.A)("@railway/logs/dismissed-retention-banner",{defaultValue:!1});return o||null==t?null:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.c,{className:"!my-5 dark:border-gray-200"}),(0,a.jsxs)(g.N,{href:(null==r?void 0:r.subscriptionType)===f.dh$.Pro?l.demo({}).url:l.workspacePlan({}).url,className:"group flex items-center text-xs w-full text-gray-600 hover:text-pink-600 py-4 -my-4",children:[(0,a.jsx)("div",{className:(0,i.xW)(n&&"text-yellow-600"),children:(null==r?void 0:r.subscriptionType)===f.dh$.Pro?"Need more than ".concat((0,y.k)("day",t),"?"):"Look back more than ".concat((0,y.k)("day",t))}),(0,a.jsx)(c.$n,{as:"div",size:"2xs",variant:"outline",className:"ml-auto",color:n?"yellow":"pink",children:(null==r?void 0:r.subscriptionType)===f.dh$.Pro?"Reach Out":"PRO"}),(0,a.jsx)("button",{className:"transition-all w-0 group-hover:w-6 overflow-hidden",onClick:e=>{e.preventDefault(),d(!0)},children:(0,a.jsx)(v.In,{icon:s.X,size:"sm",title:"Dismiss",className:"text-gray-400 hover:text-gray-600 ml-auto"})})]})]})}},93874:(e,t,n)=>{n.d(t,{PP:()=>c,Qf:()=>o,tN:()=>x,yZ:()=>m});var l=n(3149),a=n(67214),s=n(859);let r={dark:!0,background:"hsl(250, 21%, 11%)",foreground:"#787c99",selection:"#515c7e40",cursor:"#c0caf5",dropdownBackground:"#1a1b26",dropdownBorder:"#787c99",activeLine:"transparent",lineNumber:"#363b54",lineNumberActive:"#737aa2",matchingBracket:"#16161e",keyword:"#bb9af7",variable:"#c0caf5",function:"#7aa2f7",string:"#9ece6a",constant:"#bb9af7",type:"#0db9d7",class:"#c0caf5",number:"#ff9e64",comment:"#444b6a",heading:"#89ddff",invalid:"#ff5370",regexp:"#b4f9f8"},i=l.Lz.theme({"&":{color:r.foreground,backgroundColor:r.background},".cm-content":{caretColor:r.cursor,paddingBottom:"0px !important"},".cm-cursor, .cm-dropCursor":{borderLeftColor:r.cursor},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:r.selection},".cm-panels":{backgroundColor:r.dropdownBackground,color:r.foreground},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:r.dropdownBackground,outline:"1px solid ".concat(r.dropdownBorder)},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:r.selection},".cm-activeLine":{backgroundColor:r.activeLine},".cm-selectionMatch":{backgroundColor:r.selection},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:r.matchingBracket,outline:"none"},".cm-gutters":{backgroundColor:r.background,color:r.foreground,border:"none"},".cm-activeLineGutter":{backgroundColor:r.background},".cm-lineNumbers .cm-gutterElement":{color:r.lineNumber},".cm-lineNumbers .cm-activeLineGutter":{color:r.lineNumberActive},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:r.foreground},".cm-tooltip":{border:"1px solid ".concat(r.dropdownBorder),backgroundColor:r.dropdownBackground,color:r.foreground},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:r.foreground,borderBottomColor:r.foreground},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{background:r.selection,color:r.foreground}}},{dark:r.dark}),o=a.cr.define([{tag:s._A.keyword,color:r.keyword},{tag:[s._A.name,s._A.deleted,s._A.character,s._A.macroName],color:r.variable},{tag:[s._A.propertyName],color:r.function},{tag:[s._A.processingInstruction,s._A.string,s._A.inserted,s._A.special(s._A.string)],color:r.string},{tag:[s._A.function(s._A.variableName),s._A.labelName],color:r.function},{tag:[s._A.color,s._A.constant(s._A.name),s._A.standard(s._A.name)],color:r.constant},{tag:[s._A.definition(s._A.name),s._A.separator],color:r.variable},{tag:[s._A.className],color:r.class},{tag:[s._A.number,s._A.changed,s._A.annotation,s._A.modifier,s._A.self,s._A.namespace],color:r.number},{tag:[s._A.typeName],color:r.type,fontStyle:r.type},{tag:[s._A.operator,s._A.operatorKeyword],color:r.keyword},{tag:[s._A.url,s._A.escape,s._A.regexp,s._A.link],color:r.regexp},{tag:[s._A.meta,s._A.comment],color:r.comment},{tag:s._A.strong,fontWeight:"bold"},{tag:s._A.emphasis,fontStyle:"italic"},{tag:s._A.link,textDecoration:"underline"},{tag:s._A.heading,fontWeight:"bold",color:r.heading},{tag:[s._A.atom,s._A.bool,s._A.special(s._A.variableName)],color:r.variable},{tag:s._A.invalid,color:r.invalid},{tag:s._A.strikethrough,textDecoration:"line-through"}]),c=[i,(0,a.y9)(o)],d={dark:!1,background:"#ffffff",foreground:"#343b58",selection:"#acb0bf40",cursor:"#363c4d",dropdownBackground:"#e6e7ed",dropdownBorder:"#c1c2c7",activeLine:"transparent",lineNumber:"#9da0ab",lineNumberActive:"#363c4d",matchingBracket:"#cdced1",keyword:"#65359d",variable:"#343b58",function:"#2959aa",string:"#385f0d",constant:"#965027",type:"#006c86",class:"#343b58",number:"#965027",comment:"#888b94",heading:"#363c4d",invalid:"#942f2f",regexp:"#3e6968"},u=l.Lz.theme({"&":{color:d.foreground,backgroundColor:d.background},".cm-content":{caretColor:d.cursor,paddingBottom:"0px !important"},".cm-cursor, .cm-dropCursor":{borderLeftColor:d.cursor},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:d.selection},".cm-panels":{backgroundColor:d.dropdownBackground,color:d.foreground},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:d.dropdownBackground,outline:"1px solid ".concat(d.dropdownBorder)},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:d.selection},".cm-activeLine":{backgroundColor:d.activeLine},".cm-selectionMatch":{backgroundColor:d.selection},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:d.matchingBracket,outline:"none"},".cm-gutters":{backgroundColor:d.background,color:d.foreground,border:"none"},".cm-activeLineGutter":{backgroundColor:d.background},".cm-lineNumbers .cm-gutterElement":{color:d.lineNumber},".cm-lineNumbers .cm-activeLineGutter":{color:d.lineNumberActive},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:d.foreground},".cm-tooltip":{border:"1px solid ".concat(d.dropdownBorder),backgroundColor:d.dropdownBackground,color:d.foreground},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:d.foreground,borderBottomColor:d.foreground},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{background:d.selection,color:d.foreground}}},{dark:d.dark}),m=a.cr.define([{tag:s._A.keyword,color:d.keyword},{tag:[s._A.name,s._A.deleted,s._A.character,s._A.macroName],color:d.variable},{tag:[s._A.propertyName],color:d.function},{tag:[s._A.processingInstruction,s._A.string,s._A.inserted,s._A.special(s._A.string)],color:d.string},{tag:[s._A.function(s._A.variableName),s._A.labelName],color:d.function},{tag:[s._A.color,s._A.constant(s._A.name),s._A.standard(s._A.name)],color:d.constant},{tag:[s._A.definition(s._A.name),s._A.separator],color:d.variable},{tag:[s._A.className],color:d.class},{tag:[s._A.number,s._A.changed,s._A.annotation,s._A.modifier,s._A.self,s._A.namespace],color:d.number},{tag:[s._A.typeName],color:d.type},{tag:[s._A.operator,s._A.operatorKeyword],color:d.keyword},{tag:[s._A.url,s._A.escape,s._A.regexp,s._A.link],color:d.regexp},{tag:[s._A.meta,s._A.comment],color:d.comment},{tag:s._A.strong,fontWeight:"bold"},{tag:s._A.emphasis,fontStyle:"italic"},{tag:s._A.link,textDecoration:"underline"},{tag:s._A.heading,fontWeight:"bold",color:d.heading},{tag:[s._A.atom,s._A.bool,s._A.special(s._A.variableName)],color:d.variable},{tag:s._A.invalid,color:d.invalid},{tag:s._A.strikethrough,textDecoration:"line-through"}]),x=[u,(0,a.y9)(m)]},95907:(e,t,n)=>{n.d(t,{$:()=>p});var l=n(50979),a=n(25963),s=n(55850),r=n(97865),i=n(66800),o=n.n(i),c=n(31754),d=n(67970),u=n(89088),m=n(42419),x=n(49863),h=n(80374);let p=e=>{var t,n,i;let{environmentId:p,serviceId:g,pluginId:v}=e,[j,y]=(0,a.useState)(!1),[f,b]=(0,a.useState)(!1),{result:w,invalidateQuery:N}=(e=>{let{environmentId:t,serviceId:n,pluginId:l,fetchInactive:a,enabled:i}=e,{graphqlClient:c}=(0,s.q)(),d=["admin-svc-container-info",t,null!=n?n:l,a];return(0,r.W)(d,async()=>{if(null!=n)return(await c.adminAllContainerInfoForServiceInEnvironment({environmentId:t,serviceId:n,fetchInactive:a})).adminAllContainerInfoForServiceInEnvironment;if(null!=l)return(await c.adminAllContainerInfoForPluginInEnvironment({environmentId:t,pluginId:l})).adminAllContainerInfoForPluginInEnvironment;throw Error("Must provide either serviceId or pluginId")},{enabled:i,staleTime:o()("5m"),retry:!1})})({environmentId:p,serviceId:g,pluginId:v,enabled:j,fetchInactive:f}),I=null!=(n=w.data)?n:[];return(0,l.jsxs)("div",{className:"w-full",children:[(0,l.jsxs)("div",{className:"flex gap-2 items-center justify-between",children:[(0,l.jsx)(c.$n,{size:"sm",isLoading:w.isFetching,onClick:()=>{j?N():y(!0)},children:"Load Containers"}),(0,l.jsx)(m.xC,{children:null!=w.data?"Found ".concat(I.length," ").concat((0,h.td)("container",I.length)):"No containers loaded"}),(0,l.jsx)(u.N,{id:"fetchInactive",size:"sm",checked:f,onCheckedChange:e=>{b(e)},className:"w-auto",children:(0,l.jsxs)("div",{className:"grid",children:[(0,l.jsx)("p",{children:"Inactive deployments"}),(0,l.jsxs)("p",{className:"text-xs text-gray-500",children:["Fetch containers for the last 7 days of ",(0,l.jsx)("b",{children:"all"})," deployments"]})]})})]}),(0,l.jsx)("div",{className:"grid gap-4",children:null!=w.data?(0,l.jsx)(l.Fragment,{children:I.toSorted((e,t)=>e.host.localeCompare(t.host)||e.id.localeCompare(t.id)).map(e=>(0,l.jsx)(x.BN,{container:e},e.id))}):w.isLoading?(0,l.jsx)(d.m6,{}):w.isError?(0,l.jsx)(m.yn,{children:null!=(i=null==(t=w.error)?void 0:t.message)?i:"Unable to load containers"}):(0,l.jsx)(l.Fragment,{children:" "})})]})}},96429:(e,t,n)=>{n.d(t,{_:()=>R});var l=n(50979),a=n(81154),s=n(25963),r=n(93208),i=n(70375),o=n(2551),c=n(77505),d=n(47188),u=n(36609),m=n(40148),x=n(31754),h=n(17057),p=n(95662),g=n(42419),v=n(45047),j=n(59613),y=n(42113),f=n(61259),b=n(67906),w=n(88887),N=n(70740),I=n(27644);let k=e=>{var t;let{value:n,onEdit:a,onCancelEdit:r,autocompleteOptions:i}=e,d=(0,s.useRef)(null),u=(0,s.useRef)(!1),{modalActions:m}=(0,c.U)(),{handleSubmit:h,watch:g,formState:v,setValue:k,register:C,reset:S}=(0,y.mN)({defaultValues:{value:n}}),T=g("value"),D=async()=>{S(),r()},A=async e=>{let{value:t}=e;try{await a(t)}catch(e){m.createToast((0,l.jsx)(w.y8,{variant:"error",title:"Failed to save variable"}))}},E=(0,s.useMemo)(()=>(0,j.findReferences)(T),[T]),{ref:R,...L}=C("value",{validate:N.G}),M=(0,s.useCallback)(e=>{if(R(e),e&&!u.current){e.focus();let t=e.value;e.setSelectionRange(t.length,t.length),u.current=!0}},[R]);return(0,l.jsxs)(f.lV,{ref:d,name:"Edit Variable",trackingProperties:{containsSharedReference:E.some(e=>e.includes(".")),containsLocalReference:E.some(e=>!e.includes("."))},onCancel:D,onSubmit:h(A),enableBindings:!0,className:"flex items-center w-full",children:[(0,l.jsx)(I.T,{ref:M,...L,error:null==(t=v.errors.value)?void 0:t.message,autocompleteOptions:null!=i?i:[],value:T,onChange:e=>{k("value",e)},onSubmit:()=>{var e;null==(e=d.current)||e.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))}}),(0,l.jsx)(b.h,{x:2}),(0,l.jsxs)(p.z,{align:"center",children:[(0,l.jsx)(x.K0,{icon:o.X,title:"Cancel",type:"button",onClick:D}),(0,l.jsx)(x.K0,{icon:o.Jlk,title:"Submit"})]})]})};var C=n(47655),S=n(86954),T=n(90029);let D=["${{ secret() }}","${{ secret(10) }}",'${{ secret(8, "alphabet") }}'],A=e=>{let{existingGenerator:t,onUpdateGenerator:n}=e,{id:a}=(0,T.eR)(),{modalActions:r}=(0,c.U)(),i=()=>r.exitModal(a),[d,m]=(0,s.useState)(null!=t?t:""),h=(0,s.useMemo)(()=>(0,j.collapseFunctions)(d),[d]);return(0,l.jsxs)(T.aF,{title:"Set up your project locally",modalStyles:(0,u.xW)(),children:[(0,l.jsxs)(p.z,{align:"start",justify:"between",className:"w-full mb-6",children:[(0,l.jsxs)(p.T,{space:2,children:[(0,l.jsx)(T.wt,{children:"Variable Generator"}),(0,l.jsx)(T.xW,{className:"text-gray-500",children:"Control how this variable behaves when creating new environments"})]}),(0,l.jsx)(x.K0,{icon:o.X,title:"Close",onClick:i})]}),(0,l.jsxs)(f.lV,{enableBindings:!0,className:"grid gap-4",onSubmit:()=>{n(""===d.trim()?null:d),i()},children:[(0,l.jsxs)(p.T,{space:3,children:[(0,l.jsx)(S.pd,{value:d,onChange:e=>m(e.target.value),label:{text:"Generator function",hidden:!0},placeholder:"${{ secret(32) }}"}),""!==h&&(0,l.jsxs)(g.ax,{className:"break-all",children:["Generated value: ",(0,l.jsx)("span",{className:"font-mono",children:h})]})]}),(0,l.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,l.jsx)(g.ax,{className:"font-semibold mb-3",children:"How this works"}),(0,l.jsx)(g.xC,{className:"mb-4",children:"By default, variable values are copied when a new environment is created based off this one. You can change this behavior by providing a generator function."}),(0,l.jsx)(g.ax,{className:"font-semibold mb-3",children:"Examples"}),(0,l.jsx)("ul",{className:"flex flex-wrap gap-2",children:D.map((e,t)=>(0,l.jsx)("li",{className:"font-mono text-xs whitespace-nowrap bg-gray-100 px-2 py-1 rounded",children:(0,l.jsx)("button",{type:"button",onClick:()=>m(e),children:e})},t))})]}),(0,l.jsx)(p.z,{className:"flex items-center justify-end",children:(0,l.jsx)(x.$n,{className:"max-w-max",name:"Save Variable Generator",children:"Save"})})]})]})};var E=n(18407);let R=e=>{let{name:t,value:n,renderedValue:j,componentLeft:y,className:f,onEdit:b,onDelete:w,onAdd:N,onShare:I,isShared:S,isStaged:T,onPromoteToShared:D,skipConfirmation:R,componentAfterValue:L,autocompleteOptions:M,generator:P,onGeneratorUpdate:z,onSeal:O,isSealed:U,publicEndpointReferences:F,serviceId:V,serviceIdsAndNames:B,editWarning:_,...q}=e,[W,K]=(0,s.useState)(!1),{isConfirmed:Y}=(0,r.S)(),{modalActions:Q}=(0,c.U)(),{isTemplateCreatePage:$}=(0,i.c)(),G=(0,a.md)(d.DM),J=async e=>{if("function"!=typeof b)throw Error("onEdit not passed to GenericVariableRow");K(!1),await b({name:t,value:e})},X=async()=>{(null!=n||U)&&(!_||await Y({title:_.title,message:_.description,confirmLabel:"Continue",theme:"danger"}))&&K(!0)},H=D?async()=>{await Y({confirmLabel:"Promote",message:(0,l.jsxs)(l.Fragment,{children:["Are you sure you want to promote ",(0,l.jsx)(g.R0,{children:t}),"? This will convert it to a shared variable that can be referenced by multiple services."]}),theme:"info",title:"Promote to Shared Variable"})&&await D({name:t})}:null,Z=w?async()=>{(R||await Y({confirmLabel:"Delete",message:(0,l.jsxs)(l.Fragment,{children:["Are you sure you want to delete ",(0,l.jsx)(g.R0,{children:t}),"? Once deleted, it will be gone forever."]}),title:"Delete Variable"}))&&await w({name:t})}:null,ee=O?async()=>{await Y({confirmLabel:"Seal variable",message:(0,l.jsx)(v.vZ,{}),theme:"info",title:"Seal Variable"})&&await O({name:t})}:null,et=!W&&(G.Write||$);return(0,l.jsxs)(E.Ff,{className:(0,u.xW)("variable-row group",T&&"bg-pink-50 text-pink-600",f),hideActions:!et,...q,children:[(0,l.jsxs)(p.z,{space:4,align:"center",className:"text-sm",children:[y,(0,l.jsx)("span",{title:t,className:(0,u.xW)("truncate","added"===N&&"text-gray-500"),children:t})]}),(0,l.jsx)("div",{children:W&&(null!=n||U)?(0,l.jsx)(k,{value:null!=n?n:"",onEdit:J,onCancelEdit:()=>K(!1),autocompleteOptions:M},"edit-".concat(t)):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(C.r,{variableName:t,value:n,renderedValue:j,isSealed:U,publicEndpointReferences:F,serviceId:V,serviceIdsAndNames:B,permissions:G}),T&&_&&(0,l.jsx)("div",{className:"mt-1 text-xs text-pink-600",children:_.title}),(0,l.jsx)("div",{className:"w-full ml-3",children:L})]})}),et&&(0,l.jsxs)(p.z,{align:"center",justify:"end",children:["added"===N&&(0,l.jsx)(x.$n,{disabled:!0,size:"xs",variant:"outline",color:"gray",children:"ADDED"}),"function"==typeof N&&(0,l.jsx)(x.$n,{size:"xs",variant:"outline",onClick:()=>N({name:t}),className:"opacity-0 group-hover:opacity-100",children:"ADD"}),(b||Z||H||I)&&(0,l.jsxs)(p.z,{align:"center",space:2,className:"actions",children:[I&&(0,l.jsx)(x.$n,{variant:"outline",size:"xs",onClick:()=>I({name:t}),className:(0,u.xW)("opacity-0 group-hover:opacity-100",!S&&"opacity-100"),children:"SHARE"}),(0,l.jsxs)(h.ms,{children:[(0,l.jsx)(h.Lk,{icon:o.GvN,title:"Variable actions",className:"p-1 pr-0 text-gray-600"}),(0,l.jsxs)(h.pm,{align:"end",children:[b&&(0,l.jsx)(h.tJ,{onSelect:X,icon:o.ffu,className:"edit-variable",children:"Edit"}),ee&&(0,l.jsxs)(h.tJ,{onSelect:ee,icon:o.X_F,children:["Seal ",(0,l.jsx)(m.qR,{className:"ml-1"})]}),H&&(0,l.jsx)(h.tJ,{onSelect:H,icon:o.qzq,children:"Promote"}),z&&(0,l.jsx)(h.tJ,{onSelect:()=>Q.openModal((0,l.jsx)(A,{existingGenerator:P,onUpdateGenerator:z})),icon:o.G9Y,children:"Generator"}),Z&&(0,l.jsx)(h.tJ,{onSelect:Z,variant:"danger",icon:o.TBR,children:"Delete"})]})]})]})]})]})}}}]);