"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6424],{5041:(e,t,n)=>{n.d(t,{$:()=>u});var l=n(50979),a=n(25963),r=n(28592),s=n(2551),i=n(36609),o=n(31754),d=n(13077),c=n(95662);let u=e=>{let{hideCopyButton:t,textToCopy:n,copyButtonStyles:u,children:m,...p}=e,x=(0,a.useMemo)(()=>{var e;return null!=(e=null==m?void 0:m.toString())?e:""},[m]),[g,h]=(0,r.T)();return(0,l.jsxs)("pre",{...p,className:(0,i.xW)("grid gap-1 grid-cols-[minmax(0px,_1fr)_auto] items-center","relative min-h-[44px] my-0 py-2 px-3 text-sm font-mono rounded-lg leading-6 bg-gray-100 border border-gray-100",p.className),children:[(0,l.jsx)("span",{className:"overflow-hidden overflow-ellipsis",children:m}),!t&&(0,l.jsx)("div",{children:g?(0,l.jsx)(c.T,{align:"center",justify:"center",className:"h-sm py-1.5",children:(0,l.jsx)(d.In,{icon:s.Jlk,size:"sm",initial:{y:6},animate:{y:0}})}):(0,l.jsx)(o.K0,{icon:s.QRo,title:"Copy Code",iconStyles:u,onClick:()=>{null!=x&&h("string"==typeof n?n:x)},type:"button",className:(0,i.xW)("copy-button","m-0 p-0 text-foreground transition-opacity duration-150","hover:bg-gray-200")})})]})}},7021:(e,t,n)=>{n.d(t,{Ap:()=>u,CS:()=>x,PI:()=>p,gP:()=>c,oI:()=>m});var l=n(53036),a=n(81154),r=n(84044),s=n(44039),i=n(12645),o=n(15857),d=n(55850);function c(){var e,t,n,r;let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,a.md)(o.T6),c=null!=(t=null==i?void 0:i.id)?t:"",u=x(c),{graphqlClient:m}=(0,d.q)(),p=!!c&&!!(null==i||null==(e=i.volumes)?void 0:e.length);return(0,l.I)({queryKey:u,queryFn:async()=>(await m.projectVolumeMigrations({id:c})).project.recentVolumeMigrations,...s,enabled:null!=(n=s.enabled)?n:p,staleTime:null!=(r=s.staleTime)?r:5e3})}function u(e){var t,n;let{removeDismissed:l=!1,refetchOnMount:r,refetchOnWindowFocus:o,staleTime:d,enabled:u}=e,m=(0,a.md)(i.Zy),x=null!=(n=null==m?void 0:m.id)?n:"",g=(0,a.md)(p(x)),h=c({refetchOnMount:r,refetchOnWindowFocus:o,staleTime:d,enabled:u}),v=(0,a.md)((0,s.pG)(null!=x?x:"")),y=null==(t=h.data)?void 0:t.filter(e=>{var t;return"migrate"===e.reason&&!e.acknowledgedAt&&e.destVolumeInstance.environmentId===x&&(null==(t=v.services)?void 0:t[e.sourceServiceId])}).sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()).filter((e,t,n)=>t===n.findIndex(t=>t.sourceServiceId===e.sourceServiceId&&t.destVolumeInstance.serviceId===e.destVolumeInstance.serviceId&&"migrate"===t.reason)).filter(e=>!l||!g.includes(e.sourceServiceId));return{...h,data:y}}function m(e){var t,n;let{serviceId:l,refetchOnMount:r,refetchOnWindowFocus:o,staleTime:d,enabled:u}=e,m=(0,a.md)(i.Zy),p=c({refetchOnMount:r,refetchOnWindowFocus:o,staleTime:d,enabled:u}),x=(0,a.md)((0,s.pG)(null!=(n=null==m?void 0:m.id)?n:"")),g=null==(t=p.data)?void 0:t.filter(e=>e.sourceServiceId===l&&e.destVolumeInstance.environmentId===(null==m?void 0:m.id)&&(e.destVolumeInstance.serviceId===l||null===e.destVolumeInstance.serviceId)).filter(e=>{var t;return null==(t=x.services)?void 0:t[e.sourceServiceId]});return{...p,data:g}}let p=(0,r.Iz)(e=>(0,r.tG)("@railway/automatedVolumeMigrations/dismissed/".concat(e),[]));function x(e){return[...(0,o.NU)(e),"recentVolumeMigrations"]}},8935:(e,t,n)=>{n(50979),n(3732),n(40137),n(70375),n(2551),n(45588),n(15857),n(82660),n(31754),n(47654),n(42419),n(73648)},10046:(e,t,n)=>{n.d(t,{f:()=>g});var l=n(50979),a=n(14034),r=n(67590),s=n.n(r),i=n(2551),o=n(36609);function d(e){if(!e.length)return"";let t=Object.keys(e[0]);return[t.map(c).join(","),...e.map(e=>t.map(t=>c(e[t])).join(","))].join("\r\n")}function c(e){if(null==e)return"";"object"==typeof e&&(e=JSON.stringify(e));let t=String(e);return t.includes('"')||t.includes(",")||t.includes("\r")||t.includes("\n")?'"'.concat(t.replace(/"/g,'""'),'"'):t}function u(e,t){let n=new Blob([e],{type:{csv:"text/csv",json:"application/json",txt:"text/plain",xml:"application/xml",html:"text/html"}[t.format]}),l=URL.createObjectURL(n),a=document.createElement("a");a.href=l,a.download=t.appendDate?function(e){let t=e.split("."),n=new Date().getTime()+"";return t.splice(t.length-1,0,n),t.join(".")}(t.filename):t.filename,a.click(),URL.revokeObjectURL(l)}var m=n(31754),p=n(75749),x=n(17057);function g(e){let{logs:t,toJSON:n=y,toPlainText:r=v,className:c}=e,g="text-neutral focus:text-neutral dark:focus:text-neutral focus:bg-neutral-surface-hover font-medium text-sm rounded";return(0,l.jsxs)(x.ms,{children:[(0,l.jsx)(a.ty,{asChild:!0,children:(0,l.jsx)(m.K0,{icon:i.f5X,color:"gray",size:"xs",variant:"outline",className:(0,o.xW)("p-4 bg-background",c),title:"Options"})}),(0,l.jsxs)(x.pm,{align:"end",className:"min-w-0 w-48 p-1",onCloseAutoFocus:e=>e.preventDefault(),children:[(0,l.jsx)(x.o_,{children:"Download logs as..."}),(0,l.jsx)(x.tJ,{className:g,onSelect:()=>{u(t.map(r).join("\n"),{filename:"logs.log",format:"txt",appendDate:!0})},children:"Plain text"}),(0,l.jsx)(x.tJ,{className:g,onSelect:()=>{u(JSON.stringify(t.map(n)),{filename:"logs.json",format:"json",appendDate:!0})},children:"JSON"}),(0,l.jsx)(x.tJ,{className:g,onSelect:()=>{u(d(t.map(n)),{filename:"logs.csv",format:"csv",appendDate:!0})},children:"CSV"}),(0,l.jsx)(p.c,{}),(0,l.jsx)(x.o_,{children:"Copy logs as..."}),(0,l.jsx)(x.tJ,{className:g,onSelect:()=>{let e=t.map(r).join("\n");s()(e)},children:"Plain text"}),(0,l.jsx)(x.tJ,{className:g,onSelect:()=>{let e=t.map(n);s()(JSON.stringify(e))},children:"JSON"}),(0,l.jsx)(x.tJ,{className:g,onSelect:()=>{let e=d(t.map(n));s()(e)},children:"CSV"})]})]})}let h={debug:"dbg",info:"inf",warn:"wrn",error:"err"};function v(e){var t;if("string"!=typeof e.message)return JSON.stringify(e);let n=e.message||"",l=e.timestamp,a="string"==typeof e.severity?"[".concat(null!=(t=h[e.severity])?t:e.severity.slice(0,3),"] "):"";return"".concat(l," ").concat(a," ").concat(n)}function y(e){if("string"!=typeof e.message)return e;let{message:t,timestamp:n}=e;return{timestamp:n,message:t}}},28476:(e,t,n)=>{n.d(t,{f:()=>i});var l=n(50979),a=n(71144),r=n(46650),s=n(36609);n(25963);let i=e=>{let{activeTab:t,tabs:n}=e,{track:i}=(0,a.j)();return(0,l.jsx)(r.B8,{className:(0,s.xW)(4===n.length&&"md:grid-cols-[auto_auto_auto_auto_1fr]",3===n.length&&"md:grid-cols-[auto_auto_auto_1fr]",2===n.length&&"md:grid-cols-[auto_auto_1fr]",1===n.length&&"md:grid-cols-[auto_1fr]","md:grid gap-4 py-4","sticky top-0 bg-background dark:bg-secondaryBg px-5 md:px-12 border-b border-gray-200 w-auto z-10"),children:n.map(e=>(0,l.jsxs)(o,{value:e.value,active:t===e.value,isHidden:e.hidden,onMouseUpCapture:()=>{i({action:"Click",object:"Show ".concat(e.label," Logs Button")}),window.location.hash=e.value},children:[e.label," ",e.appendLogs&&(0,l.jsx)("span",{className:"hidden md:inline",children:" Logs"})]},e.value))})},o=(0,s.DR)(r.l9)(e=>{let{active:t,isHidden:n}=e;return["h-sm py-1.5 px-3 rounded-md text-sm leading-5 space-x-2 font-medium cursor-pointer transition-colors","hover:bg-gray-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-pink-500",t&&"!bg-gray-100",n&&"invisible"]})},29455:(e,t,n)=>{n.d(t,{w:()=>c});var l=n(50979),a=n(50596),r=n(25963),s=n(31754),i=n(4409),o=n(2551),d=n(36609);let c={Root:function(e){let{children:t,closable:n=!0,isResizable:c=!1,maxWidth:u,onAfterClose:m,onOpenChange:p,open:x,portalContainer:g,hideCloseButton:h}=e,v=(0,r.useRef)(null),y=(0,r.useRef)(null),f=(0,d.xW)(["bg-black/[.45] dark:bg-black/80","flex justify-end fixed inset-0 z-50","rdx-state-closed:animate-modal-overlay-out rdx-state-open:animate-modal-overlay-in"]),b=(0,d.xW)(["bg-background dark:bg-secondaryBg","rdx-state-closed:animate-modal-from-right-out rdx-state-open:animate-modal-from-right-in","relative overflow-hidden outline-none sm:w-auto max-w-full"]),j=(0,d.xW)(["absolute z-[100] rounded-sm top-4 right-4","outline-none focus-visible:ring-2 inline-flex items-center justify-center"]),w=(0,r.useCallback)(e=>{if(!n&&!e)return void p(!0);p(e),e||setTimeout(()=>{null==m||m()},200)},[n,m,p]),{isResizing:N}=(0,i.$)(c&&x,v,y,{min:300,max:null!=u?u:750});return(0,l.jsx)(a.bL,{open:x,onOpenChange:w,children:(0,l.jsx)(a.ZL,{container:g,children:(0,l.jsx)(a.hJ,{className:f,children:(0,l.jsxs)(a.UC,{className:b,ref:v,style:{...N?{userSelect:"none"}:{}},children:[n&&!h&&(0,l.jsx)(a.bm,{className:j,children:(0,l.jsx)(s.K0,{icon:o.X,title:"Close"})}),(0,l.jsx)(a.VY,{asChild:!0,children:t}),c&&(0,l.jsx)("div",{className:"absolute bg-gray-200 h-full left-0 top-0 w-1 z-10 hover:bg-gray-300 hover:cursor-col-resize",ref:y})]})})})})}}},38922:(e,t,n)=>{n.d(t,{J:()=>x});var l=n(95925),a=n(53036),r=n(25963),s=n(62190),i=n(45479),o=n(758),d=n(18571),c=n(91630),u=n(55850),m=n(18731),p=n(7021);function x(e,t){var n;let{isFirstDeployment:x=!1}=t,g=(0,l.jE)(),{graphqlClient:h}=(0,u.q)(),v=["deploymentEvents",e.id],[y]=(0,r.useState)(()=>Object.keys((0,s.hT)(e,x)).reduce((e,t)=>({...e,[t]:{events:[]}}),{})),{isLoading:f,data:b}=(0,a.I)({queryKey:v,queryFn:async()=>{var t;let n=await h.deploymentEvents({id:e.id}),l=(null!=(t=null==n?void 0:n.deploymentEvents.edges)?t:[]).map(e=>e.node).sort((e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime());return{data:n,events:l}},refetchInterval:!1,refetchOnWindowFocus:!1}),j=(0,r.useRef)(null),w=async t=>{var n,l;if(!t)return;let a=s.t5[t.step];(a!==j.current||(null==(n=t.payload)?void 0:n.error))&&((null==(l=t.payload)?void 0:l.error)&&await new Promise(e=>setTimeout(e,500)),g.refetchQueries({type:"active",queryKey:(0,d.q6)({projectId:e.projectId,environmentId:e.environmentId,serviceId:e.serviceId}),fetchStatus:null===j.current?"idle":void 0}),g.refetchQueries({type:"active",queryKey:(0,o.B1)(e.id),fetchStatus:null===j.current?"idle":void 0}),"MIGRATE_VOLUMES"===t.step&&t.completedAt&&await g.refetchQueries({queryKey:(0,p.CS)(e.projectId),fetchStatus:"idle"}),g.refetchQueries({type:"active",queryKey:(0,m.l4)({environmentId:e.environmentId}),fetchStatus:null===j.current?"idle":void 0}),j.current=a)};(0,c.R)(i.LgV,{variables:{id:e.id},onError:()=>{},onNext:async e=>{let{data:t}=e,n=null==t?void 0:t.deploymentEvents;n&&(g.setQueryData(v,e=>e?{...e,events:[...e.events,n].sort((e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime())}:e),w(n))},dependencies:[e.id]});let N=s.PU.includes(e.status),k=null==b?void 0:b.events.find(e=>{var t;return!!(null==(t=e.payload)?void 0:t.error)}),S=(null==b?void 0:b.events)?b.events.reduce((e,t)=>{var n,l;let a=s.t5[t.step];return{...e,[a]:{...e[a],events:[...null!=(l=null==(n=e[a])?void 0:n.events)?l:[],t].sort((e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime())}}},y):y,D=Object.keys(y);return S=Object.keys(S).reduce((e,t)=>{var n,l,a;let r;for(let e=D.indexOf(t)+1;e<D.length;e++){let t=D[e];if(null==(l=S[t])?void 0:l.events.length){r=S[t];break}}let s=S[t],i=s.events.at(-1);return{...e,[t]:{...s,startedAt:null==s||null==(n=s.events.at(0))?void 0:n.createdAt,completedAt:(null==r?void 0:r.events.length)||N?null!=(a=null==i?void 0:i.completedAt)?a:null==i?void 0:i.createdAt:void 0}}},S),{isComplete:N,isSleeping:e.status===i.Uty.Sleeping,hasDeploymentFailed:!!k||e.status===i.Uty.Failed,currentEvent:null==b?void 0:b.events.at(-1),data:S,error:k,isLoading:f,startedAt:null==b||null==(n=b.events.at(0))?void 0:n.createdAt}}},40137:(e,t,n)=>{n(25963)},56229:(e,t,n)=>{n.d(t,{P:()=>h});var l=n(50979),a=n(25963),r=n(65884),s=n(31754),i=n(77505),o=n(10733),d=n(61259),c=n(42419),u=n(95662),m=n(86954),p=n(33119),x=n(88887);let g=e=>{let{reason:t,onClick:n}=e;return(0,l.jsx)(s.$n,{type:"button",variant:"outline",color:"blue",onClick:n,className:"text-sm max-w-max leading-none mb-2 mr-2",children:t})},h=e=>{let{user:t,team:n,open:h,onOpenChange:v}=e,[y,f]=(0,a.useState)(""),[b,j]=(0,a.useState)(!1),{adminActions:w}=(0,r.PN)(),{modalActions:N}=(0,i.U)(),{id:k,name:S,isTeam:D}=(0,a.useMemo)(()=>null!=t?{...t,isTeam:!1}:{...n,isTeam:!0},[t,n]),I=async()=>{if(""!==y.trim()){j(!0);try{D?await w.banTeam({id:k,input:{banReason:y}}):await w.ban({input:{userId:k,reason:y}}),N.createToast((0,l.jsx)(x.y8,{variant:"success",title:"Hammer Down!",description:"".concat(S," has been banned with reason - ").concat(y,"!")}))}catch(e){N.createToast((0,l.jsx)(x.y8,{variant:"error",title:"Error",description:"".concat(S," has not been banned! ").concat(e.message)}))}v(!1),j(!1)}};return(0,l.jsx)(o.a.Root,{open:h,onOpenChange:v,children:(0,l.jsxs)(d.lV,{onSubmit:I,enableBindings:!0,className:"min-w-sm max-w-lg space-y-5",children:[(0,l.jsxs)(c.lD,{children:["Ban ",D?"Team":"User"]}),(0,l.jsxs)(c.EY,{children:["Are you sure you want to ban ",(0,l.jsx)("strong",{children:S}),"? This action will ban the ",D?"team":"user"," from the platform and notify them via an email."," ",D?"This will also ban all admins in the team.":"This will also ban all teams where the user is an admin."]}),(0,l.jsxs)(u.T,{space:2,children:[(0,l.jsx)(m.pd,{name:"reason",id:"reason",label:"Ban reason",placeholder:"Unspecified",value:y,onChange:e=>f(e.target.value)}),(0,l.jsx)(u.z,{className:"flex-wrap",children:Object.values(p.C).map(e=>(0,l.jsx)(g,{reason:e,onClick:()=>f(e)},e))})]}),(0,l.jsxs)(u.z,{justify:"end",space:3,children:[(0,l.jsx)(s.$n,{color:"gray",type:"button",onClick:()=>v(!1),children:"Cancel"}),(0,l.jsx)(s.$n,{color:"red",disabled:""===y.trim(),isLoading:b,children:"Ban"})]})]})})}},64126:(e,t,n)=>{n.d(t,{N:()=>r});var l=n(25963),a=n(41054);let r=e=>{let{scrollContainer:t,childContainer:n}=e,[r,s]=(0,l.useState)(0),[i,o]=(0,l.useState)(!1),d=(0,a.L)(n);(0,l.useEffect)(()=>{if(null==t.current)return;let e=()=>{if(null==t.current)return;let{clientHeight:e,scrollHeight:n,scrollTop:l}=t.current,a=n-e-l<=5;n>e&&a?o(!0):o(!1),s(l)};return e(),t.current.addEventListener("scroll",e),()=>{null!=t.current&&t.current.removeEventListener("scroll",e)}},[t.current,i]),(0,l.useEffect)(()=>{if(null==t.current||!i)return;let e=t.current;e.scrollTop=e.scrollHeight,s(e.scrollTop)},[d.height]);let c=t.current;return{lockedToBottom:i,isAtTop:0===r,isAtBottom:null!=c&&r===c.scrollHeight,canScroll:null!=c&&c.scrollHeight>c.clientHeight}}},65884:(e,t,n)=>{n.d(t,{VB:()=>I,Z:()=>k,cA:()=>F,rF:()=>j,R7:()=>O,GQ:()=>N,ue:()=>U,pr:()=>D,PN:()=>h,A6:()=>z,BN:()=>W,NY:()=>y,Kz:()=>q,Fg:()=>P,V5:()=>w,k_:()=>C,Wi:()=>S,GR:()=>g,ZX:()=>b,F2:()=>f,_y:()=>L,kq:()=>E,Hh:()=>T,Zk:()=>A,Dd:()=>v,EA:()=>R});var l=n(25963),a=n(95925),r=n(5979),s=n(45588),i=n(97865),o=n(55850),d=n(72898),c=n(70375),u=n(84202);let m=e=>{var t,n,a;let{queryKey:r,args:s,queryFn:o,queryConfig:d,itemsPerPage:m=15}=e,[p,x]=(0,u.L)({page:0,cursor:void 0}),{page:g}=p,[h,v]=(0,l.useState)("next"),y="previous"===h?{last:m,...void 0===p.cursor||!p.cursor?{}:{before:p.cursor}}:{first:m,...void 0===p.cursor||!p.cursor?{}:{after:p.cursor}},{isReady:f}=(0,c.c)(),{result:b,...j}=(0,i.W)([...r,y],o({...y,...s}),{...d,enabled:f}),w=(e,t)=>{x({page:e,cursor:t})},N=null==(t=b.data)?void 0:t.pageInfo,{startCursor:k,endCursor:S}=null!=N?N:{};return{pagination:{page:g,setPage:e=>{if(isNaN(e)||e<0)return void w(0,void 0);switch(e){case 0:v("next"),w(e,void 0);break;case g-1:v("previous"),w(g-1,0===g?void 0:k||void 0);break;case g+1:v("next"),w(g+1,S||void 0);break;default:throw Error("Invalid page")}},hasPreviousPage:null!=(n=null==N?void 0:N.hasPreviousPage)&&n,hasNextPage:null!=(a=null==N?void 0:N.hasNextPage)&&a},...j,result:b,queryKey:r}};var p=n(66800),x=n.n(p);let g=()=>{let[{user:e}]=(0,s.Jd)(),{graphqlClient:t}=(0,o.q)(),{result:n}=(0,i.W)(["admin","stats"],async()=>(await t.getAdminStats({})).adminStats,{enabled:null!=e});return{stats:n}},h=()=>{let{graphqlClient:e}=(0,o.q)(),t=(0,a.jE)();return{adminActions:{ban:async n=>{let{input:{userId:l,reason:a}}=n;await e.userBan({input:{userId:l,reason:a}}),t.invalidateQueries({queryKey:k(l)})},allowUsageAnomaly:async n=>{let{input:l}=n;await e.usageAnomalyAllow({input:l}),(e=>{e.invalidateQueries({queryKey:["grouped-usage-anomalies","needs-action"]}),e.invalidateQueries({queryKey:["grouped-usage-anomalies","all"]})})(t)},unban:async n=>{let{userId:l}=n;await e.userUnban({userId:l}),t.invalidateQueries({queryKey:k(l)})},delete:async n=>{let{userId:l}=n;await e.adminDelete({userId:l}),t.invalidateQueries({queryKey:k(l)})},banTeam:async n=>{await e.teamBan(n),t.invalidateQueries({queryKey:I(n.id)})},unbanTeam:async n=>{await e.teamUnban(n),t.invalidateQueries({queryKey:I(n.id)})},stopTeamResources:async n=>{await e.teamResourcesStop(n),t.invalidateQueries({queryKey:I(n.id)})},overrideTeamSupportTier:async n=>{await e.adminOverrideTeamSupportTier(n),t.invalidateQueries({queryKey:I(n.teamId)})},cancelAllSubscriptions:async n=>{await e.customerCancelSubscriptions(n),t.invalidateQueries({queryKey:k(n.userId)})},generateAdoptionInfoForTeam:async n=>{await e.generateAdoptionInfoForTeam(n),t.invalidateQueries({queryKey:I(n.teamId)})},upsertSlackChannelForTeam:async n=>{await e.upsertSlackChannelForTeam(n),t.invalidateQueries({queryKey:I(n.teamId)})},toggleSlackChannelArchival:async(n,l)=>{await e.adminWorkspaceToggleArchiveSlackChannel(n),t.invalidateQueries({queryKey:I(l)})},issueRefund:async t=>{await e.adminIssueRefundForRefundRequest(t)},triggerAdoptionInfoRun:async()=>{await e.adminTriggerAdoptionInfoRun()}}}},v=e=>{let{graphqlClient:t}=(0,o.q)();return(0,i.W)(["admin","topProjects",e],async()=>(0,r.nX)(await t.topMetrics(e)).topMetrics,{staleTime:3e5})},y=e=>{let{graphqlClient:t}=(0,o.q)();return m({queryKey:["admin","projects",e],args:e,queryFn:e=>async()=>{let n=await t.adminAllProjects(e);return{projects:(0,r.nX)(n).adminAllProjects,pageInfo:n.adminAllProjects.pageInfo}},itemsPerPage:20})},f=e=>{let{graphqlClient:t}=(0,o.q)(),{result:n,pagination:l}=m({queryKey:["admin","users",e],args:e,queryFn:e=>async()=>{let n=await t.users(e);return{users:(0,r.nX)(n).users,pageInfo:n.users.pageInfo}},itemsPerPage:20});return{result:n,pagination:l}},b=e=>{let{graphqlClient:t}=(0,o.q)(),{result:n,pagination:l}=m({queryKey:["admin","teams",e],args:e,queryFn:e=>async()=>{let n=await t.teams(e);return{teams:n.teams,pageInfo:n.teams.pageInfo}},itemsPerPage:20});return{result:n,pagination:l}},j=e=>{let{graphqlClient:t}=(0,o.q)(),{result:n,pagination:l}=m({queryKey:["admin","deployments",e],args:e,queryFn:e=>async()=>{let n=await t.adminDeployments(e);return{deployments:(0,r.nX)(n).adminDeployments,pageInfo:n.adminDeployments.pageInfo}},itemsPerPage:20});return{result:n,pagination:l}},w=e=>{let{graphqlClient:t}=(0,o.q)();return m({queryKey:["admin","services",e],args:e,queryFn:e=>async()=>{let n=await t.adminAllServices(e);return{services:(0,r.nX)(n).adminAllServices,pageInfo:n.adminAllServices.pageInfo}},itemsPerPage:20})},N=e=>{let{graphqlClient:t}=(0,o.q)();return(0,i.W)(["admin","domains",e],async()=>(await t.adminAllDomains(e)).adminAllDomains)},k=e=>["admin","user",e],S=e=>{let{graphqlClient:t}=(0,o.q)(),{result:n,invalidateQuery:a}=(0,i.W)(k(e.userId),async()=>{let n=(await t.adminUser(e)).user,l=(0,r.nX)(n);return l.workspaces=l.workspaces.map(r.nX),l});return(0,l.useEffect)(()=>{(async()=>{var l;(null==(l=n.failureReason)?void 0:l.message)==="User has no workspaces"&&e.userId&&(await t.userTrialWorkspaceCreate({userId:e.userId}),a())})()},[n.failureReason,e.userId]),{result:n}},D=e=>{let{filters:t}=e,{graphqlClient:n}=(0,o.q)(),l=["grouped-usage-anomalies",t.needsAction?"needs-action":"all"],{result:a}=(0,i.W)(l,async()=>await n.groupedUsageAnomalies({input:{filters:t}}));return{result:a}},I=e=>["admin","team",e],C=e=>{let{graphqlClient:t}=(0,o.q)();return(0,i.W)(I(e.id),async()=>{let n=(await t.team(e)).team;return(0,r.nX)(n)},{staleTime:x()("30s"),enabled:null!=e.id})},R=e=>{let{graphqlClient:t}=(0,o.q)(),n=(0,a.jE)(),{result:l}=(0,i.W)(["admin","riskLevel",e],async()=>(await t.userRiskLevel({userId:e})).userRiskLevel);return{userRiskLevel:l,actions:{updateRiskLevel:async e=>{let{input:{userId:l,riskLevel:a}}=e;await t.userRiskLevelUpdate({input:{userId:l,riskLevel:a}}),n.invalidateQueries({queryKey:k(l)})}}}},T=e=>{let{graphqlClient:t}=(0,o.q)(),{result:n}=(0,i.W)(["admin","adoptionLevel",e],async()=>(await t.teamAdoptionLevel({teamId:e})).teamAdoptionLevel);return{teamAdoptionLevel:n}},A=e=>{var t;let{graphqlClient:n}=(0,o.q)(),{result:l}=(0,i.W)(["admin","teamTopMovers",e],async()=>(0,r.nX)(await n.teamTopMovers({input:e})),{staleTime:3e5});return{result:null==(t=l.data)?void 0:t.teamTopMovers}},L=e=>{let{graphqlClient:t}=(0,o.q)(),n=["admin","ip-clashes",e.userId],{result:l}=(0,i.W)(n,async()=>(await t.usersWithClashingIP(e)).usersWithClashingIP);return{usersWithClashingIPs:l}},P=()=>{let{graphqlClient:e}=(0,o.q)(),t=(0,a.jE)();return{adminActions:{resetTwoFactorInfo:async n=>{await e.twoFactorInfoReset(n),t.invalidateQueries({queryKey:k(n.userId)})}}}},E=e=>{let{graphqlClient:t}=(0,o.q)();return(0,i.W)(["admin","githubEvents",e],async()=>(await t.githubEvents({userId:e})).githubEvents)},F=()=>{let{graphqlClient:e}=(0,o.q)(),t=["admin","control-panel","lockdown-status"],{result:n}=(0,i.W)(t,async()=>(await e.lockdownStatus()).lockdownStatus),l=["admin","control-panel","auto-refund-settings"],{result:a}=(0,i.W)(l,async()=>(await e.adminAutoRefundSettings()).adminAutoRefundSettings),r=["admin","control-panel","platform-feature-flags"],{result:s}=(0,i.W)(r,async()=>(await e.platformFeatureFlags()).platformFeatureFlags);return{lockdownStatus:n,autoRefundSettings:a,platformFeatureFlags:s,adminControlPanelActions:{togglePlatformService:(0,d.n)(t,async t=>(await e.platformServiceToggle(t)).platformServiceToggle),updateAutoRefundSettings:(0,d.n)(l,async t=>(await e.adminUpdateAutoRefundSettings(t)).adminUpdateAutoRefundSettings),togglePlatformFeatureFlag:(0,d.n)(r,async t=>(await e.togglePlatformFeatureFlag({input:t})).togglePlatformFeatureFlag),setPercentagePlatformFeatureFlag:(0,d.n)(r,async t=>(await e.setPercentagePlatformFeatureFlag({input:t})).setPercentagePlatformFeatureFlag)}}},W=e=>{let{queryKey:t}=e,{graphqlClient:n}=(0,o.q)();return{planLimitOverride:(0,d.n)(t,async e=>(await n.planLimitOverrideUpsert(e)).planLimitOverrideUpsert),planLimitOverrideDelete:(0,d.n)(t,async e=>(await n.planLimitOverrideDelete(e)).planLimitOverrideDelete)}},z=e=>{let{queryKey:t}=e,{graphqlClient:n}=(0,o.q)();return(0,d.n)(t,async e=>(await n.deploymentsNeedApprovalUpdate(e)).deploymentsNeedApprovalUpdate)},O=e=>{let{queryKey:t}=e,{graphqlClient:n}=(0,o.q)();return{set:(0,d.n)(t,async e=>(await n.adminSetDomainTrafficLimit(e)).adminSetDomainTrafficLimit),clear:(0,d.n)(t,async e=>(await n.adminClearDomainTrafficLimit(e)).adminClearDomainTrafficLimit)}},q=e=>{let{graphqlClient:t}=(0,o.q)(),{result:n}=(0,i.W)(["admin","refund-request",e.id],async()=>(await t.adminRefundRequestInfo(e)).adminRefundRequestInfo);return{result:n}},U=()=>{let{graphqlClient:e}=(0,o.q)();return(0,i.W)(["admin","email-templates"],async()=>(await e.adminEmailTemplates()).adminEmailTemplates,{staleTime:1/0})}},84202:(e,t,n)=>{n.d(t,{L:()=>s});var l=n(25963),a=n(70375);let r=(e,t)=>Object.entries(e).reduce((e,n)=>{var l,a;let[r,s]=n;return{...e,[r]:null!=t[r]?((e,t)=>{try{if("boolean"==typeof e)return"true"===t;if("number"==typeof e){let n=parseInt(t);return isNaN(n)?e:n}}catch(e){}return t})(s,null!=(a=null==(l=t[r])?void 0:l.toString())?a:""):s}},e),s=e=>{let{isReady:t,pathname:n,navActions:s,query:i}=(0,a.c)(),[o,d]=(0,l.useState)(()=>r(e,i));return(0,l.useLayoutEffect)(()=>{t&&d(e=>r(e,i))},[i,t]),[o,e=>{0===e.page&&(e.page=null),""===e.query&&(e.query=null),s.replace({url:n,query:{...i,...e}},{scroll:!1,shallow:!0})}]}},84455:(e,t,n)=>{n.d(t,{Z:()=>a});var l=n(1142);let a=()=>(0,l.z)("sm")},92727:(e,t,n)=>{n.d(t,{C:()=>g});var l=n(50979),a=n(25963),r=n(36609),s=n(2551),i=n(13077);function o(e,t){switch(t){case"string":return'"'.concat(e,'"');case"object":return"{}";case"array":return"[]";default:return String(e)}}function d(e){let{depth:t,name:n,value:c,jsonPath:u,wrapText:m=!1,onAttrClick:p}=e,[x,g]=(0,a.useState)(!1),h=null!=u?u:String(n),v=null===c?"null":Array.isArray(c)?"array":"object"==typeof c?"object":"string"==typeof c?"string":"number"==typeof c?"number":"other",y="object"===v||"array"===v,f=()=>{p&&!y&&p(String(null!=u?u:n),c)};return(0,l.jsxs)("div",{className:(0,r.xW)(0===t&&"-ml-4","font-mono text-xs text-left select-text"),children:[(0,l.jsxs)("button",{className:"grid grid-cols-[max-content,minmax(0,auto)] items-start group text-left",onClick:e=>{e.stopPropagation(),g(e=>!e)},children:[y?(0,l.jsxs)("div",{className:"relative flex items-center pl-4",children:[(0,l.jsx)(i.In,{size:"xs",icon:s.c_$,className:(0,r.xW)("left-0 absolute transition-transform text-gray-500 group-hover:text-gray-700",x&&"rotate-90")}),(0,l.jsxs)("span",{className:"text-neutral-secondary group-hover:text-neutral mr-1.5",children:[n,":"]})]}):(0,l.jsxs)("div",{className:"text-neutral-secondary pl-4 mr-1.5",children:[n,":"]}),(()=>{if(y){let e=x?o(c,v):"object"===v?"{⋯}":"[⋯]";return(0,l.jsx)("span",{className:"text-gray-500",children:e})}let e=o(c,v);return(0,l.jsx)("button",{className:(0,r.xW)("text-left select-text",m?"text-wrap break-words":"truncate",function(e){switch(e){case"number":return"text-pink-500 dark:text-pink-600";case"string":return"text-blue-500 dark:text-blue-600";case"null":return"text-yellow-600 dark:text-yellow-700";default:return""}}(v),p&&"cursor-pointer hover:underline"),onClick:e=>{let t=window.getSelection();if(t&&t.toString().length>0){let n=e.currentTarget,l=n.contains(t.anchorNode),a=n.contains(t.focusNode);if(l||a)return}f&&f()},children:e})})()]}),(()=>{if(!x||!y)return null;let e=[];return"object"===v?e=Object.keys(c).sort().map(e=>(0,l.jsx)(d,{depth:t+1,value:c[e],name:e,jsonPath:function(e,t){let n=/^[a-z0-9_]+$/i.test(t)?t:"`".concat(t,"`");return"".concat(e,".").concat(n)}(h,e),wrapText:m,onAttrClick:p},e)):"array"===v&&(e=c.map((e,n)=>{var a,r;return(0,l.jsx)(d,{depth:t+1,value:e,name:n,jsonPath:(a=h,r=n,"".concat(a,"[").concat(r,"]")),wrapText:m,onAttrClick:p},n)})),(0,l.jsx)("div",{className:"ml-2 max-w-full",children:e})})()]})}var c=n(21500),u=n(76999),m=n(23466),p=n(73751),x=n(67366);function g(e){let{defaultExpanded:t=!1,toJSON:n}=e;return(0,a.forwardRef)(function(e,s){let{item:i,className:o,children:g,onClick:h,style:v,...y}=e,[f,b]=(0,a.useState)(t),j=(0,c.R7)(),w=(e,t)=>{if(!j.enabled)return;let n=function(e,t){if("message"===e)return new u.NJ(JSON.stringify(t.split("\n")[0]));if(e.startsWith("tags.")){var n;let l=e.replace("tags.","");return new u.nW(null!=(n=p.r3[l])?n:l,JSON.stringify(t))}return e.startsWith("attributes.")?new u.nW(e.replace("attributes.",""),JSON.stringify(t)):null}(e,t);n&&j.addExpression(n)},N=f?Object.entries(n(i)):[],k=(0,m.FW)();return(0,l.jsxs)(x.u,{...y,item:i,onClick:e=>{!function(e,t){let n=e;for(;n&&n!==t;){if(n instanceof HTMLButtonElement||n instanceof HTMLAnchorElement||n.hasAttribute("data-expanded-group"))return!0;n=n.parentElement}return!1}(e.target,e.currentTarget)&&(b(e=>!e),null==h||h(e))},className:(0,r.xW)("hover:bg-gray-50 cursor-pointer",o),ref:s,style:v,children:[g,f&&(0,l.jsx)("div",{style:v,"data-expanded-group":!0,children:(0,l.jsx)("div",{className:"col-span-full pl-5 pb-2 select-none cursor-auto border-l border-l-neutral ml-[13px]",children:N.map(e=>{let[t,n]=e;return(0,l.jsx)(d,{depth:0,value:n,name:t,wrapText:k.wrapText,onAttrClick:w},t)})})})]})})}},96218:(e,t,n)=>{n.d(t,{K:()=>nc});var l=n(50979),a=n(46650),r=n(76685),s=n(25963),i=n(73742),o=n(62190),d=n(45479),c=n(61649),u=n(81154),m=n(47188),p=n(46040),x=n(758),g=n(94347),h=n(64126),v=n(3732),y=n(71121),f=n(67044),b=n(84455),j=n(2551),w=n(45588),N=n(36609),k=n(82660),S=n(47654),D=n(78781),I=n(64162);n(24224);var C=n(64963);n(8935);var R=n(70375);n(98078);var T=n(31754),A=n(75749),L=n(13077),P=n(83119);n(37154),n(21341),n(12224),n(6075);var E=n(47199),F=n.n(E);function W(e){let{log:t}=e,n=t.message.split("\n");return(0,l.jsx)(l.Fragment,{children:n.map((e,t)=>O.some(t=>t.test(e))?(0,l.jsx)(P.g$,{content:e,className:"cursor-text"},t):(0,l.jsx)("div",{className:"px-2",dangerouslySetInnerHTML:{__html:z.ansi_to_html(e)}},t))})}let z=new(F());z.use_classes=!0;let O=[/^npm error Missing/,/^npm error Not found/,/^npm error fetch failed/,/^pip(3)? error/,/^gem install error/,/ERR_PNPM_UNSUPPORTED_ENGINE/,/ERR_PNPM_NO_MATCHING_VERSION/,/ERR_PNPM_LOCKFILE_MISSING/,/ERR_PNPM_LOCKFILE_BREAKING_CHANGE/,/ERR_PNPM_LOCKFILE_VERSION/,/your lock\s?file/i,/No lockfile found/,/error:/,/^no Go files in/,/^error\[E\d+\]/,/error TS\d+:/,/^Error:/,/^Type error:/,/^Cannot find module/,/^Module parse failed/,/^Invalid configuration object/,/^next-env\.d\.ts cannot be found/,/ENOENT/,/EACCES/,/ENOSPC/,/version conflict/i];var q=n(22986),U=n(79864);n(38987);let M=/\[([\w-]+?)\s*?([\d/]+)?\]/;var _=n(21500),B=n(67366),K=n(81428),J=n(23466),H=n(90511),Q=n(47829),V=n(10046),G=n(25836),Z=n(40853),$=n(77146),X=n(49872),Y=n(13099),ee=n(63315),et=n(17032),en=n(90454),el=n(17851);let ea=el.z.object({type:el.z.literal("status"),id:el.z.string(),vertex:el.z.string(),message:el.z.string().optional(),current:el.z.number().optional(),timestamp:el.z.string(),started:el.z.string().optional(),completed:el.z.string().optional()}),er=el.z.object({type:el.z.literal("log"),vertex:el.z.string(),message:el.z.string(),stream:el.z.number(),timestamp:el.z.string()}),es=el.z.object({type:el.z.literal("vertex"),digest:el.z.string(),message:el.z.string(),current:el.z.number().optional(),started:el.z.string().optional(),completed:el.z.string().optional(),error:el.z.string().optional(),cached:el.z.boolean().optional(),timestamp:el.z.string()}),ei=el.z.discriminatedUnion("type",[er,es,ea]),eo=el.z.object({message:el.z.string(),severity:el.z.string().nullish(),tags:el.z.record(el.z.unknown()).nullish(),timestamp:el.z.string(),attributes:el.z.array(el.z.object({key:el.z.string(),value:el.z.string()}))}).transform(e=>{let t=(e=>{let t={};for(let n of e)try{t[n.key]=JSON.parse(n.value)}catch(e){t[n.key]=n.value}return t})(e.attributes),n=ei.safeParse({...e,...t});return n.success?{...e,...n.data}:null});el.z.array(eo).transform(e=>{let t=[];for(let n of e)n&&t.push(n);return t});var ed=n(98830);let{useLogs:ec,useLogsQuery:eu,useLogsStream:em,useLogsPagination:ep,atoms:{newLogsAtom:ex}}=(0,ed.G)({streamLogs(e,t,n,l){var a;let{snapshotId:r,isRailpack:s,...i}=n,o=e(et.iv);return i.filter="".concat(null!=(a=i.filter)?a:""," (@snapshot:").concat(r," OR @replica:").concat(r,")"),o.subscribe({query:(0,ee.y)(d.w37),variables:i},{...l,next(e){e.data&&l.next(e.data.environmentLogs.map(e=>{let t=eo.safeParse(e);return t.success&&null!=t.data?t.data:e}))}})},async queryLogs(e,t,n){var l;let{snapshotId:a,isRailpack:r,...s}=n,i=e(en.a);if(!i)throw Error("No GraphQL client");return s.filter="".concat(null!=(l=s.filter)?l:""," (@snapshot:").concat(a," OR @replica:").concat(a,")"),(await i.environmentLogs(s)).environmentLogs.map(e=>{let t=eo.safeParse(e);return t.success&&null!=t.data?t.data:e})}});var eg=n(97989),eh=n(80428),ev=n(13025),ey=n(84044),ef=n(24554),eb=n(66800),ej=n.n(eb),ew=n(52846),eN=n(58400);function ek(e){let{data:t,toJSON:n,isRailpack:a,className:r,...s}=e;return(0,l.jsx)(eg.n,{colSpan:2,severity:t.severity,className:(0,N.xW)("overflow-visible py-1.5",r),...s,children:(0,l.jsx)(eS,{data:t,wrapText:s.wrapText,isRailpack:a})})}let eS=(0,s.memo)(function(e){var t,n,a;let{data:r,wrapText:i=!1,isRailpack:o=!1}=e,d=(null==(a=r.attributes)?void 0:a.error)?"error":(null==a?void 0:a.completed)?"success":"in-progress",[c,m]=(0,u.fp)(eF(r.id)),[p]=(0,s.useMemo)(()=>o?[]:function(e){let t=M.exec(e);return t?[t[1],t[2]]:[]}(r.message),[r.message,o]),x=(0,s.useMemo)(()=>r.message.replace(M,"").replace(eA,"").trim(),[r.message]),g=(0,s.useMemo)(()=>r.children.flatMap(e=>e.message.trimEnd().split("\n").map(t=>({line:t,timestamp:e.timestamp}))).filter(e=>!!(0,eN.aJ)(e.line)),[r.children]),h=g.length>1;return(0,s.useEffect)(()=>{"open"!==c&&"error"===d&&requestAnimationFrame(()=>m("open"))},[d]),(0,l.jsx)("button",{className:(0,N.xW)("w-full flex flex-col gap-1 group/cell tabular-nums",h?"cursor-pointer":"cursor-text"),onClick:e=>{var t;(null==(t=window.getSelection())||!t.toString())&&h&&(e.stopPropagation(),m(e=>"open"!==e?"open":"closed"))},onMouseEnter:()=>{h&&"closed"===c&&m("preview")},onMouseLeave:()=>{"preview"===c&&m("closed")},children:(0,l.jsxs)("div",{className:(0,N.xW)("grid grid-cols-[max-content,minmax(0,1fr),max-content] text-left items-start px-1 gap-x-3 gap-y-1 select-text w-full",i?"whitespace-pre-wrap":"whitespace-pre"),children:[(0,l.jsx)(eD,{status:d,stage:p,isRailpack:o}),(0,l.jsx)(eI,{message:x,status:d,isCached:null==(t=r.attributes)?void 0:t.cached,wrapText:i,showFullWidth:!p&&!o}),(0,l.jsx)(eC,{started:null==(n=r.attributes)?void 0:n.started,completed:r.completed,status:d}),(0,l.jsx)(eR,{appearance:c,status:d,processedLogs:g,hasMultipleLogs:h,children:r.children})]})})}),eD=(0,s.memo)(function(e){let{status:t,stage:n,isRailpack:a}=e;if(!n&&!a)return null;let r="error"===t?j.hcu:"success"===t?j.Jlk:eT;return(0,l.jsxs)("div",{className:(0,N.xW)("grid grid-cols-[max-content,minmax(0,1fr)] items-center justify-between text-left gap-1 rounded-md pr-1 text-neutral-secondary",eL,"error"===t&&"text-danger",a&&"grid-cols-1 pt-0.5 gap-0 w-auto items-center justify-center bg-transparent border-transparent px-0"),children:[(0,l.jsx)(L.In,{icon:r,size:"xs",className:(0,N.xW)("text-info","in-progress"===t&&"animate-spin","error"===t&&"text-danger","success"===t&&"text-success-secondary")}),!a&&(0,l.jsx)("div",{className:"truncate text-ellipsis",children:n})]})}),eI=(0,s.memo)(function(e){let{message:t,status:n,isCached:a,wrapText:r,showFullWidth:s}=e;return(0,l.jsxs)("div",{className:(0,N.xW)("min-w-0",!r&&"truncate text-ellipsis !overflow-hidden",s&&"col-span-2",a&&"text-neutral-secondary","error"===n&&"text-danger font-semibold"),children:[t,a&&(0,l.jsx)("span",{className:"text-neutral-secondary opacity-50",children:" cached"})]})}),eC=(0,s.memo)(function(e){let{started:t,completed:n,status:a}=e;return(0,l.jsx)("div",{className:(0,N.xW)("text-right text-neutral-secondary",eP),children:t?(0,l.jsx)(ew.d,{startedAt:t,finishedAt:n,timeStyle:"narrow"}):"in-progress"===a?(0,l.jsx)(l.Fragment,{children:"⋯"}):(0,l.jsx)(l.Fragment,{children:"—"})})}),eR=(0,s.memo)(function(e){let{appearance:t,status:n,children:a,processedLogs:r,hasMultipleLogs:i}=e;if("open"===t)return(0,l.jsx)(l.Fragment,{children:a.map(e=>(0,l.jsx)(s.Fragment,{children:"error"===n?(0,l.jsx)("div",{className:"text-[11px] col-span-3 text-neutral pt-2",children:(0,l.jsx)(W,{log:e})}):(0,l.jsx)("div",{className:"text-foreground text-[11px] col-span-2 pt-2",dangerouslySetInnerHTML:{__html:eE.ansi_to_html(e.message)}})},e.timestamp))});let o=r[r.length-1];return o?(0,l.jsx)(eh.N,{mode:"wait",children:(0,l.jsxs)(s.Fragment,{children:[(0,l.jsx)("div",{}),(0,l.jsxs)(ev.P.div,{className:"text-foreground font-semibold text-[11px] col-span-2 group-hover/cell:text-foreground relative",initial:{y:16,opacity:0},animate:{y:0,opacity:1},exit:{y:-16,opacity:0},transition:{duration:.1},children:[i&&"in-progress"!==n&&(0,l.jsx)("div",{className:"absolute left-[-27px] text-neutral-secondary bg-neutral-button group-hover/cell:bg-neutral-button-hover group-hover/cell:text-foreground w-4 h-4 rounded-full flex items-center justify-center",children:(0,l.jsx)(L.In,{icon:j.yQN,size:"xs"})}),(0,l.jsx)("div",{className:"truncate text-ellipsis !overflow-hidden",children:(0,eN.aJ)(o.line).trim()})]})]},o.timestamp+o.line)}):null});function eT(e){return(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...e,children:(0,l.jsx)("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"})})}let eA=/\s*--mount=[^\s]+/g,eL="w-24",eP="w-14",eE=new(F());eE.use_classes=!0;let eF=(0,ey.Iz)(e=>(0,ef.eU)("closed"));function eW(e){let{data:t,showPlainText:n=!1,dataColumns:a,toJSON:r,showAttributes:s=!0,className:i,...o}=e;return(0,l.jsx)(eg.n,{colSpan:2,severity:t.severity,className:(0,N.xW)("overflow-visible",i),...o,children:(0,l.jsx)("button",{className:(0,N.xW)("text-left gap-x-1 px-1 select-text cursor-text",o.wrapText?"whitespace-pre-wrap":"whitespace-pre"),children:(0,l.jsx)(P.u7,{content:ez.ansi_to_html(t.message||" ")})})})}eF.setShouldRemove(e=>Date.now()-e>ej()("1h"));let ez=new(F());function eO(e){return(0,s.useSyncExternalStore)((0,s.useCallback)(t=>{var n;let l=new ResizeObserver(t);return l.observe((null==(n=e.current)?void 0:n.parentElement)||document.body),()=>{l.disconnect()}},[]),(0,s.useCallback)(()=>{var t,n;return null==(n=e.current)||null==(t=n.parentElement)?void 0:t.offsetHeight},[]))}function eq(e){var t,n;let{data:a,showPlainText:r=!1,ansiToHtml:i=!1,dataColumns:o,toJSON:d,className:c,...u}=e,[m,p]=(0,s.useState)(!1),x=null==(n=a.attributes)||null==(t=n.find(e=>"plan"===e.key))?void 0:t.value;return(0,l.jsxs)(eg.n,{colSpan:2,severity:a.severity,className:(0,N.xW)("overflow-visible",c),...u,children:[(0,l.jsx)("button",{className:(0,N.xW)("inline-flex text-left items-center gap-x-1 px-1 select-text","border border-transparent hover:border-neutral hover:bg-gray-100 hover:dark:bg-gray-200 rounded-xl cursor-pointer",u.wrapText?"whitespace-pre-wrap":"whitespace-pre"),onClick:()=>p(!m),children:a.message}),m&&x&&(0,l.jsx)("div",{className:"mt-2 p-2 bg-neutral-surface text-xs rounded-lg",children:(0,l.jsx)("pre",{className:"whitespace-pre-wrap",children:JSON.stringify(JSON.parse(x),null,2)})})]})}function eU(e){let t=(0,_.A5)();return(0,l.jsx)(_.B4,{backend:t,children:(0,l.jsx)(eM,{deployment:e.deployment,activeDateRange:e.activeDateRange})})}ez.use_classes=!0;let eM=(0,s.memo)(function(e){var t,n,a;let{deployment:r,activeDateRange:i}=e,c=(0,s.useMemo)(()=>r.status,[]),u=r.status!==d.Uty.Building&&r.status!==d.Uty.Queued&&r.status!==d.Uty.Initializing,m=o.PU.includes(c),{projectId:p,environmentId:x,snapshotId:g}=r,[h,v]=(0,s.useState)(!1),y=(0,_.R7)(),f=(0,s.useRef)(null),b=(0,s.useMemo)(()=>({startTime:new Date(r.createdAt).getTime(),endTime:m?new Date(i.end?i.end:r.updatedAt).getTime():null}),[m,r.createdAt,r.updatedAt,i.start,i.end]),j=ec({variables:{snapshotId:g+"",environmentId:x,filter:y.toString(),...(0,K.m)({timeRange:b})},streamPaused:h||!r.snapshotId,onStreamPausedChange:v,mode:m?"query":"stream"}),w=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{hideInternalStages:n=!0,hideIncompleteStages:l=!1,hideNotStarted:a=!0,collapseAdjacentCopies:r=!0}=t;return{data:(0,s.useMemo)(()=>{let{vertexEvents:t,vertexChildren:s,nonBuildKitLogs:i}=function(e){let t=new Map,n=new Map,l=[];return e.forEach(e=>{if(!("type"in e))return void l.push(e);if("vertex"===e.type){let n=e.digest;t.has(n)||t.set(n,[]),t.get(n).push(e)}else if("log"===e.type||"status"===e.type){let t=e.vertex;n.has(t)||n.set(t,[]),n.get(t).push(e)}}),{vertexEvents:t,vertexChildren:n,nonBuildKitLogs:l}}(e),o=[];for(let[r,i]of t){let t=function(e,t){var n;let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=t[0],r=t.find(e=>e.started),s=t.find(e=>e.completed),i=t.some(e=>e.cached),o=t.find(e=>e.error),d={...a,started:null==r?void 0:r.started,completed:null==s?void 0:s.completed,cached:i,error:null==o?void 0:o.error},c=(null==(n=t.find(e=>"error"===e.severity))?void 0:n.severity)||a.severity;return{type:"vertex",id:e,numChildLogs:l.length,children:l,timestamp:t.reduce((e,t)=>0>t.timestamp.localeCompare(e)?t.timestamp:e,t[0].timestamp),message:a.message,severity:c,attributes:d,completed:null==s?void 0:s.completed}}(r,i,s.get(r));(function(e,t){var n;let l=e.attributes;return!(e.message.includes("docker-image://ghcr.io/railwayapp/railpack-")||"loading ."===e.message||(null==(n=e.attributes)?void 0:n.message.startsWith("[railpack]"))||"mkdir /etc/mise"===e.message||"create mise config"===e.message||e.message.startsWith("load build definition from railpack-plan.json"))&&(!t.hideNotStarted||!!l.started||!!l.cached)&&(!t.hideIncompleteStages||!!l.completed)})(t,{hideInternalStages:n,hideIncompleteStages:l,hideNotStarted:a})&&o.push({group:t,executionTime:function(e){let t=e.attributes;return t.started?t.started:t.cached&&t.completed?t.completed:null}(t),firstAppearance:e.indexOf(i[0])})}return o.sort((e,t)=>e.executionTime&&t.executionTime?e.executionTime.localeCompare(t.executionTime):e.executionTime&&!t.executionTime?-1:!e.executionTime&&t.executionTime?1:e.firstAppearance-t.firstAppearance),function(e,t){let n=[],l=0,a=0;for(;l<e.length||a<t.length;){let r=e[l],s=t[a];if(r)if(s){let e=r.executionTime||r.group.timestamp,t=s.timestamp;0>=e.localeCompare(t)?(n.push(r.group),l++):(n.push(s),a++)}else n.push(r.group),l++;else n.push(s),a++}return n}(r?function(e){let t=[],n=0;for(;n<e.length;){var l,a,r;let s=e[n];if(!s.group.message.startsWith("copy ")){t.push(s),n++;continue}let i=!!(null==(l=s.group.attributes)?void 0:l.cached),o=[s],d=n+1;for(;d<e.length&&e[d].group.message.startsWith("copy ")&&!!(null==(a=e[d].group.attributes)?void 0:a.cached)===i;)o.push(e[d]),d++;if(1===o.length){t.push(s),n++;continue}let c=o.map(e=>e.group.message.substring(5)),u={...o[0].group.attributes,started:o.map(e=>{var t;return null==(t=e.group.attributes)?void 0:t.started}).filter(e=>!!e).sort((e,t)=>e.localeCompare(t)).shift(),completed:o.map(e=>{var t;return null==(t=e.group.attributes)?void 0:t.completed}).filter(e=>!!e).sort((e,t)=>e.localeCompare(t)).pop(),cached:null==(r=o[0].group.attributes)?void 0:r.cached},m={...o[0].group,message:"copy ".concat(c.join(", ")),timestamp:o.reduce((e,t)=>0>t.group.timestamp.localeCompare(e)?t.group.timestamp:e,o[0].group.timestamp),completed:u.completed,attributes:u,children:o.flatMap(e=>e.group.children),numChildLogs:o.reduce((e,t)=>e+t.group.numChildLogs,0)};t.push({group:m,executionTime:o[0].executionTime,firstAppearance:o[0].firstAppearance}),n=d}return t}(o):o,i)},[e,n,l,a,r])}}(j.data,{hideIncompleteStages:u}),k=function(e){let{logs:t,scrollToIndex:n}=e,l=(0,s.useRef)(!1),a=(0,s.useRef)(n),r=(0,s.useMemo)(()=>t.findIndex(e=>{var t;return"children"in e&&(null==(t=e.attributes)?void 0:t.error)||"children"in e&&e.children.some(e=>"error"in e)}),[t]);return(0,Y.Nf)(()=>{if(!t.length||l.current||-1===r)return;l.current=!0;let e=setTimeout(()=>{a.current(r)},100);return()=>clearTimeout(e)},[t.length,r]),r}({logs:w.data,scrollToIndex(e){var t;null==(t=f.current)||t.scrollToIndex(e,{align:"start"})}});(0,s.useEffect)(()=>{if(u){let e=setTimeout(()=>{v(!0)},ej()("30s"));return()=>{clearTimeout(e)}}},[u]);let S=ep(j),D=(0,J.FW)({id:p,type:"build"}),I=(null==(a=r.meta)||null==(n=a.serviceManifest)||null==(t=n.build)?void 0:t.builder)==="RAILPACK",R=(0,s.useCallback)(function(e,t){var n,a;let r=null==(n=j.store.get(ex))?void 0:n.has(e.timestamp),s="children"in e&&(null==(a=e.attributes)?void 0:a.error)?"error":e.severity;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(H.x,{severity:s,showSeverity:D.showSeverity,isNew:r,className:"select-none hover:underline cursor-pointer",children:e.timestamp}),"children"in e?(0,l.jsx)(ek,{data:e,isNew:r,wrapText:D.wrapText,severity:s,isRailpack:I,className:"col-span-2"}):e.attributes.some(e=>"plan"===e.key)?(0,l.jsx)(eq,{data:e,severity:s,wrapText:D.wrapText,isNew:r,className:"col-span-2"}):(0,l.jsx)(eW,{data:e,severity:s,wrapText:D.wrapText,isNew:r,className:"col-span-2"})]})},[D,j.store,I]),T=(0,s.useCallback)(()=>{let e=new Date().toLocaleTimeString([],{timeZoneName:"short"}).split(" ").pop(),t=[{key:"time",columnKey:"timestamp",defaultWidth:196,children:"Time (".concat(e,")")},{key:"message",columnKey:"message",children:"Message"},{key:"settings",columnKey:"settings",defaultWidth:64,children:(0,l.jsx)(J.QA,{id:p,type:"build",className:"!pr-0",visibleOptions:{dataColumns:!1,showHistogram:!1,showPlainText:!1,showRawData:!1,showDataAttributes:!1}}),className:"text-right"}];return t.map((e,n)=>(0,l.jsx)(Q.x,{columnKey:e.columnKey,resizable:n<t.length-(D.showRawData?2:1),defaultWidth:e.defaultWidth,className:e.className,style:e.style,children:e.children},e.key))},[D]);(0,s.useEffect)(()=>{if("connected"!==j.status&&"connecting"!==j.status&&!h){var e;null==(e=f.current)||e.scrollToPosition("bottom")}},[j.status]);let A=(0,s.useRef)(null),L=eO(A),P=r.meta;if((null==P?void 0:P.configErrors)!=null&&(null==P?void 0:P.configErrors.length)>0)return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{}),(0,l.jsx)(C.ZU,{logs:P.configErrors.map(e=>({message:e,timestamp:r.createdAt}))})]});if((null==P?void 0:P.checkSuitesError)!=null&&(null==P?void 0:P.checkSuitesError.trim())!=="")return(0,l.jsx)(C.ZU,{logs:[{message:P.checkSuitesError,timestamp:r.createdAt}]});let E=y.expression?j.data:w.data,F=e=>"children"in e?{message:e.message,timestamp:e.timestamp,children:e.children.map(e=>({message:e.message,timestamp:e.timestamp}))}:e.attributes.some(e=>"plan"===e.key)?{message:e.message,timestamp:e.timestamp,plan:JSON.parse(e.attributes.find(e=>"plan"===e.key).value)}:{message:e.message,timestamp:e.timestamp};return(0,l.jsxs)("div",{className:"w-full h-full relative grid grid-rows-[min-content,minmax(0,auto)]",ref:A,style:{height:L},children:[(0,l.jsx)("div",{className:"grid grid-rows-1 sm:grid-rows-[max-content,minmax(0,1fr)] w-full",children:(0,l.jsx)("div",{className:"hidden sm:flex bg-secondaryBg w-full flex-col pb-2 gap-y-3.5 border-b border-b-neutral max-w-[100vw]",children:(0,l.jsxs)("div",{className:(0,N.xW)("pt-2 px-2 grid sm:items-stretch grid-rows-2 items-center grid-cols-[minmax(0,1fr),max-content] sm:grid-rows-1 sm:grid-cols-[minmax(0,1fr),max-content,max-content] gap-2"),children:[(0,l.jsx)(_.ZY,{className:"col-span-2 sm:col-span-1",showPopover:!1,placeholder:"Search build logs"}),(0,l.jsx)(V.f,{logs:j.data,toJSON:F,className:"hidden sm:flex"})]})})}),(0,l.jsxs)("div",{className:"w-full h-full pb-1.5 relative max-w-[100vw] bg-background ansi-color-wrapper",children:[j.isLoading&&!E.length?(0,l.jsx)(G.C,{}):j.isLoading||E.length?(0,l.jsx)(Z.t,{logs:E,toJSON:F,toPlainText:e=>"id"in e?e.message+("children"in e?"\n\n"+e.children.map(e=>e.message).join("\n"):""):e.message+"",children:(0,l.jsx)(B.M,{ref:f,data:E,renderRow:R,renderHeader:T,initialPosition:k>-1?"top":"bottom",showScrollControls:u,showScrollbar:!1,renderTopBookend:e=>(0,l.jsx)($.w,{position:"top",timeRange:b,pagination:S,...e}),renderBottomBookend:e=>(0,l.jsx)($.w,{position:"bottom",timeRange:b,pagination:S,...e})})}):(0,l.jsx)(G.C,{title:y.expression?"No logs found for this filter":u?"No build logs":"Waiting for build to start...",subtitle:u?"No build logs were found for this deployment.":""}),(0,l.jsx)(X.Y,{isPaused:"timedOut"===j.status,onResume:()=>{v(!1),j.reconnectStream()}})]})]})});n(40137);var e_=n(70643),eB=n(73751),eK=n(29009),eJ=n(76933),eH=n(60904),eQ=n(92727);function eV(e){let t=(0,_.T_)();return(0,l.jsx)(_.B4,{backend:t,children:(0,l.jsx)(eG,{deployment:e.deployment})})}let eG=(0,s.memo)(function(e){let{deployment:t}=e,{projectId:n,environmentId:a}=t,[r,i]=(0,s.useState)(!1),d=(0,_.R7)(),c=(0,s.useRef)(null),u=(0,e_.JO)(),m=(0,s.useMemo)(()=>{var e;return{startTime:new Date(t.createdAt).getTime(),endTime:o.Ag.includes(t.status)?null:new Date(null!=(e=t.statusUpdatedAt)?e:t.updatedAt).getTime()}},[t.status,t.createdAt,t.statusUpdatedAt,t.updatedAt]),p=(0,eH.EM)({variables:{environmentId:a,filter:"@deployment:".concat(t.id," ").concat(d),...(0,K.m)({timeRange:m,viewInContext:u})},streamPaused:r,onStreamPausedChange:i,mode:u.context||"SUCCESS"!==t.status&&"DEPLOYING"!==t.status?"query":"stream"}),x=(0,eH.KX)(p),g=(0,J.FW)({id:n,type:"deploy"});(0,e_.Do)({logs:p,viewInContext:u,scrollToIndex(e){var t;null==(t=c.current)||t.scrollToIndex(e,{behavior:"auto",align:"center"})}});let h=(0,s.useMemo)(()=>["replica"],[]),v=(0,s.useCallback)(function(e,t){var n;let a=null==(n=p.store.get(eH.uc))?void 0:n.has(e.timestamp);return(0,l.jsx)(eZ,{data:e,tableSettings:g,isNew:a,viewInContextStore:u.store,railwayTagColumns:h})},[g,u.store,h,p.store]),y=(0,s.useCallback)(()=>{let e=new Date().toLocaleTimeString([],{timeZoneName:"short"}).split(" ").pop(),t=[{key:"time",columnKey:"timestamp",defaultWidth:196,children:"Time (".concat(e,")")},...g.railwayColumns.filter(e=>h.includes(e)).map(e=>({key:e,columnKey:"tags.".concat(e),className:"capitalize",defaultWidth:164,children:e})),...g.showRawData?[{key:"data",columnKey:"data",children:"Data"}]:[],{key:"settings",columnKey:"settings",children:(0,l.jsx)(J.QA,{id:n,type:"deploy",className:"!pr-0",railwayTags:h,visibleOptions:{dataColumns:!1,showHistogram:!1}}),className:"text-right"}];return t.map((e,n)=>(0,l.jsx)(Q.x,{columnKey:e.columnKey,resizable:n<t.length-(g.showRawData?2:1),defaultWidth:e.defaultWidth,className:e.className,style:e.style,children:e.children},e.key))},[g]),f=(0,_.nU)(p.data);(0,s.useEffect)(()=>{if("connected"!==p.status&&"connecting"!==p.status&&!r){var e;null==(e=c.current)||e.scrollToPosition("bottom")}},[p.status]);let b=(0,s.useRef)(null),j=eO(b),w=(0,s.useMemo)(()=>({Row:(0,eQ.C)({toJSON:eH.H_})}),[]);return(0,l.jsxs)("div",{className:"w-full h-full relative grid grid-rows-[min-content,minmax(0,auto)]",ref:b,style:{height:j},children:[(0,l.jsx)("div",{className:"grid grid-rows-1 sm:grid-rows-[max-content,minmax(0,1fr)] w-full",children:(0,l.jsx)("div",{className:"hidden sm:flex bg-secondaryBg w-full flex-col pb-2 gap-y-3.5 border-b border-b-neutral max-w-[100vw]",children:(0,l.jsxs)("div",{className:(0,N.xW)("pt-2 px-2 grid sm:items-stretch grid-rows-2 items-center grid-cols-[minmax(0,1fr),max-content] sm:grid-rows-1 sm:grid-cols-[minmax(0,1fr),max-content,max-content] gap-2"),children:[(0,l.jsx)(_.ZY,{customFields:f,railwayTags:["deployment","replica"],visibleFilters:{services:!1},className:"col-span-2 sm:col-span-1"}),(0,l.jsx)(V.f,{logs:p.data,className:"hidden sm:flex",toJSON:eH.H_}),(0,l.jsx)(eX,{deployment:t,filter:d.toString()})]})})}),(0,l.jsxs)("div",{className:"w-full h-full pb-1.5 relative max-w-[100vw] bg-background ansi-color-wrapper",children:[p.isLoading&&!p.data.length?(0,l.jsx)(G.C,{}):p.isLoading||p.data.length?(0,l.jsx)(Z.t,{logs:p.data,viewInContext:u,toJSON:eH.H_,children:(0,l.jsx)(B.M,{ref:c,data:p.data,components:w,renderRow:v,renderHeader:y,initialPosition:u.context?"top":"bottom",showScrollbar:!1,renderTopBookend:e=>(0,l.jsx)($.w,{position:"top",timeRange:m,pagination:x,...e}),renderBottomBookend:e=>(0,l.jsx)($.w,{position:"bottom",timeRange:m,pagination:x,...e}),onScrollStateChange:e=>{"bottom"!==e.position&&"both"!==e.position?i(!0):i(!1)}})}):(0,l.jsx)(G.C,{title:d.expression?"No logs found for this filter":"No logs in this time range",subtitle:"Logs will show up here as they are found."}),(0,l.jsx)(X.Y,{isPaused:"timedOut"===p.status,onResume:()=>{i(!1),p.reconnectStream()}})]})]})}),eZ=(0,s.memo)(function(e){let{data:t,tableSettings:n,isNew:a,viewInContextStore:r,railwayTagColumns:s}=e,i=(0,e_.JO)(r),o=i.isInContext(t.timestamp);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(H.x,{severity:t.severity,showSeverity:n.showSeverity,isNew:a,className:(0,N.xW)("select-none hover:underline cursor-pointer",o&&"relative before:absolute before:inset-0 before:border-l-3 before:border-l-pink-400 bg-gradient-to-r from-pink-100 via-transparent to-transparent"),...i.getPropsForTimestamp(t.timestamp),children:t.timestamp}),n.railwayColumns.filter(e=>s.includes(e)).map(e=>(0,l.jsx)(eB.zX,{tags:t.tags,name:e,severity:t.severity,isNew:a,className:"select-none"},e)),n.showRawData&&(0,l.jsx)(eK.n,{data:t,severity:t.severity,wrapText:n.wrapText,showPlainText:n.showPlainText,isNew:a,dataColumns:n.dataColumns,showAttributes:n.showDataAttributes,toJSON:e$}),!n.showRawData&&(0,l.jsx)(eg.n,{severity:t.severity,isNew:a})]})}),e$=e=>(0,eH.H_)(e,{message:!0,timestamp:!0,attributes:!0,tags:!1});function eX(e){var t;let{deployment:n,filter:a}=e,{routes:r}=(0,R.c)();return(0,l.jsx)(eJ.m,{content:"Open in Log Explorer",side:"bottom",className:"text-xs font-medium",children:(0,l.jsx)("div",{children:(0,l.jsx)(T.sh,{icon:j.GrD,color:"gray",size:"xs",variant:"outline",className:"p-4 bg-background",title:"Open in Log Explorer",...r.projectLogs({filter:"(@deployment:".concat(n.id,") ").concat(a),start:new Date(n.createdAt).getTime()+"",end:n.status!==d.Uty.Success?new Date(null!=(t=n.statusUpdatedAt)?t:n.updatedAt).getTime()+"":void 0})})})})}var eY=n(53036),e0=n(38922),e1=n(55850),e5=n(94702),e2=n(2092),e4=n(72783),e6=n(89118),e7=n(80374);let e3={[d.Uty.Building]:"bg-blue-50 border border-blue-200",[d.Uty.Crashed]:"bg-red-50 border border-red-200",[d.Uty.Deploying]:"bg-blue-50 border border-blue-200",[d.Uty.Failed]:"bg-red-50 border border-red-200",[d.Uty.Success]:"bg-green-50 border border-green-200",[d.Uty.Initializing]:"bg-blue-50 border border-blue-200",[d.Uty.Sleeping]:"bg-yellow-50 border border-yellow-200"};function e9(e){let{currentEvent:t,deployment:n,isComplete:a=!1,error:r,events:i,map:d,startedAt:c,hasDeploymentFailed:u,isSleeping:m}=e,[p,x]=(0,s.useState)(""),g=""!==p,h=(0,N.xW)(["rounded-md",e3[n.status]]),v=(0,N.xW)(["flex","group","items-center","justify-between","gap-x-4","rounded-md","w-full","px-4","py-3"]),y=Object.keys(d);return(0,l.jsx)(e2.bL,{collapsible:!0,className:h,onValueChange:x,type:"single",value:p,children:(0,l.jsxs)(e2.q7,{value:"checklist",children:[(0,l.jsxs)(e2.l9,{className:v,children:[u?(0,l.jsx)("div",{className:"flex items-center text-sm text-red-500",children:(0,l.jsxs)("div",{className:"flex items-center gap-x-6",children:[(0,l.jsx)(L.In,{className:"text-red-500",icon:j.hcu}),r?(0,l.jsxs)("p",{children:["Deployment failed during the"," ",(0,o.JI)(o.t5[r.step])," ","process"]}):(0,l.jsx)("p",{children:"Deployment failed"})]})}):(0,l.jsxs)(l.Fragment,{children:[!a&&!r&&(0,l.jsx)(e4.B.InProgress,{currentEvent:t,events:i,isExpanded:g}),a&&!r&&!m&&(0,l.jsx)(e4.B.Complete,{}),m&&!r&&(0,l.jsx)(e4.B.Sleeping,{})]}),(0,l.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,l.jsx)("p",{className:"text-gray-500 text-sm text-right",children:g?"View less":"View more"}),(0,l.jsx)(L.In,{className:"group-rdx-state-open:rotate-180 group-rdx-state-closed:rotate-0 text-gray-500 transition-transform",color:"currentColor",icon:j.yQN,size:"sm"})]})]}),(0,l.jsx)(e2.UC,{className:"overflow-hidden bg-background border-t border-gray-100 rdx-state-open:animate-accordion-slide-down rdx-state-closed:animate-accordion-slide-up",children:y.map(e=>(0,l.jsx)(e6.e,{isExpanded:g,item:d[e],title:(0,e7.VR)(e).replaceAll("_","-"),hasDeploymentFailed:u,deploymentId:n.id},e))})]})})}var e8=n(30595),te=n(71144);let tt=["border","border-transparent","bg-black/[.02]","dark:bg-white/[.02]","flex flex-col","gap-y-4","py-3","px-4","rounded-md"];function tn(e){let{description:t,file:n,path:a,title:r,tooltip:s}=e;return(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,l.jsx)("p",{className:"text-gray-500 text-xs",children:r}),n&&a||s?(0,l.jsx)(eJ.m,{content:s?(0,l.jsx)(l.Fragment,{children:s}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"text-xs font-mono text-pink-500 dark:text-pink-600 break-all",children:a})," ","in ",n]}),side:"top",sideOffset:5,children:(0,l.jsx)(L.In,{icon:j.R2D,className:"text-gray-500",size:"sm"})}):null]}),(0,l.jsx)("p",{className:"text-foreground whitespace-pre-wrap",children:t})]})}function tl(e){let{children:t,title:n,icon:a}=e;return(0,l.jsxs)("div",{className:(0,N.xW)(tt),children:[(0,l.jsxs)("div",{className:"flex items-center gap-x-4",children:[(0,l.jsx)(L.In,{icon:a,size:"sm"}),(0,l.jsx)("p",{className:"font-semibold text-sm text-foreground",children:n})]}),(0,l.jsx)("div",{className:"ml-8",children:t})]})}let ta=e=>null!=e&&""!==e.toString().trim()&&(!Array.isArray(e)||e.length>0),tr=(e,t)=>null==t?"":Object.entries(null!=t?t:{}).filter(e=>{let[,t]=e;return ta(t)}).reduce((e,t)=>{let[n,l]=t;return"".concat(e,"\n").concat(n," = ").concat(JSON.stringify(l))},"".concat(e));var ts=n(4177),ti=n(56144),to=n(19966);function td(e){var t,n,a,r,i,o,d,c,u,m,p,x,g,h,v,y,f,b,w,N;let{meta:k,propertyFileMapping:S,serviceManifest:D}=e,I=[{name:"Builder",path:S["build.builder"],value:(0,l.jsx)(tc,{value:null==D||null==(t=D.build)?void 0:t.builder,nixpacksProviders:k.nixpacksProviders})},...(null==D||null==(n=D.build)?void 0:n.builder)==="RAILPACK"&&(null==k?void 0:k.railpackInfo)!=null?[{name:"Executable versions",value:(0,l.jsx)(tu,{railpackInfo:k.railpackInfo})}]:[],{name:"Build command",path:S["build.buildCommand"],value:null==D||null==(a=D.build)?void 0:a.buildCommand},{name:"Dockerfile path",path:S["build.dockerfilePath"],value:null==D||null==(r=D.build)?void 0:r.dockerfilePath},{name:"Nixpacks config path",path:S["build.nixpacksConfigPath"],value:null==D||null==(i=D.build)?void 0:i.nixpacksConfigPath},{name:"Watch patterns",path:S["build.watchPatterns"],value:Array.isArray(null==D||null==(o=D.build)?void 0:o.watchPatterns)?(null!=(N=null==D||null==(d=D.build)?void 0:d.watchPatterns)?N:[]).join("\n"):null==D||null==(c=D.build)?void 0:c.watchPatterns}].filter(e=>{let{value:t}=e;return ta(t)}),C=(0,s.useMemo)(()=>{var e,t;return(null==D||null==(e=D.deploy)?void 0:e.multiRegionConfig)==null?{value:null==D||null==(t=D.deploy)?void 0:t.numReplicas,path:S["deploy.numReplicas"]}:{value:Object.values(D.deploy.multiRegionConfig).reduce((e,t)=>{var n;return e+(null!=(n=null==t?void 0:t.numReplicas)?n:1)},0),path:void 0}},[null==D||null==(u=D.deploy)?void 0:u.multiRegionConfig,null==D||null==(m=D.deploy)?void 0:m.numReplicas]),R=(0,s.useMemo)(()=>{var e,t,n,l;let a=null==D||null==(e=D.deploy)?void 0:e.multiRegionConfig;if(null==a)return{value:[null!=(n=null==D||null==(t=D.deploy)?void 0:t.region)?n:ti.s9],path:S["deploy.region"]};let r=null!=(l=k.deprecatedRegions)?l:[],s=Object.keys(a),i=[];for(let e of s){let t=e,n=r.find(t=>t.region===e);null!=n&&(t=n.replacementRegion),i.includes(t)||i.push(t)}return{value:i,path:void 0,tooltip:r.length>0?"Deprecated regions replaced: "+r.map(e=>e.region).join(", "):null}},[null==D||null==(p=D.deploy)?void 0:p.multiRegionConfig,null==D||null==(x=D.deploy)?void 0:x.region]),T=[{name:"Cron schedule",value:null==D||null==(g=D.deploy)?void 0:g.cronSchedule,path:S["deploy.cronSchedule"]},!(0,to.M)(k)&&{name:"Start command",path:S["deploy.startCommand"],value:null==D||null==(h=D.deploy)?void 0:h.startCommand},{name:(0,e7.td)("Region",R.value.length),path:R.path,value:R.value.join(", "),tooltip:R.tooltip},{name:"Number of replicas",...C},{name:"Healthcheck path",value:null==D||null==(v=D.deploy)?void 0:v.healthcheckPath,path:S["deploy.healthcheckPath"]},{name:"Healthcheck timeout (sec)",value:null==D||null==(y=D.deploy)?void 0:y.healthcheckTimeout,path:S["deploy.healthcheckTimeout"]},{name:"Restart policy",value:(0,ts.C)(null==D||null==(f=D.deploy)?void 0:f.restartPolicyType),path:S["deploy.restartPolicyType"]},{name:"Restart policy max retries",value:(null==D||null==(b=D.deploy)?void 0:b.restartPolicyType)==="ON_FAILURE"?null==D||null==(w=D.deploy)?void 0:w.restartPolicyMaxRetries:null,path:S["deploy.restartPolicyMaxRetries"]}].filter(e=>!!e&&ta(e.value));return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"md:flex-1",children:(0,l.jsx)(tl,{icon:j.azJ,title:"Build",children:(0,l.jsx)("div",{className:"flex flex-col gap-y-4",children:I.map((e,t)=>{let{name:n,value:a,path:r}=e;return(0,l.jsxs)(s.Fragment,{children:[(0,l.jsx)(tn,{title:n,file:k.configFile,path:r,description:a}),t!==I.length-1&&(0,l.jsx)(A.c,{className:"my-0 border-gray-200"})]},n)})})})}),(0,l.jsx)("div",{className:"md:flex-1",children:(0,l.jsx)(tl,{icon:j.Esr,title:"Deploy",children:(0,l.jsx)("div",{className:"flex flex-col gap-y-4",children:T.map((e,t)=>{let{name:n,value:a,path:r,tooltip:i}=e;return(0,l.jsxs)(s.Fragment,{children:[(0,l.jsx)(tn,{title:n,file:k.configFile,path:r,description:a,tooltip:i}),t!==T.length-1&&(0,l.jsx)(A.c,{className:"my-0 border-black/[.05] dark:border-white/[.05]"})]},n)})})})})]})}let tc=e=>{let{value:t,nixpacksProviders:n}=e;return null==t?(0,l.jsx)(l.Fragment,{children:"Nixpacks"}):(0,l.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,l.jsx)("span",{children:(0,e7.VR)(t)}),(0,l.jsx)("div",{className:"flex gap-1 items-center",children:null==n?void 0:n.map((e,t)=>(0,l.jsx)("img",{src:"https://devicons.railway.com/".concat(e,".svg"),alt:e,className:"w-5 h-5"},t))})]})},tu=e=>{let{railpackInfo:t}=e;return null==t||null==t.resolvedPackages?null:(0,l.jsx)(eJ.m,{content:JSON.stringify(t,null,2),children:(0,l.jsx)("div",{className:"grid gap-0.5",children:Object.entries(t.resolvedPackages).map(e=>{let[t,n]=e;return(0,l.jsxs)("div",{children:[t,"@",null==n?void 0:n.resolvedVersion]},t)})})})};var tm=n(28592);n(97865),n(72898);var tp=n(80430),tx=n(5041);function tg(e){let{language:t,meta:n}=e,{routes:a}=(0,R.c)(),r=(null==n?void 0:n.configFile)!=null&&(null==n?void 0:n.repo)!=null&&null!=n.branch?(e=>{let{repo:t,branch:n,path:l}=e;return"https://github.com/".concat(t,"/edit/").concat(n,"/").concat(l)})({repo:n.repo,branch:n.branch,path:null!=n.rootDirectory?"".concat(n.rootDirectory,"/").concat(n.configFile):n.configFile}):null;return n.configFile?(0,l.jsxs)("div",{className:"grid items-center gap-2 grid-cols-[auto_1fr_auto] text-sm bg-black dark:bg-white bg-opacity-[2%] dark:bg-opacity-[2%] px-4 py-2 rounded-md",children:[(0,l.jsx)(L.In,{icon:j.CyN,className:"text-gray-500"}),(0,l.jsxs)("p",{className:"text-sm",children:["Configuration merged from"," ",(0,l.jsx)(S.N,{...a.projectServiceSettings({}),variant:"coloured",children:"service settings"})," ","and ",(0,l.jsx)("b",{className:"font-semibold",children:n.configFile})]}),null!=r&&(0,l.jsxs)(S.N,{variant:"coloured",href:r,className:"text-sm whitespace-nowrap",children:["Edit ",(0,l.jsx)("b",{className:"font-semibold",children:n.configFile})," in GitHub ↗"]})]}):(0,l.jsx)(k.l,{className:"items-center",size:"sm",variant:"info",children:(0,l.jsx)("div",{className:"flex items-center justify-between w-full",children:(0,l.jsxs)("p",{children:["Save this in a file called"," ",(0,l.jsx)("b",{className:"font-semibold",children:"json"===t?"railway.json":"railway.toml"})," ","to codify your deployments config."]})})})}function th(e){let{meta:t,serviceManifest:n}=e,[a,r]=(0,e8.A)("@railway/config/code/lang",{defaultValue:"json"}),[o,d]=(0,tm.T)(),[c,u]=(0,s.useState)(null),[m,p]=(0,s.useState)(null);return((0,s.useEffect)(()=>{try{var e;p(null),(null==n||null==(e=n.deploy)?void 0:e.region)===ti.s9&&delete n.deploy.region;let t="json"===a?(e=>{let t=Object.entries(null!=e?e:{}).reduce((e,t)=>{let[n,l]=t;return{...e,...null!=l?{[n]:Object.entries(l).filter(e=>{let[,t]=e;return ta(t)}).reduce((e,t)=>{let[n,l]=t;return{...e,[n]:l}},{})}:{}}},{});return JSON.stringify({$schema:i.V2,...t},null,2)})(n):(e=>{let t=tr("[build]",null==e?void 0:e.build),n=tr("[deploy]",null==e?void 0:e.deploy);return"".concat(t,"\n\n").concat(n)})(n);u(t)}catch(e){p(e.message),u(null)}},[a,n]),null==c)?null:(0,l.jsxs)("div",{className:"w-full",children:[(0,l.jsx)(tg,{language:a,meta:t}),(0,l.jsxs)("div",{className:"bg-black/[.02] dark:bg-white/[.02] relative p-4 mt-4 rounded-md",children:[(0,l.jsxs)("div",{className:(0,N.xW)("grid grid-cols-2","absolute top-4 left-0 right-4 items-center z-10"),children:[m&&(0,l.jsx)(k.l,{className:"items-center py-1",variant:"danger",children:m}),(0,l.jsxs)("div",{className:"flex col-start-2 gap-x-3 items-center justify-end",children:[(0,l.jsx)(tp.l,{size:"sm",label:{text:"Format",hidden:!0},options:[{value:"json",text:"JSON"},{value:"toml",text:"TOML"}],value:a,onChange:e=>{r(e)},style:{minWidth:"100px"}}),(0,l.jsx)(T.K0,{icon:o?j.Jlk:j.QRo,title:"Copy manifest to clipboard",variant:"outline",onClick:()=>{c&&d(c)}})]})]}),(0,l.jsx)(tx.$,{className:"bg-transparent border-none rounded-node",hideCopyButton:!0,children:c})]})]})}var tv=n(37590),ty=n(64124),tf=n.n(ty);let tb=["border","border-gray-200","cursor-pointer","flex items-center gap-x-2","px-3 py-2","group","text-gray-500","first:rounded-l-md","last:rounded-r-md"];function tj(e){var t,n;let{deployment:r,meta:i}=e,{track:o}=(0,te.j)(),[c,u]=(0,e8.A)("@railway/config/view",{defaultValue:"pretty"}),{routes:m}=(0,R.c)(),p=null!=(n=i.propertyFileMapping)?n:{},x=null==(t=r.meta)?void 0:t.serviceManifest,g=!!i.image;return(0,l.jsxs)(a.bL,{value:g?"pretty":c,onValueChange:e=>{e&&c!==e&&(o({action:"Click",object:"Deployment ${capitalize(value)} Configuration"}),u(e))},children:[(0,to.M)(i)&&i.serviceManifest&&(0,l.jsxs)("div",{className:"flex flex-col gap-4 justify-between pb-6",children:[(0,l.jsxs)("p",{className:"text-sm font-semibold text-foreground flex items-center gap-2",children:[(0,l.jsx)("span",{children:"Source Code"}),r.status===d.Uty.Success&&(0,l.jsx)(S.N,{...m.projectServiceSourceCode({}),variant:"underline",children:(0,l.jsx)(L.In,{icon:j.ffu,size:"sm"})})]}),(0,l.jsx)("div",{className:"flex flex-col gap-4 basis-full w-full",children:(0,l.jsx)("div",{className:"border-gray-200 border rounded-md overflow-hidden h-96 max-h-72",children:(0,l.jsx)(s.Suspense,{fallback:tw,children:(0,l.jsx)(tN,{initialValue:(0,I.getFunctionSourceCode)(i.serviceManifest),readOnly:!0})})})})]}),(0,l.jsxs)("div",{className:"flex items-center justify-between pb-4",children:[(0,l.jsx)("p",{className:"text-sm font-semibold text-foreground",children:"Configuration"}),!g&&(0,l.jsxs)(a.B8,{className:"grid grid-cols-2",children:[(0,l.jsxs)(a.l9,{className:(0,N.xW)([...tb,"pretty"===c&&"text-foreground","pretty"!==c&&"border-gray-200 hover:text-foreground"]),value:"pretty",children:[(0,l.jsx)(L.In,{icon:j.B8B,size:"sm"}),(0,l.jsx)("p",{className:"text-sm",children:"Pretty"})]}),(0,l.jsxs)(a.l9,{className:(0,N.xW)([...tb,"code"===c&&"text-foreground","code"!==c&&"border-gray-200 hover:text-foreground"]),value:"code",children:[(0,l.jsx)(L.In,{icon:j.CyN,size:"sm"}),(0,l.jsx)("p",{className:"text-sm",children:"Code"})]})]})]}),(0,l.jsx)(a.UC,{className:"flex flex-col sm:flex-row flex-wrap gap-2 gap-y-4",value:"pretty",children:(0,l.jsx)(td,{meta:i,propertyFileMapping:p,serviceManifest:x})}),(0,l.jsx)(a.UC,{className:"h-full",value:"code",children:(0,l.jsx)(th,{meta:i,serviceManifest:x})})]})}let tw=(0,l.jsx)("div",{className:"w-full h-full relative",children:(0,l.jsx)(tv.g,{style:{borderRadius:0,position:"absolute",inset:0},width:"100%",height:"100%"})}),tN=tf()(()=>Promise.all([n.e(9002),n.e(4369),n.e(8812),n.e(4809),n.e(7976)]).then(n.bind(n,17976)).then(e=>e.CodeMirror),{loadableGenerated:{webpack:()=>[17976]},ssr:!1,loading:()=>tw});var tk=n(98498),tS=n(21507),tD=n(95662),tI=n(42419),tC=n(37245),tR=n(41220),tT=n(73648),tA=n(91555),tL=n(15857),tP=n(94474);let tE=e=>{let{email:t}=e,n=(0,u.md)(tL.T6),{workspace:a}=(0,tT.hA)(),[r,i]=(0,s.useState)(!1),{routes:o,navActions:d}=(0,R.c)();return n?(0,l.jsxs)(tR.bL,{open:r,modal:!0,children:[(0,l.jsx)(tR.l9,{className:"text-sm text-pink-700 hover:text-pink-600 underline",onClick:()=>{i(!0)},children:"Invite them"}),(0,l.jsx)(tR.ZL,{children:(0,l.jsx)(tR.UC,{align:"end",className:"px-6 py-4 z-40 lg:min-w-[482px] w-[260px] shadow-sm bg-background rounded-lg border border-black border-opacity-[7%] dark:border-white dark:border-opacity-[7%]",sideOffset:8,onPointerDownOutside:()=>i(!1),onEscapeKeyDown:()=>i(!1),onFocusOutside:()=>i(!1),onInteractOutside:()=>i(!1),children:(null==a?void 0:a.teamId)?(0,l.jsx)(tF,{email:t,workspace:a,onClosePopover:()=>i(!1)}):(0,l.jsx)(tP.p8,{project:n,email:t,onClosePopover:()=>i(!1)})})})]}):null},tF=e=>{let{workspace:t,email:n,onClosePopover:a}=e,{routes:r,navActions:s}=(0,R.c)(),{track:i}=(0,te.j)();return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(tD.z,{justify:"between",align:"center",children:(0,l.jsx)(tI.ax,{className:"font-semibold",children:"Invite to team"})}),(0,l.jsx)(A.c,{}),(0,l.jsx)(tA.TeamInviteForm,{email:n}),(0,l.jsxs)(tD.z,{justify:"between",align:"center",className:"pl-2 py-2",children:[(0,l.jsx)(tI.ax,{className:"font-medium",children:"People with Access"}),(0,l.jsx)(T.$n,{variant:"ghost",onClick:()=>{var e;a(),s.push(r.workspacePeople({teamId:null!=(e=t.teamId)?e:void 0}))},size:"sm",children:"Manage Access"})]}),(0,l.jsx)(tD.T,{as:"ul",space:2,children:(0,l.jsx)(tP.RV,{workspace:t})})]})},tW=["border","border-transparent","bg-black/[.02]","dark:bg-white/[.02]","flex","items-center","gap-x-4","py-3","px-4","rounded-md"];function tz(e){var t;let{deployment:n}=e;return(0,l.jsxs)("div",{className:(0,N.xW)(tW),children:[(0,l.jsx)(tC.$,{deployment:n}),(0,l.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,l.jsx)("p",{className:"font-mono text-foreground text-sm",children:"railway up"}),(0,l.jsx)("p",{className:"text-sm text-gray-500",children:null==(t=n.creator)?void 0:t.name})]})]})}function tO(e){let{deployment:t,meta:n}=e,a=n.image&&(0,tS.o6)(n.image),r=n.image&&(0,tk.parseDockerImage)(n.image),s=r&&(0,tk.getDockerImageRegistryName)(r),i=r&&(0,tk.getDockerImageUrl)(r),o=n.imageDigest;return(0,l.jsxs)(S.N,{className:(0,N.xW)([...tW,"hover:border-pink-500"]),href:i||void 0,target:"_blank",rel:"noopener noreferrer",children:[(0,l.jsx)(tC.$,{deployment:t}),(0,l.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,l.jsx)("p",{className:"text-sm text-foreground",children:a}),(0,l.jsxs)("div",{className:"flex gap-2 text-gray-500 text-xs",children:[(0,l.jsx)("p",{children:s}),null!=o&&""!==o.trim()&&(0,l.jsx)("p",{className:"font-mono",children:(0,tk.formatSha)(o)})]})]})]})}function tq(e){var t,n,a;let{deployment:r,meta:s}=e,i=o.vZ.includes(r.status);return(0,l.jsxs)(tD.T,{className:(0,N.xW)([...tW,"hover:border-pink-500",...i?["bg-yellow-50 dark:bg-yellow-50 border-yellow-200 shadow-sm hover:bg-yellow-100 hover:border-yellow-300"]:[""]]),children:[(0,l.jsxs)(S.N,{className:"w-full grid grid-cols-[auto_1fr]",href:"https://github.com/".concat(s.repo,"/commit/").concat(s.commitHash),target:"_blank",rel:"noopener noreferrer",children:[(0,l.jsx)(tC.$,{deployment:r}),(0,l.jsxs)("div",{className:"flex flex-col gap-y-1 ml-2",children:[(0,l.jsx)("p",{className:"text-sm text-foreground line-clamp-3 overflow-ellipsis",title:s.commitMessage,children:s.commitMessage}),(0,l.jsxs)("div",{className:"flex items-center gap-x-2 text-gray-500 text-xs",children:[(0,l.jsx)("p",{children:s.repo}),(0,l.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,l.jsx)(L.In,{icon:j.lg3,size:"sm"}),(0,l.jsx)("p",{children:s.branch})]}),s.rootDirectory&&(0,l.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,l.jsx)(L.In,{icon:j.vdG,size:"sm"}),(0,l.jsx)("p",{children:s.rootDirectory})]})]})]})]}),i?(0,l.jsxs)("div",{className:"w-full mt-2 text-yellow-600 dark:text-yellow-700",children:[(0,l.jsx)("hr",{className:"my-1"}),(0,l.jsxs)("div",{className:"mt-3 flex flex-row",children:[(0,l.jsx)(L.In,{icon:j.ypN,size:"lg",className:"mx-2.5"}),(0,l.jsxs)(tI.ax,{children:[(0,l.jsx)("span",{className:"underline",children:null!=(a=null==(t=r.creator)?void 0:t.name)?a:"User"})," ","isn't on the Railway team, so their commit needs approval."," ",(0,l.jsx)(tE,{email:null==(n=r.creator)?void 0:n.email})," to bypass this requirement."]})]})]}):void 0]})}function tU(e){let{deployment:t,meta:n}=e,a=(0,tS.c5)(t.meta),r=o.vZ.includes(t.status);return(0,l.jsxs)("div",{className:"flex flex-col gap-y-3",children:[(0,l.jsxs)("p",{className:"text-sm font-semibold text-foreground",children:["CLI"===a&&"Deployed via CLI","Docker"===a&&"Deployed via Docker Image","GitHub"===a&&r&&"Deployment Request Details","GitHub"===a&&!r&&"Deployed via GitHub"]}),"CLI"===a&&(0,l.jsx)(tz,{deployment:t}),"Docker"===a&&(0,l.jsx)(tO,{deployment:t,meta:n}),"GitHub"===a&&(0,l.jsx)(tq,{deployment:t,meta:n})]})}var tM=n(79060);function t_(e){let{isLoading:t=!1,variables:n}=e,a=Object.entries(null!=n?n:{});return(0,l.jsx)("div",{className:"bg-black/[.02] dark:bg-white/[.02] rounded-md",children:(0,l.jsx)(tM.Z,{disabled:t||0===a.length,hasChevron:a.length>0,triggerClassName:"px-4 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:rounded-md",title:(0,l.jsxs)(l.Fragment,{children:[t&&(0,l.jsx)(tv.g,{height:"20px",width:"80px"}),!t&&(0,l.jsxs)("p",{className:"text-sm text-foreground",children:[a.length," ",(0,e7.td)("Variable",a.length)]})]}),children:a.map((e,t)=>{let[n,a]=e;return(0,l.jsxs)("div",{className:(0,N.xW)(["border-t border-transparent flex items-center justify-between gap-x-8 px-4 py-3",t>0&&"border-black/5"]),children:[(0,l.jsx)("div",{className:"flex-1 max-w-36 sm:max-w-[325px] overflow-x-scroll",children:(0,l.jsx)("span",{className:"font-mono text-foreground text-sm",children:n})}),(0,l.jsx)("div",{className:"bg-black/[0.04] dark:bg-white/[0.04] flex-1 max-w-36 sm:max-w-sm overflow-x-scroll rounded-md px-3 py-2",children:(0,l.jsx)("span",{className:"text-foreground text-sm",children:a})})]},n)})})})}function tB(e){var t,n,a,r;let{deployment:s}=e,i=null!=(a=null==s?void 0:s.meta)?a:{},d=(0,u.md)(m.mz),{graphqlClient:c}=(0,e1.q)(),{currentEvent:p,data:x,error:g,isComplete:h,isLoading:v,isSleeping:y,startedAt:f,hasDeploymentFailed:b}=(0,e0.J)(s,{isFirstDeployment:!1}),{data:j,isLoading:w}=(0,eY.I)({queryKey:["deploymentSnapshot",s.id],queryFn:async()=>c.deploymentSnapshot({deploymentId:s.id}),refetchInterval:!1,refetchOnWindowFocus:!1}),N=null!=(r=null==j||null==(t=j.deploymentSnapshot)?void 0:t.variables)?r:{},S=Object.values((0,o.hT)(s,!1)).flatMap(e=>e),D=!o.Dt.includes(s.status)&&!o.vZ.includes(s.status)&&(0,e5.AX)(s.createdAt,o.Q0);return(0,l.jsxs)("div",{className:"bg-secondaryBg overflow-y-auto flex flex-col gap-y-6 h-full px-12 py-8",children:[(null==(n=s.meta)?void 0:n.failedReason)?(0,l.jsx)(k.l,{variant:"warning",children:s.meta.failedReason}):null,D&&(0,l.jsx)(e9,{currentEvent:p,deployment:s,events:S,error:g,isComplete:h,isLoading:v,map:x,startedAt:f,hasDeploymentFailed:b,isSleeping:y}),d&&(0,l.jsx)(t_,{variables:N,isLoading:w}),(0,l.jsx)(tU,{deployment:s,meta:i}),(0,l.jsx)(tj,{deployment:s,meta:i})]})}var tK=n(94554);n(38023);var tJ=n(52992),tH=n(44153),tQ=n(77505),tV=n(44039),tG=n(12645),tZ=n(54131),t$=n(56229),tX=n(17057),tY=n(36725),t0=n(88887);n(39303),n(90567);let t1=e=>{var t,n;let{deployment:a,hideActions:r,showAdminLinks:s,showBackLink:i}=e,{routes:c,query:x}=(0,R.c)(),{modalActions:g}=(0,tQ.U)(),[,h]=(0,tm.T)(),v=(0,u.md)(m.mz),y=(0,u.md)((0,tZ.lU)(a.serviceId)),f=(0,u.md)(tG.KE),b=t4(x.returnTo,c,f),w=(0,u.md)((0,tV.KI)({environmentId:a.environmentId,serviceId:null!=(n=a.serviceId)?n:""})),k=a.id.substring(0,7),D=a.status===d.Uty.Initializing||a.status===d.Uty.Queued||a.status===d.Uty.Building||a.status===d.Uty.Deploying,I=o.vZ.includes(a.status),C=a.status===d.Uty.Failed||a.status===d.Uty.Crashed,P=a.status===d.Uty.Success,E=a.status===d.Uty.Sleeping,{serviceIcon:F,serviceName:W}=(0,tH.W)(y,null==w?void 0:w.source),{actions:z,isLoading:O}=(0,p.f)(a);return(0,l.jsxs)("div",{className:"grid gap-6 pt-8 px-5 md:px-12 md:pt-10 z-50",children:[(0,l.jsxs)("div",{className:"grid gap-3 grid-cols-[auto_1fr_auto] items-center w-full",children:[(0,l.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,l.jsxs)(S.N,{variant:"highlight",...c.projectServiceDeployments({environmentId:a.environmentId}),className:"flex items-center gap-x-3 group leading-7",children:[(0,l.jsx)(L.In,{size:"lg",icon:F,className:"cursor-pointer"}),(0,l.jsx)("span",{className:" font-semibold text-xl text-foreground hover:text-pink-600",children:W})]}),(0,l.jsx)("span",{className:"text-gray-200 text-xl",children:"/"}),(0,l.jsx)("button",{onClick:()=>{h(a.id),g.createToast((0,l.jsx)(t0.y8,{title:"Copied deployment ID",variant:"success",description:"Feel free to paste it in the Railway Discord"}))},className:"text-xl text-foreground font-mono leading-7 hover:text-pink-600",children:k})]}),a&&(0,l.jsx)(tY.g,{className:"hidden sm:block text-gray-500 text-sm text-right max-w-max justify-self-end",children:a.createdAt}),!a&&(0,l.jsx)(tv.g,{width:"100px",height:"21px",className:"justify-self-end"}),i&&(0,l.jsx)(T.vx,{icon:j.X,variant:"ghost",color:"gray",size:"sm","data-testid":"close-deployment-pane",...b,className:"col-start-3 text-gray-500"})]}),(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[a&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"flex items-center gap-x-4 isolate",children:[(0,l.jsx)("p",{"data-testid":"deployment-detail-status",className:(0,N.xW)("deployment-detail-status","text-sm col-start-1 border px-2 py-1 font-medium uppercase rounded-full z-10","text-gray-500 dark:text-gray-600 bg-gray-50 border-gray-200",I&&"text-yellow-500 dark:text-yellow-600 bg-yellow-50 border-yellow-200 dark:border-yellow-300",D&&"!text-blue-500 dark:!text-blue-600 !bg-blue-50 !border-blue-200 dark:!border-blue-300",C&&"text-red-500 dark:text-red-600 bg-red-50 border-red-200 dark:border-red-300",P&&"text-green-500 dark:text-green-600 bg-green-50 border-green-200 dark:border-green-300",E&&"text-yellow-500 dark:text-yellow-600 bg-yellow-50 border-yellow-200 dark:border-yellow-300"),children:(0,tS.Iw)(a)}),(null==(t=a.meta)?void 0:t.skippedReason)&&(0,l.jsx)("p",{className:"text-sm truncate hidden sm:block text-gray-500 bg-black/[.01] dark:bg-black/[.2] border border-gray-200 pr-4 pl-10 py-1 rounded-full -ml-11",children:a.meta.skippedReason}),a.staticUrl&&(0,l.jsx)(S.G,{href:"https://".concat(a.staticUrl),external:!0,className:"hidden sm:block",children:a.staticUrl}),I&&(0,l.jsx)("p",{className:"text-yellow-500 dark:text-yellow-600",children:"Deploy this commit from an external contributor?"}),(0,l.jsx)(tY.g,{className:"text-sm block sm:hidden text-gray-500",children:a.createdAt})]}),(0,l.jsxs)("div",{className:"flex items-center gap-x-4",children:[I&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(T.$n,{color:"green",icon:j.Jlk,isLoading:O,disabled:O,size:"sm",onClick:()=>{z.approveDeployment()},variant:"outline",children:"Deploy"}),(0,l.jsx)(T.$n,{color:"gray",icon:j.X,isLoading:O,disabled:O,size:"sm",onClick:()=>{z.rejectDeployment()},variant:"outline",children:"Skip"})]}),C&&(0,l.jsx)("div",{className:"flex items-center gap-x-4",children:(0,l.jsx)(T.vx,{size:"sm",variant:"primary",title:"Railway Help Station",name:"Railway Help Station",icon:j.YjQ,href:tK.D8,children:"Get Help"})}),!r&&v&&!I&&(0,l.jsxs)(tX.ms,{children:[(0,l.jsx)(tX.Lk,{title:"Deployment actions",icon:j.GvN,className:"col-start-3 w-9 h-9 text-gray-500 border border-gray-200 flex justify-center items-center hover:bg-gray-100","data-testid":"deployment-actions-dropdown"}),null!=a&&(0,l.jsx)(t2,{deployment:a})]})]})]}),!a&&(0,l.jsx)("div",{className:"py-1 col-span-2",children:(0,l.jsx)(tv.g,{width:"62px",height:"28px"})})]}),s&&null!=a&&(0,l.jsx)(t5,{deployment:a}),(0,l.jsx)(A.c,{className:"my-0"})]})},t5=e=>{var t;let{deployment:n}=e,{actions:a}=(0,p.f)({...n,environmentId:n.environmentId}),{routes:r}=(0,R.c)(),{modalActions:s}=(0,tQ.U)(),{showModal:i}=(0,tJ.h)();return(0,l.jsx)(k.l,{icon:j.c_I,children:(0,l.jsxs)(tD.z,{space:2,align:"center",className:"w-full",children:[(0,l.jsx)(tI.ax,{className:"mr-auto",children:"Admin Actions"}),(0,l.jsx)(T.vx,{...r.projectServiceDeployments({projectId:n.projectId,environmentId:n.environmentId,serviceId:null!=(t=n.serviceId)?t:"",deploymentId:n.id}),external:!0,variant:"outline",size:"xs",children:"Go to project"}),(0,l.jsx)(T.vx,{onClick:a.downloadSnapshot,variant:"outline",size:"xs",children:"Download code"}),(0,l.jsx)(T.$n,{color:"red",variant:"outline",size:"xs",onClick:()=>{if(null==n.creator)s.createToast((0,l.jsx)(t0.y8,{variant:"error",title:"Cannot Ban",description:"Deployment does not have a creator"}));else{var e;i(t$.P,{user:{id:n.creator.id,name:null!=(e=n.creator.name)?e:n.creator.email}})}},className:"max-w-max",children:"Ban User"})]})})},t2=e=>{let{deployment:t}=e,{actions:n}=(0,p.f)({...t,environmentId:t.environmentId});return(0,l.jsxs)(tX.pm,{align:"end",children:[null!=n.restartDeployment&&(0,l.jsx)(tX.tJ,{onSelect:n.restartDeployment,name:"Restart",children:"Restart"}),null!=n.rollbackDeployment&&(0,l.jsx)(tX.tJ,{onSelect:n.rollbackDeployment,name:"Rollback",children:"Rollback"}),null!=n.redeployDeployment&&(0,l.jsx)(tX.tJ,{onSelect:n.redeployDeployment,name:"Redeploy",children:"Redeploy"}),null!=n.deployCommit&&(0,l.jsx)(tX.tJ,{onSelect:n.deployCommit,name:"Deploy commit",children:"Deploy commit"}),null!=n.cancelDeployment&&(0,l.jsx)(tX.tJ,{onSelect:n.cancelDeployment,name:"Abort",className:"text-red-500",children:"Abort"}),null!=n.removeDeployment&&(0,l.jsx)(tX.tJ,{onSelect:n.removeDeployment,name:"Remove",className:"text-red-500",children:"Remove"})]})},t4=(e,t,n)=>"cron-schedule"===e?t.projectServiceSchedule({environmentId:n}):t.projectServiceDeployments({environmentId:n});var t6=n(28476);let{useLogs:t7,useLogsQuery:t3,useLogsStream:t9,useLogsPagination:t8,atoms:{newLogsAtom:ne}}=(0,ed.G)({defaultPaginationLimit:500,streamLogs:(e,t,n,l)=>e(et.iv).subscribe({query:(0,ee.y)(d.pZ6),variables:n},{...l,next(e){e.data&&l.next(e.data.httpLogs)}}),async queryLogs(e,t,n){let l=e(en.a);if(!l)throw Error("No GraphQL client");return(await l.httpLogs(n)).httpLogs}});function nt(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{requestId:l=!0,timestamp:a=!0,method:r=!0,path:s=!0,host:i=!0,httpStatus:o=!0,upstreamProto:d=!0,downstreamProto:c=!0,responseDetails:u=!0,totalDuration:m=!0,upstreamAddress:p=!0,clientUa:x=!0,upstreamRqDuration:g=!0,txBytes:h=!0,rxBytes:v=!0,srcIp:y=!0,edgeRegion:f=!0,upstreamErrors:b=!0}=n;return null!=(t=(0,eN.xF)({requestId:l?e.requestId:void 0,timestamp:a?e.timestamp:void 0,method:r?e.method:void 0,path:s?e.path:void 0,host:i?e.host:void 0,httpStatus:o?e.httpStatus:void 0,upstreamProto:d?e.upstreamProto:void 0,downstreamProto:c?e.downstreamProto:void 0,responseDetails:u?e.responseDetails:void 0,totalDuration:m?e.totalDuration:void 0,upstreamAddress:p?e.upstreamAddress:void 0,clientUa:x?e.clientUa:void 0,upstreamRqDuration:g?e.upstreamRqDuration:void 0,txBytes:h?e.txBytes:void 0,rxBytes:v?e.rxBytes:void 0,srcIp:y?e.srcIp:void 0,edgeRegion:f?e.edgeRegion:void 0,upstreamErrors:b?e.upstreamErrors:void 0}))?t:{}}var nn=n(76999);function nl(e){let{tags:t,name:n,children:a,className:r,...s}=e,i=(0,_.R7)(),o=(0,N.xW)("text-neutral-secondary",r),d=a;switch(n){case"totalDuration":d=(0,U.e)(Number(a),{unitDisplay:"narrow"});break;case"httpStatus":let c=Number(d);o=c>=500?"text-danger":c>=400?"text-warn":c>=300?"text-info":"text-success";break;case"path":o="text-neutral"}return(0,l.jsx)(eg.n,{className:(0,N.xW)("text-neutral-secondary",o),...s,children:(0,l.jsx)("button",{className:i.enabled?"hover:underline text-left":"text-left",onClick:()=>{i.addExpression(new nn.nW(n,a))},children:d})})}function na(e){let t=(0,_.A5)();return(0,l.jsx)(_.B4,{backend:t,children:(0,l.jsx)(nr,{deployment:e.deployment})})}let nr=(0,s.memo)(function(e){let{deployment:t}=e,{projectId:n}=t,[a,r]=(0,s.useState)(!1),i=(0,_.R7)(),o=(0,s.useRef)(null),d=(0,s.useMemo)(()=>({startTime:new Date(t.createdAt).getTime(),endTime:"SUCCESS"!==t.status?new Date(t.updatedAt).getTime():null}),[t.status,t.createdAt,t.updatedAt]),c=i+"",u=t7({variables:{deploymentId:t.id,filter:c?c.includes("@")?c:"@path:".concat(c):"",...(0,K.m)({timeRange:d})},streamPaused:a,onStreamPausedChange:r,mode:"SUCCESS"!==t.status?"query":"stream"}),m=t8(u),p=(0,J.FW)({id:n,type:"http"}),x=(0,s.useCallback)(function(e,t){var n;let a=null==(n=u.store.get(ne))?void 0:n.has(e.timestamp);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(H.x,{showSeverity:!1,isNew:a,className:"select-none hover:underline cursor-pointer",children:e.timestamp}),...p.railwayColumns.map(t=>{let n=e[t];return(0,l.jsx)(nl,{name:t,wrapText:p.wrapText,isNew:a,children:n},t)}),(0,l.jsx)(eg.n,{isNew:a})]})},[p,u.store]),g=(0,s.useCallback)(()=>{let e=new Date().toLocaleTimeString([],{timeZoneName:"short"}).split(" ").pop(),t=[{key:"time",columnKey:"timestamp",defaultWidth:156,children:"Time (".concat(e,")")},...p.railwayColumns.map(e=>({key:e,columnKey:e,defaultWidth:"path"===e?200:"totalDuration"===e||"httpStatus"===e?120:64,children:(0,eN.$l)(e)})),{key:"settings",columnKey:"settings",children:(0,l.jsx)(J.QA,{id:n,type:"http",className:"!pr-0",visibleOptions:{dataColumns:!1,showHistogram:!1,showPlainText:!1,showRawData:!1,showDataAttributes:!1,showSeverity:!1}}),className:"text-right"}];return t.map((e,n)=>(0,l.jsx)(Q.x,{columnKey:e.columnKey,resizable:n<t.length-(p.showRawData?2:1),defaultWidth:e.defaultWidth,className:e.className,style:e.style,children:e.children},e.key))},[p]);(0,s.useEffect)(()=>{if("connected"!==u.status&&"connecting"!==u.status&&!a){var e;null==(e=o.current)||e.scrollToPosition("bottom")}},[u.status]);let h=(0,s.useRef)(null),v=eO(h),y=(0,s.useMemo)(()=>({Row:(0,eQ.C)({toJSON:nt})}),[]);return(0,l.jsxs)("div",{className:"w-full h-full relative grid grid-rows-[min-content,minmax(0,auto)]",ref:h,style:{height:v},children:[(0,l.jsx)("div",{className:"grid grid-rows-1 sm:grid-rows-[max-content,minmax(0,1fr)] w-full",children:(0,l.jsx)("div",{className:"hidden sm:flex bg-secondaryBg w-full flex-col pb-2 gap-y-3.5 border-b border-b-neutral max-w-[100vw]",children:(0,l.jsx)("div",{className:(0,N.xW)("pt-2 px-2 grid sm:items-stretch grid-rows-2 items-center grid-cols-[minmax(0,1fr),max-content] sm:grid-rows-1 sm:grid-cols-[minmax(0,1fr),max-content,max-content] gap-2"),children:(0,l.jsx)(_.ZY,{className:"col-span-2 sm:col-span-1",showPopover:!1,placeholder:"Search HTTP logs e.g. @path:/api/users @httpStatus:200"})})})}),(0,l.jsxs)("div",{className:"w-full h-full pb-1.5 relative max-w-[100vw] bg-background",children:[u.isLoading&&!u.data.length?(0,l.jsx)(G.C,{}):u.isLoading||u.data.length?(0,l.jsx)(Z.t,{logs:u.data,toJSON:nt,children:(0,l.jsx)(B.M,{ref:o,data:u.data,showScrollbar:!1,components:y,renderRow:x,renderHeader:g,renderTopBookend:e=>(0,l.jsx)($.w,{position:"top",timeRange:d,pagination:m,...e}),renderBottomBookend:e=>(0,l.jsx)($.w,{position:"bottom",timeRange:d,pagination:m,...e}),onScrollStateChange:e=>{"bottom"!==e.position&&"both"!==e.position?r(!0):r(!1)}})}):(0,l.jsx)(G.C,{title:i.expression?"No logs found for this filter":"No logs in this time range",subtitle:"Logs will show up here as they are found."}),(0,l.jsx)(X.Y,{isPaused:"timedOut"===u.status,onResume:()=>{r(!1),u.reconnectStream()}})]})]})});var ns=n(50825),ni=n(50253),no=n.n(ni);let nd="deployment-metro-pane",nc=e=>{let{deploymentId:t,hideActions:n=!1,showAdminLinks:a=!1,showBackLink:i=!1,isLoadingProject:o}=e,{deployment:d}=(0,x.hF)(t),c=(0,u.md)(m.DM),p=(()=>{let{query:e}=(0,q.useRouter)();return(0,s.useMemo)(()=>{if("string"==typeof e.start&&"string"==typeof e.end){let t=no()(e.start).subtract(15,"seconds").toDate();return{end:no()(e.end).add(15,"seconds").toDate(),start:t}}},[e])})();(0,g.HX)(null==d?void 0:d.status);let h=(0,r.tF)();return(0,f.Lu)(h),(0,l.jsx)(D.Xd,{className:(0,N.xW)(nd,"grid-rows-[minmax(0px,_1fr)]"),children:d&&(0,l.jsx)(nm,{deployment:d,hideActions:n,initialDateRange:p,isLoadingProject:o,permissions:c,showAdminLinks:a,showBackLink:i})})},nu=[{value:"@requestId:",icon:j.dJT},{value:"@srcIp:",icon:j.qzq},{value:"@method:",icon:j.dJT},{value:"@path:",icon:j.dJT},{value:"@httpStatus:",icon:j.dJT}],nm=e=>{var t,n,r,u;let{deployment:m,initialDateRange:p,hideActions:x,showAdminLinks:g,showBackLink:f,permissions:k,isLoadingProject:S}=e,D=null!=(t=m.projectId)?t:"",[{user:I}]=(0,w.Jd)(),[C,R]=(0,s.useState)(!1),T=o.vZ.includes(m.status),A=(0,y.py)();(0,c.bU)(()=>({value:"log-preferences",text:"Log Preferences",group:"Deployment",highlighted:!0,icon:j.wB_,subCommands:A}),[A]),(0,c.bU)(()=>({value:"open-deployment-temporal-".concat(m.id),text:"Open in Temporal",icon:j.GrD,group:"Admin",action:()=>{var e;window.open((0,i.$8)({deploymentId:m.id,isRollback:(null==(e=m.meta)?void 0:e.reason)==="rollback"}))},isAvailable:()=>{var e;return null!=(e=null==I?void 0:I.isAdmin)&&e}}),[null==I?void 0:I.isAdmin,m.id]);let L=(null==I?void 0:I.isAdmin)||(null==k?void 0:k.Read),[P,E]=((e,t)=>{var n;let l=(0,ns.Q)(),a=(0,s.useRef)(l),r=(0,s.useRef)(!1),i=null!=(n=null==e?void 0:e.meta)?n:{},o=n=>{if(null==e||!t)return"details";let l=["details","build","deploy","http"].includes(null!=n?n:"");if(null!=n&&l)return n;if(e.status===d.Uty.Initializing||e.status===d.Uty.Queued||e.status===d.Uty.NeedsApproval)return"details";let a=e.status===d.Uty.Building||e.status===d.Uty.Deploying||e.status===d.Uty.Skipped||e.status===d.Uty.Failed;return a&&null!=i.image?"deploy":a?"build":"deploy"},[c,u]=(0,s.useState)(o(l));return(0,s.useEffect)(()=>{(r.current||!l)&&u(o(l!==a.current?l:void 0)),r.current=!0},[null==e?void 0:e.status,t]),[c,u]})(m,L),F=(0,s.useRef)(null),W=(0,s.useRef)(null),z=(0,b.Z)(),O=(0,v.v)({projectId:D,extraFilter:"@snapshot:".concat(m.snapshotId," OR @replica:").concat(m.snapshotId)}),q=(0,v.v)({projectId:D,extraFilter:"@deployment:".concat(m.id," -@replica:").concat(m.snapshotId)}),[U,M]=null!=(n=({build:O,deploy:q,http:(0,v.v)({projectId:D,extraFilter:"",autocompleteOptions:nu}),details:null})[P])?n:[],_=(0,s.useMemo)(()=>p||{end:null,start:new Date(m.createdAt)},[m]);return(0,s.useEffect)(()=>{z?(F.current=document.querySelector(".".concat(nd)),W.current=document.querySelector(".tabs-root")):(F.current=null,W.current=null)},[z]),(0,h.N)({scrollContainer:F,childContainer:W}),(0,l.jsxs)(a.bL,{value:P,onValueChange:E,className:(0,N.xW)("tabs-root","grid relative","grid-rows-[auto_auto_minmax(0px,_1fr)] h-full"),children:[null!=m&&(0,l.jsx)(np,{deployment:m}),(0,l.jsx)(t1,{deployment:m,hideActions:x,showAdminLinks:g,showBackLink:f}),T?void 0:(0,l.jsx)(t6.f,{autocompleteOptions:null==U?void 0:U.autocompleteOptions,activeTab:null==m||S?"":P,activeFilter:null!=(r=null==U?void 0:U.filter)?r:"",setActiveDateRangeAndFilter:null==M?void 0:M.setDateRangeAndFilter,activeDateRange:_,isLoading:C,logExplorerRoute:null==M?void 0:M.logExplorerRoute,tabs:[{label:"Details",value:"details",hidden:S},{label:"Build",value:"build",appendLogs:!0,hidden:!L},{label:"Deploy",value:"deploy",appendLogs:!0,hidden:!L},{label:"HTTP",value:"http",appendLogs:!0,hidden:!m.staticUrl||!L}]}),null!=m?(0,l.jsx)(nx,{deployment:m,filter:null==U?void 0:U.filter,filterWithExtras:null==U?void 0:U.filterWithExtras,scrollParent:null!=(u=F.current)?u:void 0,contextStart:null==U?void 0:U.contextStart,contextEnd:null==U?void 0:U.contextEnd,logExplorerRoute:null==M?void 0:M.logExplorerRoute,setIsLoading:R,activeDateRange:_,setActiveDateRangeAndFilter:null==M?void 0:M.setDateRangeAndFilter}):(0,l.jsx)("div",{className:"h-full bg-secondaryBg dark:bg-gray-100"})]})},np=e=>{let{deployment:t}=e;return(e=>{let{actions:t,isLoading:n}=(0,p.f)(e),l=(0,u.md)(m.mz),{addCommand:a}=(0,c.oG)();(0,s.useEffect)(()=>{if(!n&&l)return a({value:"remove-deployment",text:"Remove Deployment",group:"Deployment",isAvailable:()=>null!=t.removeDeployment,action:()=>{null!=t.removeDeployment&&t.removeDeployment()}},{value:"cancel-deployment",text:"Cancel Deployment",group:"Deployment",isAvailable:()=>null!=t.cancelDeployment,action:()=>{null!=t.cancelDeployment&&t.cancelDeployment()}},{value:"restart-deployment",text:"Restart Deployment",group:"Deployment",isAvailable:()=>null!=t.restartDeployment,action:()=>{null!=t.restartDeployment&&t.restartDeployment()}},{value:"redeploy-deployment",text:"Redeploy Deployment",group:"Deployment",isAvailable:()=>null!=t.redeployDeployment,action:()=>{null!=t.redeployDeployment&&t.redeployDeployment()}},{value:"rollback-deployment",text:"Rollback Deployment",group:"Deployment",isAvailable:()=>null!=t.rollbackDeployment,action:()=>{null!=t.rollbackDeployment&&t.rollbackDeployment()}},{value:"download-deployment-logs",text:"Download Deployment Logs",group:"Deployment",isAvailable:()=>null!=t.downloadDeploymentLogs,action:()=>{null!=t.downloadDeploymentLogs&&t.downloadDeploymentLogs()}},{value:"download-build-logs",text:"Download Build Logs",group:"Deployment",isAvailable:()=>null!=t.downloadBuildLogs,action:()=>{null!=t.downloadBuildLogs&&t.downloadBuildLogs()}})},[e.status,n,l,t.removeDeployment,t.cancelDeployment,t.restartDeployment,t.redeployDeployment,t.rollbackDeployment,t.downloadDeploymentLogs,t.downloadBuildLogs])})({...t,environmentId:t.environmentId}),null},nx=e=>{var t;let{deployment:n,filter:r,filterWithExtras:s,scrollParent:i,contextStart:o,contextEnd:d,logExplorerRoute:c,setIsLoading:u,activeDateRange:m,setActiveDateRangeAndFilter:p}=e;if((null==n||null==(t=n.meta)?void 0:t.logsV2)!==!0)return(0,l.jsx)("div",{children:(0,l.jsx)(k.l,{variant:"info",className:"my-3",children:(0,l.jsxs)("p",{children:["Please re-deploy to upgrade to the new"," ",(0,l.jsxs)(S.N,{href:"https://blog.railway.com/p/building-logs-v2",children:[(0,l.jsx)("span",{className:"underline peer",children:"logging experience"}),(0,l.jsx)("span",{"aria-hidden":!0,className:"ml-1 invisible peer-hover:visible",children:"↗"})]})]})})});let x="grid-rows-[max-content_minmax(0px,1fr)] rdx-state-active:grid rdx-state-inactive::hidden";return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(a.UC,{value:"details",className:"outline-black",children:(0,l.jsx)(tB,{deployment:n})}),(0,l.jsx)(a.UC,{value:"build",className:x,children:(0,l.jsx)(eU,{deployment:n,filter:r,filterWithExtras:null!=s?s:"",scrollParent:i,contextStart:o,contextEnd:d,setIsLoading:u,activeDateRange:m},"build-logs-".concat(n.id))}),(0,l.jsx)(a.UC,{value:"deploy",className:x,children:(0,l.jsx)(eV,{deployment:n,filter:null!=r?r:"",filterWithExtras:null!=s?s:"",scrollParent:i,contextStart:o,contextEnd:d,logExplorerRoute:c,setIsLoading:u,activeDateRange:m},"deploy-logs-".concat(n.id))}),(0,l.jsx)(a.UC,{value:"http",className:x,children:(0,l.jsx)(na,{deployment:n,deploymentId:n.id,setIsLoading:u,stickyScrollParent:i,contextStart:o,contextEnd:d,filter:r?r.includes("@")?r:"@path:".concat(r):"",setActiveDateRangeAndFilter:null!=p?p:void 0,activeDateRange:m},"http-logs-".concat(n.id))})]})}}}]);