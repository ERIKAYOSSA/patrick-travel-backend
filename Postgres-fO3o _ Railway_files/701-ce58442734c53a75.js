"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[701],{3531:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{parse:function(){return s},toString:function(){return function e(t){if(!t)return"";switch(t.type){case"searchTerm":return t.value;case"exactMatch":var r=t.value.replace(/\\/g,"\\\\").replace(/"/g,'\\"');return'"'.concat(r,'"');case"attribute":var n=t.value;if(!n)return"@".concat(t.field,":");if("string"===t.valueType||n.includes(" ")||n.includes(":")||n.includes("@")){var a=n.replace(/"/g,'\\"');return"@".concat(t.field,':"').concat(a,'"')}return"@".concat(t.field,":").concat(n);case"fieldValue":return"".concat(t.field,":").concat(t.value);case"not":var l=e(t.child);return l.startsWith("-")?l:"-".concat(l);case"and":return t.children.map(function(t){var r=e(t);return"or"===t.type?"(".concat(r,")"):r}).join(" AND ");case"or":return t.children.map(function(t){return e(t)}).join(" OR ");case"grouped":return"(".concat(e(t.child),")");default:return""}}},attribute:function(){return o},searchTerm:function(){return u},exactMatch:function(){return c},and:function(){return d},or:function(){return f},addExpression:function(){return m},removeNodes:function(){return function e(t,r){if(!t||r(t))return null;switch(t.type){case"and":case"or":var n=t.children.map(function(t){return e(t,r)}).filter(function(e){return null!==e});if(0===n.length)return null;if(1===n.length)return n[0];return i(l({},t),{children:n});case"not":var a=e(t.child,r);return a?i(l({},t),{child:a}):null;case"grouped":var s=e(t.child,r);return s?i(l({},t),{child:s}):null;default:return t}}}});var n=r(46281);function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n;n=r[t],t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n})}return e}function i(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}function s(e){try{return(0,n.parseToAST)(e)}catch(t){return{type:"searchTerm",value:e}}}function o(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=t,a=void 0;t.startsWith('"')&&t.endsWith('"')&&(n=t.slice(1,-1).replace(/\\"/g,'"'),a="string");var l={type:"attribute",field:e,value:n,valueType:a};return r?{type:"not",child:l}:l}function u(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r={type:"searchTerm",value:e};return t?{type:"not",child:r}:r}function c(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r={type:"exactMatch",value:e};return t?{type:"not",child:r}:r}function d(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return 0===t.length?{type:"searchTerm",value:"*"}:1===t.length?t[0]:{type:"and",children:t}}function f(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return 0===t.length?{type:"searchTerm",value:"*"}:1===t.length?t[0]:{type:"or",children:t}}function m(e,t){if(!e)return t;if("and"===e.type){var r;return i(l({},e),{children:((function(e){if(Array.isArray(e))return a(e)})(r=e.children)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(r)||function(e,t){if(e){if("string"==typeof e)return a(e,void 0);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return a(e,t)}}(r)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).concat([t])})}return d(e,t)}},3732:(e,t,r)=>{r.d(t,{j:()=>y,v:()=>x});var n=r(4766),a=r(50253),l=r.n(a),i=r(81154),s=r(84177),o=r(25963),u=r(45588),c=r(12645),d=r(97865),f=r(55850),m=r(70375);let h="filter",p="start",g=()=>({start:l()().subtract(15,"minute").toDate(),end:null}),x=e=>{var t,r,a,l;let{projectId:x,enableQueryParams:y,extraFilter:j,autocompleteOptions:S}=e,{routes:E,navActions:N,isLogExplorerPage:k}=(0,m.c)(),L=(0,s.useSearchParams)(),[{user:C}]=(0,u.Jd)(),O=null!=(t=L.get(h))?t:"",T=null!=(r=L.get(p))?r:null,A=null!=(a=L.get("end"))?a:null,M=L.get("context")||null,[R,I]=null!=(l=null==M?void 0:M.split(".."))?l:[],[P,_]=(0,o.useState)(O),[U,D]=(0,o.useState)(""),[z,W]=(0,o.useState)(""),F="( ".concat(P," ) ").concat(null!=j?j:"").trim(),{graphqlClient:B}=(0,f.q)(),q=(0,i.md)((0,c.CI)({id:x}));(0,o.useEffect)(()=>{_(O)},[O]),(0,o.useEffect)(()=>{D(null!=T?T:b(g().start))},[T]),(0,o.useEffect)(()=>{W(null!=A?A:b(g().end))},[A]);let J=(0,o.useCallback)(e=>{var t,r;let n="".concat(null!=(t=e.filter)?t:P," ").concat(null!=j?j:"").trim();for(let t of null!=(r=e.tags)?r:[])n=v({filter:n,...t});let a={projectId:x,environmentId:q,filter:n};return"context"in e?a.context=e.context:(a.context=R,I&&(a.context+=".."+I)),null!=e.context?(delete a[p],delete a.end):null!=e.dateRange?(a[p]=b(e.dateRange.start),a.end=b(e.dateRange.end)):null==e.context&&(a[p]=U,a.end=z),{external:!k,...E.projectLogs(a)}},[x,q,F,R,I]),V=(0,o.useCallback)(e=>{if(_(e),!y)return;let t=new URLSearchParams(L);""===e?t.delete(h):t.set(h,e),N.push(E.projectLogs({projectId:x,environmentId:q,filter:e,context:null,[p]:U,end:z}))},[x,q,L,R,I]),H=(0,o.useCallback)(e=>{let t=b(e.start),r=b(e.end);if(D(t),W(r),!y)return;let n=new URLSearchParams(L);n.set(p,t),n.set("end",r),N.push(E.projectLogs({projectId:x,environmentId:q,context:null,filter:P,[p]:t,end:r}))},[x,q,L,R,I,P]),G=(0,o.useCallback)((e,t)=>{let r=b(e.start),n=b(e.end);if(D(r),W(n),_(t),!y)return;let a=new URLSearchParams(L);a.set(p,r),a.set("end",n),N.push(E.projectLogs({projectId:x,environmentId:q,context:null,filter:t,[p]:r,end:n}))},[x,q]),$=(0,o.useMemo)(()=>({start:w(U),end:w(z)}),[U,z]),K=(e=>{var t,r,a;return{planRetentionDays:null!=(a=null==(r=(0,d.W)(["logs","limits"],()=>B.logLimits({projectId:e}),{refetchOnWindowFocus:!1}).result)||null==(t=r.data)?void 0:t.logsLimits.retentionDays)?a:null,adminRetentionDays:(null==C?void 0:C.isAdmin)?n.ADMIN_LOG_RETENTION_DAYS:null}})(x);return[{dateRange:$,autocompleteOptions:S,filterWithExtras:F,filter:P,contextStart:R,contextEnd:I,planRetentionDays:K.planRetentionDays,adminRetentionDays:K.adminRetentionDays},{setFilter:V,setDateRange:H,setDateRangeAndFilter:G,logExplorerRoute:J}]},v=e=>{let{filter:t,name:r,value:n}=e,a=y(r),l="@".concat(a,":").concat(function(e){return e.match(/^[^@:"()\s\\]+$/)?e:'"'.concat(e.replace(/"/g,'\\"'),'"')}(n)),i=new RegExp("@".concat(a,":[0-9a-f-]{36}"));return t.includes(l)?t.replace(i,l):(t+" "+l).trim()},y=e=>"deploymentInstanceId"===e||"deploymentInstance"===e||"replicaId"===e?"replica":"deploymentId"===e?"deployment":"pluginId"===e?"plugin":"serviceId"===e?"service":e,b=e=>null==e?"":e.getTime().toString(),w=e=>{let t=new Date(parseFloat(e));return isNaN(t.getTime())?null:t}},12224:(e,t,r)=>{r.d(t,{F:()=>l,q:()=>i});var n=r(50979);r(25963);var a=r(36609);let l=e=>{let{className:t,enableTextSelection:r,...l}=e;return(0,n.jsx)("div",{className:(0,a.xW)(t,!r&&"select-none cursor-default","truncate text-xs min-w-[0px] scrollbar-hide"),...l})},i=e=>{let{className:t,children:r,onDragStart:i,onDragReset:o,columnId:u,isResizing:c,hideResizeHandle:d,...f}=e;return(0,n.jsxs)(l,{"data-log-column":!0,className:(0,a.xW)(t,"text-left font-medium text-gray-600 py-1 my-1 relative"),...f,children:[!d&&(0,n.jsx)(s,{isResizing:c,onDragStart:e=>i(e,u),onDoubleClick:()=>o(u)}),r]})},s=e=>{let{className:t,isResizing:r,...l}=e;return(0,n.jsxs)("div",{"aria-hidden":!0,draggable:!0,className:(0,a.xW)(t,"pr-1 pl-4","opacity-0 hover:opacity-100 transition-opacity group/resize","z-20 absolute -right-0 top-0 h-full py-1","cursor-ew-resize"),...l,children:[r&&(0,n.jsx)("div",{className:"fixed -left-20 -right-20 -top-20 -bottom-20 cursor-ew-resize"}),(0,n.jsx)("div",{className:(0,a.xW)("w-0.5 rounded-[1px] h-full bg-gray-200 group-hover/resize:bg-gray-500")})]})}},13611:(e,t,r)=>{r.d(t,{YR:()=>c,dq:()=>d,oG:()=>p});var n=r(50979),a=r(66800),l=r.n(a),i=r(25963),s=r(59459),o=r(36609),u=r(54940);let c={debug:"bg-gray-300 dark:bg-gray-300 group-hover:bg-gray-400 dark:group-hover:bg-gray-400",info:"bg-blue-400 dark:bg-blue-500 group-hover:bg-blue-500 dark:group-hover:bg-blue-600",warn:"bg-yellow-300 dark:bg-yellow-600 group-hover:bg-yellow-400 dark:group-hover:bg-yellow-700",error:"bg-red-400 dark:bg-red-600 group-hover:bg-red-400 dark:group-hover:bg-red-700"};function d(e){let{data:t,showYAxis:r=!1,showXAxis:a=!0,className:u="",onSelectTimeRange:d}=e,[p,g]=(0,i.useState)(null),x=(0,s.y)(p),{width:v,height:y}=x||{width:0,height:0},b=(0,i.useRef)(null),w=(0,i.useRef)(null),j=(0,i.useRef)(d);(0,i.useEffect)(()=>{j.current=d});let S=t?1e3*t.stepSeconds:l()("1h"),E=(0,i.useMemo)(()=>{if(!t||0===t.buckets.length){let e=Date.now(),t=e-36e5,r=l()("1h");return Array.from({length:Math.floor((e-t)/r)},(e,n)=>({timestamp:t+n*r,counts:{error:0,warn:0,info:0,debug:0},total:0}))}let e=new Map;return t.buckets.forEach(t=>{let r=new Date(t.timestamp).getTime();e.has(r)||e.set(r,{error:0,warn:0,info:0,debug:0}),e.get(r)[t.severity.toLowerCase()]=t.count}),Array.from(e.entries()).map(e=>{let[t,r]=e;return{timestamp:t,counts:r,total:Object.values(r).reduce((e,t)=>e+t,0)}}).sort((e,t)=>e.timestamp-t.timestamp)},[t,S]),N=(0,i.useMemo)(()=>Math.max(...E.map(e=>e.total),1),[E]),k=Math.max(1,v/E.length),L=(0,i.useMemo)(()=>E.map((e,r)=>{let a=e.total/N*y,l=Object.keys(c).map(t=>{var r;let l=e.counts[t]||0;if(0===l)return null;let i=l/e.total*a;return i<=0?null:(0,n.jsx)("div",{style:{height:i},className:(0,o.xW)("w-full",null!=(r=c[t])?r:c.info)},t)}).filter(Boolean);return(0,n.jsxs)("div",{"data-bucket-index":r,className:"group flex items-end h-full relative cursor-crosshair",style:{width:k,height:y},children:[(0,n.jsx)("div",{className:"flex flex-col-reverse w-full h-full px-[1px]",children:(0,n.jsx)("div",{className:"flex flex-col-reverse w-full rounded-t-sm overflow-hidden",children:l.length>0?l:(0,n.jsx)("div",{className:"w-full h-full bg-neutral-button",style:{height:3}})})}),(0,n.jsx)("div",{className:"group-hover:visible absolute inset-0 h-full invisible opacity-0 group-hover:opacity-20 bg-black dark:bg-white transition-all rounded-t"}),t&&t.buckets.length>0&&(0,n.jsx)(f,{bucket:e})]},e.timestamp)}),[E,N,y,k,t]),C=e=>{if(0===E.length)return 0;let t=(e=>{if(0===E.length)return null;let t=Math.floor(e/k),r=Math.max(0,Math.min(E.length-1,t));return E[r]})(e);return t?t.timestamp:E[0].timestamp},O=e=>{let{width:t,left:r}=e;w.current&&(w.current.style.width="".concat(t,"px"),w.current.style.left="".concat(r,"px"),w.current.style.display=0===t?"none":"block")},{start:T,end:A}=function(e,t){let r=new Date(e),n=new Date(t);if(r.toDateString()!==n.toDateString()){let e=new Intl.DateTimeFormat(m,{month:"short",day:"numeric"});return{start:e.format(r),end:e.format(n)}}{let e=new Intl.DateTimeFormat(m,{hour:"numeric",minute:"2-digit"});return{start:e.format(r),end:e.format(n)}}}(E.length>0?E[0].timestamp:0,E.length>0?E[E.length-1].timestamp+S:0);return(0,i.useLayoutEffect)(()=>{let e=e=>{if(!b.current||!x)return;let t=e.clientX-x.left;b.current=b.current?{...b.current,end:t}:null,w.current&&b.current&&O({width:Math.abs(b.current.end-b.current.start),left:Math.min(b.current.start,b.current.end)})},r=e=>{if(b.current&&x&&t&&t.buckets.length&&j.current){if(10>Math.abs(e.clientX-x.left-b.current.start)){let t=(e=>{let t=e.closest("[data-bucket-index]");if(!t)return null;let r=parseInt(t.dataset.bucketIndex||"",10);return isNaN(r)||r<0||r>=E.length?null:E[r]})(e.target);if(t){let e=E.findIndex(e=>e.timestamp===t.timestamp),r=E[e+1],n=t.timestamp,a=r?r.timestamp:t.timestamp+S;j.current(n,a)}}else{let e=C(b.current.start),t=C(b.current.end),r=Math.min(e,t),n=Math.max(e,t);n-r>1e3&&j.current(r,n)}b.current=null,O({width:0,left:0})}};return document.addEventListener("mousemove",e),document.addEventListener("mouseup",r),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",r)}},[x,t,S]),(0,n.jsxs)("div",{className:(0,o.xW)("select-none grid grid-cols-[max-content,minmax(0,auto)] grid-rows-[minmax(0,1fr),max-content] h-full w-full overflow-x-clip",u),onMouseDown:e=>{if(!x)return;let t=e.clientX-x.left;b.current={start:t,end:t}},children:[r?(0,n.jsxs)("div",{className:"h-full flex flex-col justify-between text-[10px] text-neutral-secondary pointer-events-none pr-3 tabular-nums",children:[(0,n.jsx)("span",{children:h.format(N)}),(0,n.jsx)("span",{className:"relative inline-block top-1.5",children:"0"})]}):(0,n.jsx)("div",{}),(0,n.jsx)("div",{className:"w-full h-full relative",ref:g,children:(0,n.jsxs)("div",{className:"flex items-end h-full relative justify-start",children:[L,t&&t.buckets.length>0&&(0,n.jsx)("div",{ref:w,className:"absolute top-0 bottom-0 bg-neutral-surface-hover opacity-50 pointer-events-none",style:{left:0,width:0,top:0,display:"none"}})]})}),a&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{}),(0,n.jsxs)("div",{className:"py-1 flex justify-between items-center text-[10px] font-mono text-neutral-secondary tabular-nums pointer-events-none",children:[(0,n.jsx)("span",{children:t&&0!==t.buckets.length?E.length>0?T:"":"—"}),(0,n.jsx)("span",{children:t&&0!==t.buckets.length?E.length>0?A:"":"—"})]})]})]})}let f=(0,i.memo)(function(e){let{bucket:t,className:r=""}=e,a=(0,i.useRef)(null),[l,s]=(0,i.useState)({left:0,transform:"translateX(-50%)"});return(0,i.useLayoutEffect)(()=>{let e=a.current;if(!e)return;let t=()=>{let t=e.getBoundingClientRect(),r=t.left,n=t.right>window.innerWidth;r<0?s({left:0,transform:""}):n&&s({right:0,transform:""})};return e.addEventListener("transitionstart",t),()=>{e.removeEventListener("transitionstart",t)}},[]),(0,n.jsx)("div",{ref:a,className:"absolute z-20 top-full mt-1 mb-2 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap ".concat(r),style:l,children:(0,n.jsx)(u.H,{timestamp:t.timestamp,value:(0,n.jsx)(n.Fragment,{children:Object.entries(t.counts).map(e=>{var t;let[r,a]=e;return a>0&&(0,n.jsxs)("div",{className:"capitalize w-full justify-between flex",children:[(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)("span",{className:(0,o.xW)("inline-block mr-1",null!=(t=c[r])?t:c.info),style:{width:8,height:8,borderRadius:"50%"}}),r]}),(0,n.jsx)("div",{className:"text-foreground tabular-nums",children:h.format(a)})]},r)})})})})}),m=window.navigator.language,h=new Intl.NumberFormat(m,{notation:"compact",maximumFractionDigits:1});function p(e){let{className:t="",targetBucketWidth:r=16,showXAxis:a=!0,showYAxis:l=!1}=e,u=(0,i.useRef)(null),c=(0,s.y)(u),d=Math.max(1,Math.floor(((null==c?void 0:c.width)||0)/r)),f=Array.from({length:d},(e,t)=>{let r=t/d*2e3;return{baseHeight:30+25*Math.sin(.5*t)+15*Math.cos(.3*t),delay:-r}});return(0,n.jsxs)("div",{ref:u,className:(0,o.xW)("select-none grid grid-cols-[max-content,minmax(0,auto)] grid-rows-[minmax(0,1fr),max-content] h-full w-full overflow-x-clip",t),children:[(0,n.jsx)("style",{children:"\n        @keyframes pulse-height {\n          0%, 100% {\n            transform: scaleY(0.6);\n            opacity: 0.65;\n          }\n          50% {\n            transform: scaleY(1);\n            opacity: 0.3;\n          }\n        }\n      "}),l?(0,n.jsxs)("div",{className:"h-full flex flex-col justify-between text-[10px] text-neutral-secondary/30 pr-3 tabular-nums",children:[(0,n.jsx)("span",{children:"—"}),(0,n.jsx)("span",{className:"relative inline-block top-1.5",children:"—"})]}):(0,n.jsx)("div",{}),(0,n.jsx)("div",{className:"w-full h-full relative",children:(0,n.jsx)("div",{className:"flex items-end h-full justify-start",children:f.map((e,t)=>(0,n.jsx)("div",{className:"flex items-end h-full relative",style:{width:"".concat(100/d,"%"),minWidth:r},children:(0,n.jsx)("div",{className:"flex flex-col-reverse w-full h-full px-[1px]",children:(0,n.jsx)("div",{className:"w-full bg-gray-200 rounded-t-sm",style:{minHeight:3,height:"".concat(e.baseHeight,"%"),animation:"pulse-height 2s ease-in-out ".concat(e.delay,"ms infinite"),transformOrigin:"bottom"}})})},t))})}),a&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{}),(0,n.jsxs)("div",{className:"py-1 flex justify-between items-center text-[10px] font-mono text-neutral-secondary/30 tabular-nums",children:[(0,n.jsx)("span",{children:"—"}),(0,n.jsx)("span",{children:"—"})]})]})]})}},15518:(e,t,r)=>{r.d(t,{i_:()=>a});var n=r(2551);let a=e=>{let{dateRange:t,beforeDate:r,anchorDate:n,afterDate:a}=e;return{beforeDate:l(t,null!=r?r:null,"start"),anchorDate:l(t,null!=n?n:null,"end"),afterDate:l(t,null!=a?a:null,"end")}},l=(e,t,r)=>{let n=e.start,a=e.end;return null==t&&"start"===r?null==n?null:n.toISOString():null==t?null==a?null:a.toISOString():null!=n&&t<n.toISOString()?n.toISOString():null!=a&&t>a.toISOString()?a.toISOString():t};n.dJT,n.dJT,n.dJT,n.dJT},21341:(e,t,r)=>{r.d(t,{s:()=>x});var n=r(50979),a=r(14034),l=r(25963),i=r(28592),s=r(3732),o=r(2551),u=r(31754),c=r(17057),d=r(13077),f=r(95662),m=r(36609),h=r(47654),p=r(71121);let g=e=>{let{depth:t,attrKey:r,attrValue:a,attrKeyJsonPath:i,logExplorerRoute:s,onLabelClick:u}=e;i=null!=i?i:"".concat(r);let[{wordWrap:c}]=(0,p.EH)(),[f,x]=(0,l.useState)(!1),{isExpandable:v,children:y,label:b,labelClassName:w}=(0,l.useMemo)(()=>{let e=Object.prototype.toString.call(a);return"[object Object]"===e?{children:f?Object.keys(a).sort((e,t)=>e.localeCompare(t)).flatMap(e=>(0,n.jsx)(g,{depth:t+1,attrValue:a[e],attrKey:e,attrKeyJsonPath:function(e,t){let r=t.match(/^[a-z0-9_]+$/i)?t:"`".concat(t,"`");return null==e?r:"".concat(e,".").concat(r)}(i,e),logExplorerRoute:s})):null,isExpandable:!0,label:f?"{ }":"{⋯}",labelClassName:"text-gray-500"}:"[object Array]"===e?{children:f?a.flatMap((e,r)=>(0,n.jsx)(g,{depth:t+1,attrValue:e,attrKey:r,attrKeyJsonPath:function(e,t){return"".concat(null!=e?e:"","[").concat(t,"]")}(i,r),logExplorerRoute:s})):null,isExpandable:!0,label:f?"[ ]":"[⋯]",labelClassName:"text-gray-500"}:{children:null,isExpandable:!1,label:"[object String]"===e?'"'.concat(a,'"'):"".concat(a),labelClassName:(0,m.xW)("[object Number]"===e&&"text-green-600","[object String]"===e&&"text-yellow-600","[object Null]"===e&&"text-pink-600",null!=u&&"cursor-pointer hover:underline")}},[a,i,f,t,null!=u]),j=(0,l.useCallback)(()=>u?u("".concat(r),a):null,[u,r,a]);return(0,n.jsxs)("div",{className:(0,m.xW)(0===t&&"-ml-4","font-mono text-xs"),children:[(0,n.jsxs)("div",{className:"flex items-start",children:[v?(0,n.jsxs)("button",{className:"relative flex items-center pl-4 group",onClick:()=>x(e=>!e),children:[(0,n.jsx)(d.In,{size:"xs",icon:o.c_$,className:(0,m.xW)("left-0 absolute transition-transform text-gray-500 group-hover:text-gray-700 flex gap-1 items-center",f?"rotate-90":"")}),(0,n.jsxs)("span",{className:"text-blue-600 group-hover:text-blue-800 mr-1.5",children:[r,":"]})]}):(0,n.jsxs)("span",{className:"text-blue-600 group-hover:text-blue-800 mr-1.5 pl-4",children:[r,":"]}),null==s||v||null==b?(0,n.jsx)("span",{className:(0,m.xW)(w,!c&&"truncate"),onClick:j,children:b}):(0,n.jsx)(h.N,{"data-full-key":i,className:(0,m.xW)(w,"hover:underline",!c&&"truncate"),...s({tags:[{name:i,value:"".concat(a)}]}),children:b})]}),y&&(0,n.jsx)("div",{className:"ml-4",children:y})]})},x=e=>{let{log:t,linkedTags:r,logExplorerRoute:m}=e,h=(0,l.useMemo)(()=>null==t.tags?[]:Object.keys(t.tags).sort((e,t)=>e.localeCompare(t)),[t.tags]),p=(0,l.useMemo)(()=>t.attributes.sort((e,t)=>e.key.localeCompare(t.key)),[t.attributes]),x=(0,l.useMemo)(()=>p.map(e=>(0,n.jsx)(g,{depth:0,logExplorerRoute:m,attrValue:v(e.value),attrKey:e.key},e.key)),[p]),[y,b]=(0,i.T)();return(0,n.jsx)("div",{className:"py-2 pt-1",children:(0,n.jsxs)("div",{className:"pl-6 border-l text-xs text-gray-800",children:[x.length>0&&(0,n.jsx)("div",{className:"pb-3",children:x}),h.map(e=>{var l;let i=(null!=(l=t.tags)?l:{})[e];if(null===i)return null;let d=!!r&&r.includes(e);return d?(0,n.jsxs)("div",{children:[(0,n.jsxs)("span",{className:"text-pink-700",children:[(0,s.j)(e),": "]}),null!=m&&d?(0,n.jsxs)(c.ms,{children:[(0,n.jsx)(a.l9,{className:"hover:underline",children:i}),(0,n.jsxs)(c.pm,{align:"end",children:[(0,n.jsx)(a.q7,{children:(0,n.jsx)(u.vx,{icon:o.dJT,variant:"ghost",size:"sm",color:"gray",className:"!ml-0 text-sm text-gray-700 justify-start",...m({tags:[{name:e,value:i}]}),children:"Add Filter"})}),(0,n.jsx)(a.q7,{children:(0,n.jsx)(u.vx,{icon:o.B1E,variant:"ghost",size:"sm",color:"gray",className:"!ml-0 text-sm text-gray-700 justify-start",...m({filter:"",tags:[{name:e,value:i}],context:t.timestamp}),children:"View in Context"})})]})]}):(0,n.jsx)("span",{children:i})]},e):null}),null!=m&&(0,n.jsxs)(f.z,{space:1,children:[(0,n.jsx)(u.vx,{size:"xs",variant:"outline",color:"pink",className:"inline-flex mt-2",...m({filter:"",context:t.timestamp}),children:"View in Context"}),(0,n.jsxs)(u.$n,{size:"xs",variant:"outline",color:"pink",className:"inline-flex mt-2",onClick:()=>{let e=p.map(e=>({key:e.key,value:v(e.value)})).reduce((e,t)=>Object.assign(e,{[t.key]:t.value}),{}),r=h.map(e=>{var r,n;return{key:e,value:null!=(n=(null!=(r=t.tags)?r:{})[e])?n:null}}).reduce((e,t)=>Object.assign(e,{[t.key]:t.value}),{});b(JSON.stringify({severity:t.severity,timestamp:t.timestamp,message:t.message,tags:r,attributes:e},null,2))},children:["Copy as JSON",y&&(0,n.jsx)("span",{className:"inline-flex align-middle items-center ml-1",children:(0,n.jsx)(d.In,{icon:o.rAV,size:"xs"})})]})]})]})})},v=e=>{try{return JSON.parse(e)}catch(t){return e}}},21500:(e,t,r)=>{r.d(t,{A5:()=>U,B4:()=>D,MI:()=>W,R7:()=>z,T_:()=>_,ZY:()=>N,nU:()=>P});var n=r(50979),a=r(17851),l=r(41220),i=r(24554),s=r(81154),o=r(22986),u=r.n(o),c=r(25963),d=r(61455),f=r(55297),m=r(70643),h=r(59459),p=r(2551),g=r(36609),x=r(13077),v=r(76999),y=r(43067),b=r(44153),w=r(75749),j=r(86954),S=r(44661),E=r(31754);function N(e){let{customFields:t,railwayTags:r,showPopover:a=!0,placeholder:i="Filter and search logs",visibleFilters:s,className:o}=e,[u,f]=(0,c.useState)({}),m=(0,c.useRef)(null),y=(0,c.useRef)(null),b=(0,c.useRef)(null),w=(0,h.y)(b),[j,S]=(0,c.useState)(""),{expression:N,setExpression:C,resetFilter:O}=z(),[T,A]=(0,c.useState)(!1),M=(0,d.tokenizeForHighlighting)(j);return(0,c.useLayoutEffect)(()=>{N?S(N.toString()):S("")},[N]),(0,c.useLayoutEffect)(()=>{if(j){let e=m.current;e&&f(t=>{e.style.height="auto";let r=e.scrollHeight;return r===t.height?(e.style.height=e.scrollHeight+"px",t):{height:r,maxHeight:r}})}else f(e=>void 0===e.height?e:{})},[j]),(0,n.jsxs)(l.AM,{open:T,onOpenChange:e=>{a&&A(e)},children:[(0,n.jsxs)("div",{ref:b,className:(0,g.xW)("w-full min-w-0 rounded-md text-foreground font-mono text-xs min-h-[34px] bg-background grid grid-cols-[min-content,minmax(0,auto),min-content] cursor-text","border border-gray-200 placeholder-gray-500 group","focus:outline-none relative z-10",o),onClick:e=>{if(!(e.target instanceof HTMLTextAreaElement)){var t;null==(t=e.currentTarget.querySelector("textarea"))||t.focus()}a&&A(!0)},children:[(0,n.jsx)(x.In,{icon:p.dJT,size:"xs",className:"text-neutral-secondary opacity-70 m-2 relative top-0.5 pointer-events-none"}),(0,n.jsx)(l.dT,{asChild:!0,children:(0,n.jsxs)("div",{className:"relative h-full w-full pt-1.5",children:[(0,n.jsx)("div",{ref:y,className:(0,g.xW)("absolute inset-0 w-full pt-2 pl-1 h-full pointer-events-none overflow-hidden whitespace-pre font-mono text-xs",o),"aria-hidden":"true",children:(()=>{if(!j)return(0,n.jsx)("span",{className:"text-neutral-secondary",children:i});let e=0,t=[];return M.forEach((r,a)=>{r.start>e&&t.push((0,n.jsx)("span",{children:j.slice(e,r.start)},"text-".concat(a)));let l=r.value.split(":"),i="attribute"===r.type?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"font-semibold",children:l[0]}),l.length>1&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{children:":"}),(0,n.jsx)("span",{className:"text-pink-700 dark:text-pink-800",children:l.slice(1).join(":")})]})]}):r.value;t.push((0,n.jsx)("span",{className:k[r.type],children:i},a)),e=r.end}),e<j.length&&t.push((0,n.jsx)("span",{children:j.slice(e)},"remainder")),t})()}),(0,n.jsx)("textarea",{ref:m,rows:1,value:j,onChange:e=>{S(e.target.value)},className:"relative m-0 w-full pl-1 h-full text-transparent bg-transparent whitespace-pre font-mono text-xs focus:outline-none caret-black dark:caret-white resize-none scrollbar-hide",style:{WebkitTextFillColor:"transparent",...u},onKeyDown:e=>{if("Enter"===e.key&&!e.shiftKey)if(e.preventDefault(),j.trim())try{let e=v.lq.parse(j);C(e),A(!1)}catch(e){}else O(),A(!1)},onScroll:e=>{y.current&&(y.current.scrollLeft=e.currentTarget.scrollLeft)},onFocus:()=>{a&&A(!0)},spellCheck:"false",autoCapitalize:"off",autoComplete:"off",autoCorrect:"off"})]})}),j&&(0,n.jsx)(E.K0,{title:"Clear filters",icon:p.X,size:"xs",color:"gray",variant:"ghost",className:"absolute right-[3px] top-[3px] opacity-50 text-neutral-secondary hover:text-neutral hover:opacity-100",onClick:()=>{S(""),O(),A(!1)}})]}),(0,n.jsx)(l.hl,{align:"start",sideOffset:4,className:"bg-background border border-neutral shadow-md rounded-lg z-50 w-80 max-w-[90vw] font-light text-left grid grid-cols-2 max-h-[50vh] overflow-y-auto",style:{width:null==w?void 0:w.width,maxWidth:720},onOpenAutoFocus:e=>e.preventDefault(),onFocusOutside:e=>e.preventDefault(),onInteractOutside:e=>{var t;e.target instanceof HTMLElement&&(e.target===b.current||(null==(t=b.current)?void 0:t.contains(e.target)))&&e.preventDefault()},children:(0,n.jsx)(L,{customFields:t,railwayTags:r,visibleFilters:s})})]})}let k={search_term:"text-foreground",exact_match:"text-blue-500 dark:text-blue-600",attribute:"text-pink-500 relative dark:text-pink-600 before:absolute before:-z-10 before:content-[''] before:bg-pink-100 before:dark:bg-pink-200 before:rounded-full before:-left-1 before:-right-1 before:-top-px before:-bottom-px",operator:"text-yellow-600 dark:text-yellow-400",incomplete:"text-gray-400"};function L(e){let{customFields:t,railwayTags:r=[],visibleFilters:a}=e,{services:l=!0,customFields:i=!!(null==t?void 0:t.length),tags:s=r.length>0,searchTerm:o=!0}=null!=a?a:{},[u,d]=(0,c.useState)(null),[f,m]=(0,c.useState)(null);return l||i||s||o?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"border-r border-r-neutral h-full space-y-3 overflow-y-auto",children:[(0,n.jsx)("div",{className:"text-xs font-medium text-neutral-secondary pt-5 px-5",children:"Filter on"}),(0,n.jsxs)("div",{className:"flex flex-col items-start justify-stretch w-full font-mono text-xs gap-2 px-5 pb-5",children:[o&&(0,n.jsx)("button",{className:"p-0 w-full text-left group flex items-start",onMouseEnter:()=>d((0,n.jsx)(C,{type:"searchTerm"})),onMouseLeave:()=>d(null),onClick:()=>m((0,n.jsx)(O,{type:"searchTerm"})),"data-selected":f&&"searchTerm"===f.props.type,children:(0,n.jsxs)("div",{className:"group-hover:bg-neutral-surface-hover rounded-full py-1 px-3 -ml-3 flex items-center gap-2 group-data-[selected=true]:bg-neutral-surface-hover",children:["Search term",(0,n.jsx)(x.In,{icon:p.vji,size:"xs",className:"text-neutral-secondary opacity-50"})]})}),l&&(0,n.jsx)("button",{className:"p-0 w-full text-left group flex items-start",onMouseEnter:()=>d((0,n.jsx)(C,{type:"services"})),onMouseLeave:()=>d(null),onClick:()=>m((0,n.jsx)(O,{type:"services"})),"data-selected":f&&"services"===f.props.type,children:(0,n.jsx)("div",{className:"group-hover:bg-neutral-surface-hover rounded-full py-1 px-3 -ml-3 flex items-center gap-2 group-data-[selected=true]:bg-neutral-surface-hover",children:"Services"})})]}),i&&t&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(w.c,{}),(0,n.jsx)("div",{className:"flex flex-col items-start max-h-full justify-stretch w-full font-mono text-xs gap-2 px-5 pb-5",children:(0,n.jsxs)("div",{className:"w-full",children:[(0,n.jsx)("button",{className:"p-0 w-full text-left group flex items-start",onMouseEnter:()=>d((0,n.jsx)(C,{type:"customFields"})),onMouseLeave:()=>d(null),onClick:()=>m((0,n.jsx)(O,{type:"customFields",fields:t})),"data-selected":f&&"customFields"===f.props.type,children:(0,n.jsxs)("div",{className:"group-hover:bg-neutral-surface-hover rounded-full py-1 px-3 -ml-3 flex items-center gap-2 group-data-[selected=true]:bg-neutral-surface-hover",children:["Custom fields"," ",(0,n.jsx)(x.In,{icon:p.FWt,size:"xs",className:"text-neutral-secondary opacity-50"})]})}),(0,n.jsx)("div",{className:"grid grid-cols-2 gap-x-3 -ml-3",children:t.slice(0,6).map(e=>(0,n.jsxs)("button",{className:"px-3 py-1 rounded-full gap-1.5 hover:bg-neutral-surface-hover justify-between flex text-left text-[10px] font-mono",onMouseEnter:()=>d((0,n.jsx)(C,{type:"customFields"})),onMouseLeave:()=>d(null),onClick:()=>m((0,n.jsx)(O,{type:"customFields",fields:t,preSelectedField:e},e[0])),children:[(0,n.jsxs)("span",{className:"truncate text-ellipsis",children:["@",e[0]]}),(0,n.jsx)("span",{className:"text-neutral-secondary",children:e[1]})]},e[0]))})]})})]})]}),(0,n.jsx)("div",{className:"p-5 w-full h-full max-h-full overflow-y-auto",children:null!=f?f:u})]}):null}function C(e){let{type:t}=e;return"services"===t?(0,n.jsxs)("div",{className:"w-full space-y-2",children:[(0,n.jsx)("div",{className:"text-xs font-medium text-neutral-secondary",children:"Service field"}),(0,n.jsx)("div",{className:"text-sm",children:"Create a filter for a specific service, such as your Postgres database or Redis cache."})]}):"searchTerm"===t?(0,n.jsxs)("div",{className:"w-full space-y-2",children:[(0,n.jsx)("div",{className:"text-xs font-medium text-neutral-secondary",children:"Search term"}),(0,n.jsx)("div",{className:"text-sm",children:"Create a filter for a specific search term, such as an error message or a specific log line."})]}):"customFields"===t?(0,n.jsxs)("div",{className:"w-full space-y-2",children:[(0,n.jsx)("div",{className:"text-xs font-medium text-neutral-secondary",children:"Custom fields"}),(0,n.jsx)("div",{className:"text-sm",children:"Create a filter for a custom field, such as a user ID or session token from your JSON structured logs."})]}):"tags"===t?(0,n.jsxs)("div",{className:"w-full space-y-2",children:[(0,n.jsx)("div",{className:"text-xs font-medium text-neutral-secondary",children:"Tags"}),(0,n.jsx)("div",{className:"text-sm",children:"Create a filter for a Railway tag, such as a deployment ID. Tags are automatically added to your logs by Railway."})]}):null}function O(e){return(0,n.jsxs)("div",{className:"w-full grid grid-rows-[max-content,minmax(0,1fr)] gap-y-3",children:[(0,n.jsx)(C,{type:e.type}),(0,n.jsxs)("div",{className:"mt-2 overflow-y-auto w-full",children:["searchTerm"===e.type&&(0,n.jsx)(T,{...e}),"services"===e.type&&(0,n.jsx)(A,{...e}),"tags"===e.type&&(0,n.jsx)(M,{...e,railwayTags:e.railwayTags||[]}),"customFields"===e.type&&(0,n.jsx)(R,{...e,customFields:e.fields||[],preSelectedField:e.preSelectedField||null})]})]})}function T(e){let{addExpression:t}=z(),[r,a]=(0,c.useState)(""),[l,i]=(0,c.useState)(!1),[s,o]=(0,c.useState)(!0);return(0,n.jsxs)("form",{className:"flex flex-col gap-3 w-full text-left text-xs font-mono",onSubmit:e=>{e.preventDefault(),s?t(new v.h4(r,l)):r.split(/\s+/).forEach(e=>{e.trim()&&t(new v.NJ(e,l))}),a("")},children:[(0,n.jsx)("div",{className:"rounded-lg bg-neutral-surface",children:(0,n.jsx)(j.pd,{label:{hidden:!0,text:"Search term"},size:"sm",type:"text",autoFocus:!0,placeholder:"Search term",className:"w-full bg-transparent border-0 focus:ring-0",value:r,onChange:e=>a(e.target.value),icon:p.vji})}),(0,n.jsx)("div",{className:"pl-3 text-neutral-secondary",children:(0,n.jsx)(S.S,{id:"exact-search-term",size:"xs",label:"Exact match",checked:s,onChange:o})}),(0,n.jsx)("div",{className:"pl-3 text-neutral-secondary",children:(0,n.jsx)(S.S,{id:"negate-search-term",size:"xs",label:"Negate search term",checked:l,onChange:i})})]})}function A(e){let{addExpression:t}=z(),r=(0,y.t)();return(0,n.jsx)("div",{className:"grid grid-cols-2 gap-2 w-full",children:Object.keys(r).map(e=>{let a=r[e];return(0,n.jsxs)("button",{className:"p-2 rounded-md bg-neutral-surface hover:bg-neutral-secondary text-left text-xs font-mono grid grid-cols-[max-content,minmax(0,auto)] items-center",onClick:()=>{t(new v.nW("service",e))},children:[(0,n.jsx)(I,{service:a,className:"inline-block mr-2 text-neutral-secondary opacity-50"}),(0,n.jsx)("div",{className:"truncate text-ellipsis",children:a.name})]},e)})})}function M(e){let{railwayTags:t}=e,{addExpression:r}=z(),[a,l]=(0,c.useState)(""),[i,s]=(0,c.useState)(null);return(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-2 w-full",children:[t.filter(e=>e===i||!i).map(e=>(0,n.jsx)("button",{className:"p-2 rounded-md bg-neutral-surface hover:bg-neutral-secondary text-left text-xs font-mono grid grid-cols-[max-content,minmax(0,auto)] items-center",onClick:()=>{s(e)},children:(0,n.jsx)("div",{className:"truncate text-ellipsis",children:e})},e)),i&&(0,n.jsxs)("form",{className:"flex items-center gap-3 w-full text-left text-xs font-mono col-span-2",onSubmit:e=>{e.preventDefault(),r(new v.nW(i,JSON.stringify(a)))},children:[(0,n.jsx)("div",{className:"rounded-lg bg-neutral-surface grow",children:(0,n.jsx)(j.pd,{label:{hidden:!0,text:"Search term"},size:"sm",type:"text",autoFocus:!0,placeholder:"Enter value",className:"w-full grow bg-transparent border-0 focus:ring-0",value:a,onChange:e=>l(e.currentTarget.value),icon:p.vji})}),(0,n.jsx)(E.K0,{type:"button",title:"Clear tag filter",icon:p.X,size:"xs",onClick:()=>s(null)})]})]})}function R(e){let{customFields:t,preSelectedField:r}=e,{addExpression:a}=z(),[l,i]=(0,c.useState)(""),[s,o]=(0,c.useState)(r||null);return(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-2 w-full",children:[t.filter(e=>e===s||!s).map(e=>(0,n.jsxs)("button",{className:"p-2 rounded-md bg-neutral-surface gap-2 justify-between hover:bg-neutral-secondary text-left text-xs font-mono flex items-center",onClick:()=>{o(e)},children:[(0,n.jsxs)("div",{className:"truncate text-ellipsis",children:["@",e[0]]}),(0,n.jsx)("div",{className:"text-neutral-secondary",children:e[1]})]},e[0])),s&&(0,n.jsxs)("form",{className:"flex items-center gap-3 w-full text-left text-xs font-mono col-span-2",onSubmit:e=>{e.preventDefault(),a(new v.nW(s[0],JSON.stringify(l))),i("")},children:[(0,n.jsx)("div",{className:"rounded-lg bg-neutral-surface grow",children:(0,n.jsx)(j.pd,{label:{hidden:!0,text:"Search term"},size:"sm",type:"number"===s[1]?"number":"text",autoFocus:!0,placeholder:"Enter value",className:"w-full grow bg-transparent border-0 focus:ring-0",value:l,onChange:e=>i(e.currentTarget.value),icon:p.vji})}),(0,n.jsx)(E.K0,{type:"button",title:"Clear tag filter",icon:p.X,size:"xs",onClick:()=>o(null)})]})]})}function I(e){let{service:t,className:r}=e,{serviceIcon:a}=(0,b.W)(t,null);return(0,n.jsx)(x.In,{icon:a,className:r})}function P(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,c.useMemo)(()=>(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{sampleSize:r=500,maxResults:n=10}=t,a=new Map,l=Math.min(r,e.length),i=0;for(;a.size<n&&i<l;){let t=Math.floor(Math.random()*e.length),r=e[t];for(let e of(i++,r.attributes||[])){if(a.has(e.key))continue;let t={};try{t=JSON.parse(e.value)}catch(e){}if("number"==typeof t?a.set(e.key,"number"):"string"==typeof t&&a.set(e.key,"string"),a.size>=n)break}}return Array.from(a.entries()).sort((e,t)=>e[0].localeCompare(t[0]))})(e,r),[null==(t=e[0])?void 0:t.timestamp])}function _(){let{replace:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[t]=(0,c.useState)(()=>(0,i.y$)());return(0,c.useEffect)(()=>t.sub(G,()=>{}),[t]),(0,c.useMemo)(()=>({expressionAtom:F,setParams:r=>{if(W in r){let e=r[W]?v.lq.parse(r[W]).simplify():null;t.set(B,e)}(0,f.bj)(r,{replace:e})},getExpression:()=>t.get(F)||null,store:t,enabled:!0}),[t,e])}function U(){let[e]=(0,c.useState)(()=>(0,i.y$)()),t=(0,s.Xr)(q,{store:e});return(0,c.useMemo)(()=>({store:e,expressionAtom:J,setParams:e=>{t(t=>({...t,...e}))},getExpression:()=>e.get(J),createUrl(){let t=e.get(q);return(0,f.sH)(t)},enabled:!0}),[t,e])}function D(e){let{backend:t,children:r}=e;return(0,n.jsx)($.Provider,{value:t,children:r})}function z(){let e=(0,c.useContext)($),t=(0,s.md)(e.expressionAtom,e);return(0,c.useMemo)(()=>({expression:t,addExpression(t){let r,n=e.getExpression();r=n?new v.KD([n,t]):t,e.setParams({filter:r.toString(),[m.XR]:null})},removeExpression(t){let r=e.getExpression();if(r){let n=r.remove(t);e.setParams({filter:n?n.toString():null})}},setExpression(t){t?e.setParams({filter:t.toString()}):e.setParams({filter:null})},resetFilter(){e.setParams({filter:null})},toString(){var t;let r=e.getExpression();return null!=(t=null==r?void 0:r.toString())?t:""},getBuilder(){let t=e.getExpression();return t?v.lq.fromExpression(t):v.lq.create()},enabled:e.enabled}),[e,t])}let W="filter",F=(0,i.eU)(e=>{let t=e(G),r=e(B);if(null!=r)return r;if(!t[W])return null;try{return v.lq.parse(t[W]).simplify()}catch(e){return null}}),B=(0,i.eU)(null);B.onMount=e=>{e(null);let t=()=>e(null);return u().events.on("routeChangeComplete",t),window.addEventListener("popstate",t),()=>{u().events.off("routeChangeComplete",t),window.removeEventListener("popstate",t)}};let q=(0,i.eU)({}),J=(0,i.eU)(e=>{let t=e(q);if(!t[W])return null;try{return v.lq.parse(t[W]).simplify()}catch(e){return null}}),V=a.z.object({filter:a.z.string().nullable().optional(),[m.XR]:a.z.any().optional()});function H(e){let t=Object.fromEntries(e.searchParams.entries()),r=V.safeParse(t);return r.success?r.data:{}}let G=(0,i.eU)(H((0,f.bp)()));G.onMount=e=>{e(H((0,f.bp)()));let t=t=>{e(H(new URL(t,window.location.origin)))},r=t=>{e(H((0,f.bp)()))};return u().events.on("routeChangeComplete",t),window.addEventListener("popstate",r),()=>{u().events.off("routeChangeComplete",t),window.removeEventListener("popstate",r)}};let $=(0,c.createContext)({store:(0,i.zp)(),expressionAtom:J,setParams(){},getExpression:()=>null,enabled:!1})},23466:(e,t,r)=>{r.d(t,{FW:()=>g,QA:()=>p});var n=r(50979),a=r(41220),l=r(25963),i=r(31754),s=r(84044),o=r(81154),u=r(24554),c=r(44661),d=r(2551),f=r(36609),m=r(13077),h=r(58400);let p=(0,l.memo)(function(e){let{id:t,type:r="deploy",visibleOptions:l,railwayTags:s,className:u}=e,[m,p]=(0,o.fp)(b),[g,E]=(0,o.fp)(w),[T,A]=(0,o.fp)(y),[M,R]=(0,o.fp)(v),[I,P]=(0,o.fp)(x),[_,U]=(0,o.fp)(j),[D,z]=(0,o.fp)(C(null!=t?t:"any")),[W,F]=(0,o.fp)(S(r)),B=s||({deploy:k,http:L,build:N})[r],{showRawData:q=!0,showDataAttributes:J=!0,showPlainText:V=!0,wrapText:H=!0,showHistogram:G=!0,showSeverity:$=!0,dataColumns:K=!0,railwayColumns:X=!0}=null!=l?l:{};return(0,n.jsxs)(a.AM,{children:[(0,n.jsx)(a.Wv,{asChild:!0,children:(0,n.jsx)(i.K0,{title:"Layout settings",icon:d.wB_,size:"xs",variant:"ghost",color:"gray",className:(0,f.xW)("ml-auto",u)})}),(0,n.jsx)(a.i0,{children:(0,n.jsx)(a.hl,{align:"end",sideOffset:2,className:"bg-background border border-neutral shadow-md rounded-lg z-50 w-80 max-w-[90vw] font-light text-left",children:(0,n.jsxs)("div",{className:"flex flex-col gap-5 !p-4",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("div",{className:"text-xs font-sans font-medium text-neutral-secondary",children:"View options"}),(0,n.jsxs)("div",{className:"space-y-1.5 text-neutral",children:[G&&(0,n.jsx)(c.S,{id:"show-histogram",size:"xs",checked:M,onChange:R,label:"Show histogram"}),$&&(0,n.jsx)(c.S,{id:"show-severity-level",size:"xs",checked:I,onChange:P,label:"Show severity level"}),q&&(0,n.jsx)(c.S,{id:"show-raw-data",size:"xs",checked:m,onChange:p,label:"Show data column"}),J&&(0,n.jsx)(c.S,{id:"show-data-attributes",size:"xs",checked:g,onChange:E,label:"Show attributes in data column"}),V&&(0,n.jsx)(c.S,{id:"show-raw-data-as-plain-text",size:"xs",checked:T,onChange:A,label:"Display data column as JSON"}),H&&(0,n.jsx)(c.S,{id:"wrap-text",size:"xs",checked:_,onChange:U,label:"Wrap long lines"})]})]}),X&&B.length>0&&(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("div",{className:"text-xs font-sans font-medium text-neutral-secondary",children:"Railway tag columns"}),(0,n.jsx)("div",{className:"gap-1.5 grid grid-cols-2 text-neutral",children:B.map(e=>(0,n.jsx)(c.S,{id:"railway-".concat(e),size:"xs",checked:W.includes(e),onChange:t=>{F(r=>t?[...r,e]:r.filter(t=>t!==e))},label:(0,h.$l)(e)},e))})]}),K&&(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("div",{className:"text-xs font-sans font-medium text-neutral-secondary",children:"Data columns"}),(0,n.jsxs)("div",{className:"space-y-2.5",children:[(0,n.jsxs)("div",{className:"text-xs text-neutral-secondary font-sans",children:["Include properties from JSON structured logs as columns e.g."," ",(0,n.jsx)("code",{children:"nested.message"})]}),(0,n.jsx)(O,{chips:D,onChipsChange:z})]})]})]})})})]})});function g(){let{id:e,type:t="deploy"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[r,n]=(0,o.fp)(b),[a,i]=(0,o.fp)(w),[s,u]=(0,o.fp)(y),[c,d]=(0,o.fp)(j),[f,m]=(0,o.fp)(v),[h,p]=(0,o.fp)(x),[g,S]=(0,o.fp)(C(null!=e?e:"any")),[N,k]=(0,o.fp)(E(t));return(0,l.useMemo)(()=>({showRawData:r,showDataAttributes:a,showPlainText:s,wrapText:c,showHistogram:f,showSeverity:h,dataColumns:g,railwayColumns:N,setShowRawData:n,setShowPlainText:u,setWrapText:d,setShowHistogram:m,setShowSeverity:p,setDataColumns:S,setRailwayColumns:k}),[r,a,s,c,f,h,g,N,n,u,d,m,p,S,k])}let x=(0,s.tG)("@railway/logs/showSeverity",!0,void 0,{getOnInit:!0}),v=(0,s.tG)("@railway/logs/showHistogram",!0,void 0,{getOnInit:!0}),y=(0,s.tG)("@railway/logs/showRawDataAsPlainText",!1,void 0,{getOnInit:!0}),b=(0,s.tG)("@railway/logs/showRawData",!0),w=(0,s.tG)("@railway/logs/showDataAttributes",!0,void 0,{getOnInit:!0}),j=(0,s.tG)("@railway/logs/wrapText",!0,void 0,{getOnInit:!0}),S=(0,s.Iz)(e=>(0,s.tG)("@railway/logs/".concat(e,"/railwayColumns"),"deploy"===e?["service"]:"http"===e?["method","path","httpStatus","totalDuration"]:[],void 0,{getOnInit:!0})),E=(0,s.Iz)(e=>(0,u.eU)(t=>t(S(e)).sort((t,r)=>"http"===e?L.indexOf(t)-L.indexOf(r):"deploy"===e?k.indexOf(t)-k.indexOf(r):N.indexOf(t)-N.indexOf(r)))),N=[],k=["service","deploy","replica"],L=["method","path","httpStatus","totalDuration"],C=(0,s.Iz)(e=>(0,s.tG)("@railway/logs/".concat(e,"/dataColumns"),[],void 0,{getOnInit:!0}));function O(e){let{chips:t,onChipsChange:r}=e,[a,i]=(0,l.useState)(t.length);return(0,n.jsxs)("div",{className:(0,f.xW)("relative text-[11px] flex w-full flex-wrap items-center gap-1 rounded-md border bg-background font-normal shadow-input transition-all aria-[invalid=true]:border-borders-danger dark:bg-background","border-neutral focus-within:border-primary focus-within:bg-white focus-within:text-neutral focus-within:outline-none focus-within:ring focus-within:ring-primary focus-within:hover:border-primary","p-[0.333em] text-sm cursor-text"),onClick:e=>{if(e.currentTarget===e.target){var t;null==(t=e.currentTarget.querySelector("input"))||t.focus()}},children:[t.map((e,a)=>(0,n.jsxs)("div",{className:"flex text-[11px] items-center gap-2 rounded bg-primary-button px-1.5 py-0.5 text-white",style:{order:a+1},children:[(0,n.jsx)("span",{children:e}),(0,n.jsx)("button",{"aria-label":"Remove",className:"!rounded-full",onClick:()=>{r(t.filter(t=>t!==e))},children:(0,n.jsx)(m.In,{icon:d.X,size:"xs"})})]},e)),(0,n.jsx)("input",{type:"text",name:"chip",autoCapitalize:"off",autoCorrect:"off",autoComplete:"off",className:(0,f.xW)("inline-block w-[3ch] text-[11px] min-w-[3ch] max-w-full border-0 bg-transparent px-1.5 py-0.5 focus:outline-none focus:ring-0"),style:{order:a},onChange:e=>{e.currentTarget.style.width="".concat(Math.max(e.currentTarget.value.length+4,4),"ch")},onKeyDown:e=>{if(e.currentTarget.value.length){("Enter"===e.key||" "===e.key)&&(e.preventDefault(),r([...t.slice(0,a),e.currentTarget.value.trim(),...t.slice(a)].filter((e,t,r)=>e&&r.indexOf(e)===t)),e.currentTarget.value="",e.currentTarget.style.width="4ch",i(e=>++e));return}switch(e.key){case"Backspace":r([...t.slice(0,a-1),...t.slice(a)]),i(Math.max(0,a-1));break;case"ArrowLeft":i(Math.max(0,a-1));break;case"ArrowRight":i(Math.min(t.length,a+1))}}})]})}},24224:(e,t,r)=>{r.d(t,{J:()=>x,j:()=>v});var n=r(47199),a=r.n(n),l=r(50253),i=r.n(l),s=r(25963),o=r(50095),u=r(63315),c=r(62843),d=r(21328),f=r(55850),m=r(45479),h=r(15518);let p=/(\b(https?):\/\/[-A-Z0-9+&@#/%?=~_|!:,.;]*[-A-Z0-9+&@#/%=~_|])/gim,g=new(a());g.use_classes=!0;let x=(e,t)=>{var r;let n=null!=(r=null==t?void 0:t.message)?r:"";return"".concat(e,"-").concat(t.timestamp,"-").concat(n)},v=e=>{var t,r;let{environmentId:n,filter:a,contextStart:l,contextEnd:p,dateRange:g}=e,{graphqlClient:x}=(0,f.q)(),[v,b]=(0,s.useState)(!0),[w,j]=(0,s.useState)(!0),[S,E]=(0,s.useState)([]),[N,k]=(0,s.useState)([]),[L,C]=(0,s.useState)(!1),[O,T]=(0,s.useState)(!1),A=[n,a,l,p,"".concat(null==(t=g.start)?void 0:t.toISOString(),"-").concat(null==(r=g.end)?void 0:r.toISOString())],M=l?new Date(l):null,R=p?new Date(null!=p?p:l):null,I=R&&M?R.getTime()-M.getTime():0,[P,_]=function(e,t){var r,n;let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l={key:"unset",data:[],error:null,isLoading:!0===a.enabled,isPaused:!1},[i,f]=(0,s.useState)(l),[m,h]=(0,o._)(l,5),p=(0,s.useRef)();(0,s.useEffect)(()=>h(i),[i]);let g=function(){let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(a.enabled)return f(e=>({key:new Date().toISOString(),isLoading:!r||e.isLoading,data:r?e.data:[],error:null,isPaused:!1})),p.current=(0,c.UU)({url:d.p.graphQLV2Subscription()}).subscribe({query:(0,u.y)(e),variables:t},{next:e=>{let{data:t}=e,r=Object.keys(t)[0];f(e=>({...e,isLoading:!1,data:Array.isArray(t[r])?function(e,t,r){if(null==r)return[...e,...t];let n=[...e];for(let e of t){let t=n.length,a=n.length-1e3;for(let l=n.length-1;l>=0&&l>=a;l--){let a=r(n[l],e);if(0===a){t=-1;break}if(!(a<0))break;t=l}t>=0&&n.splice(t,0,e)}return n}(e.data,t[r],a.compare):t[r]}))},error:e=>{var t,r;(null==(t=e.reason)?void 0:t.includes("deadline_exceeded"))?f(e=>({...e,isPaused:!0,isLoading:!1})):(null==(r=e.reason)?void 0:r.includes("invalid_argument"))?f(t=>({...t,error:e.reason,isLoading:!1})):setTimeout(()=>g(!0),5e3)},complete:()=>{}}),()=>{var e;return null==(e=p.current)?void 0:e.call(p)}};return(0,s.useEffect)(()=>g(),[null!=(r=a.enabled)&&r,...null!=(n=a.deps)?n:[]]),[m,{resume:(0,s.useCallback)(()=>{g(!0)},[g]),pause:(0,s.useCallback)(()=>{var e;return f(e=>({...e,isPaused:!0})),null==(e=p.current)?void 0:e.call(p)},[p.current])}]}(m.w37,{environmentId:n,filter:a,...M?{beforeLimit:80,beforeDate:i()(null!=R?R:M).subtract(I>5?I:5,"second").toISOString(),anchorDate:null!=p?p:l,afterLimit:80,afterDate:i()(M).add(I>5?I:5,"second").toISOString()}:{beforeLimit:1e3,...(0,h.i_)({dateRange:g,beforeDate:null,afterDate:null,anchorDate:null})}},{enabled:!0,compare:(e,t)=>t.timestamp.localeCompare(e.timestamp),deps:A});(0,s.useEffect)(()=>{E([]),k([]),b(!0),j(!0)},A),(0,s.useEffect)(()=>{l||b(P.data.length>=1e3)},[...A,P.data.length>0?"some":"none"]);let U=async()=>{var e,t;C(!0);let r=null!=(t=null!=(e=S[0])?e:P.data[0])?t:null,{environmentLogs:l}=await x.environmentLogs({afterLimit:0,beforeLimit:1e3,filter:a,environmentId:n,beforeDate:new Date(0).toISOString(),anchorDate:r?r.timestamp:new Date().toISOString()});C(!1),b(l.length>=1e3),E(e=>[...l,...e])},D=async()=>{var e,t;T(!0);let r=null!=(t=null!=(e=N[N.length-1])?e:P.data[P.data.length-1])?t:null,{environmentLogs:l}=await x.environmentLogs({beforeLimit:0,afterLimit:1e3,filter:a,environmentId:n,anchorDate:r?r.timestamp:new Date().toISOString(),afterDate:new Date().toISOString()});T(!1),j(l.length>=1e3),k(e=>[...e,...l])};return[{logs:(0,s.useMemo)(()=>{let e=[],t=new Set,r=r=>{let{message:n,timestamp:a}=r,l="".concat(n.toLocaleLowerCase(),":").concat(a);t.has(l)||(t.add(l),e.push(y(r)))};return S.forEach(r),P.data.forEach(r),N.forEach(r),e},[P.data,S,N]),dataKey:P.key,hasMoreAfter:w,hasMoreBefore:v,isLoadingAfter:O,isLoadingBefore:L,numLogsBefore:S.length,numLogsAfter:N.length,isLoading:P.isLoading||L||O,isSubscriptionPaused:P.isPaused},{loadMoreBefore:U,loadMoreAfter:D,pause:_.pause,resume:_.resume}]},y=e=>{let t=g.ansi_to_html(e.message||" ").replace(p,'<a href="$1" style="text-decoration:underline" target="_blank" rel="noopener noreferrer">$1</a>');return{...e,html:t}}},25836:(e,t,r)=>{r.d(t,{C:()=>a});var n=r(50979);function a(e){let{width:t=99,height:r=84,scrollSpeed:a=.8,lineSpacing:l=4,minLineWidth:i=16,maxLineWidth:s=72,lineCount:o=30,className:u="",title:c="Your logs are loading...",subtitle:d="Give us a moment to fetch your logs."}=e,f=Array.from({length:o},()=>Math.floor(Math.random()*(s-i+1))+i),m=o*l,h=m/(a*l);return(0,n.jsxs)("div",{className:"flex flex-col gap-6 w-full h-full items-center justify-center text-neutral-tertiary",children:[(0,n.jsxs)("svg",{width:t,height:r,viewBox:"0 0 ".concat(t," ").concat(r),fill:"none",xmlns:"http://www.w3.org/2000/svg",className:u,children:[(0,n.jsx)("path",{opacity:"0.5",d:"M1.5 7C1.5 5.4087 2.13214 3.88258 3.25736 2.75736C4.38258 1.63214 5.9087 1 7.5 1H91.5C93.0913 1 94.6174 1.63214 95.7426 2.75736C96.8679 3.88258 97.5 5.4087 97.5 7V77C97.5 78.5913 96.8679 80.1174 95.7426 81.2426C94.6174 82.3679 93.0913 83 91.5 83H7.5C5.9087 83 4.38258 82.3679 3.25736 81.2426C2.13214 80.1174 1.5 78.5913 1.5 77V7Z",stroke:"currentColor",strokeWidth:"1.5"}),(0,n.jsx)("path",{d:"M91.5 1H7.5C4.18629 1 1.5 3.68629 1.5 7V73C1.5 76.3137 4.18629 79 7.5 79H91.5C94.8137 79 97.5 76.3137 97.5 73V7C97.5 3.68629 94.8137 1 91.5 1Z",stroke:"currentColor",strokeWidth:"1.5"}),(0,n.jsx)("path",{opacity:"0.12",d:"M9.5 17H89.5V18H9.5V17Z",fill:"currentColor"}),(0,n.jsx)("rect",{x:"9.5",y:"9",width:"60",height:"4",rx:"1",fill:"currentColor"}),(0,n.jsx)("rect",{x:"73.5",y:"9",width:"16",height:"4",rx:"1",fill:"currentColor"}),(0,n.jsx)("defs",{children:(0,n.jsx)("clipPath",{id:"contentMask",children:(0,n.jsx)("rect",{x:"9.5",y:"22",width:"80",height:"50"})})}),(0,n.jsx)("g",{id:"Loglines",clipPath:"url(#contentMask)",children:[0,1].map(e=>(0,n.jsxs)("g",{children:[(0,n.jsx)("animateTransform",{attributeName:"transform",type:"translate",from:"0 ".concat(e*m),to:"0 ".concat((e-1)*m),dur:"".concat(h,"s"),repeatCount:"indefinite"}),f.map((e,t)=>(0,n.jsx)("rect",{x:"9.5",y:22+t*l,width:e,height:"2",rx:"1",fill:"currentColor"},t))]},e))})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("h2",{className:"font-semibold text-base text-neutral",children:c}),(0,n.jsx)("p",{className:"text-xs text-neutral-secondary",children:d})]})]})}r(25963)},29009:(e,t,r)=>{r.d(t,{n:()=>d});var n=r(50979),a=r(97989),l=r(21500),i=r(25963),s=r(36609),o=r(76999);let u=(0,i.memo)(function(e){let{attribute:t,severity:r}=e,a=(0,l.R7)(),u=(0,i.useMemo)(()=>{try{return JSON.parse(t.value)}catch(e){}},[t.value]);return(0,n.jsxs)("button",{className:(0,s.xW)("inline-flex text-left text-neutral-secondary opacity-70 items-center gap-x-1 px-1 select-none cursor-default text-xs font-mono",a.enabled&&"cursor-pointer border border-transparent rounded-xl","error"===r?a.enabled&&"hover:border-danger hover:opacity-100 hover:bg-danger-surface-hover":a.enabled&&"hover:border-neutral hover:opacity-100 hover:bg-gray-100 hover:dark:bg-gray-200 cursor-pointer"),onClick:"object"==typeof u&&null!==u?()=>{let e=[],r=[{obj:u,prefix:t.key}];for(;r.length>0;){let{obj:t,prefix:n}=r.pop();if("object"!=typeof t||null===t){e.push(new o.nW(n,JSON.stringify(t)));continue}Object.entries(t).forEach(a=>{let[l,i]=a,s=Array.isArray(t),u="".concat(n,".").concat(l);"object"==typeof i&&null!==i?r.push({obj:i,prefix:u}):e.push(s?new o.GP(n,parseInt(l),JSON.stringify(i)):new o.nW(u,JSON.stringify(i)))})}e.length>0&&a.addExpression(1===e.length?e[0]:new o.KD(e))}:()=>{a.addExpression(new o.nW(t.key,t.value))},children:[(0,n.jsxs)("span",{className:(0,s.xW)("font-semibold","error"===r&&"text-red-400 dark:text-red-600"),children:[t.key,":"]}),(0,n.jsx)("span",{className:"inline-block max-w-[160px] md:max-w-[360px] text-xs font-mono text-nowrap truncate text-ellipsis",children:t.value.replace(/\n/g," ")})]})},(e,t)=>e.attribute.key===t.attribute.key&&e.attribute.value===t.attribute.value&&e.severity===t.severity);var c=r(47199);function d(e){let{data:t,showPlainText:r=!1,dataColumns:l,toJSON:i,showAttributes:o=!0,className:u,...c}=e;return(0,n.jsx)(a.n,{severity:t.severity,className:(0,s.xW)("overflow-visible col-span-2",u),...c,children:r?(0,n.jsx)(m,{data:t,wrapText:c.wrapText,toJSON:i}):(0,n.jsx)(f,{data:t,dataColumns:l,wrapText:c.wrapText,showAttributes:o})})}function f(e){let{data:t,dataColumns:r=[],wrapText:a=!1,showAttributes:i=!0}=e;return(0,l.R7)(),(0,n.jsxs)("div",{children:[t.message&&(0,n.jsx)("div",{className:(0,s.xW)("text-left px-1 select-text inline-block",a?"whitespace-pre-wrap":"whitespace-pre"),dangerouslySetInnerHTML:{__html:h.ansi_to_html(t.message||" ")}}),i&&t.attributes.filter(e=>"level"!==e.key&&"severity"!==e.key&&!r.includes(e.key)).map(e=>(0,n.jsx)(u,{attribute:e,severity:t.severity},e.key))]})}function m(e){let{data:t,wrapText:r,toJSON:a}=e,l=(0,i.useMemo)(()=>{var e;return null!=(e=null==a?void 0:a(t))?e:t},[t,a]),s=(0,i.useMemo)(()=>JSON.stringify(l),[l]);return(0,n.jsx)("pre",{className:r?"whitespace-pre-wrap text-[11px]":"whitespace-pre",children:s})}let h=new(r.n(c)());h.use_classes=!0},33479:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{OptimizedEnvironmentLogGenerator:function(){return u},createOptimizedEnvironmentLogGenerator:function(){return c},generateOptimizedSql:function(){return d}});var n=r(36227);function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function l(e,t,r){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=i(e)););return e}(e,t);if(n){var a=Object.getOwnPropertyDescriptor(n,t);return a.get?a.get.call(r||e):a.value}})(e,t,r||e)}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r,n,a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var l=[],i=!0,s=!1;try{for(a=a.call(e);!(i=(r=a.next()).done)&&(l.push(r.value),!t||l.length!==t);i=!0);}catch(e){s=!0,n=e}finally{try{i||null==a.return||a.return()}finally{if(s)throw n}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return a(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var u=function(e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");a.prototype=Object.create(e&&e.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),e&&s(a,e);var t,r,n=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r,n=i(a);r=t?Reflect.construct(n,arguments,i(this).constructor):n.apply(this,arguments);if(r&&("object"==((e=r)&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e)||"function"==typeof r))return r;if(void 0===this)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return this});function a(){if(!(this instanceof a))throw TypeError("Cannot call a class as a function");return n.call(this,{columnMap:{project:"project_id",project_id:"project_id",environment:"environment_id",environment_id:"environment_id",service:"service_id",service_id:"service_id",deployment:"deployment_id",deployment_id:"deployment_id",replica:"deployment_instance_id",replica_id:"deployment_instance_id",deployment_instance:"deployment_instance_id",snapshot:"snapshot_id",snapshot_id:"snapshot_id",plugin:"plugin_id",plugin_id:"plugin_id",severity:"severity"},jsonColumn:"message",searchPath:"$.msg"})}return r=[{key:"buildJsonFieldCondition",value:function(e,t,r){var n=this,a="message";if(!e.includes(".")&&!e.includes("[")){var l=this.getExtractFunction(r,t),i=this.makeParam(e),s=this.makeParam(t,this.getParamType(r,t));return"".concat(l,"(").concat(a,", ").concat(i,") = ").concat(s)}var o=this.parseJsonPath(e).map(function(e){return"number"==typeof e?n.makeParam(String(e),"Int64"):n.makeParam(String(e))}),u=this.makeParam(t,this.getParamType(r,t)),c="JSONExtractString";return"number"===r&&(c=this.isFloat(t)?"JSONExtractFloat":"JSONExtractInt"),"".concat(c,"(").concat(a,", ").concat(o.join(", "),") = ").concat(u)}},{key:"buildSearchTerm",value:function(e){if(!this.config.jsonColumn)return"FALSE";var t=this.makeParam(e);return"positionCaseInsensitive(simpleJSONExtractString(".concat(this.config.jsonColumn,", 'msg'), ").concat(t,") > 0")}},{key:"buildExactMatch",value:function(e){if(!this.config.jsonColumn)return"FALSE";var t=this.makeParam(e);return"simpleJSONExtractString(".concat(this.config.jsonColumn,", 'msg') = ").concat(t)}},{key:"makeParam",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"String",r="p".concat(this.paramIndex++);if("Int64"===t||"Float64"===t){var n=parseFloat(e);this.params[r]=isNaN(n)?e:n}else this.params[r]=e;return"{".concat(r,":").concat(t,"}")}},{key:"parseJsonPath",value:function(e){for(var t=[],r="",n=!1,a=!1,l=0;l<e.length;l++){var i=e[l];if("["===i)'"'===e[l+1]?(r&&(t.push(r),r=""),n=!0,l++):/[\d-]/.test(e[l+1]||"")?(r&&(t.push(r),r=""),a=!0):r+=i;else if(n&&'"'===i&&"]"===e[l+1])t.push(r),r="",n=!1,l++;else if(a&&"]"===i){var s=parseInt(r,10);isNaN(s)?t.push(r):s>=0?t.push(s+1):t.push(s),r="",a=!1}else n||a||"."!==i?r+=i:r&&(t.push(r),r="")}return r&&t.push(r),t}},{key:"isFloat",value:function(e){return e.includes(".")}},{key:"getExtractFunction",value:function(e,t){return"number"!==e?"simpleJSONExtractString":t&&this.isFloat(t)?"simpleJSONExtractFloat":"simpleJSONExtractInt"}},{key:"getParamType",value:function(e,t){return"number"!==e?"String":t&&this.isFloat(t)?"Float64":"Int64"}},{key:"visit",value:function(e){if(!e)return"TRUE";switch(e.type){case"attribute":return this.buildOptimizedAttributeCondition(e);case"fieldValue":return this.buildOptimizedFieldValueCondition(e);default:return l(i(a.prototype),"visit",this).call(this,e)}}},{key:"buildOptimizedAttributeCondition",value:function(e){var t=null==(i=(s=this.config).fieldHandler)?void 0:i.call(s,e.field,e.value);if(t){var r=t.condition,n=!0,a=!1,l=void 0;try{for(var i,s,u,c,d=Object.entries(t.params)[Symbol.iterator]();!(n=(c=d.next()).done);n=!0){var f,m=o(c.value,2),h=m[0],p=m[1],g=this.makeParam(p,t.type||(null==(f=this.config.typeMap)?void 0:f[e.field]));r=r.replace("{".concat(h,"}"),g)}}catch(e){a=!0,l=e}finally{try{n||null==d.return||d.return()}finally{if(a)throw l}}return r}var x=null==(u=this.config.columnMap)?void 0:u[e.field];if(x){var v,y=this.makeParam(e.value,null==(v=this.config.typeMap)?void 0:v[e.field]);return"".concat(x," = ").concat(y)}return this.buildJsonFieldCondition(e.field,e.value,e.valueType)}},{key:"buildOptimizedFieldValueCondition",value:function(e){var t=null==(i=(s=this.config).fieldHandler)?void 0:i.call(s,e.field,e.value);if(t){var r=t.condition,n=!0,a=!1,l=void 0;try{for(var i,s,u,c,d=Object.entries(t.params)[Symbol.iterator]();!(n=(c=d.next()).done);n=!0){var f,m=o(c.value,2),h=m[0],p=m[1],g=this.makeParam(p,t.type||(null==(f=this.config.typeMap)?void 0:f[e.field]));r=r.replace("{".concat(h,"}"),g)}}catch(e){a=!0,l=e}finally{try{n||null==d.return||d.return()}finally{if(a)throw l}}return r}var x=null==(u=this.config.columnMap)?void 0:u[e.field];if(x){var v,y=this.makeParam(e.value,null==(v=this.config.typeMap)?void 0:v[e.field]);return"".concat(x," = ").concat(y)}return this.buildJsonFieldCondition(e.field,e.value,e.valueType)}}],function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(a.prototype,r),a}(n.SqlGenerator);function c(){return new u}function d(e){var t,r,n,a=c();try{return a.generate(e)}catch(a){if((null!=(t=Error)&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](a):a instanceof t)&&a.message.includes("Parsing errors"))return{clause:"positionCaseInsensitive(simpleJSONExtractString(message, 'msg'), {".concat("p1",":String}) > 0"),params:(r={},n=e.trim(),"p1"in r?Object.defineProperty(r,"p1",{value:n,enumerable:!0,configurable:!0,writable:!0}):r.p1=n,r)};throw a}}},33738:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{RailwayLogParser:function(){return u},parserInstance:function(){return c}});var n=r(78495),a=r(61453);function l(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&o(n,e);var t,r=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r,a=s(n);return r=t?Reflect.construct(a,arguments,s(this).constructor):a.apply(this,arguments),r&&("object"==((e=r)&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e)||"function"==typeof r)?r:l(this)});function n(){var e;if(!(this instanceof n))throw TypeError("Cannot call a class as a function");return i(l(e=r.call(this,a.allTokens)),"query",e.RULE("query",function(){e.OPTION(function(){e.SUBRULE(e.orExpression)})})),i(l(e),"orExpression",e.RULE("orExpression",function(){e.SUBRULE(e.andExpression,{LABEL:"left"}),e.MANY(function(){e.CONSUME(a.Or),e.SUBRULE2(e.andExpression,{LABEL:"right"})})})),i(l(e),"andExpression",e.RULE("andExpression",function(){e.SUBRULE(e.unaryExpression,{LABEL:"left"}),e.MANY(function(){e.OPTION(function(){e.CONSUME(a.And,{LABEL:"explicitAnd"})}),e.SUBRULE2(e.unaryExpression,{LABEL:"right"})})})),i(l(e),"unaryExpression",e.RULE("unaryExpression",function(){e.OPTION(function(){e.CONSUME(a.Minus,{LABEL:"negation"})}),e.SUBRULE(e.primaryExpression)})),i(l(e),"primaryExpression",e.RULE("primaryExpression",function(){e.OR([{ALT:function(){e.CONSUME(a.LeftParen),e.OPTION(function(){e.SUBRULE(e.orExpression,{LABEL:"grouped"})}),e.CONSUME(a.RightParen)}},{ALT:function(){e.CONSUME(a.At),e.SUBRULE(e.attribute,{LABEL:"attribute"})}},{ALT:function(){e.CONSUME(a.StringLiteral,{LABEL:"exactMatch"})}},{GATE:e.BACKTRACK(function(){e.CONSUME2(a.UnquotedToken),e.CONSUME2(a.Colon)}),ALT:function(){e.SUBRULE(e.fieldValue,{LABEL:"fieldValue"})}},{GATE:e.BACKTRACK(function(){e.CONSUME4(a.NumberLiteral),e.CONSUME3(a.Colon)}),ALT:function(){e.SUBRULE2(e.fieldValue,{LABEL:"fieldValue"})}},{ALT:function(){e.SUBRULE(e.searchTerm,{LABEL:"searchTerm"})}}])})),i(l(e),"attribute",e.RULE("attribute",function(){e.OR([{ALT:function(){return e.CONSUME(a.UnquotedToken,{LABEL:"field"})}},{ALT:function(){return e.CONSUME1(a.NumberLiteral,{LABEL:"field"})}}]),e.MANY(function(){e.CONSUME(a.LeftBracket),e.OR2([{ALT:function(){e.CONSUME2(a.Minus,{LABEL:"bracketNegative"}),e.OR3([{ALT:function(){return e.CONSUME3(a.NumberLiteral,{LABEL:"bracketContent"})}},{ALT:function(){return e.CONSUME3(a.UnquotedToken,{LABEL:"bracketContent"})}}])}},{ALT:function(){return e.CONSUME2(a.NumberLiteral,{LABEL:"bracketContent"})}},{ALT:function(){return e.CONSUME2(a.UnquotedToken,{LABEL:"bracketContent"})}},{ALT:function(){return e.CONSUME(a.StringLiteral,{LABEL:"bracketContent"})}}]),e.CONSUME(a.RightBracket)}),e.CONSUME(a.Colon),e.SUBRULE(e.attributeValue,{LABEL:"value"})})),i(l(e),"fieldValue",e.RULE("fieldValue",function(){e.OR([{ALT:function(){return e.CONSUME(a.UnquotedToken,{LABEL:"field"})}},{ALT:function(){return e.CONSUME3(a.NumberLiteral,{LABEL:"field"})}}]),e.CONSUME(a.Colon),e.SUBRULE(e.attributeValue,{LABEL:"value"})})),i(l(e),"attributeValue",e.RULE("attributeValue",function(){e.OPTION(function(){e.OR([{ALT:function(){return e.CONSUME(a.StringLiteral,{LABEL:"stringValue"})}},{ALT:function(){e.OR2([{ALT:function(){e.CONSUME2(a.NumberLiteral,{LABEL:"valueTokens"})}},{ALT:function(){return e.CONSUME3(a.UnquotedToken,{LABEL:"valueTokens"})}},{ALT:function(){e.AT_LEAST_ONE(function(){e.CONSUME4(a.Colon,{LABEL:"valueTokens"})}),e.OPTION2(function(){e.CONSUME5(a.UnquotedToken,{LABEL:"valueTokens"})})}}]),e.OPTION3(function(){e.CONSUME6(a.Colon,{LABEL:"valueTokens"}),e.OR3([{ALT:function(){return e.CONSUME7(a.NumberLiteral,{LABEL:"valueTokens"})}},{ALT:function(){return e.CONSUME8(a.UnquotedToken,{LABEL:"valueTokens"})}}])})}}])})})),i(l(e),"searchTerm",e.RULE("searchTerm",function(){e.OR([{ALT:function(){return e.CONSUME5(a.NumberLiteral,{LABEL:"searchTokens"})}},{ALT:function(){return e.CONSUME3(a.UnquotedToken,{LABEL:"searchTokens"})}},{ALT:function(){e.AT_LEAST_ONE2(function(){e.CONSUME6(a.Minus,{LABEL:"searchTokens"})}),e.OPTION4(function(){e.CONSUME7(a.UnquotedToken,{LABEL:"searchTokens"})})}}])})),e.performSelfAnalysis(),e}return n}(n.CstParser),c=new u},36227:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{SqlGeneratorFactory:function(){return d},SqlGenerator:function(){return f},generateSql:function(){return m},generateHttpLogSql:function(){return h}});var n=r(46281);function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function l(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r,n,a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var l=[],i=!0,s=!1;try{for(a=a.call(e);!(i=(r=a.next()).done)&&(l.push(r.value),!t||l.length!==t);i=!0);}catch(e){s=!0,n=e}finally{try{i||null==a.return||a.return()}finally{if(s)throw n}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return a(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var d=function(){function e(){l(this,e)}return s(e,null,[{key:"createEnvironmentLogGenerator",value:function(){return new f({columnMap:{project:"project_id",project_id:"project_id",environment:"environment_id",environment_id:"environment_id",service:"service_id",service_id:"service_id",deployment:"deployment_id",deployment_id:"deployment_id",replica:"deployment_instance_id",replica_id:"deployment_instance_id",deployment_instance:"deployment_instance_id",snapshot:"snapshot_id",snapshot_id:"snapshot_id",plugin:"plugin_id",plugin_id:"plugin_id",severity:"severity"}})}},{key:"createHttpLogGenerator",value:function(){var e={host:"host",path:"path",method:"method",httpStatus:"http_status",totalDuration:"total_duration",responseTime:"response_time",edgeRegion:"edge_region",id:"request_id",requestId:"request_id",txBytes:"tx_bytes",rxBytes:"rx_bytes",deploymentId:"deployment_id",deploymentInstanceId:"deployment_instance_id",timestamp:"timestamp",upstreamProto:"upstream_proto",downstreamProto:"downstream_proto",responseDetails:"response_details",upstreamAddress:"upstream_address",clientUa:"client_ua",upstreamRqDuration:"upstream_rq_duration",upstreamErrors:"upstream_errors"};return new f({columnMap:e,fieldHandler:function(t,r){if("srcIp"===t){var n=r.includes(":");return{column:n?"src_ip6":"src_ip4",condition:"".concat(n?"src_ip6":"src_ip4"," = {value}"),params:{value:r},type:n?"IPv6":"IPv4"}}return e[t]||"srcIp"===t?null:{column:"",condition:"FALSE",params:{}}},typeMap:{totalDuration:"UInt32",httpStatus:"UInt16",responseTime:"UInt32",txBytes:"UInt64",rxBytes:"UInt64",upstreamRqDuration:"UInt32",upstreamErrors:"UInt32"},jsonColumn:void 0})}},{key:"create",value:function(e){return new f(e)}}]),e}(),f=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};l(this,e),o(this,"config",void 0),o(this,"paramIndex",1),o(this,"params",{}),this.config={columnMap:t.columnMap||{},fieldHandler:t.fieldHandler||function(){return null},jsonColumn:t.jsonColumn||"message",searchPath:t.searchPath||"$.msg",typeMap:t.typeMap||{}}}return s(e,[{key:"generate",value:function(e){if(!e.trim())return{clause:"TRUE",params:{}};var t=(0,n.parseToAST)(e);return t?(this.paramIndex=1,this.params={},{clause:this.visit(t),params:this.params}):{clause:"TRUE",params:{}}}},{key:"visit",value:function(e){var t=this;if(!e)return"TRUE";switch(e.type){case"or":return"(".concat(e.children.map(function(e){return t.visit(e)}).join(" OR "),")");case"and":return"(".concat(e.children.map(function(e){return t.visit(e)}).join(" AND "),")");case"not":return"NOT (".concat(this.visit(e.child),")");case"attribute":return this.buildAttributeCondition(e);case"fieldValue":return this.buildFieldValueCondition(e);case"exactMatch":return this.buildExactMatch(e.value);case"searchTerm":return this.buildSearchTerm(e.value);case"grouped":return"(".concat(this.visit(e.child),")");default:throw Error("Unknown node type: ".concat(e.type))}}},{key:"buildAttributeCondition",value:function(e){var t=this.config.fieldHandler(e.field,e.value);if(t){var r=t.condition,n=!0,a=!1,l=void 0;try{for(var i,s=Object.entries(t.params)[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var o=c(i.value,2),u=o[0],d=o[1],f=this.makeParam(d,t.type||this.config.typeMap[e.field]);r=r.replace("{".concat(u,"}"),f)}}catch(e){a=!0,l=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw l}}return r}var m=this.config.columnMap[e.field];if(m){var h=this.makeParam(e.value,this.config.typeMap[e.field]);return"".concat(m," = ").concat(h)}return this.buildJsonFieldCondition(e.field,e.value)}},{key:"buildFieldValueCondition",value:function(e){var t=this.config.fieldHandler(e.field,e.value);if(t){var r=t.condition,n=!0,a=!1,l=void 0;try{for(var i,s=Object.entries(t.params)[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var o=c(i.value,2),u=o[0],d=o[1],f=this.makeParam(d,t.type||this.config.typeMap[e.field]);r=r.replace("{".concat(u,"}"),f)}}catch(e){a=!0,l=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw l}}return r}var m=this.config.columnMap[e.field];if(m){var h=this.makeParam(e.value,this.config.typeMap[e.field]);return"".concat(m," = ").concat(h)}return this.buildJsonFieldCondition(e.field,e.value)}},{key:"buildJsonFieldCondition",value:function(e,t){if(!this.config.jsonColumn)return"FALSE";var r=this.formatJsonPath(e),n=this.makeParam(r),a=this.makeParam(t);return"JSON_VALUE(".concat(this.config.jsonColumn,", '$.' || ").concat(n,") = ").concat(a)}},{key:"buildExactMatch",value:function(e){if(!this.config.jsonColumn)return"FALSE";var t=this.makeParam(e);return"JSON_VALUE(".concat(this.config.jsonColumn,", '").concat(this.config.searchPath,"') = ").concat(t)}},{key:"buildSearchTerm",value:function(e){if(!this.config.jsonColumn)return"FALSE";var t=this.makeParam(e);return"JSON_VALUE(".concat(this.config.jsonColumn,", '").concat(this.config.searchPath,"') ILIKE '%' || ").concat(t," || '%'")}},{key:"makeParam",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"String",r="p".concat(this.paramIndex++);return this.params[r]=e,"{".concat(r,":").concat(t,"}")}},{key:"formatJsonPath",value:function(e){if(e.includes("["))return e;for(var t=e.split(".").map(function(e){if(/[^a-zA-Z0-9_]/.test(e)){var t=e.replace(/\\/g,"\\\\").replace(/"/g,'\\"');return'["'.concat(t,'"]')}return e}),r="",n=0;n<t.length;n++){var a=t[n];a.startsWith("[")?r+=a:r+=(0===n?"":".")+a}return r}}]),e}();function m(e,t){var r=t?new f({columnMap:t}):d.createEnvironmentLogGenerator();try{return r.generate(e)}catch(t){if(u(t,Error)&&t.message.includes("Parsing errors"))return{clause:"positionCaseInsensitive(JSONExtractString(message, 'msg'), {".concat("p1",":String}) > 0"),params:o({},"p1",e.trim())};throw t}}function h(e){var t=d.createHttpLogGenerator();try{return t.generate(e)}catch(t){if(u(t,Error)&&t.message.includes("Parsing errors"))return{clause:"positionCaseInsensitive(JSONExtractString(message, 'msg'), {".concat("p1",":String}) > 0"),params:o({},"p1",e.trim())};throw t}}},37154:(e,t,r)=>{r.d(t,{P:()=>l});var n=r(50979);r(25963);var a=r(36609);let l=e=>{var t;let{severity:r,inContext:l,className:i,wrapperClassName:s,...o}=e,u=null==r?void 0:r.toLowerCase(),c=null!=(t=o.as)?t:"div";return(0,n.jsxs)(c,{className:(0,a.xW)(s,"group/logline relative py-[0.2em]","border border-transparent rounded group/logline relative w-full",l?"border-blue-200 dark:border-blue-300":""),children:[(0,n.jsx)("div",{className:(0,a.xW)(i,"w-full pl-8 relative z-10"),...o}),(0,n.jsx)("div",{"aria-hidden":!0,className:(0,a.xW)("absolute inset-0","opacity-30 group-hover/logline:opacity-40",(null==u?void 0:u.startsWith("warn"))?"bg-yellow-200":(null==u?void 0:u.startsWith("err"))?"bg-red-200":"info"===u||"debug"===u?"group-hover/logline:bg-gray-100":null)})]})}},40853:(e,t,r)=>{r.d(t,{t:()=>f});var n=r(50979),a=r(67590),l=r.n(a),i=r(25963),s=r(2551),o=r(2476),u=r(21500),c=r(55297),d=r(70643);function f(e){let{logs:t,toPlainText:r,toJSON:a,viewInContext:f,children:m}=e,[h,p]=(0,i.useState)(!1),[g,x]=(0,i.useState)(null),v=(0,u.R7)();return(0,n.jsxs)(o.tz,{name:"Log Explorer Context Menu",children:[(0,n.jsx)(o.Rc,{asChild:!0,disabled:h,children:(0,n.jsx)("div",{className:"w-full h-full",onPointerDown:e=>{var r;if(p(!1),null==(r=window.getSelection())?void 0:r.toString()){p(!0),x(null);return}let n=e.target.closest("[role=row]");if(!n||e.target.closest("[role=columnheader]")){p(!0),x(null);return}let a=Number(n.getAttribute("data-item-index"));if(isNaN(a))return;let l=t[a];l?x(l):(p(!0),x(null))},children:m})}),null!==g&&(0,n.jsxs)(o.Ip,{className:"p-1",children:[a&&(0,n.jsx)(o.vd,{value:"copy-as-json",icon:s.QRo,className:"text-xs",onSelect:()=>{let e=a(g);l()(JSON.stringify(e,null,2))},children:"Copy row as JSON"}),(r||"message"in g&&"string"==typeof g.message)&&(0,n.jsx)(o.vd,{value:"copy-message",className:"text-xs",icon:s.vEG,onSelect:()=>{var e;l()(null!=(e=null==r?void 0:r(g))?e:g.message+"")},children:"Copy message"}),v.enabled&&v.expression&&f&&(0,n.jsx)(o.vd,{value:"view-in-context",className:"text-xs",icon:s.Sc1,onSelect:()=>{(0,c.bj)({[d.XR]:g.timestamp,[u.MI]:null})},children:"View in context"})]})]})}},43067:(e,t,r)=>{r.d(t,{t:()=>i});var n=r(81154),a=r(24554),l=r(15857);function i(){return(0,n.md)(s)}let s=(0,a.eU)(e=>{let t=e(l.T6);return t?null==t?void 0:t.services.reduce((e,r)=>{var n;return e[r.id]={projectId:t.id,name:r.name,icon:null!=(n=r.icon)?n:null},e},{}):{}})},46281:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{RailwayLogASTVisitor:function(){return u},parseToAST:function(){return c}});var n=r(33738),a=r(61453);function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return l(e,void 0);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return l(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var u=function(e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");a.prototype=Object.create(e&&e.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),e&&s(a,e);var t,r,n=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r,n=i(a);r=t?Reflect.construct(n,arguments,i(this).constructor):n.apply(this,arguments);if(r&&("object"==((e=r)&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e)||"function"==typeof r))return r;if(void 0===this)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return this});function a(){var e;if(!(this instanceof a))throw TypeError("Cannot call a class as a function");return(e=n.call(this)).validateVisitor(),e}return r=[{key:"query",value:function(e){return e.orExpression&&0!==e.orExpression.length?this.visit(e.orExpression):null}},{key:"orExpression",value:function(e){var t=this,r=this.visit(e.left);if(!r&&(!e.right||0===e.right.length))return null;if(!e.right||0===e.right.length)return r;var n=e.right.map(function(e){return t.visit(e)}).filter(function(e){return null!==e});return r||0!==n.length?r?0===n.length?r:{type:"or",children:[r].concat(o(n))}:1===n.length?n[0]:{type:"or",children:n}:null}},{key:"andExpression",value:function(e){var t=this,r=this.visit(e.left);if(!r&&(!e.right||0===e.right.length))return null;if(!e.right||0===e.right.length)return r;var n=e.right.map(function(e){return t.visit(e)}).filter(function(e){return null!==e});return r||0!==n.length?r?0===n.length?r:{type:"and",children:[r].concat(o(n))}:1===n.length?n[0]:{type:"and",children:n}:null}},{key:"unaryExpression",value:function(e){var t=this.visit(e.primaryExpression);return t?e.negation?{type:"not",child:t}:t:null}},{key:"primaryExpression",value:function(e){if(e.grouped)return{type:"grouped",child:this.visit(e.grouped)};if(!e.attribute&&!e.fieldValue&&!e.exactMatch&&!e.searchTerm)return null;if(e.attribute)return this.visit(e.attribute);if(e.fieldValue){var t=this.visit(e.fieldValue);if(t)return t}if(e.exactMatch)return{type:"exactMatch",value:e.exactMatch[0].image.slice(1,-1).replace(/\\(.)/g,function(e,t){return'"'===t?'"':"\\"===t?"\\":e})};if(e.searchTerm)return this.visit(e.searchTerm);throw Error("Unknown primary expression")}},{key:"attribute",value:function(e){var t=e.field[0].image,r=e.value?this.visit(e.value):{value:"",type:"string"};if(e.bracketContent){var n=e.bracketNegative||[],a=[];e.bracketContent.forEach(function(e,t){e.image.startsWith('"')||a.push(t)});var l=n.length,i=Math.max(0,a.length-l),s=new Set(a.slice(i));e.bracketContent.forEach(function(e,r){var n=e.image;if(n.startsWith('"')){var a=n.slice(1,-1).replace(/\\"/g,'"');t="".concat(t,'["').concat(a,'"]')}else{var l=s.has(r);t="".concat(t,"[").concat(l?"-":"").concat(n,"]")}})}return{type:"attribute",field:t,value:r.value,valueType:r.type}}},{key:"fieldValue",value:function(e){if(!e.field)return null;var t=e.field[0].image,r=e.value?this.visit(e.value):{value:"",type:"string"};return{type:"fieldValue",field:t,value:r.value,valueType:r.type}}},{key:"attributeValue",value:function(e){if(e.stringValue)return{value:this.getTokenValue(e.stringValue[0]),type:"string"};if(e.valueTokens){var t=e.valueTokens.map(function(e){return e.image}).join(""),r="value";return/^-?\d+$/.test(t)||/^-?\d+\.\d+$/.test(t)?r="number":/^[a-zA-Z_][a-zA-Z0-9_\-.]*$/.test(t)&&(r="identifier"),{value:t,type:r}}return{value:"",type:"string"}}},{key:"searchTerm",value:function(e){return e.searchTokens?{type:"searchTerm",value:e.searchTokens.map(function(e){return e.image}).join("")}:{type:"searchTerm",value:Object.values(e)[0][0].image}}},{key:"getTokenValue",value:function(e){Array.isArray(e)&&(e=e[0]);var t=e.image||e;return"string"==typeof t&&t.startsWith('"')&&t.endsWith('"')&&(t=t.slice(1,-1).replace(/\\"/g,'"')),t}}],function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(a.prototype,r),a}(n.parserInstance.getBaseCstVisitorConstructor());function c(e){var t=a.RailwayLogLexer.tokenize(e);if(t.errors.length>0)throw Error("Lexing errors: ".concat(t.errors.map(function(e){return e.message}).join(", ")));n.parserInstance.input=t.tokens;var r=n.parserInstance.query();if(n.parserInstance.errors.length>0)throw Error("Parsing errors: ".concat(n.parserInstance.errors.map(function(e){return e.message}).join(", ")));return new u().visit(r)}},47829:(e,t,r)=>{r.d(t,{x:()=>l});var n=r(50979),a=r(36609);function l(e){let{children:t,className:r,resizable:l,defaultWidth:i,columnKey:s,...o}=e;return(0,n.jsxs)("div",{role:"columnheader",className:(0,a.xW)("relative px-2 py-1.5 group/th bg-secondaryBg whitespace-nowrap items-center flex",r),"data-column-key":s,"data-column-default-width":i,...o,children:[t,l&&(0,n.jsx)("div",{"data-column-resize-handle":!0,className:"absolute w-4 right-0 top-0 bottom-0 cursor-col-resize select-none",children:(0,n.jsx)("div",{className:"absolute top-2 bottom-2 right-0 w-1 rounded-full group-hover/th:bg-neutral-button-hover"})}),(0,n.jsx)("div",{className:"absolute inset-x-0 bottom-0 border-b border-b-neutral"})]})}},49872:(e,t,r)=>{r.d(t,{Y:()=>d});var n=r(50979),a=r(80428),l=r(13025),i=r(2551),s=r(82660),o=r(31754),u=r(13077),c=r(95662);function d(e){let{isPaused:t,onResume:r}=e;return(0,n.jsx)(a.N,{children:t&&(0,n.jsx)(l.P.div,{initial:{translateY:48,opacity:0},animate:{translateY:0,opacity:1},exit:{translateY:48,opacity:0},children:(0,n.jsx)(s.l,{variant:"primary",hideIcon:!0,className:"mx-auto text-sm border border-pink-200 py-0 absolute z-20 left-12 right-12 md:right-20 bottom-6",children:(0,n.jsxs)(c.z,{className:"w-full",align:"center",children:[(0,n.jsx)(u.In,{icon:i.R2D,className:"w-4 h-4 mr-2",size:"sm"}),(0,n.jsx)("div",{children:"Log stream has been paused"}),(0,n.jsx)(o.$n,{size:"xs",color:"pink",variant:"outline",name:"Resume Logs",className:"ml-auto my-1.5",onClick:r,children:"Resume live updates"})]})})})})}},55297:(e,t,r)=>{r.d(t,{Az:()=>u,bj:()=>o,bp:()=>i,sH:()=>s});var n=r(22986),a=r.n(n);let l={};function i(){let e;try{e=a().asPath}catch(t){e=window.location.pathname+window.location.search}let t=new URL(e,window.location.origin);return Object.entries(l).forEach(e=>{let[r,n]=e;null==n?t.searchParams.delete(r):t.searchParams.set(r,String(n))}),t}function s(e,t){let r=i(),{deleteKeys:n=[],customSerializer:a}=t||{};return n.forEach(e=>{r.searchParams.delete(e)}),Object.entries(e).forEach(e=>{let[t,n]=e;if(null==n)r.searchParams.delete(t);else if(a){let e=a(t,n);null!==e&&r.searchParams.set(t,e)}else r.searchParams.set(t,String(n))}),r}function o(e,t){let{replace:r=!1,deleteKeys:n=[],...i}=t||{};Object.entries(e).forEach(e=>{let[t,r]=e;n.includes(t)?delete l[t]:l[t]=r}),n.forEach(e=>{delete l[e]});let o=s(e,{deleteKeys:n,...i});if(a().asPath===o.pathname+o.search&&0===Object.keys(l).length)return;let u=()=>{l={},a().events.off("routeChangeComplete",u),a().events.off("routeChangeError",u)};a().events.on("routeChangeComplete",u),a().events.on("routeChangeError",u),r?a().replace(o):a().push(o)}function u(e,t){let{replace:r=!0,...n}=t||{},a=s(e,n);r?window.history.replaceState(null,"",a):window.history.pushState(null,"",a)}},58400:(e,t,r)=>{function n(e){cancelAnimationFrame(e.v)}function a(e,t){let r=performance.now(),n={v:0},a=()=>{performance.now()-r>=t?e.call(null):n.v=requestAnimationFrame(a)};return n.v=requestAnimationFrame(a),n}function l(e){let t,r=!1,n=()=>{r=!1,t&&e(...t)};return function(){for(var e=arguments.length,a=Array(e),l=0;l<e;l++)a[l]=arguments[l];t=a,r||(r=!0,requestAnimationFrame(n))}}function i(e){if(e)return Object.fromEntries(Object.entries(e).filter(e=>{let[t,r]=e;return null!=r}))}function s(e){return e.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/([A-Z])([A-Z][a-z])/g,"$1 $2").replace(/^./,e=>e.toUpperCase()).replace("Http","HTTP").replace("Url","URL").replace("Id","ID")}function o(e){return e.replace(u,"")}r.d(t,{$l:()=>s,Ee:()=>n,Vq:()=>a,aJ:()=>o,hp:()=>l,xF:()=>i});let u=/[\u001b\u009b][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-ORZcf-nqry=><]/g},58599:(e,t,r)=>{let n;r.d(t,{w:()=>l});var a=r(25963);function l(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=i(r.polyfill),l=function(e){let t=a.useRef(e);return a.useEffect(()=>{t.current=e}),t}(t);return a.useLayoutEffect(()=>{let t=!1,r=e&&"current"in e?e.current:e;if(!r)return()=>{};function a(e,r){t||l.current(e,r)}return n.subscribe(r,a),()=>{t=!0,n.unsubscribe(r,a)}},[e,n,l]),n.observer}let i=e=>n||(n=function(e){let t=!1,r=[],n=new Map,a=new(e||window.ResizeObserver)((e,a)=>{r=r.concat(e),t||window.requestAnimationFrame(()=>{let e=new Set;for(let t=0;t<r.length;t++){if(e.has(r[t].target))continue;e.add(r[t].target);let l=n.get(r[t].target);null==l||l.forEach(e=>e(r[t],a))}r=[],t=!1}),t=!0});return{observer:a,subscribe(e,t){var r;a.observe(e);let l=null!=(r=n.get(e))?r:[];l.push(t),n.set(e,l)},unsubscribe(e,t){var r;let l=null!=(r=n.get(e))?r:[];if(1===l.length){a.unobserve(e),n.delete(e);return}let i=l.indexOf(t);-1!==i&&l.splice(i,1),n.set(e,l)}}}(e))},59459:(e,t,r)=>{r.d(t,{y:()=>l});var n=r(25963),a=r(58599);function l(e){let[t,r]=(0,n.useState)(null);return(0,a.w)(e,()=>{let t=e&&"current"in e?e.current:e;t instanceof Element&&r(t.getBoundingClientRect())}),(0,n.useEffect)(()=>{let t=e&&"current"in e?e.current:e;t instanceof Element&&r(t.getBoundingClientRect())},[e]),t}},60904:(e,t,r)=>{r.d(t,{EM:()=>c,H_:()=>p,KX:()=>m,uc:()=>h});var n=r(63315),a=r(45479),l=r(17032),i=r(90454),s=r(98830),o=r(73751),u=r(58400);let{useLogs:c,useLogsQuery:d,useLogsStream:f,useLogsPagination:m,atoms:{newLogsAtom:h}}=(0,s.G)({streamLogs:(e,t,r,i)=>e(l.iv).subscribe({query:(0,n.y)(a.w37),variables:r},{...i,next(e){e.data&&i.next(e.data.environmentLogs)}}),async queryLogs(e,t,r){let n=e(i.a);if(!n)throw Error("No GraphQL client");return(await n.environmentLogs(r)).environmentLogs}});function p(e,t){var r;let{message:n=!0,timestamp:a=!0,attributes:l=!0,tags:i=!0}=null!=t?t:{},s=l?e.attributes.reduce((e,t)=>{try{e[t.key]=JSON.parse(t.value)}catch(r){e[t.key]=t.value}return e},{}):void 0;return{message:n?e.message:void 0,attributes:s,tags:i?Object.keys(null!=(r=(0,u.xF)(e.tags))?r:{}).reduce((t,r)=>(t[o.r3[r]]=e.tags[r],t),{}):void 0,timestamp:a?e.timestamp:void 0}}},61453:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{createToken:function(){return n.createToken},Lexer:function(){return n.Lexer},StringLiteral:function(){return a},NumberLiteral:function(){return l},And:function(){return i},Or:function(){return s},At:function(){return o},Colon:function(){return u},Minus:function(){return c},LeftParen:function(){return d},RightParen:function(){return f},LeftBracket:function(){return m},RightBracket:function(){return h},UnquotedToken:function(){return p},WhiteSpace:function(){return g},allTokens:function(){return x},RailwayLogLexer:function(){return v}});var n=r(78495),a=(0,n.createToken)({name:"StringLiteral",pattern:function(e,t){if('"'!==e[t])return null;for(var r=t+1;r<e.length;){var n=e[r];if("\\"===n&&r+1<e.length)r+=2;else{if('"'===n)return[e.substring(t,r+1)];r++}}return null},line_breaks:!1}),l=(0,n.createToken)({name:"NumberLiteral",pattern:/-?\d+(\.\d+)?(?!\S)/}),i=(0,n.createToken)({name:"And",pattern:/\bAND\b/i}),s=(0,n.createToken)({name:"Or",pattern:/\bOR\b/i}),o=(0,n.createToken)({name:"At",pattern:/@/}),u=(0,n.createToken)({name:"Colon",pattern:/:/}),c=(0,n.createToken)({name:"Minus",pattern:/-/}),d=(0,n.createToken)({name:"LeftParen",pattern:/\(/}),f=(0,n.createToken)({name:"RightParen",pattern:/\)/}),m=(0,n.createToken)({name:"LeftBracket",pattern:/\[/}),h=(0,n.createToken)({name:"RightBracket",pattern:/\]/}),p=(0,n.createToken)({name:"UnquotedToken",pattern:/[^\s()[\]":@-][^\s()[\]":]*/}),g=(0,n.createToken)({name:"WhiteSpace",pattern:/\s+/,group:n.Lexer.SKIPPED}),x=[g,a,l,i,s,p,d,f,m,h,o,u,c],v=new n.Lexer(x)},61455:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{RailwayLogLexer:function(){return n.RailwayLogLexer},allTokens:function(){return n.allTokens},RailwayLogParser:function(){return a.RailwayLogParser},parserInstance:function(){return a.parserInstance},RailwayLogASTVisitor:function(){return l.RailwayLogASTVisitor},parseToAST:function(){return l.parseToAST},SqlGenerator:function(){return i.SqlGenerator},SqlGeneratorFactory:function(){return i.SqlGeneratorFactory},generateSql:function(){return i.generateSql},generateHttpLogSql:function(){return i.generateHttpLogSql},OptimizedEnvironmentLogGenerator:function(){return s.OptimizedEnvironmentLogGenerator},createOptimizedEnvironmentLogGenerator:function(){return s.createOptimizedEnvironmentLogGenerator},generateOptimizedSql:function(){return s.generateOptimizedSql},tokenizeForHighlighting:function(){return o.tokenizeForHighlighting},isInsideQuotes:function(){return o.isInsideQuotes},getTokenAtPosition:function(){return o.getTokenAtPosition},expression:function(){return u}});var n=r(61453),a=r(33738),l=r(46281),i=r(36227),s=r(33479),o=r(84564),u=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=c(t);if(r&&r.has(e))return r.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if("default"!==l&&Object.prototype.hasOwnProperty.call(e,l)){var i=a?Object.getOwnPropertyDescriptor(e,l):null;i&&(i.get||i.set)?Object.defineProperty(n,l,i):n[l]=e[l]}return n.default=e,r&&r.set(e,n),n}(r(3531));function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(c=function(e){return e?r:t})(e)}},64963:(e,t,r)=>{r.d(t,{R3:()=>er,ZU:()=>ea});var n=r(86739),a=r(50979),l=r(50253),i=r.n(l),s=r(13025),o=r(81154),u=r(25963),c=r(883),d=r(1142),f=r(71121),m=r(24224),h=r(30595),p=r(2551),g=r(15857),x=r(36609),v=r(94702),y=r(82660),b=r(31754),w=r(13077),j=r(47654),S=r(67970),E=r(95662),N=r(52846),k=r(83119),L=r(75749),C=r(36725),O=r(37154);let T=e=>{var t;let{activeDateRange:r,side:n,className:l}=e,i=null!=(t=null==r?void 0:r[n])?t:null;return null==i?null:(0,a.jsx)(O.P,{className:(0,x.xW)(l,"!pl-0 py-3 text-gray-600"),children:(0,a.jsx)(L.c,{as:"div",className:"relative border-gray-200",children:(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-start",children:(0,a.jsxs)("div",{className:"border border-gray-200 ml-8 bg-background rounded px-3 py-0.5 text-xs",children:["You reached the ",n," of the range",r&&(0,a.jsxs)(a.Fragment,{children:[" ","→ ",(0,a.jsx)(C.g,{children:i})]})]})})})})};var A=r(44661),M=r(17057);let R=e=>{let{allColumns:t,setColumnVisibility:r}=e;return(0,a.jsxs)(M.ms,{children:[(0,a.jsx)(M.Lk,{icon:p.GvN,title:"Log preferences",className:"z-10 absolute right-7 h-full px-2 text-gray-400",size:"xs"}),(0,a.jsx)(M.pm,{align:"end",children:t.map(e=>{let{id:t,isVisible:n,isToggleable:l,label:i}=e;return l?(0,a.jsx)(M.tJ,{keepOpenOnSelect:!0,onSelect:()=>r(t,!n),children:(0,a.jsx)(A.S,{checked:n,id:t,size:"xs",label:i})},t):null})})]})};var I=r(47868),P=r(73611),_=r(11589),U=r(4883),D=r(66138),z=r(75631),W=r(55355),F=r(53133),B=r(54940);let q=e=>e.all.count,J=e=>e.timestamp,V=e=>e.severity,H={rx:2,ry:2},G=e=>{let{width:t,height:r,histogram:n,onRangeChange:l}=e,{tooltipOpen:i,tooltipTop:s,tooltipLeft:o,tooltipData:c,showTooltip:d,updateTooltip:f,hideTooltip:m}=(0,D.A)(),{groupedHistogramBuckets:h}=(0,u.useMemo)(()=>{let e={};for(let t of n.buckets){let r=J(t),n=V(t);null==e[r]&&(e[r]={}),null==e[r].all?e[r].all={severity:"all",timestamp:t.timestamp,count:t.count}:e[r].all.count+=t.count,e[r][n]=t}return{groupedHistogramBuckets:Object.values(e)}},[n.buckets]),{containerRef:p,TooltipInPortal:g}=(0,z.A)({detectBounds:!0,scroll:!0}),y=null!=t?t:0,b=(null!=r?r:0)-0,w=(0,u.useMemo)(()=>(0,P.A)({range:[0,y],domain:n.buckets.map(J)}),[y,n.buckets]),j=(0,u.useMemo)(()=>{var e;let t=Math.max(...null!=(e=h.map(q))?e:[]);return(0,_.A)({nice:!0,range:[0,b],domain:[0,0===t?1:t]})},[b,h]),[S,E]=u.useState(null),N=e=>{if(null==S)return;let t=e.all.timestamp,{from:r,to:n}=S,[a,l]=r<n?[r,n]:[n,r];return t>=a&&t<=l},k=()=>{if(null==S)return;let{from:e,to:t}=S,[r,a]=e<t?[new Date(e),new Date(t)]:[new Date(t),new Date(e)];l({start:r,end:K(n,a)})};return(0,u.useEffect)(()=>{let e=()=>E(null);return document.addEventListener("mouseup",e),()=>document.removeEventListener("mouseup",e)},[S]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("svg",{ref:p,width:t,height:r,children:h.map(e=>{var t;let r=e.all.timestamp,n=w.bandwidth(),l=n-2,i=(null!=(t=w(r))?t:0)+1,s=i+1,o=Math.max(1,j(q(e))),u=b-o,c=0;return(0,a.jsxs)(I.A,{onMouseOver:t=>((e,t)=>{if(null!=e.currentTarget.ownerSVGElement)if(null!=S)E({from:S.from,to:t.all.timestamp});else{let r=(0,W.A)(e.currentTarget.ownerSVGElement,e);d({tooltipLeft:null==r?void 0:r.x,tooltipTop:null==r?void 0:r.y,tooltipData:t})}})(t,e),onMouseMove:t=>((e,t)=>{if(null==e.currentTarget.ownerSVGElement)return;let r=(0,W.A)(e.currentTarget.ownerSVGElement,e);f({tooltipLeft:null==r?void 0:r.x,tooltipTop:null==r?void 0:r.y,tooltipOpen:!0,tooltipData:t})})(t,e),onMouseLeave:m,onMouseDown:()=>(e=>{let t=e.all.timestamp;E({from:t,to:t})})(e),onMouseUp:k,height:b,className:"group",children:[(0,a.jsx)("rect",{fill:"transparent",x:i,width:n,height:b}),(0,a.jsx)("rect",{...H,id:"background-".concat(r),x:s,width:l,height:b,className:(0,x.xW)("fill-transparent group-hover:fill-gray-100",N(e)&&"!fill-gray-200")}),(0,a.jsx)("clipPath",{id:"clip-".concat(r),children:(0,a.jsx)("rect",{...H,x:s,y:u,width:l,height:o})}),(0,a.jsx)(I.A,{id:"bar-stack-".concat(r),clipPath:"url(#clip-".concat(r,")"),children:Object.keys(e).filter(e=>"all"!==e).sort(X).map(t=>{var n;let i=e[t],o=Math.max(+("info"===t),null!=(n=j(i.count))?n:0),u=b-o-c,d=V(i);return c+=o,(0,a.jsx)("rect",{id:"bar-".concat(r,"-").concat(d),x:s,y:u,width:l,height:o,className:(0,x.xW)("debug"===d&&"fill-gray-400 group-hover:fill-gray-500 ".concat(N(e)?"!fill-gray-600":""),"info"===d&&"fill-blue-400 group-hover:fill-blue-500 ".concat(N(e)?"!fill-blue-600":""),d.startsWith("warn")&&"fill-yellow-400 group-hover:fill-yellow-500 ".concat(N(e)?"!fill-yellow-600":""),d.startsWith("err")&&"fill-red-400 group-hover:fill-red-500 ".concat(N(e)?"!fill-red-600":""))},"bar-".concat(t))})})]},r)})}),i&&c&&(0,a.jsx)(g,{top:s,left:o,style:{...F.k5,backgroundColor:"var(--gray-100)"},children:S?(0,a.jsx)(B.H,{label:(0,v.Kg)(S.from),value:"Selected "+(0,v.v_)(S.from,K(n,new Date(S.to)))}):(0,a.jsx)(B.H,{label:(0,v.Kg)(c.all.timestamp),value:(0,a.jsx)("div",{children:Object.keys(c).sort(X).reverse().map(e=>"all"!==V(c[e])&&(0,a.jsxs)("div",{children:[V(c[e]).replace(/\berr\b/g,"error").toLowerCase(),": ",c[e].count]},e))})})})]})},$=e=>(0,a.jsx)(U.A,{children:t=>{let{width:r,height:n}=t;return(0,a.jsx)(G,{width:null!=r?r:0,height:null!=n?n:0,...e})}}),K=(e,t)=>i()(t).add(e.stepSeconds,"second").toDate(),X=(e,t)=>{var r,n;let a={debug:0,info:1,warn:2,error:3,err:3};return(null!=(r=a[e])?r:-1)-(null!=(n=a[t])?n:-1)};var Y=r(21341);let Z=e=>{let{isAtTop:t,isAtBottom:r,scrollToBottom:n,scrollToTop:l}=e;return(0,a.jsxs)("div",{className:"bottom-6 hidden sm:flex flex-col fixed right-12 lg:right-8 gap-1 z-10",children:[(0,a.jsx)(b.K0,{title:"Jump to top",variant:"outline",icon:p.DoI,className:"bg-gray-100 hover:bg-gray-200 disabled:hover:bg-gray-100 disabled:active:scale-100",disabled:t,onClick:l}),(0,a.jsx)(b.K0,{title:"Jump to bottom",variant:"outline",icon:p.yd$,className:"bg-gray-100 hover:bg-gray-200 disabled:hover:bg-gray-100 disabled:active:scale-100",disabled:r,onClick:n})]})};var Q=r(12224);let ee=e=>{var t;let{label:r,tagName:n,tagValue:l,logExplorerRoute:i,dateRange:s}=e,o=null!=(t=null!=r?r:null==l?void 0:l.split("-",2)[0])?t:"--";return(0,a.jsx)(Q.F,{title:"Filter by ".concat(n),className:"text-gray-600 pr-2",children:null!=i&&l?(0,a.jsx)(j.N,{className:"hover:underline hover:text-gray-600 cursor:pointer",...i({dateRange:s,tags:[{name:n,value:l}]}),children:o}):(0,a.jsx)("span",{className:"text-gray-300",children:o})})};function et(){let e=(0,n._)(["bg-secondaryBg dark:bg-background h-full max-h-full overflow-x-auto text-xs font-mono cursor-text"]);return et=function(){return e},e}let er=e=>{var t;let{lineClassName:r,logs:n,groups:l,histogram:L,dataKey:C,isSubscriptionPaused:A,resume:M,numLogsBefore:I,hasMoreBefore:P,hasMoreAfter:_,isLoadingBefore:U,isLoadingAfter:D,isLoading:z,error:W,loadMoreBefore:F,loadMoreAfter:B,emptyMessage:q,stickyScrollParent:J,logExplorerRoute:V,setActiveDateRange:H,activeDateRange:G,linkedTags:K=[],visibleColumns:X=[],viewableColumns:et=[]}=e,er=(0,u.useRef)(null),ea=(0,o.md)(g.T6),es=(0,d.z)("sm"),eo=!es,[eu]=(0,f.EH)(),[ec,ed]=(0,u.useState)(!eo),[ef,em]=(0,u.useState)(eo),eh=(0,u.useMemo)(()=>{var e;let t={};for(let r of null!=(e=null==ea?void 0:ea.services)?e:[])t[r.id]=r.name;return t},[null==ea?void 0:ea.services]),ep=(0,u.useMemo)(()=>{var e;let t={};for(let r of null!=(e=null==ea?void 0:ea.plugins)?e:[])t[r.id]=r.friendlyName;return t},[null==ea?void 0:ea.plugins]),eg=new URLSearchParams(window.location.search).get("context"),[ex,ev]=null!=(t=null==eg?void 0:eg.split(".."))?t:[],[ey,eb]=(0,u.useState)({}),ew=Math.floor(Number.MAX_SAFE_INTEGER/2)-I,[ej,eS]=(0,u.useMemo)(()=>{let e=-1,t=-1;for(let r=0;r<n.length;r++){let a=n[r];a.timestamp===ex?(e=ew+r,t=ew+r):a.timestamp===ev&&(t=ew+r)}return[e,t]},[n,ex,ev,ey]),eE=0===n.length||!P,eN=(0,u.useRef)(null),ek=(0,u.useId)(),[eL,eC]=(e=>{let{columnDefinitions:t,deps:r}=e,[n,l]=(0,h.A)("@railway/log-table",{defaultValue:{}}),[i,s]=(0,u.useState)({}),[o,c]=(0,u.useState)({}),[d,f]=(0,u.useState)(null);(0,u.useEffect)(()=>{s({}),c({}),f(null)},r);let m=(0,u.useMemo)(()=>{let e=new Set;for(let i of t){var r,a,l;let t=null!=(a=null==(r=n.columns)?void 0:r[i.id])?a:null;(null!=(l=null==t?void 0:t.visible)?l:!i.defaultHidden)&&e.add(i.id)}return e},[t,n.columns]),p=(0,u.useMemo)(()=>t.filter(e=>m.has(e.id)),[t,m]),g=(0,u.useRef)(null),x=()=>{if(null!==g.current){var e,t;document.documentElement.removeEventListener("mousemove",null==(e=g.current)?void 0:e.mouseMove),document.documentElement.removeEventListener("mouseup",null==(t=g.current)?void 0:t.mouseUp)}},v=(0,u.useCallback)((e,r)=>{l(n=>{var a,l,i,s;let o=null!=(l=t.find(t=>t.id===e))?l:null;if(null==o)return n;let u=null!=(i=o.minWidth)?i:13,c=null!=(s=o.maxWidth)?s:500;return r<u&&(r=u),r>c&&(r=c),{...n,columns:{...n.columns,[o.id]:{...null==(a=n.columns)?void 0:a[o.id],width:r}}}})},[t]),y=(0,u.useCallback)((e,r)=>{l(n=>{var a,l;let i=null==(a=t.find(t=>t.id===e))?void 0:a.id;return null==i?n:{...n,columns:{...n.columns,[i]:{...null==(l=n.columns)?void 0:l[i],visible:r}}}})},[t]),b=(0,u.useCallback)(e=>{var r,n;let a=null!=(r=t.find(t=>t.id===e))?r:null;v(e,null!=(n=null==a?void 0:a.defaultWidth)?n:100)},[v]),w=(0,u.useCallback)((e,t)=>{s(r=>({...r,[e.timestamp]:t}))},[s]),j=(0,u.useCallback)(e=>{var t;return null!=(t=i[e.timestamp])&&t},[i]),S=(0,u.useCallback)(function(e){var t;let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return null!=(t=o[e])?t:r},[o]),E=(0,u.useCallback)((e,t)=>{c(r=>({...r,[e]:t}))},[c]),N=(0,u.useCallback)((e,t)=>{if(e.preventDefault(),!(e.target instanceof Element))return;let r=e.target.closest("[data-log-column]");x();let n=r.getBoundingClientRect(),a=e.clientX,l=n.width;g.current={mouseMove:e=>{e.preventDefault(),v(t,l-(a-e.clientX))},mouseUp:e=>{e.preventDefault(),x(),f(null)}},document.documentElement.addEventListener("mousemove",g.current.mouseMove),document.documentElement.addEventListener("mouseup",g.current.mouseUp),f(t)},[]),k=(0,u.useMemo)(()=>({display:"grid",gridTemplateColumns:p.map((e,r)=>{var a,l,i,s,o;if(e.autoWidth)return"auto";let u=null!=(i=t.find(t=>t.id===e.id))?i:null,c=null!=(o=null!=(s=null==(l=n.columns)||null==(a=l[e.id])?void 0:a.width)?s:null==u?void 0:u.defaultWidth)?o:100,d=r===p.length-1?"1fr":"".concat(c,"px");return"minmax(0,".concat(d,")")}).join(" "),gridAutoRows:"auto"}),[t.map(e=>e.id).join(","),n.columns]),L=(0,u.useMemo)(()=>p.map((e,t)=>{var r,a;let l=t===p.length-1,i=null!=(a=null==(r=n.columns)?void 0:r[e.id])?a:null;return{id:e.id,label:e.label,isResizing:d===e.id,width:l?"1fr":"".concat(null==i?void 0:i.width,"px"),canResize:!l&&!e.autoWidth&&(null==e.minWidth||e.minWidth!==e.maxWidth)}}),[p,n.columns,d]),C=(0,u.useMemo)(()=>t.map(e=>({id:e.id,label:e.label,isVisible:m.has(e.id),isToggleable:e.isToggleable})),[m]),O=(0,u.useCallback)(e=>(0,a.jsx)("div",{style:k,children:t.map(t=>{var r;return m.has(t.id)&&(0,a.jsx)("div",{children:t.render({log:e,expanded:null!=(r=i[e.timestamp])&&r})},t.id)})}),[t]),T=(0,u.useCallback)((e,r)=>(0,a.jsx)("div",{style:k,children:t.map(t=>m.has(t.id)&&(0,a.jsx)("div",{children:t.render({log:e,expanded:r})},t.id))}),[t]);return[{allColumns:C,columns:L,rowStyles:k},{renderRow:O,renderGroupRow:T,isExpanded:j,onDragStart:N,onDragReset:b,setLogExpanded:w,setColumnWidth:v,setColumnVisibility:y,isGroupExpanded:S,setGroupExpanded:E}]})({deps:[C],columnDefinitions:[{label:"",id:"expand",autoWidth:!0,isToggleable:!1,render:e=>{let{log:t,expanded:r}=e;if("type"in t){let e=t.numChildLogs>0;return(0,a.jsx)(w.In,{className:(0,x.xW)("text-gray-500 transition-transform absolute left-4 top-0",!e&&"opacity-0",r?"rotate-90":"rotate-0"),icon:p.c_$,size:"sm"})}return(0,a.jsx)(b.K0,{className:"w-7 h-5 group/btn opacity-0 group-hover/logline:opacity-100 border-0 absolute left-0 top-0",iconStyles:"text-gray-500 group-hover/btn:text-gray-800",size:"sm",title:r?"Collapse":"Expand",icon:r?p.a0Z:p.evX,onClick:()=>eA(t,!r)})}},{label:"Severity",id:"severity",minWidth:18,defaultWidth:18,maxWidth:18,isToggleable:!0,render:e=>{var t,r,n;let{log:l}=e,i=null!=(r=null==(t=l.severity)?void 0:t.toLowerCase())?r:"info";return"type"in l&&l.numChildLogs>0&&(i=null!=l.completed?"vertex"===l.type&&(null==(n=l.attributes)?void 0:n.error)==null?"success":i:"pending"),(0,a.jsx)(Q.F,{className:"pr-2 w-full h-full",children:(0,a.jsx)(j.N,{...null!=V&&V({tags:[{name:"level",value:i}],dateRange:G}),className:(0,x.xW)("block h-full w-2 rounded-[3px]","debug"===i&&"bg-gray-300 hover:bg-gray-500","info"===i&&"bg-blue-200 hover:bg-blue-400",i.startsWith("warn")&&"bg-yellow-400 hover:bg-yellow-600",i.startsWith("err")&&"bg-red-300 hover:bg-red-500","success"===i&&"bg-green-300 hover:bg-green-500","pending"===i&&"bg-gray-300 hover:bg-gray-500")})})}},{label:"Timestamp",id:"timestamp",defaultWidth:120,isToggleable:!0,defaultHidden:es,render:e=>{let{log:t}=e,r=(0,v.Kg)(t.timestamp),n=e=>{let r=new URL(window.location.href);if("string"==typeof r.searchParams.get("context")&&e){let[,n]=e.split("."),[,a]=t.timestamp.split("."),l=new Date(t.timestamp).getTime()-new Date(e).getTime(),i=Number(a.replace(/[^0-9]/g,"")),s=Number(n.replace(/[^0-9]/g,""));l<0||0===l&&i<s?r.searchParams.set("context","".concat(t.timestamp,"..").concat(e)):r.searchParams.set("context","".concat(e,"..").concat(t.timestamp))}else r.searchParams.set("context",t.timestamp);window.history.replaceState(null,"",r),eb({})};return(0,a.jsx)(Q.F,{className:"text-gray-500",children:V?(0,a.jsx)(j.N,{scroll:!1,title:t.timestamp,className:"hover:underline",onClick:e=>{if(e.metaKey||e.ctrlKey)return;e.preventDefault();let t=new URL(window.location.href);if(e.shiftKey){var r;let e=null==(r=t.searchParams.get("context"))?void 0:r.split("..");n(e&&e[0])}else n()},draggable:!0,onDragStart:e=>{let r=document.getElementById(ek);r&&r.remove();let a=e.currentTarget.cloneNode(!0);a instanceof HTMLElement&&(a.style.opacity="0",a.style.visibility="hidden",a.id=ek,document.body.appendChild(a),e.dataTransfer.setDragImage(a,0,0),eN.current=t.timestamp,n())},onDragEnd:e=>{eN.current=null;let t=document.getElementById(ek);t&&t.remove()},onDragEnter:e=>{let t=new URL(window.location.href).searchParams.get("context");if("string"==typeof t){var r;let e=null!=(r=eN.current)?r:t.split("..")[0];if(!e)return;n(e)}},...V({context:t.timestamp,filter:""}),children:r}):r})}},...et.map(e=>({id:e,label:el[e],defaultHidden:!X.includes(e),defaultWidth:80,isToggleable:!0,render:t=>{var r,n,l,i,s,o,u;let{log:c}=t,d=null;return"serviceId"===e?d=null!=(i=eh[null!=(l=null==(n=c.tags)?void 0:n.serviceId)?l:""])?i:null:"pluginId"===e&&(d=null!=(u=ep[null!=(o=null==(s=c.tags)?void 0:s.pluginId)?o:""])?u:null),(0,a.jsx)(ee,{tagName:e,tagValue:null==(r=c.tags)?void 0:r[e],label:d,logExplorerRoute:V,dateRange:G})}})),{label:"Message",id:"message",isToggleable:!1,render:e=>{let{log:t}=e;if("type"in t){var r,n;let e=null==(r=t.attributes)?void 0:r.cached,l=null!=t.completed,i=null==(n=t.attributes)?void 0:n.error;return(0,a.jsxs)(Q.F,{enableTextSelection:!0,className:"flex whitespace-pre-wrap gap-4",children:[(0,a.jsxs)("div",{className:"flex-grow",children:[(0,a.jsx)("p",{className:"flex-grow line-clamp-2 text-ellipsis",children:t.message}),i&&(0,a.jsx)("p",{className:"mt-1 text-red-500 text-xs font-bold",children:i})]}),e?(0,a.jsx)("p",{className:"text-gray-500 text-xs uppercase",children:"Cached"}):(0,a.jsxs)("p",{className:"text-gray-500 gap-4 text-xs flex items-center whitespace-nowrap",children:[!l&&t.numChildLogs>0&&(0,a.jsx)(S.Rh,{size:12,className:"text-gray-400"}),(0,a.jsx)(N.d,{startedAt:t.timestamp,finishedAt:t.completed,timeStyle:"narrow"})]})]})}let l=eu.wordWrap||eC.isExpanded(t),i=l?t.html:t.html.replace(/\n/g," ");return(0,a.jsx)(Q.F,{enableTextSelection:!0,className:l?"whitespace-pre-wrap":"whitespace-pre truncate",children:(0,a.jsx)(k.u7,{content:i})})}}]}),eO=e=>{var t;let r=null==l?void 0:l[e];return null!=r&&"copy"!==r.type&&((null==r?void 0:r.numChildLogs)>0&&(null==r?void 0:r.completed)==null||(null==r||null==(t=r.attributes)?void 0:t.error)!=null)},eT=(0,u.useMemo)(()=>n.filter(e=>{if(null==e.groupId||null==(null==l?void 0:l[e.groupId]))return!0;let t=eO(e.groupId);return eC.isGroupExpanded(e.groupId,t)}),[n,l,eC]),eA=(0,u.useCallback)((e,t)=>{eC.setLogExpanded(e,t)},[]),eM=(0,u.useMemo)(()=>({Header:()=>0===n.length||z&&!U?(0,a.jsx)("div",{className:"h-3"}):P?(0,a.jsx)(O.P,{className:(0,x.xW)(r,"pt-3 pb-1"),children:(0,a.jsx)(b.$n,{size:"xs",color:"gray",name:"Load More Logs",isLoading:U,onClick:F,children:"Load More"})}):(0,a.jsx)(T,{className:r,activeDateRange:G,side:"start"}),Footer:()=>A?(0,a.jsx)(O.P,{className:(0,x.xW)(r,"pb-3 pt-1"),children:(0,a.jsx)(y.l,{variant:"primary",hideIcon:!0,className:"mr-5 border border-pink-200 py-0 my-1",children:(0,a.jsxs)(E.z,{className:"w-full",align:"center",children:[(0,a.jsx)(w.In,{icon:p.R2D,className:"w-4 h-4 mr-2",size:"sm"}),(0,a.jsx)("div",{children:"Log stream has been paused"}),(0,a.jsx)(b.$n,{size:"xs",color:"pink",variant:"outline",name:"Resume Logs",className:"ml-auto my-1.5",onClick:M,children:"Resume Log Stream"})]})})}):ej>-1?(0,a.jsxs)(O.P,{className:(0,x.xW)(r,"pb-3 pt-1"),children:[!_&&(0,a.jsx)("div",{className:"mb-1 text-pink-600",children:"You reached the present time"}),(0,a.jsx)(E.z,{align:"center",space:2,children:(0,a.jsx)(b.$n,{size:"xs",color:"gray",name:"Load More Logs",isLoading:D,onClick:B,children:_?"Load More":"Try Loading More"})})]}):_?(0,a.jsx)(T,{className:r,activeDateRange:G,side:"end"}):(0,a.jsx)("div",{className:"h-3"})}),[U,D,0===n.length?"empty":"not-empty",ej,eE,A]),eR=eo?Number.MAX_SAFE_INTEGER:0,eI=(0,u.useCallback)(()=>{var e;null==(e=er.current)||e.scrollToIndex({index:n.length-1,behavior:"auto"})},[er.current]),eP=(0,u.useCallback)(()=>{var e;null==(e=er.current)||e.scrollTo({top:0,behavior:"auto"})},[er.current]);(0,u.useEffect)(()=>{setTimeout(()=>eI())},[C]);let e_=(0,u.useRef)(!1);return(0,u.useEffect)(()=>{e_.current||(-1!==ej||-1!==eS)&&(setTimeout(()=>{var e;null==(e=er.current)||e.scrollToIndex({index:ej>-1?eS-ew:ej-ew,align:"center",behavior:"smooth"})},500),e_.current=!0)},[ej,eS]),(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"grid grid-rows-[auto_auto_minmax(0,1fr)] h-full",children:[null!=H&&eu.histogram&&null!=L?(0,a.jsx)("div",{className:"w-full h-8 my-3 px-5 md:px-9 overflow-hidden",children:(0,a.jsx)($,{histogram:L,onRangeChange:H})}):(0,a.jsx)("span",{}),(0,a.jsxs)(O.P,{style:eL.rowStyles,wrapperClassName:"!py-0 !border-0",className:(0,x.xW)(r,"z-10 bg-secondaryBg shadow-sm dark:shadow-none"),children:[(0,a.jsx)(R,{allColumns:eL.allColumns,setColumnVisibility:eC.setColumnVisibility}),eL.columns.map(e=>{let{id:t,label:r,isResizing:n,canResize:l}=e;return(0,a.jsx)(Q.q,{columnId:t,hideResizeHandle:!l,isResizing:n,onDragStart:eC.onDragStart,onDragReset:eC.onDragReset,children:"severity"===t?"":"timestamp"===t?(0,a.jsxs)(a.Fragment,{children:["Date"," ",(0,a.jsxs)("span",{className:"text-gray-400",children:["(",i()().format("Z"),")"]})]}):r},t)})]}),(0,a.jsxs)(ei,{children:[W?(0,a.jsxs)(O.P,{className:(0,x.xW)(r,"text-red-600"),children:[(0,a.jsx)("br",{}),W]}):0!==n.length||z?(0,a.jsx)(s.P.div,{className:"w-full h-full",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1,ease:"easeInOut"},children:(0,a.jsx)(c.aY,{ref:er,data:eT,initialTopMostItemIndex:eR,firstItemIndex:ew,increaseViewportBy:1e3,customScrollParent:J,followOutput:!es&&"auto",atTopThreshold:50,atBottomThreshold:50,atTopStateChange:e=>{ed(e)},atBottomStateChange:e=>{em(e)},components:eM,computeItemKey:(e,t)=>(0,m.J)(C,t),itemContent:(e,t)=>"type"in t?(0,a.jsx)(en,{group:t,groupDefaultExpanded:eO,tableActions:eC,lineClassName:r,contextStart:ej,contextEnd:eS,index:e}):(0,a.jsxs)(O.P,{className:r,inContext:e>=ej&&e<=eS,severity:t.severity,children:[eC.renderRow(t),eC.isExpanded(t)&&(0,a.jsx)(Y.s,{log:t,linkedTags:K,logExplorerRoute:V})]})})}):(0,a.jsxs)(O.P,{className:(0,x.xW)(r,"text-gray-500"),children:[(0,a.jsx)("br",{}),q]}),(0,a.jsx)(Z,{isAtTop:ec,isAtBottom:ef,scrollToTop:eP,scrollToBottom:eI})]})]})})},en=e=>{let{group:t,groupDefaultExpanded:r,tableActions:n,lineClassName:l,contextStart:i,contextEnd:s,index:o}=e,u=r(t.id),c=n.isGroupExpanded(t.id,u),d=t.numChildLogs>0;return(0,a.jsx)(O.P,{as:d?"button":void 0,className:(0,x.xW)(l,"text-left"),inContext:o>=i&&o<=s,severity:t.severity,onClick:()=>n.setGroupExpanded(t.id,!c),children:n.renderGroupRow(t,c)})},ea=e=>{let{logs:t}=e;return(0,a.jsxs)(ei,{children:[(0,a.jsx)("br",{}),t.map(e=>(0,a.jsx)(O.P,{children:e.message},e.timestamp))]})},el={deploymentId:"Deploy",serviceId:"Service",snapshotId:"Snapshot",deploymentInstanceId:"Replica",projectId:"Project",environmentId:"Environment",pluginId:"Plugin"},ei=x.qy.div(et())},67366:(e,t,r)=>{r.d(t,{M:()=>x,u:()=>v});var n=r(50979),a=r(25963),l=r(31754),i=r(2551);function s(e){let{position:t,scrollToBottom:r,scrollToTop:a}=e;return(0,n.jsxs)("div",{className:"bottom-6 hidden sm:flex flex-col fixed right-12 lg:right-8 gap-1 z-10",children:[(0,n.jsx)(l.K0,{type:"button",title:"Jump to top",variant:"outline",icon:i.DoI,className:"bg-gray-100 hover:bg-gray-200 disabled:hover:bg-gray-100 disabled:active:scale-100",disabled:"top"===t||"both"===t,onClick:a}),(0,n.jsx)(l.K0,{type:"button",title:"Jump to bottom",variant:"outline",icon:i.yd$,className:"bg-gray-100 hover:bg-gray-200 disabled:hover:bg-gray-100 disabled:active:scale-100",disabled:"bottom"===t||"both"===t,onClick:r})]})}var o=r(24554),u=r(84044),c=r(58400);let d=(0,u.tG)("@railway/resizableTable/columnWidths",{},void 0,{getOnInit:!0}),f=(0,o.y$)();function m(e,t){var r;let n=e.getAttribute("data-column-key");if(n)return"".concat(t,":").concat(n);let a=null==(r=e.textContent)?void 0:r.trim();return"".concat(t,":").concat(a)}function h(e){let t=e.cloneNode(!0);if(t instanceof HTMLElement){t.style.position="absolute",t.style.visibility="hidden",t.style.width="auto",t.style.whiteSpace="nowrap",document.body.appendChild(t);let e=t.offsetWidth;return document.body.removeChild(t),e}return 0}var p=r(81758),g=r(36609);let x=(0,a.forwardRef)(function(e,t){var r,l,i,o,u;let{data:x,components:y,renderRow:b,renderHeader:w,renderTopBookend:j,renderBottomBookend:S,defaultItemHeight:E=28,initialPosition:N="bottom",positionThreshold:k={top:48,bottom:48},onScrollStateChange:L,showScrollControls:C=!0,showScrollbar:O=!0,resizableTableId:T="logs"}=e,[A,M]=(0,a.useState)(null),[R,I]=(0,a.useState)(null),[P,_]=(0,a.useState)(null),{gridTemplateColumns:U}=function(e){let{headerRef:t,bodyRef:r,tableId:n}=e,l=(0,a.useRef)(0),i=(0,a.useSyncExternalStore)((0,a.useCallback)(e=>{if(!t)return()=>{};let a={isResizing:!1,currentColumn:null,startX:0,startWidth:0},i=e=>{if(!(e.target instanceof HTMLElement))return;let t=e.target.closest("[data-column-resize-handle]");if(!t)return;let r=t.closest("[role='columnheader']");r instanceof HTMLElement&&(a.currentColumn=r,a.isResizing=!0,a.startX=e.clientX,a.startWidth=r.offsetWidth,document.body.style.cursor="col-resize",document.body.style.userSelect="none",e.preventDefault())},s=(0,c.hp)(e=>{if(!a.isResizing)return;let t=e.clientX-a.startX,r=Math.max(50,a.startWidth+t),l=a.currentColumn;if(!(l instanceof HTMLElement))return;let i=m(l,n);f.set(d,e=>({...e,[i]:r}))}),o=()=>{a.isResizing&&(a.isResizing=!1,a.currentColumn=null,document.body.style.cursor="",document.body.style.userSelect="")},u=e=>{if(!(e.target instanceof HTMLElement))return;let a=e.target.closest("[data-column-resize-handle]");if(!a)return;let l=a.closest("[role='columnheader']");if(!(l instanceof HTMLElement))return;let i=function(e,t,r){let n=0,a=e.querySelectorAll("[role='columnheader']");n=Math.max(n,h(r));let l=Array.from(a).indexOf(r);if(t){let e=t.querySelectorAll("[role='row']"),r=Math.min(e.length,50);for(let t=0;t<r;t++){let r=e[t].querySelectorAll("[role='cell']")[l];r instanceof HTMLElement&&(n=Math.max(n,h(r)))}}return Math.max(50,n)}(t,r,l),s=m(l,n);f.set(d,e=>({...e,[s]:i}))},p=new ResizeObserver((0,c.hp)(()=>{l.current++,e()}));p.observe(t);let g=new MutationObserver((0,c.hp)(()=>{l.current++,e()}));g.observe(t,{childList:!0,subtree:!1});let x=f.sub(d,()=>{l.current++,e()});return t.addEventListener("mousedown",i),t.addEventListener("dblclick",u),document.addEventListener("mousemove",s),document.addEventListener("mouseup",o),()=>{p.disconnect(),g.disconnect(),x(),t.removeEventListener("mousedown",i),t.removeEventListener("dblclick",u),document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",o)}},[t,r,n]),(0,a.useCallback)(()=>l.current,[])),s=(0,a.useMemo)(()=>t?Array.from(t.querySelectorAll("[role='columnheader']")).filter(e=>e instanceof HTMLElement):[],[t,i]);return{gridTemplateColumns:(0,a.useMemo)(()=>{var e;if(!t||0===s.length)return"minmax(0,auto)";let a=f.get(d),l=null==r?void 0:r.closest("[role=rowgroup]"),i=l?l.clientWidth:(null==(e=t.parentElement)?void 0:e.clientWidth)||0,o=0,u=0;s.forEach(e=>{let t=a[m(e,n)]||e.getAttribute("data-column-default-width");t?o+=parseInt(t+"",10):u++});let c=i-o,h=c>0&&u>0?Math.max(128,Math.floor(c/u)):128;return s.map(e=>{let t=a[m(e,n)];if(t)return"".concat(t,"px");let r=parseInt(e.getAttribute("data-column-default-width")||h+"",10);return"".concat(r,"px")}).join(" ")},[s,n,t,r])}}({headerRef:R,bodyRef:P,tableId:T}),D=+!!j+ +!!S,z=(0,p.Te)({count:x.length+D,getScrollElement:()=>A,estimateSize:()=>E,overscan:20}),W=function(e){var t,r;let{scrollElement:n,virtualizer:l,thresholds:i,initialPosition:s="bottom",onScrollStateChange:o}=e,u=(0,a.useRef)({position:s,mode:"idle"}),d=(0,a.useRef)(l),f=(0,a.useRef)({onScrollStateChange:o,thresholds:{top:null!=(t=null==i?void 0:i.top)?t:48,bottom:null!=(r=null==i?void 0:i.bottom)?r:48}});(0,a.useEffect)(()=>{var e,t;d.current=l,f.current={onScrollStateChange:o,thresholds:{top:null!=(e=null==i?void 0:i.top)?e:48,bottom:null!=(t=null==i?void 0:i.bottom)?t:48}}});let m=(0,a.useSyncExternalStore)((0,a.useCallback)(e=>{if(!n)return()=>{};let t=null,r=(0,c.hp)(()=>{if("programmatic"===u.current.mode)return;u.current.mode="user";let r=u.current.position,{scrollTop:a,scrollHeight:l,clientHeight:i}=n,s=function(e,t,r,n,a){let l=e<=n,i=t-e<=r+a;return l&&i?"both":l?"top":i?"bottom":"middle"}(a,l,i,f.current.thresholds.top,f.current.thresholds.bottom);if(u.current.position=s,r!==s){var o,d;e(),null==(o=(d=f.current).onScrollStateChange)||o.call(d,u.current)}t&&(0,c.Ee)(t),t=(0,c.Vq)(()=>{u.current.mode="idle"},1e3/30)}),a=()=>{let{position:e}=u.current;("bottom"===e||"both"===e)&&"user"!==u.current.mode&&(u.current.mode="programmatic",n.scrollTop=n.scrollHeight,requestAnimationFrame(()=>{requestAnimationFrame(()=>{u.current.mode="idle"})}))},l=new ResizeObserver(a),i=n.querySelector("[role='rowgroup']");i&&l.observe(i);let s=new MutationObserver(a);return i&&s.observe(i,{childList:!0,subtree:!1,attributes:!1}),n.addEventListener("scroll",r,{passive:!0}),()=>{n.removeEventListener("scroll",r),l.disconnect(),s.disconnect(),t&&(0,c.Ee)(t)}},[n]),(0,a.useCallback)(()=>u.current,[])),h=(0,a.useCallback)((0,c.hp)(e=>{var t,r;if(!n)return;let a={position:e,mode:"programmatic"};u.current=a,null==(t=(r=f.current).onScrollStateChange)||t.call(r,a),n.scrollTop="top"===e?0:n.scrollHeight,requestAnimationFrame(()=>{requestAnimationFrame(()=>{u.current.mode="idle"})})}),[n]);return(0,a.useMemo)(()=>({state:m,scrollToPosition:h}),[m,h])}({virtualizer:z,scrollElement:A,thresholds:{top:null!=(l=null==k?void 0:k.top)?l:E,bottom:null!=(i=null==k?void 0:k.bottom)?i:E},initialPosition:N,onScrollStateChange:L});(0,a.useImperativeHandle)(t,()=>({...W,scrollToIndex(e,t){z.scrollToIndex(e+ +!!j,{align:"center",...t})}}),[W,z,j]);let F=z.getVirtualItems(),B={display:"grid",gridTemplateColumns:U,contain:"layout"},q=null==j?void 0:j({}),J=null==S?void 0:S({}),V=null!=(o=null==y?void 0:y.Row)?o:v;return(0,n.jsxs)("div",{role:"table",className:"h-full absolute contain-strict inset-0 grid grid-rows-[max-content,minmax(0,1fr)] overflow-y-hidden overflow-x-auto  overscroll-contain",children:[w&&(0,n.jsx)("div",{role:"rowgroup",className:"w-full",children:(0,n.jsx)("div",{role:"row",ref:I,className:"grid w-full font-mono text-left text-[11px] font-medium text-neutral-secondary select-none",style:{gridTemplateColumns:U},children:w()})}),(0,n.jsx)("div",{className:(0,g.xW)("h-full overflow-x-hidden overflow-y-auto contain-strict overscroll-contain",!O&&"scrollbar-hide"),ref:M,children:(0,n.jsx)("div",{style:{height:z.getTotalSize(),width:"100%",position:"relative"},children:(0,n.jsxs)("div",{ref:_,className:"w-full",style:{position:"absolute",top:0,left:0,width:"100%",transform:"translateY(".concat(null!=(u=null==(r=F[0])?void 0:r.start)?u:0,"px)")},role:"rowgroup",children:[F.map(e=>{if(0===e.index&&q)return(0,n.jsx)("div",{role:"row",ref:z.measureElement,"data-index":e.index,className:"grid",style:B,children:q},e.key+"");if(e.index===x.length+1&&J)return(0,n.jsx)("div",{role:"row",ref:z.measureElement,"data-index":e.index,className:"grid",style:B,children:J},e.key+"");let t=+(null!==j),r=e.index-t,a=x[r];return(0,n.jsx)(V,{ref:z.measureElement,index:e.index,itemIndex:r,item:a,style:B,children:b(a,r)},e.key+"")}),(0,n.jsx)("div",{"aria-hidden":"true",style:{height:"100%"}})]})})}),C&&(0,n.jsx)(s,{position:W.state.position,scrollToTop:()=>{W.scrollToPosition("top")},scrollToBottom:()=>{W.scrollToPosition("bottom")}})]})}),v=(0,a.forwardRef)(function(e,t){let{index:r,itemIndex:a,className:l,...i}=e;return(0,n.jsx)("div",{role:"row",ref:t,"data-index":r,"data-item-index":a,className:(0,g.xW)("font-mono text-xs",l),...i})})},70643:(e,t,r)=>{r.d(t,{Do:()=>h,JO:()=>f,XR:()=>c});var n=r(25963),a=r(24554),l=r(81154),i=r(17851),s=r(22986),o=r.n(s),u=r(55297);let c="context",d=i.z.object({[c]:i.z.string().transform(e=>{let[t,r]=e.split("..");return{start:t,end:r}}).optional()});function f(e){let[t]=(0,n.useState)(()=>(0,a.y$)()),r=null!=e?e:t,i=(0,n.useId)(),s=(0,l.md)(p,{store:r}),[o,u]=(0,l.fp)(x,{store:r});return(0,n.useMemo)(()=>{let e=()=>{n(void 0),m({context:void 0})},t=e=>{var t,r;return t=e,!(!(r=o)||0>t.localeCompare(r.start))&&(r.end?0>=t.localeCompare(r.end):t===r.start)},n=(e,t)=>{let r=e?t?{start:e,end:t}:{start:e}:void 0;u(r),m({context:r})},a=(e,t)=>{let r=function(e,t){if(e||t)return t?e?0>e.localeCompare(t)?{start:e,end:t}:{start:t,end:e}:{start:t}:{start:e}}(e,t);n(null==r?void 0:r.start,null==r?void 0:r.end)};return{store:r,visualContext:o,context:s.context,isInContext:t,setVisualContext:n,setVisualContextRange:a,clearContext:e,getPropsForTimestamp:l=>({draggable:!0,onClick:r=>r.shiftKey&&(null==o?void 0:o.start)?a(o.start,l):t(l)?e():void a(l),onDragStart(e){let t=document.getElementById(i);null==t||t.remove();let a=e.currentTarget.cloneNode(!0);a.style.opacity="0",a.style.visibility="hidden",a.style.width="0px",a.style.height="0px",a.style.position="absolute",a.style.pointerEvents="none",a.style.overflow="hidden",a.style.top="-9999px",a.style.left="-9999px",a.id=i,document.body.appendChild(a),e.dataTransfer.setDragImage(a,0,0),r.set(v,l),n(l)},onDragEnd(){var e;null==(e=document.getElementById(i))||e.remove(),r.set(v,void 0)},onDragEnter:()=>a(r.get(v),l)})}},[o,r])}function m(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];(0,u.Az)(e,{replace:t,customSerializer:(e,t)=>e===c&&"object"==typeof t?t.end?"".concat(t.start,"..").concat(t.end):t.start+"":null,deleteKeys:void 0===e[c]?[c]:[]})}function h(e){let{logs:t,scrollToIndex:r,viewInContext:a}=e,{context:l}=a,i=(0,n.useRef)(!1),s=(0,n.useRef)(),o=(0,n.useRef)(r),u=(0,n.useRef)(0),c=(0,n.useRef)();(0,n.useLayoutEffect)(()=>{(null==l?void 0:l.start)!==s.current&&(i.current=!1,s.current=null==l?void 0:l.start,u.current=0)},[null==l?void 0:l.start]),(0,n.useLayoutEffect)(()=>{if(t.data.length&&!i.current&&l&&!t.isLoading&&!t.isFetching){if(u.current!==t.data.length)return u.current=t.data.length,c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{e()},300),()=>{c.current&&clearTimeout(c.current)};e()}function e(){let e=l.start,r=t.data.findIndex(t=>t.timestamp===e),n=t.data.findIndex(e=>l.end&&e.timestamp===l.end),a=r;-1!==n&&n>r&&(a=Math.floor((r+n)/2)),-1!==a&&(i.current=!0,o.current(a))}},[l,t.data.length,t.isLoading,t.isFetching])}let p=(0,a.eU)(y((0,u.bp)())),g=(0,a.eU)(void 0),x=(0,a.eU)(e=>{var t;return null!=(t=e(g))?t:e(p).context},(e,t,r)=>{t(g,r)}),v=(0,a.eU)(void 0);function y(e){let t=e.searchParams.get(c),r=d.safeParse({context:t||void 0});return r.success?r.data:{}}p.onMount=e=>{let t=()=>{e(y((0,u.bp)()))},r=t=>{e(y(new URL(t,window.location.origin)))};return o().events.on("routeChangeComplete",r),window.addEventListener("popstate",t),()=>{window.removeEventListener("popstate",t),o().events.off("routeChangeComplete",r)}}},71121:(e,t,r)=>{r.d(t,{EH:()=>s,py:()=>o});var n=r(25963),a=r(30595),l=r(23466);let i={wordWrap:!0,histogram:!0},s=()=>{let[e,t]=(0,a.A)("@railway/logs/preferences",{defaultValue:i});return[(0,n.useMemo)(()=>({...i,...e}),[e]),t]},o=()=>{let[e,t]=s(),r=(0,l.FW)();return(0,n.useMemo)(()=>[{value:"logs-word-wrap",text:e.wordWrap?"Disable word wrap":"Enable word wrap",action:()=>{t(e=>({...e,wordWrap:!e.wordWrap})),r.setWrapText(e=>!e)}},{value:"logs-histogram",text:e.histogram?"Disable histogram":"Enable histogram",action:()=>{t(e=>({...e,histogram:!e.histogram})),r.setShowHistogram(e=>!e)}}],[e])}},73751:(e,t,r)=>{r.d(t,{r3:()=>c,zX:()=>f});var n=r(50979),a=r(36609),l=r(21500),i=r(76999),s=r(97989),o=r(43067);let u={service:"serviceId",deploy:"deploymentId",replica:"deploymentInstanceId"},c={serviceId:"service",deploymentId:"deployment",deploymentInstanceId:"replica",environmentId:"environment",pluginId:"plugin",projectId:"project",snapshotId:"snapshot"},d={service:"service",deploy:"deployment",replica:"replica"};function f(e){var t,r,c;let{tags:f,name:m,className:h,...p}=e,g=(0,l.R7)(),x=(0,o.t)(),v=u[m],y=null==f?void 0:f[v],{displayValue:b,hasValue:w}=(t=m,r=y,c=x,null==r?{displayValue:"",hasValue:!1}:"service"===t&&"string"==typeof r&&(null==c?void 0:c[r])?{displayValue:c[r].name,hasValue:!0}:{displayValue:String(r).slice(0,8),hasValue:!0});return(0,n.jsx)(s.n,{className:(0,a.xW)("text-neutral-secondary",h),...p,children:w?(0,n.jsx)("button",{className:(0,a.xW)("text-left",g.enabled&&"hover:underline"),onClick:()=>{g.enabled&&w&&null!=y&&g.addExpression(new i.nW(d[m],String(y)))},children:b}):(0,n.jsx)(n.Fragment,{children:"—"})})}},76999:(e,t,r)=>{r.d(t,{GP:()=>o,KD:()=>u,NJ:()=>l,h4:()=>i,lq:()=>f,nW:()=>s});var n=r(61455);class a{toString(){return void 0===this._stringCache&&(this._stringCache=n.expression.toString(this.node)),this._stringCache}toJSON(){return this._jsonCache||(this._jsonCache=this.createJSON()),this._jsonCache}getLeafExpressions(){return this instanceof u||this instanceof c?this.expressions.flatMap(e=>e.getLeafExpressions()):this instanceof d?this.inner.getLeafExpressions():[this]}getAllExpressions(){let e=[this];return this instanceof u||this instanceof c?e.push(...this.expressions.flatMap(e=>e.getAllExpressions())):this instanceof d&&e.push(...this.inner.getAllExpressions()),e}getChildExpressions(){return this instanceof u||this instanceof c?this.expressions:this instanceof d?[this.inner]:[]}transform(e){let t=this;if(this instanceof u||this instanceof c){let r=this.expressions.map(t=>t.transform(e)).filter(e=>null!==e);if(0===r.length)return null;if(1===r.length)return r[0];t=this instanceof u?new u(r):new c(r)}else if(this instanceof d){let r=this.inner.transform(e);if(!r)return null;t=r instanceof u||r instanceof c?new d(r):r}return e(t)}simplify(){return this}remove(e){let t=n.expression.removeNodes(this.node,t=>{let r=m(t);return!!r&&e(r)});return t?m(t):null}removeAt(e){if(this instanceof u||this instanceof c){if(e<0||e>=this.expressions.length)return this;let t=this.expressions.filter((t,r)=>r!==e);return 0===t.length?null:1===t.length?t[0]:this instanceof u?new u(t):new c(t)}return 0===e?null:this}}class l extends a{clone(){return new l(this.term,this.negate)}createJSON(){return{type:"SearchTerm",term:this.term,negate:this.negate}}constructor(e,t=!1){super(),this.term=e,this.negate=t,this.node=n.expression.searchTerm(e,t)}}class i extends a{clone(){return new i(this.message,this.negate)}createJSON(){return{type:"ExactMatch",message:this.message,negate:this.negate}}constructor(e,t=!1){super(),this.message=e,this.negate=t,this.node=n.expression.exactMatch(e,t)}}class s extends a{clone(){return new s(this.key,this.value,this.negate)}createJSON(){return{type:"Attribute",key:this.key,value:this.value,negate:this.negate}}constructor(e,t,r=!1){super(),this.key=e,this.value=t,this.negate=r,this.node=n.expression.attribute(e,t,r)}}class o extends a{clone(){return new o(this.key,this.index,this.value,this.negate)}createJSON(){return{type:"ArrayAttribute",key:this.key,index:this.index,value:this.value,negate:this.negate}}constructor(e,t,r,a=!1){super(),this.key=e,this.index=t,this.value=r,this.negate=a,this.node=n.expression.attribute("".concat(e,"[").concat(t,"]"),r,a)}}class u extends a{clone(){return new u(this.expressions.map(e=>e.clone()))}simplify(){return this}createJSON(){return{type:"And",expressions:this.expressions.map(e=>e.toJSON())}}constructor(e){super(),this.expressions=e,this.node=n.expression.and(...e.map(e=>e.node))}}class c extends a{clone(){return new c(this.expressions.map(e=>e.clone()))}simplify(){return this}createJSON(){return{type:"Or",expressions:this.expressions.map(e=>e.toJSON())}}constructor(e){super(),this.expressions=e,this.node=n.expression.or(...e.map(e=>e.node))}}class d extends a{clone(){return new d(this.inner.clone())}simplify(){return this}createJSON(){return{type:"Group",inner:this.inner.toJSON()}}constructor(e){super(),this.inner=e,this.node={type:"grouped",child:e.node}}}class f{static create(){return new f}static parse(e){if(!e||""===e.trim())throw Error("Empty expression");let t=0;for(let r of e)"("===r&&t++,")"===r&&t--;if(t>0)throw Error("Missing closing parenthesis");if(t<0)throw Error("Extra closing parenthesis");if(e.includes("()"))throw Error("Empty group");let r=n.expression.parse(e);if(!r)throw Error("Failed to parse expression");let a=m(r);if(!a)throw Error("Invalid expression");return a}static fromExpression(e){return new f().setExpression(e)}static fromString(e){let t=f.parse(e);return f.fromExpression(t)}setExpression(e){return this.expr=e,this}static and(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return new u(t.map(e=>"function"==typeof e?e(f.create()).build():e))}static or(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return new c(t.map(e=>"function"==typeof e?e(f.create()).build():e))}search(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.expr=new l(e,t),this}exact(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.expr=new i(e,t),this}attr(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.expr=new s(e,t,r),this}arrayAttr(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return this.expr=new o(e,t,r,n),this}and(e){if(!this.expr)throw Error("Cannot add AND without left expression");let t="function"==typeof e?e(f.create()).build():e;return this.expr instanceof u?(this.expr.expressions.push(t),this.expr.node=n.expression.and(...this.expr.expressions.map(e=>e.node))):this.expr=new u([this.expr,t]),this}or(e){if(!this.expr)throw Error("Cannot add OR without left expression");let t="function"==typeof e?e(f.create()).build():e;return this.expr instanceof c?(this.expr.expressions.push(t),this.expr.node=n.expression.or(...this.expr.expressions.map(e=>e.node))):this.expr=new c([this.expr,t]),this}group(e){let t="function"==typeof e?e(f.create()).build():e;return this.expr=new d(t),this}transform(e){if(!this.expr)return this;let t=this.expr.transform(e);return this.expr=t,this}simplify(){return this}clone(){let e=new f;return this.expr&&(e.expr=this.expr.clone()),e}build(){if(!this.expr)throw Error("Cannot build empty expression");return this.expr}toString(){return this.expr?this.expr.toString():""}toJSON(){return this.expr?this.expr.toJSON():{type:"Empty"}}getLeafExpressions(){return this.expr?this.expr.getLeafExpressions():[]}getAllExpressions(){return this.expr?this.expr.getAllExpressions():[]}getChildExpressions(){return this.expr?this.expr.getChildExpressions():[]}constructor(){this.expr=null}}function m(e){if(!e)return null;switch(e.type){case"searchTerm":return new l(e.value);case"exactMatch":return new i(e.value);case"attribute":case"fieldValue":let t=e.field,r=e.value,a=t.match(/^([^[]+)\[(-?\d+)\]$/);if(a){let[,e,t]=a;return new o(e,parseInt(t,10),r)}let f=r;return"string"===e.valueType&&(f='"'.concat(r.replace(/"/g,'\\"'),'"')),new s(t,f);case"not":let h=m(e.child);return h instanceof l?(h.negate=!0,h.node=n.expression.searchTerm(h.term,!0)):h instanceof i?(h.negate=!0,h.node=n.expression.exactMatch(h.message,!0)):h instanceof s?(h.negate=!0,h.node=n.expression.attribute(h.key,h.value,!0)):h instanceof o&&(h.negate=!0,h.node=n.expression.attribute("".concat(h.key,"[").concat(h.index,"]"),h.value,!0)),h;case"and":let p=e.children.map(e=>m(e)).filter(e=>null!==e);if(0===p.length)return null;if(1===p.length)return p[0];return new u(p);case"or":let g=e.children.map(e=>m(e)).filter(e=>null!==e);if(0===g.length)return null;if(1===g.length)return g[0];return new c(g);case"grouped":let x=m(e.child);return x?new d(x):null;default:return new l(JSON.stringify(e))}}},77146:(e,t,r)=>{r.d(t,{w:()=>d});var n=r(50979),a=r(2551),l=r(31754),i=r(97989),s=r(75749),o=r(13077),u=r(36725);function c(e){var t;let{timeRange:r,position:l}=e,i=null!=(t=null==r?void 0:r["top"===l?"startTime":"endTime"])?t:null;return null==i?null:(0,n.jsx)(s.c,{as:"div",className:"relative border-neutral text-neutral-secondary",children:(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-start",children:(0,n.jsxs)("div",{className:"flex items-center border border-gray-200 ml-8 bg-background rounded px-3 py-0.5 text-xs",children:["You reached the ","top"===l?"start":"end"," of the range",r&&(0,n.jsxs)(n.Fragment,{children:[" ",(0,n.jsx)(o.In,{icon:a.Qpb,className:"mx-2",style:{width:"0.75rem",height:"0.75rem"}})," ",(0,n.jsx)(u.g,{children:i})]})]})})})}function d(e){let{position:t="top",pagination:r,timeRange:s,...o}=e,u="top"===t?r.state.hasMore.before:r.state.hasMore.after;return(0,n.jsx)(i.n,{className:"col-span-full",...o,children:u?(0,n.jsx)("div",{className:"px-2 pt-2 pb-1",children:(0,n.jsx)(l.By,{size:"xs",color:"gray",variant:"outline",className:"bg-neutral-surface px-3",icon:"top"===t?a.DoI:a.yd$,onClick:async()=>{if("top"===t)return r.loadMoreBefore();await r.loadMoreAfter()},children:"Load more"})}):(0,n.jsx)(c,{timeRange:s,position:t})})}},81428:(e,t,r)=>{r.d(t,{m:()=>n});function n(e){var t,r,n;let{timeRange:a,viewInContext:l}=e,i=a.startTime?new Date(a.startTime).toISOString():new Date(0).toISOString(),s=a.endTime?new Date(a.endTime).toISOString():void 0,o=a.endTime?new Date(a.endTime).toISOString():void 0,u=i?1e3:void 0,c=s?1e3:void 0;return(null==l||null==(t=l.context)?void 0:t.start)&&(i=void 0,s=void 0,o=null!=(n=null==(r=l.context)?void 0:r.end)?n:l.context.start,u=1e3,c=1e3),{beforeDate:i,anchorDate:o,afterDate:s,beforeLimit:u||0,afterLimit:c}}},84564:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{tokenizeForHighlighting:function(){return l},isInsideQuotes:function(){return i},getTokenAtPosition:function(){return s}});var n=r(61453);function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function l(e){var t=n.RailwayLogLexer.tokenize(e),r=[],l=e.length;t.errors.length>0&&(l=t.errors[0].offset);for(var i=[],s=0;s<t.tokens.length&&"break"!==function(n){var s,o=t.tokens[n],u=null!=(s=o.startOffset)?s:0;if(u>=l)return"break";if(i.some(function(e){var t=function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r,n,a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var l=[],i=!0,s=!1;try{for(a=a.call(e);!(i=(r=a.next()).done)&&(l.push(r.value),l.length!==t);i=!0);}catch(e){s=!0,n=e}finally{try{i||null==a.return||a.return()}finally{if(s)throw n}}return l}}(e,2)||function(e,t){if(e){if("string"==typeof e)return a(e,2);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return a(e,t)}}(e,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),r=t[0],n=t[1];return u>=r&&u<n}))return"continue";if("UnquotedToken"===o.tokenType.name||"NumberLiteral"===o.tokenType.name){var c=t.tokens[n+1],d=n>0?t.tokens[n-1]:null;if(c&&"Colon"===c.tokenType.name&&(!d||"At"!==d.tokenType.name)){var f=function(e,t){for(var r=t;r<e.length&&/[a-zA-Z0-9_.-]/.test(e[r]);)r++;for(;r<e.length&&("["===e[r]||"."===e[r]);)if("["===e[r]){if('"'===e[++r]){for(r++;r<e.length&&'"'!==e[r];)"\\"===e[r]&&r++,r++;r<e.length&&'"'===e[r]&&r++}else for("-"===e[r]&&r++;r<e.length&&/[0-9]/.test(e[r]);)r++;r<e.length&&"]"===e[r]&&r++}else if("."===e[r])for(r++;r<e.length&&/[a-zA-Z0-9_-]/.test(e[r]);)r++;if(r>=e.length||":"!==e[r])return t;if(++r<e.length&&'"'===e[r]){r++;for(var n=!1;r<e.length;){if(!n&&'"'===e[r]){r++;break}n=!n&&"\\"===e[r],r++}}else for(;r<e.length&&" "!==e[r]&&"	"!==e[r]&&"\n"!==e[r]&&"("!==e[r]&&")"!==e[r];)r++;return r}(e,u);if(f>u){i.push([u,f]);var m=u>0&&"-"===e[u-1];return r.push({type:"attribute",value:m?e.slice(u-1,f):e.slice(u,f),start:m?u-1:u,end:f}),"continue"}}}var h=function(e,t,r){var n,a,l=e.tokenType.name,i=null!=(n=e.startOffset)?n:0,s=(null!=(a=e.endOffset)?a:0)+1;if("StringLiteral"===l){var o=i>0&&"-"===t[i-1];return{type:"exact_match",value:o?"-".concat(e.image):e.image,start:o?i-1:i,end:s}}if("And"===l||"Or"===l)return{type:"operator",value:e.image.toUpperCase(),start:i,end:s};if("LeftParen"===l||"RightParen"===l)return{type:"operator",value:e.image,start:i,end:s};if("At"===l){var u=function(e,t){for(var r=t+1,n=!1;r<e.length&&/[a-zA-Z0-9_.-]/.test(e[r]);)r++;for(;r<e.length&&("["===e[r]||"."===e[r]);)if("["===e[r]){if('"'===e[++r]){for(r++;r<e.length&&'"'!==e[r];)"\\"===e[r]&&r++,r++;r<e.length&&'"'===e[r]&&r++}else for("-"===e[r]&&r++;r<e.length&&/[0-9]/.test(e[r]);)r++;r<e.length&&"]"===e[r]&&r++}else if("."===e[r])for(r++;r<e.length&&/[a-zA-Z0-9_-]/.test(e[r]);)r++;if(r>=e.length||":"!==e[r])return{end:t+1,hasUnclosedQuote:!1};if(++r<e.length&&'"'===e[r]){r++;for(var a=!1,l=!1;r<e.length;){if(!a&&'"'===e[r]){r++,l=!0;break}a=!a&&"\\"===e[r],r++}n=!l}else for(;r<e.length&&" "!==e[r]&&"	"!==e[r]&&"\n"!==e[r]&&"("!==e[r]&&")"!==e[r];)r++;return{end:r,hasUnclosedQuote:n}}(t,i),c=u.end,d=u.hasUnclosedQuote;if(c>i+1){r.push([i,c]);var f=i>0&&"-"===t[i-1];return{type:d?"incomplete":"attribute",value:f?t.slice(i-1,c):t.slice(i,c),start:f?i-1:i,end:c}}}if("Colon"===l||"LeftBracket"===l||"RightBracket"===l||"NumberLiteral"===l||"Minus"===l)return null;if("UnquotedToken"===l){if(i>0&&(":"===t[i-1]||"@"===t[i-1]))return null;var m=i>0&&"-"===t[i-1];return{type:"search_term",value:m?"-".concat(e.image):e.image,start:m?i-1:i,end:s}}return{type:"search_term",value:e.image,start:i,end:s}}(o,e,i);h&&r.push(h)}(s);s++);if(l<e.length){var o=0,u=!0,c=!1,d=void 0;try{for(var f,m=r[Symbol.iterator]();!(u=(f=m.next()).done);u=!0){var h=f.value;h.end>o&&(o=h.end)}}catch(e){c=!0,d=e}finally{try{u||null==m.return||m.return()}finally{if(c)throw d}}if(o<e.length){var p=r[r.length-1];p&&p.end>l?p.type="incomplete":r.push({type:"incomplete",value:e.slice(l),start:l,end:e.length})}}return r}function i(e,t){for(var r=!1,n=!1,a=0;a<t&&a<e.length;a++)n||'"'!==e[a]||(r=!r),n=!n&&"\\"===e[a];return r}function s(e,t){return l(e).find(function(e){return e.start<=t&&t<e.end})||null}},90511:(e,t,r)=>{r.d(t,{x:()=>c});var n=r(50979),a=r(36609),l=r(36725),i=r(21500),s=r(13611),o=r(76999),u=r(97989);function c(e){let{children:t,showSeverity:r,className:s,severity:c="info",...f}=e,m=(0,i.R7)();return(0,n.jsx)(u.n,{className:(0,a.xW)("text-neutral-secondary h-full",s),severity:c,...f,children:(0,n.jsxs)("div",{className:"flex items-start h-full relative",children:[r&&(0,n.jsx)(d,{severity:c,onFilter:()=>m.addExpression(new o.nW("level",'"'.concat(c,'"'))),filtersEnabled:m.enabled}),(0,n.jsx)("button",{children:(0,n.jsx)(l.g,{dateStyle:"medium",timeStyle:"medium",hourCycle:"h23",stripCommas:!0,className:(0,a.xW)("whitespace-nowrap text-ellipsis relative tabular-nums","pl-3"),children:t})})]})})}function d(e){var t;let{severity:r,onFilter:l,filtersEnabled:i}=e,o=null!=(t=s.YR[null!=r?r:""])?t:s.YR.debug;return(0,n.jsx)("button",{className:(0,a.xW)("pl-3 group flex h-full items-stretch relative",i?"cursor-pointer":"cursor-default"),onClick:e=>{e.stopPropagation(),i&&l()},children:(0,n.jsx)("div",{className:(0,a.xW)("w-[3px] h-full rounded-full",o)})})}},97989:(e,t,r)=>{r.d(t,{n:()=>l});var n=r(50979),a=r(36609);function l(e){let{className:t,isNew:r,wrapText:l,severity:i,children:s,style:o,...u}=e;return(0,n.jsx)("div",{role:"cell",className:(0,a.xW)("pr-2 py-1 text-neutral align-text-top [&:first-of-type]:pl-0 pl-2 tabular-nums overflow-clip",r&&"animate-flash",l?"break-all whitespace-normal":"whitespace-nowrap","error"===i&&"bg-red-50","warn"===i&&"bg-yellow-50",t),style:{...o,"--flash-bg-color-start":"error"===i?"var(--red-100)":"warn"===i?"var(--yellow-100)":void 0,"--flash-bg-color-end":"error"===i?"var(--red-50)":"warn"===i?"var(--yellow-50)":void 0},...u,children:s})}},98830:(e,t,r)=>{r.d(t,{G:()=>g});var n=r(3142),a=r(62843),l=r(24554),i=r(81154),s=r(90242),o=r(66800),u=r.n(o),c=r(25963),d=r(2631),f=r(55850),m=r(90454);class h{add(e){if(0===e.length)return;let t=0===this.size;for(let r of(this.latestBatch.clear(),e)){let e=r.timestamp;if(!this.keys.has(e))if(t||this.latestBatch.add(r.timestamp),this.size===this.capacity){let t=this.buffer[this.head];t&&this.keys.delete(t.timestamp),this.buffer[this.head]=r,this.keys.add(e),this.head=(this.head+1)%this.capacity}else{let t=(this.head+this.size)%this.capacity;this.buffer[t]=r,this.keys.add(e),this.size++}}}getSorted(){let e=Array(this.size);for(let t=0;t<this.size;t++)e[t]=this.buffer[(this.head+t)%this.capacity];return e.sort(p)}getLatestBatch(){return this.latestBatch}clear(){this.buffer.fill(null),this.head=0,this.size=0,this.keys.clear(),this.latestBatch.clear()}constructor(e=25e3){this.capacity=e,this.head=0,this.size=0,this.keys=new Set,this.latestBatch=new Set,this.buffer=Array(e).fill(null)}}function p(e,t){return e.timestamp.localeCompare(t.timestamp)}function g(e){let{streamLogs:t,queryLogs:r,bufferSize:o=25e3,defaultPaginationLimit:u=1e3}=e,f={status:{before:"idle",after:"idle"},hasMore:{before:!1,after:!1},boundaries:{oldest:null,newest:null}},p=(0,l.eU)({status:"idle",error:null}),g=(0,l.eU)(0),y=(0,l.eU)(()=>new h(o)),b=(0,l.eU)(0),w=(0,l.eU)(e=>(e(g),e(y).getSorted())),j=(0,l.eU)(e=>e(y).getLatestBatch()),S=(0,l.eU)({}),E=(0,l.eU)({enabled:!0,maxConnectionRetries:5}),N=(0,l.eU)(0),k=(0,l.eU)({enabled:!0}),L=(0,l.eU)({status:"idle",error:null}),C=(0,l.eU)(f),O=(0,l.eU)(null),T=(0,l.eU)(null,(e,t,r)=>{let{variables:a,client:l}=r;if(a){let r=e(S);(0,n.bD)(a,r)||(t(S,a),t(b,e=>e+1),t(C,f))}if(l){let r=e(E);(0,n.bD)(l,r)||t(E,l)}}),A=(0,l.eU)(null,(e,t,r)=>{let{variables:a,client:l}=r;if(a){let r=e(S);(0,n.bD)(a,r)||(t(S,a),t(b,e=>e+1),t(C,f))}if(l){let r=e(k);(0,n.bD)(l,r)||t(k,l)}}),M=(0,s.$)((e,r)=>{let n=e(S),l=e(E);e(N);let i=e(y),{enabled:s=!0,maxConnectionRetries:o=5}=l||{};if(!s)return void r(p,{status:"disconnected",error:null});let c=null,d=Symbol("connection"),m=null,h=!1,x=new v({maxRetries:o,onRetry:()=>{null==c||c(),w()}}),w=()=>{var l;r(p,{status:"connecting",error:null,connectionId:d});let s=null!=(l=n.beforeLimit)?l:u;c=t(e,r,{...n,beforeLimit:s},{complete(){r(p,e=>e.connectionId===d?{status:"disconnected",error:null,connectionId:d}:e)},next(t){if(e(p).connectionId!==d)return;let n=e(b);m===n&&h||(i.clear(),h=!0,m=n,r(C,{...f,hasMore:{before:t.length>=s,after:!1}})),i.add(t),r(g,e=>e+1),r(p,{status:"connected",error:null,connectionId:d}),x.reset()},error(t){if(e(p).connectionId!==d||!(t instanceof CloseEvent)&&!(t instanceof a.sl))return;let n=t.reason;(null==n?void 0:n.includes("deadline_exceeded"))?r(p,{status:"timedOut",error:Error("Stream timed out. Click resume to continue."),connectionId:d}):(null==n?void 0:n.includes("invalid_argument"))?r(p,{status:"error",error:Error("message"in t?t.message:n),connectionId:d}):x.shouldRetry()?(r(p,{status:"error",error:Error("message"in t?t.message:n),connectionId:d}),x.scheduleRetry()):r(p,{status:"error",error:Error("Failed after ".concat(x.getRetryCount()," retries: ").concat(n)),connectionId:d})}})};return w(),()=>{x.cleanup(),null==c||c()}}),R=(0,s.$)((e,t)=>{var n;let a=e(S),l=e(k),i=e(m.a),s=e(y);if(!i)return void t(L,{status:"error",error:Error("No client")});if(!l.enabled)return void t(L,{status:"idle",error:null});let o=Symbol("query");t(L,{status:"loading",error:null,queryId:o}),r(e,t,{...a,beforeLimit:null!=(n=a.beforeLimit)?n:u}).then(r=>{var n,l;if(e(L).queryId!==o)return;s.clear(),s.add(r),t(g,e=>e+1);let i=r.length,c=null!=(n=a.beforeLimit)?n:u,d=null!=(l=a.afterLimit)?l:0;t(C,{...f,hasMore:{before:c>0&&i>=c,after:d>0&&i>=d}}),t(L,{status:"success",error:null,queryId:o})}).catch(r=>{e(L).queryId===o&&t(L,{status:"error",error:r,queryId:o})})});function I(e){return(0,l.eU)(null,async(t,n)=>{let a=t(S);if(!t(m.a))throw Error("No client available for pagination");let l=t(y),i=t(C),s=t(w);if(!i.hasMore[e]||"loading"===i.status[e])return;let o=Symbol("pagination");n(O,o),n(C,t=>({...t,status:{...t.status,[e]:"loading"}}));try{var c,d,f,h,p,x;let i="before"===e?s[0]:s[s.length-1],m="before"===e?{anchorDate:null!=(c=null==i?void 0:i.timestamp)?c:new Date().toISOString(),afterLimit:0,beforeLimit:u,beforeDate:null!=(d=a.beforeDate)?d:new Date(0).toISOString()}:{anchorDate:null!=(f=null==i?void 0:i.timestamp)?f:new Date().toISOString(),beforeLimit:0,afterLimit:u,afterDate:null!=(h=a.afterDate)?h:new Date().toISOString()},{afterLimit:v,beforeDate:y,afterDate:b,anchorDate:w,...j}=a,S=await r(t,n,{...j,...m});if(t(O)!==o)return;l.add(S),n(g,e=>e+1);let E="before"===e?null!=(p=a.beforeLimit)?p:u:null!=(x=a.afterLimit)?x:u;n(C,t=>{var r,n,a,l;return{...t,status:{...t.status,[e]:"success"},hasMore:{...t.hasMore,[e]:S.length>=E},boundaries:"before"===e?{...t.boundaries,oldest:null!=(a=null==(r=S[0])?void 0:r.timestamp)?a:t.boundaries.oldest}:{...t.boundaries,newest:null!=(l=null==(n=S.at(-1))?void 0:n.timestamp)?l:t.boundaries.newest}}})}catch(r){t(O)===o&&n(C,t=>({...t,status:{...t.status,[e]:"error"}}))}})}let P=I("before"),_=I("after");function U(e){let{store:t,variables:r,client:n={}}=e,[a]=(0,c.useState)(()=>(0,l.y$)()),s=t||a;x(s);let o=(0,i.Xr)(T,{store:s}),u=(0,i.md)(w,{store:s}),d=(0,i.md)(p,{store:s}),f=(0,i.Xr)(N,{store:s});(0,c.useEffect)(()=>{o({variables:r,client:n})}),(0,i.md)(M,{store:s});let m="connecting"===d.status||"idle"===d.status;return{store:s,data:u,status:d.status,isLoading:!u.length&&m,isFetching:m,error:d.error,reconnectStream(){("timedOut"===d.status||"error"===d.status)&&f(e=>e+1)}}}function D(e){let{store:t,client:r,variables:n}=e,[a]=(0,c.useState)(()=>(0,l.y$)()),s=t||a;x(s);let o=(0,i.Xr)(A,{store:s}),u=(0,i.md)(w,{store:s}),d=(0,i.md)(L,{store:s});(0,c.useEffect)(()=>{o({variables:n,client:r})}),(0,i.md)(R,{store:s});let f="loading"===d.status||"idle"===d.status;return{store:s,data:u,status:d.status,isLoading:!u.length&&f,isFetching:f,error:d.error}}return{useLogsStream:U,useLogsQuery:D,useLogs:function(e){let{variables:t,mode:r="stream",streamPaused:a=!1,onStreamPausedChange:i,store:s}=e,[o]=(0,c.useState)(()=>(0,l.y$)());s=s||o;let[u,f]=(0,c.useState)(t),[m,h]=(0,c.useState)(!1),p=!(0,n.bD)(t,u);(0,c.useEffect)(()=>{p&&("stream"===r&&a&&(h(!0),null==i||i(!1)),f(t))},[r,p,a]),m&&!a&&h(!1);let g="stream"===r&&!a,x=(0,d.o)(g,200),v=U({store:s,variables:t,client:{enabled:!!m||x}}),y=D({store:s,variables:t,client:{enabled:"query"===r}});(0,c.useEffect)(()=>{"timedOut"===v.status&&g&&(null==i||i(!0))},[v.status,g]);let b="stream"===r;return{store:s,data:b?v.data:y.data,status:b?v.status:y.status,isLoading:b?v.isLoading:y.isLoading,isFetching:b?v.isFetching:y.isFetching,error:b?v.error:y.error,reconnectStream(){b&&v.reconnectStream()}}},useLogsPagination:function(e){let{store:t}=e;return{state:(0,i.md)(C,{store:t}),loadMoreBefore:(0,i.Xr)(P,{store:t}),loadMoreAfter:(0,i.Xr)(_,{store:t})}},atoms:{logStreamStateAtom:p,logUpdateCountAtom:g,logBufferAtom:y,bufferVersionAtom:b,sortedLogsAtom:w,newLogsAtom:j,logVariablesAtom:S,logStreamClientConfigAtom:E,logStreamReconnectAtom:N,logQueryClientConfigAtom:k,logQueryStateAtom:L,paginationStateAtom:C,updateStreamConfigsAtom:T,updateQueryConfigsAtom:A,logStreamEffectAtom:M,logQueryEffectAtom:R,loadMoreBeforeAtom:P,loadMoreAfterAtom:_}}}function x(e){let{graphqlClient:t}=(0,f.q)(),[r,n]=(0,i.fp)(m.a,{store:e});r||n(t)}class v{shouldRetry(){return this.retryCount<this.config.maxRetries}scheduleRetry(){let e=(this.config.getDelay||(e=>Math.min(u()("5s")*Math.pow(2,e),u()("30s"))))(this.retryCount);this.retryCount++,this.retryTimeout=setTimeout(()=>{this.config.onRetry()},e)}reset(){this.retryCount=0,this.cleanup()}cleanup(){this.retryTimeout&&(clearTimeout(this.retryTimeout),this.retryTimeout=null)}getRetryCount(){return this.retryCount}constructor(e){this.config=e,this.retryCount=0,this.retryTimeout=null}}}}]);