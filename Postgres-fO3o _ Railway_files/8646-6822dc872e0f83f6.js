(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8646],{868:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{parse:function(){return s},nodeToString:function(){return o},nodesToString:function(){return c}});var r=n(14872);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i=/\s*/,a=function(){var e;function t(){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");l(this,"tokens",[]),l(this,"curr",0),l(this,"currText",""),l(this,"nodes",[])}return e=[{key:"parse",value:function(e){var t=this;return!e.includes("${{")||e.length>1e4?[{type:"text",value:e}]:(this.tokens=e.split(""),this.parserLoop(function(){if(t.match("${{")){var e=t.curr;try{t.parseCurly(),t.currText=""}catch(n){t.currText+="${{",t.curr=e}}else t.currText+=t.next()}),this.pushNode(),this.nodes)}},{key:"parseCurly",value:function(){var e=this,t="",n=!1,r=!1,l=[],i=[];if(this.skipWhitespace(),this.parserLoop(function(a){if(e.match("}}"))return n=!0,a();if(e.isFunctionName(t)&&e.match("(")){l=e.parseFunctionArgs(),r=!0;return}if(e.match(".")){i.push(t),t="";return}var s=e.next();if(r&&" "!==s)throw Error("Expected closing braces after function");t+=s}),!n)throw Error("Expected closing braces");r?this.pushNode({type:"function",name:t.trim(),args:l}):(i.push(t),this.pushNode({type:"reference",parts:this.normalizeReferenceParts(i)}))}},{key:"isFunctionName",value:function(e){return r.functionNames.includes(e.trim())}},{key:"pushNode",value:function(e){""!==this.currText&&(this.nodes.push({type:"text",value:this.currText}),this.currText=""),null!=e&&this.nodes.push(e)}},{key:"normalizeReferenceParts",value:function(e){return e.map(function(e){var t=e.trim();return t.match(/^".*"$/)?t.slice(1,-1):t})}},{key:"parseFunctionArgs",value:function(){var e=this,t=[],n=!1;if(this.parserLoop(function(r){if(e.skipWhitespace(),e.match(")"))return n=!0,r();var l=e.parseSingleArg();t.push(l),e.match(",")}),!n)throw Error("Expected closing paren");return t}},{key:"parseSingleArg",value:function(){this.skipWhitespace();var e=this.next();if(e.match(/\d/))return this.parseNumber(e);if(e.match(/"/))return this.parseString();if(e.match(/'/))return this.parseString(!0);throw Error("Unexpected token when parsing function arg: ".concat(e))}},{key:"parseString",value:function(e){var t=this,n="",r=e?"'":'"';return this.parserLoop(function(e){var l=t.next();if(l.match(r))return e();n+=l}),n}},{key:"parseNumber",value:function(e){var t=this,n=e;return this.parserLoop(function(e){if(!t.peek().match(/\d/))return e();n+=t.next()}),parseInt(n,10)}},{key:"skipWhitespace",value:function(){this.match(i)}},{key:"match",value:function(e){if("string"==typeof e){if(this.curr+e.length>this.tokens.length)return!1;if(this.tokens.slice(this.curr,this.curr+e.length).join("")===e)return this.curr+=e.length,!0}else{var t=this.tokens.slice(this.curr).join("").match(e);if(null!=t&&0===t.index)return this.curr+=t[0].length,!0}return!1}},{key:"parserLoop",value:function(e){for(var t=this.curr,n=!1,r=function(){n=!0},l=0;!this.isAtEnd()&&(t=this.curr,e(r),!n);){if(t===this.curr)throw console.error("Parser stuck",{index:t,iter:l,nodes:this.nodes,currIndex:this.curr,currText:this.currText,tokens:this.tokens}),Error("Parser stuck at index ".concat(t));if(++l>1e4)throw console.error("Parser max iteration hit",{index:t,iter:l,nodes:this.nodes,currIndex:this.curr,currText:this.currText,tokens:this.tokens}),Error("Parser stuck in infinite loop")}}},{key:"peek",value:function(){return this.tokens[this.curr]}},{key:"next",value:function(){return this.tokens[this.curr++]}},{key:"isAtEnd",value:function(){return this.curr>=this.tokens.length}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),s=function(e){return new a().parse(e)},o=function(e){return"text"===e.type?e.value:"reference"===e.type?"${{".concat(e.parts.join("."),"}}"):"function"===e.type?"${{".concat(e.name,"(").concat(e.args.map(function(e){return"string"==typeof e?'"'.concat(e,'"'):e.toString()}).join(", "),")}}"):""},c=function(e){return e.map(o).join("")}},1758:(e,t,n)=>{"use strict";n.d(t,{F:()=>l});var r=n(25963);function l(e){let t=(0,r.useRef)(e);return(0,r.useEffect)(()=>{t.current=e},[e]),t}},4177:(e,t,n)=>{"use strict";n.d(t,{A:()=>i,C:()=>l});var r=n(25963);let l=e=>null==e?e:e.replace("_"," ").toLowerCase(),i=e=>{let{deployment:t}=e;return(0,r.useMemo)(()=>{var e,n,r,l,i,a,s,o,c,d,u;if(null==t)return{build:{},deploy:{}};let p=null!=(l=null==t||null==(e=t.meta)?void 0:e.fileServiceManifest)?l:{},m=(null==t||null==(n=t.meta)?void 0:n.commitHash)?"https://github.com/".concat(t.meta.repo,"/blob/").concat(t.meta.commitHash,"/").concat(t.meta.configFile):null,h=null!=(i=null==t||null==(r=t.meta)?void 0:r.propertyFileMapping)?i:{},x=e=>h["build.".concat(e)],g=e=>h["deploy.".concat(e)],v={};for(let[e,n]of Object.entries(null!=(a=p.build)?a:{}))void 0!==n&&(v[e]={pathInFile:x(e),configFile:null!=(o=null==(s=t.meta)?void 0:s.configFile)?o:null,url:m});let f={};for(let[e,n]of Object.entries(null!=(c=p.deploy)?c:{}))void 0!==n&&(f[e]={pathInFile:g(e),configFile:null!=(u=null==(d=t.meta)?void 0:d.configFile)?u:null,url:m});return{build:v,deploy:f}},[null==t?void 0:t.meta])}},6783:(e,t,n)=>{"use strict";n.d(t,{i:()=>u});var r=n(50979),l=n(25963),i=n(6605),a=n(2551),s=n(83279),o=n(31754),c=n(42419),d=n(72370);let u=e=>{let{value:t,alwaysShowButtons:n,hideControls:u,autoFocus:p,editorStyles:m,editorId:h,onEdit:x,onChange:g,onCancel:v}=e,[f,y]=(0,l.useState)(!1),[j,b]=(0,l.useState)(!1),w=(0,l.useMemo)(()=>JSON.stringify(t,null,2),[t]),[N,k]=(0,l.useState)(w),[C,S]=(0,l.useState)(w);(0,l.useEffect)(()=>{b(N.trim()!==w.trim())},[w,N]);let E=(0,l.useMemo)(()=>(0,s.j)(N),[N]);(0,l.useEffect)(()=>{if(null!=x)try{x(E?JSON.parse(N):null,E)}catch(e){}},[N,E]);let I=async()=>{if(E)try{g&&(g(JSON.parse(N)),b(!1),S(N))}catch(e){}},A=async()=>{y(!1)},D=()=>{k(C),b(!1),null!=v&&v()};return(0,r.jsxs)("div",{className:"relative",children:[!u&&(j||n)&&(0,r.jsxs)("div",{className:"flex justify-end absolute top-1 right-1 z-10",children:[(0,r.jsx)(o.K0,{icon:a.X,title:"Cancel",onClick:e=>{D(),e.preventDefault(),e.stopPropagation()}}),(0,r.jsx)(o.K0,{icon:a.Jlk,title:"Save",disabled:!E,onClick:e=>{I(),e.preventDefault(),e.stopPropagation()}})]}),(0,r.jsx)(d.t,{textareaId:null!=h?"json-editor-".concat(h):void 0,language:"json",value:N,error:!E,onChange:e=>{k(e)},onFocus:()=>y(!0),onBlur:()=>A(),autoFocus:p,onKeyDown:e=>{e.metaKey&&"Enter"===e.key?(I(),e.preventDefault()):"Escape"===e.key&&(D(),e.preventDefault())},styles:m}),!u&&f&&(0,r.jsxs)(c.ae,{className:"opacity-70 text-right",children:[i.T2,"+enter to save"]})]})}},8289:(e,t,n)=>{"use strict";n.d(t,{N:()=>b});var r=n(50979),l=n(46650),i=n(1508),a=n(25963),s=n(28592),o=n(2551),c=n(77505),d=n(31754),u=n(61259),p=n(95662),m=n(6783),h=n(90029),x=n(72370),g=n(36609),v=n(82660),f=n(80374),y=n(25508),j=n(38982);let b=e=>{let{variables:t,setVariables:n}=e,{modalActions:l}=(0,c.U)(),[i,s]=(0,y.b)(),{variables:o,warnings:u}=(0,j.z)(),[m,x]=(0,a.useState)(null),[g,b]=(0,a.useState)(null),{sealedVariables:N,variablesWithoutSealedVariables:k}=(0,a.useMemo)(()=>{let e={},n={};for(let[r,l]of Object.entries(t))"string"!=typeof l&&(null==l?void 0:l.isSealed)?e[r]=l:n[r]=l;return{sealedVariables:e,variablesWithoutSealedVariables:n}},[t]),C=async e=>{let r=Object.keys(N);for(let t of Object.keys(e))if(r.includes(t))return void s("You already have a sealed variable named ".concat(t,". Please rename the variable or delete the sealed variable."));let i=[];for(let n of Object.keys(e)){var a,c;("string"==typeof t[n]?t[n]:null==(a=t[n])?void 0:a.value)!==("string"==typeof e[n]?e[n]:null==(c=e[n])?void 0:c.value)&&o[n]&&i.push({key:n,warning:o[n]})}if(i.length>0){let t=i.some(e=>{let{warning:t}=e;return"user"===t.type}),n=i.some(e=>{let{warning:t}=e;return"password"===t.type});x(t&&n?{title:i[0].warning.title.replace("authentication change","authentication changes"),description:u.COMBINED_CREDENTIALS_CHANGE_WARNING}:t?{title:i[0].warning.title,description:u.USER_CHANGE_WARNING}:{title:i[0].warning.title,description:u.PASSWORD_CHANGE_WARNING}),b(e);return}n({...e,...N}),l.exitModal()},S=g?Object.fromEntries(Object.entries(g).filter(e=>{let[t]=e;return!N[t]})):k;return m?(0,r.jsxs)(p.T,{space:3,children:[(0,r.jsx)(h.wt,{children:m.title}),(0,r.jsx)("div",{className:"mt-2",children:m.description}),(0,r.jsxs)(p.z,{space:3,className:"mt-4 justify-end",children:[(0,r.jsx)(d.$n,{variant:"primary",color:"gray",onClick:()=>{x(null)},children:"Cancel"}),(0,r.jsx)(d.$n,{variant:"primary",color:"red",onClick:()=>{g&&(n({...g,...N}),x(null),b(null),l.exitModal())},children:"Continue"})]})]}):(0,r.jsxs)(p.T,{space:3,className:"w-full md:min-w-md",children:[(0,r.jsx)(h.wt,{children:"Raw Editor"}),null==i?(0,r.jsx)(h.xW,{className:"mt-0 py-2 text-gray-500 border border-transparent",children:"Add, edit, or delete your project variables"}):(0,r.jsx)(h.xW,{className:"mt-0 px-3 py-2 text-red-500 bg-red-50 border border-red-100 rounded-md",children:i}),Object.keys(N).length>0&&(0,r.jsxs)(v.l,{variant:"info",children:[Object.keys(N).length," sealed"," ",(0,f.td)("variable",Object.keys(N).length)," omitted from the editor. The value will be retained as-is."]}),(0,r.jsx)(w,{variables:S,onError:s,onChangeVariables:C,onCancel:()=>l.exitModal()})]})},w=e=>{let{variables:t,onChangeVariables:n,onError:c,onCancel:h}=e,[v,f]=(0,a.useState)("ENV"),[y,j]=(0,s.T)(),[b,w]=(0,a.useState)(t),[C,S]=(0,a.useState)((0,i.variablesToEnvText)(b)),[E,I]=(0,a.useState)(null);(0,a.useEffect)(()=>{c(E)},[E]);let A={border:"none",minHeight:"100%",margin:"0.3rem 0.5rem"};return(0,r.jsxs)(u.lV,{onSubmit:()=>{null==E&&n(b)},enableBindings:!0,name:"Raw Editor",className:"raw-editor",children:[(0,r.jsxs)(l.bL,{value:v,onValueChange:e=>{S((0,i.variablesToEnvText)(b)),f(e)},className:(0,g.xW)("grid grid-rows-[auto_minmax(0px,_1fr)] h-96","border border-gray-200 rounded",null!=E&&"border-red-500"),children:[(0,r.jsxs)(l.B8,{className:"grid grid-cols-2",children:[(0,r.jsx)(N,{value:"ENV",active:"ENV"===v,children:"ENV"}),(0,r.jsx)(N,{value:"JSON",active:"JSON"===v,children:"JSON"})]}),(0,r.jsx)(l.UC,{value:"ENV",className:"w-full min-w-0 h-full",children:(0,r.jsx)(x.t,{language:"env",value:C,onChange:e=>{S(e),w((0,i.parseEnvContents)(e))},styles:A,placeholder:"HELLO=world\nFOO=bar"})}),(0,r.jsx)(k,{value:"JSON",children:(0,r.jsx)(m.i,{value:(0,i.simplifyVariablesWithMetadata)(b),onEdit:e=>{null==e?I("Invalid JSON"):(0,i.isValidJsonEnv)(e)?(I(null),w(e)):I("JSON values must be strings or { value: string, description?: string | null }")},hideControls:!0,editorStyles:A})})]}),(0,r.jsxs)(p.z,{space:4,className:"mt-3 flex-wrap xs:justify-end",children:[(0,r.jsx)(d.$n,{name:"Copy ".concat(v," Variables"),variant:"ghost",color:"pink",size:"sm",icon:o.QRo,onClick:e=>{e.preventDefault(),(()=>{try{let e="ENV"===v?C:JSON.stringify(b);j(e)}catch(e){}})()},className:"mr-auto mt-3",children:y?(0,r.jsxs)(r.Fragment,{children:["Copied! ",v]}):(0,r.jsxs)(r.Fragment,{children:["Copy ",v]})}),(0,r.jsx)(d.$n,{variant:"primary",color:"gray",size:"sm",onClick:e=>{e.preventDefault(),h()},className:"mt-3",children:"Cancel"}),(0,r.jsx)(d.$n,{size:"sm",disabled:null!=E,className:"mt-3 w-full xs:w-auto",children:"Update Variables"})]})]})},N=(0,g.DR)(l.l9)(e=>{let{active:t}=e;return["h-10 px-3 py-2 text-sm leading-5 text-center text-gray-500 border-b cursor-pointer","hover:text-foreground",t&&"font-semibold border-b-2 border-black text-foreground dark:border-white"]}),k=(0,g.DR)(l.UC)(()=>[],{display:"grid",gridTemplateRows:"minmax(0px, 1fr)",gridTemplateColumns:"minmax(0px, 1fr)"})},9157:(e,t,n)=>{"use strict";n.d(t,{K:()=>p,m:()=>u});var r=n(50979),l=n(22986),i=n(36609),a=n(70375),s=n(71144);let o=(e,t)=>{let n=document.getElementById("group-animate-source-".concat(e));n&&("add"===t?n.classList.add("group-view-transition"):n.classList.remove("group-view-transition"))},c=(e,t)=>{let n=document.getElementById("stack-container-".concat(e));n&&("add"===t?n.classList.add("group-view-transition"):n.classList.remove("group-view-transition"))},d=()=>{document.querySelectorAll(".group-view-transition").forEach(e=>{e.classList.remove("group-view-transition")})},u=()=>{let e=(0,l.useRouter)(),{routes:t}=(0,a.c)(),{track:n}=(0,s.j)(),r=async t=>new Promise(n=>{e.events.on("routeChangeComplete",n),e.push({pathname:t.url,query:t.query,hash:t.hash},(0,a.Q)(t))});return{performNavigateToGroup:e=>{n({action:"Maximize",object:"Nested Group",properties:{groupId:e}});let l=t.project({groupId:e});if(!document.startViewTransition)return void r(l);(async()=>{let t=async()=>{await r(l),o(e,"remove"),c(e,"add")};try{d(),o(e,"add");let n=document.startViewTransition({update:t,types:["group","forwards"]});await n.finished}catch(e){r(l)}finally{d()}})()},performCollapseGroup:e=>{let{navigatingFromGroup:l,navigatingToGroup:i}=e;n({action:"Minimize",object:"Nested Group",properties:{groupId:null!=l?l:null}});let a=t.project({groupId:i});if(null==l||!document.startViewTransition)return void r(a);(async()=>{let e=async()=>{await r(a),d(),o(l,"add")};try{d(),c(l,"add");let t=document.startViewTransition({update:e,types:["group","backwards"]});await t.finished}catch(e){r(a)}finally{d()}})()}}},p=e=>{let{groupId:t,className:n}=e;return(0,r.jsx)("div",{id:"group-animate-source-".concat(t),className:(0,i.xW)("absolute inset-0",n),"aria-hidden":"true"})}},9451:(e,t,n)=>{var r=n(25963);function l(e){return r.createElement("svg",e,[r.createElement("g",{clipPath:"url(#clip0_10_5247)",key:0},[r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M0 0H24V16H0V0Z",fill:"url(#paint0_linear_10_5247)",key:0}),r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M0 0H24V1.06667H0V0ZM0 2.13333H24V3.2H0V2.13333ZM0 4.26667H24V5.33333H0V4.26667ZM0 6.4H24V7.46667H0V6.4ZM0 8.53333H24V9.6H0V8.53333ZM0 10.6667H24V11.7333H0V10.6667ZM0 12.8H24V13.8667H0V12.8ZM0 14.9333H24V16H0V14.9333Z",fill:"url(#paint1_linear_10_5247)",key:1}),r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M0 0H9.85714V7.46667H0V0Z",fill:"url(#paint2_linear_10_5247)",key:2}),r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M1.64283 2.13332C1.34039 2.13332 1.09521 1.89454 1.09521 1.59998C1.09521 1.30543 1.34039 1.06665 1.64283 1.06665C1.94528 1.06665 2.19045 1.30543 2.19045 1.59998C2.19045 1.89454 1.94528 2.13332 1.64283 2.13332ZM3.83331 2.13332C3.53087 2.13332 3.28569 1.89454 3.28569 1.59998C3.28569 1.30543 3.53087 1.06665 3.83331 1.06665C4.13575 1.06665 4.38093 1.30543 4.38093 1.59998C4.38093 1.89454 4.13575 2.13332 3.83331 2.13332ZM6.02379 2.13332C5.72134 2.13332 5.47617 1.89454 5.47617 1.59998C5.47617 1.30543 5.72134 1.06665 6.02379 1.06665C6.32623 1.06665 6.57141 1.30543 6.57141 1.59998C6.57141 1.89454 6.32623 2.13332 6.02379 2.13332ZM8.21426 2.13332C7.91182 2.13332 7.66664 1.89454 7.66664 1.59998C7.66664 1.30543 7.91182 1.06665 8.21426 1.06665C8.5167 1.06665 8.76188 1.30543 8.76188 1.59998C8.76188 1.89454 8.5167 2.13332 8.21426 2.13332ZM2.73807 3.19998C2.43563 3.19998 2.19045 2.9612 2.19045 2.66665C2.19045 2.3721 2.43563 2.13332 2.73807 2.13332C3.04051 2.13332 3.28569 2.3721 3.28569 2.66665C3.28569 2.9612 3.04051 3.19998 2.73807 3.19998ZM4.92855 3.19998C4.62611 3.19998 4.38093 2.9612 4.38093 2.66665C4.38093 2.3721 4.62611 2.13332 4.92855 2.13332C5.23099 2.13332 5.47617 2.3721 5.47617 2.66665C5.47617 2.9612 5.23099 3.19998 4.92855 3.19998ZM7.11902 3.19998C6.81658 3.19998 6.57141 2.9612 6.57141 2.66665C6.57141 2.3721 6.81658 2.13332 7.11902 2.13332C7.42147 2.13332 7.66664 2.3721 7.66664 2.66665C7.66664 2.9612 7.42147 3.19998 7.11902 3.19998ZM8.21426 4.26665C7.91182 4.26665 7.66664 4.02787 7.66664 3.73332C7.66664 3.43877 7.91182 3.19998 8.21426 3.19998C8.5167 3.19998 8.76188 3.43877 8.76188 3.73332C8.76188 4.02787 8.5167 4.26665 8.21426 4.26665ZM6.02379 4.26665C5.72134 4.26665 5.47617 4.02787 5.47617 3.73332C5.47617 3.43877 5.72134 3.19998 6.02379 3.19998C6.32623 3.19998 6.57141 3.43877 6.57141 3.73332C6.57141 4.02787 6.32623 4.26665 6.02379 4.26665ZM3.83331 4.26665C3.53087 4.26665 3.28569 4.02787 3.28569 3.73332C3.28569 3.43877 3.53087 3.19998 3.83331 3.19998C4.13575 3.19998 4.38093 3.43877 4.38093 3.73332C4.38093 4.02787 4.13575 4.26665 3.83331 4.26665ZM1.64283 4.26665C1.34039 4.26665 1.09521 4.02787 1.09521 3.73332C1.09521 3.43877 1.34039 3.19998 1.64283 3.19998C1.94528 3.19998 2.19045 3.43877 2.19045 3.73332C2.19045 4.02787 1.94528 4.26665 1.64283 4.26665ZM2.73807 5.33332C2.43563 5.33332 2.19045 5.09454 2.19045 4.79998C2.19045 4.50543 2.43563 4.26665 2.73807 4.26665C3.04051 4.26665 3.28569 4.50543 3.28569 4.79998C3.28569 5.09454 3.04051 5.33332 2.73807 5.33332ZM4.92855 5.33332C4.62611 5.33332 4.38093 5.09454 4.38093 4.79998C4.38093 4.50543 4.62611 4.26665 4.92855 4.26665C5.23099 4.26665 5.47617 4.50543 5.47617 4.79998C5.47617 5.09454 5.23099 5.33332 4.92855 5.33332ZM7.11902 5.33332C6.81658 5.33332 6.57141 5.09454 6.57141 4.79998C6.57141 4.50543 6.81658 4.26665 7.11902 4.26665C7.42147 4.26665 7.66664 4.50543 7.66664 4.79998C7.66664 5.09454 7.42147 5.33332 7.11902 5.33332ZM8.21426 6.39998C7.91182 6.39998 7.66664 6.1612 7.66664 5.86665C7.66664 5.5721 7.91182 5.33332 8.21426 5.33332C8.5167 5.33332 8.76188 5.5721 8.76188 5.86665C8.76188 6.1612 8.5167 6.39998 8.21426 6.39998ZM6.02379 6.39998C5.72134 6.39998 5.47617 6.1612 5.47617 5.86665C5.47617 5.5721 5.72134 5.33332 6.02379 5.33332C6.32623 5.33332 6.57141 5.5721 6.57141 5.86665C6.57141 6.1612 6.32623 6.39998 6.02379 6.39998ZM3.83331 6.39998C3.53087 6.39998 3.28569 6.1612 3.28569 5.86665C3.28569 5.5721 3.53087 5.33332 3.83331 5.33332C4.13575 5.33332 4.38093 5.5721 4.38093 5.86665C4.38093 6.1612 4.13575 6.39998 3.83331 6.39998ZM1.64283 6.39998C1.34039 6.39998 1.09521 6.1612 1.09521 5.86665C1.09521 5.5721 1.34039 5.33332 1.64283 5.33332C1.94528 5.33332 2.19045 5.5721 2.19045 5.86665C2.19045 6.1612 1.94528 6.39998 1.64283 6.39998Z",fill:"url(#paint3_linear_10_5247)",key:3})]),r.createElement("rect",{x:"0.533333",y:"0.533333",width:"22.9333",height:"14.9333",rx:"1.06667",stroke:"black",strokeOpacity:"0.075",strokeWidth:"1.06667",key:1}),r.createElement("defs",{key:2},[r.createElement("linearGradient",{id:"paint0_linear_10_5247",x1:"252",y1:"0",x2:"252",y2:"240",gradientUnits:"userSpaceOnUse",key:0},[r.createElement("stop",{stopColor:"white",key:0}),r.createElement("stop",{offset:"1",stopColor:"#F0F0F0",key:1})]),r.createElement("linearGradient",{id:"paint1_linear_10_5247",x1:"252",y1:"0",x2:"252",y2:"240",gradientUnits:"userSpaceOnUse",key:1},[r.createElement("stop",{stopColor:"#D02F44",key:0}),r.createElement("stop",{offset:"1",stopColor:"#B12537",key:1})]),r.createElement("linearGradient",{id:"paint2_linear_10_5247",x1:"103.5",y1:"0",x2:"103.5",y2:"112",gradientUnits:"userSpaceOnUse",key:2},[r.createElement("stop",{stopColor:"#46467F",key:0}),r.createElement("stop",{offset:"1",stopColor:"#3C3C6D",key:1})]),r.createElement("linearGradient",{id:"paint3_linear_10_5247",x1:"81.5952",y1:"1.06665",x2:"81.5952",y2:"81.0666",gradientUnits:"userSpaceOnUse",key:3},[r.createElement("stop",{stopColor:"white",key:0}),r.createElement("stop",{offset:"1",stopColor:"#F0F0F0",key:1})]),r.createElement("clipPath",{id:"clip0_10_5247",key:4},r.createElement("rect",{width:"24",height:"16",rx:"1.6",fill:"white"}))])])}l.defaultProps={width:"24",height:"16",viewBox:"0 0 24 16",fill:"none"},e.exports=l,l.default=l},10137:(e,t,n)=>{"use strict";n.d(t,{$$:()=>s,JO:()=>c,ZS:()=>o});var r=n(80348),l=n.n(r),i=n(17657),a=n.n(i);function s(e){try{let t=a().toString(e).toLowerCase();return t.includes("at")?t+" (UTC)":t}catch(e){return null}}function o(e){let t=l().parseExpression(e),n=t.next();return!(t.next().getTime()-n.getTime()<3e5)}function c(e){return e.trim().split(" ").length<=5}},13780:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l,r:()=>i});var r=n(25963);let l=e=>{let[t,n]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{setTimeout(()=>n(!0),e)},[]),t},i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,[n,l]=(0,r.useState)(e),i=(0,r.useRef)(null);return(0,r.useEffect)(()=>(i.current&&(clearTimeout(i.current),i.current=null),!0===e?l(!0):i.current=setTimeout(()=>{l(!1)},t),()=>{i.current&&clearTimeout(i.current)}),[e,t]),n}},13786:(e,t,n)=>{"use strict";n.d(t,{B:()=>i});var r=n(55850),l=n(97865);let i=e=>{let{projectId:t,serviceId:n,environmentId:i,enabled:a}=e,{graphqlClient:s}=(0,r.q)(),{result:o}=(0,l.W)(["service-instance-limit-override",t,i,n],async()=>await s.serviceInstanceLimitOverride({environmentId:i,serviceId:n}),{enabled:a});return{limitOverride:o}}},14872:(e,t,n)=>{"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{functions:function(){return l},functionNames:function(){return i},executeNodeFunction:function(){return a}});var l={randomInt:{execute:function(e,t){var n=null==t?0:e||0;return Math.floor(Math.random()*((null==t?e||100:t)-n+1))+n}},secret:{execute:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"abcdefghijklmnopqrstuvwxyz0123456789",r="",l=t.length,i=function(e){if("undefined"!=typeof window&&window.crypto)return window.crypto.getRandomValues(e);var t=n(49873).randomBytes(4*e.length);return e.set(new Uint32Array(t.buffer)),e},a=0;a<e;a++){var s=Math.floor(function(){var e=new Uint32Array(1);return i(e),e[0]/0x100000000}()*l);r+=t.charAt(s)}return r}}},i=Object.keys(l),a=function(e){if("function"===e.type){var t,n=l[e.name];if(null!=n)return{type:"text",value:n.execute.apply(n,function(e){if(Array.isArray(e))return r(e)}(t=e.args)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return r(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(e,t)}}(t)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}}return e}},15945:(e,t,n)=>{"use strict";n.d(t,{IF:()=>c,Lj:()=>u,Rg:()=>d,Us:()=>o,Y0:()=>s,gp:()=>a,tj:()=>i});var r=n(97865),l=n(55850);let i=e=>{let{graphqlClient:t}=(0,l.q)(),{result:n}=(0,r.W)(["orchestrator","stacker",e,"deployment-instance-inventory"],async()=>(await t.orchestratorListDeploymentInstancesForStacker({stackerId:e})).listDeploymentInstancesForStacker,{refetchInterval:3e3});return{result:n}},a=e=>{let{region:t,includeCordoned:n}=e,{graphqlClient:i}=(0,l.q)(),{result:a}=(0,r.W)(["orchestrator","stackers"],async()=>(await i.orchestratorListStackers()).listStackers,{refetchInterval:3e3}),{data:s}=a;return{stackers:((null==s?void 0:s.filter(e=>(!t||e.region===t)&&(n||!e.isCordoned)))||[]).sort((e,t)=>e.hostname.localeCompare(t.hostname))}},s=(e,t,n)=>{let{graphqlClient:i}=(0,l.q)(),{result:a}=(0,r.W)(["orchestrator","stacker",e,"migration",t],async()=>(await i.orchestratorMigrateStackerProgress({stackerId:e,migrationId:t})).migrateStackerProgress,{enabled:!!t,...n});return{result:a}},o=e=>{let{graphqlClient:t}=(0,l.q)(),{result:n}=(0,r.W)(["orchestrator","drainStackerRunningWorkflows"],async()=>(await t.orchestratorDrainStackersAlreadyRunning()).getDrainStackerRunningWorkflows,e);return{result:n}},c=(e,t)=>{let{graphqlClient:n}=(0,l.q)(),{result:i}=(0,r.W)(["orchestrator","drainStacker",e],async()=>(await n.orchestratorDrainStackerProgress({workflowId:e})).drainStackerProgress,{enabled:!!e,...t});return{result:i}},d=e=>{let{graphqlClient:t}=(0,l.q)(),{result:n}=(0,r.W)(["orchestrator","getStackerStatsRunningWorkflows"],async()=>(await t.orchestratorStackersStatsAlreadyRunning()).getStackerStatsRunningWorkflows,e);return{result:n}},u=(e,t)=>{let{graphqlClient:n}=(0,l.q)(),{result:i}=(0,r.W)(["orchestrator","stackerStats",e],async()=>(await n.orchestratorStackerStatsProgress({workflowId:e})).stackerStatsProgress,{enabled:!!e,...t});return{result:i}}},16587:(e,t,n)=>{"use strict";n.d(t,{_:()=>h});var r=n(50979),l=n(25963),i=n(2551),a=n(36609),s=n(13077),o=n(95662),c=n(71252),d=n(83271),u=n(79006);let p={filled:"text-gray-500",outline:"text-gray-500"},m={md:"top-[2px] right-1.5",sm:"top-px right-1.5"},h=l.forwardRef(e=>{var t;let{size:n,value:h,options:x,name:g,disabled:v,autoFocus:f,searchable:y=!1,onChange:j,id:b,isStaged:w,...N}=e,{colorMode:k}=(0,u.DP)(),C=null!=(t=N.variant)?t:"outline",S=null!=n?n:"md";return b=(0,l.useMemo)(()=>(null!=b?b:"select-".concat(g))+"-"+Math.random(),[]),(0,r.jsx)(o.T,{className:(0,a.xW)("w-auto",N.parentStyles),children:(0,r.jsx)("div",{className:(0,a.xW)("relative flex items-center",v&&"opacity-60",N.containerStyles),children:(0,r.jsx)(c.Ay,{className:(0,a.xW)("max-w-3xl w-full mx-auto","select ".concat(null!=g?"select-".concat(g):""),N.selectStyles),value:x.find(e=>e.value===h),isDisabled:v,autoFocus:f,onChange:e=>{null!=j&&null!==e&&j(e.value)},isSearchable:y,isClearable:!1,options:x,styles:{container:(e,t)=>({...e,pointerEvents:"auto"}),control:(e,t)=>({...e,backgroundColor:w?"var(--pink-50)":"dark"===k?"hsla(250, 21%, 11%, 0.5)":"hsla(0, 0%, 100%, 0.05)",border:w?"1px solid var(--pink-100)":"1px solid var(--gray-200)",borderRadius:"6px",cursor:"not-allowed",boxShadow:"none",padding:"0 4px",":hover":{border:"1px solid var(--pink-500)",backgroundColor:"var(--gray-100)"},":focus":{border:"1px solid var(--pink-500)"}}),singleValue:(e,t)=>({...e,cursor:t.isDisabled?"not-allowed":"pointer",color:w?"var(--pink-600)":"var(--foreground)"}),valueContainer:(e,t)=>({...e,cursor:t.isDisabled?"not-allowed":"pointer",height:"42px"}),indicatorSeparator:()=>({display:"none"}),dropdownIndicator:e=>({...e}),input:e=>({...e,color:"var(--foreground)"}),menu:e=>({...e,padding:0,backgroundColor:"var(--secondaryBg)",borderRadius:"8px",zIndex:20}),menuList:e=>({...e,padding:"3px",backgroundColor:"var(--secondaryBg)",borderRadius:"8px"}),option:(e,t)=>({...e,color:t.isDisabled?"var(--gray-300)":"var(--foreground)",cursor:t.isDisabled?"not-allowed":"pointer",height:"fit-content",padding:"0px 8px",backgroundColor:t.isSelected?"var(--gray-200)":t.isFocused?"var(--gray-100)":"var(--secondaryBg)",borderRadius:"8px",":active":{backgroundColor:"var(--gray-100)"}})},components:{DropdownIndicator:e=>(0,r.jsx)(d.c.DropdownIndicator,{...e,children:(0,r.jsx)(o.z,{align:"center",justify:"center",className:"h-full w-full rounded-tr-md rounded-br-md pr-1.5",children:(0,r.jsx)(s.In,{className:(0,a.xW)(p[C],m[S],"min-h-full pointer-events-none"),icon:i.yQN})})}),SingleValue:e=>{var t;return(0,r.jsx)(d.c.SingleValue,{...e,children:e.data.render?e.data.render:(0,r.jsxs)(o.z,{align:"center",space:3,children:[e.data.icon&&(0,r.jsx)(s.In,{icon:e.data.icon,size:"sm"}),(0,r.jsx)("span",{children:null!=(t=e.data.label)?t:e.data.value})]})})},Option:e=>{var t;return(0,r.jsx)(d.c.Option,{...e,children:e.data.render?e.data.render:(0,r.jsxs)(o.z,{align:"center",className:"px-3 py-1",space:3,children:[e.data.icon&&(0,r.jsx)(s.In,{icon:e.data.icon}),(0,r.jsx)("span",{children:null!=(t=e.data.label)?t:e.data.value})]})})}}})})})})},17771:(e,t,n)=>{"use strict";n.d(t,{E:()=>l,p:()=>r});let r=["Source","Networking","Build","Deploy","Config-as-code","Feature-flags","Danger"],l=["Connection","Size","Region","Alerts","Data","Danger"]},18134:(e,t,n)=>{"use strict";n.d(t,{U3:()=>N,en:()=>E,jK:()=>S});var r=n(50979),l=n(12725),i=n(72287),a=n(81154),s=n(25963),o=n(42113),c=n(64162),d=n(93208),u=n(28592),p=n(2551),m=n(77505),h=n(47188),x=n(36609),g=n(31754),v=n(61259),f=n(13077),y=n(86954),j=n(95662),b=n(42419),w=n(88887);let N=e=>{var t;let{stagedTcpPorts:n,tcpProxies:l,service:a,networkingActions:s}=e,{modalActions:o}=(0,m.U)(),{isConfirmed:u}=(0,d.S)(),p=(0,i.y3)(),h=async e=>{if(await u({confirmLabel:"Remove",message:"Are you sure you want to remove the TCP Proxy?",title:"Remove TCP Proxy"}))try{await s.deleteTcpProxy({id:e.id})}catch(e){o.createToast((0,r.jsx)(w.y8,{variant:"error",title:"Error removing TCP proxy",description:e.message}))}},x=async e=>{var t;let n=p.getEnvironmentConfig();(null!=(t=null==n?void 0:n.services)?t:{})[a.id];let r=(0,c.newEnvironmentConfig)(p.getStagedChanges()).updateService(a.id,{networking:{tcpProxies:{[e]:null}}}).build();p.stageEnvironmentChanges({payload:r})};return(0,r.jsxs)("div",{children:[null!=(t=null==l?void 0:l.map(e=>(0,r.jsx)(C,{proxy:e,service:a,onDeleteProxy:h},e.id)))?t:null,n.map(e=>(0,r.jsx)(k,{port:e,service:a,onDeleteProxy:x},e))]})},k=e=>{let{port:t,onDeleteProxy:n}=e,l=(0,a.md)(h.mz),[i,s]=(0,u.T)();return(0,r.jsxs)("div",{className:(0,x.xW)("group","flex items-center w-full gap-3","px-4 py-3","hover:bg-secondaryBg dark:hover:bg-gray-100","rounded-lg bg-pink-50 text-pink-600 border border-pink-100"),children:[(0,r.jsx)(f.In,{icon:p.KHh,className:"text-gray-500"}),(0,r.jsx)(j.z,{align:"center",space:2,children:(0,r.jsxs)(b.EY,{className:"flex-grow text-left whitespace-nowrap",children:[":",t]})}),(0,r.jsx)(j.z,{space:1,className:"ml-auto",children:l&&(0,r.jsx)(g.K0,{icon:p.TBR,size:"xs",title:"Delete",type:"button",onClick:()=>n(t),className:"rounded-md hover:bg-gray-200"})})]})},C=e=>{let{proxy:t,onDeleteProxy:n}=e,l=(0,a.md)(h.mz),[i,s]=(0,u.T)();return(0,r.jsxs)("div",{className:(0,x.xW)("group","flex items-center w-full gap-3","px-4 py-3","hover:bg-secondaryBg dark:hover:bg-gray-100","rounded-lg border border-gray-200"),children:[(0,r.jsx)(f.In,{icon:p.KHh,className:"text-gray-500"}),(0,r.jsxs)(j.z,{align:"center",space:2,children:[(0,r.jsxs)(b.EY,{className:"flex-grow text-left whitespace-nowrap",children:[t.domain,":",t.proxyPort]}),(0,r.jsx)(f.In,{icon:p.Qpb,className:"text-gray-600"}),(0,r.jsxs)(b.EY,{children:[":",t.applicationPort]})]}),(0,r.jsxs)(j.z,{space:1,className:"ml-auto",children:[(0,r.jsx)(g.K0,{icon:i?p.Jlk:p.QRo,size:"xs",title:"Copy",type:"button",onClick:()=>s("".concat(t.domain,":").concat(t.proxyPort)),className:"rounded-md hover:bg-gray-200"}),l&&(0,r.jsx)(g.K0,{icon:p.TBR,size:"xs",title:"Delete",type:"button",onClick:()=>n(t),className:"rounded-md hover:bg-gray-200"})]})]})},S=e=>{let{tcpProxy:t,permissions:n,setIsAddingTcpProxy:l}=e;return null!=t?null:(0,r.jsx)(j.z,{space:2,children:(0,r.jsx)(g.$n,{variant:"outline",size:"sm",icon:p.FWt,disabled:!n.Write,onClick:()=>l(!0),children:"TCP Proxy"})})},E=e=>{var t;let{onAddTcpProxy:n,onCancel:i}=e,{register:a,handleSubmit:c,formState:{errors:d,isValid:u}}=(0,o.mN)({}),[m,h]=(0,s.useState)(!1),x=async e=>{h(!0);try{await n({applicationPort:parseInt(e.applicationPort.toString())})}catch(e){}h(!1)};return(0,r.jsxs)(v.lV,{enableBindings:!0,className:"p-4 rounded-lg bg-secondaryBg dark:bg-gray-100",onCancel:i,onSubmit:c(x),children:[(0,r.jsx)(b.ax,{className:"mb-4 font-semibold",children:"Add TCP Proxy"}),(0,r.jsx)(y.pd,{label:{hidden:!0,text:"Application port"},placeholder:"5432",type:"number",...a("applicationPort",{required:"Application port must be specified."}),min:0,max:l.MAX_PORT,error:null==(t=d.applicationPort)?void 0:t.message}),(0,r.jsxs)(j.z,{justify:"between",className:"mt-4 w-full",children:[(0,r.jsxs)(j.z,{space:3,align:"center",className:"text-gray-500",children:[(0,r.jsx)(f.In,{icon:p.R2D}),(0,r.jsx)(b.ax,{children:"Enter your application port"})]}),(0,r.jsxs)(j.z,{align:"center",space:2,children:[(0,r.jsx)(g.$n,{size:"sm",color:"gray",variant:"outline",type:"button",onClick:i,children:"Cancel"}),(0,r.jsx)(g.$n,{size:"sm",color:"pink",variant:"primary",isLoading:m,disabled:!u||m,children:"Add Proxy"})]})]})]})}},18407:(e,t,n)=>{"use strict";n.d(t,{Ff:()=>x});var r=n(86739),l=n(50979);n(25963),n(2551);var i=n(13077),a=n(13025),s=n(36609);function o(){let e=(0,r._)(["space-y-1 flex-grow text-left"]);return o=function(){return e},e}function c(){let e=(0,r._)(["text-base leading-6 text-foreground"]);return c=function(){return e},e}function d(){let e=(0,r._)(["text-sm leading-5 text-gray-500"]);return d=function(){return e},e}function u(){let e=(0,r._)(["flex items-center space-x-4 w-full pt-4 p-4 focus:outline-none"]);return u=function(){return e},e}function p(){let e=(0,r._)([""]);return p=function(){return e},e}function m(){let e=(0,r._)(["bg-gray-200 my-2"]);return m=function(){return e},e}function h(){let e=(0,r._)(["px-4 pb-4"]);return h=function(){return e},e}(0,s.Wp)("div")(e=>["rounded-lg bg-gray-100 border border-gray-100","hover:border-gray-200",e.isOpen&&"border-gray-200"]),s.qy.header(o()),s.qy.h4(c()),s.qy.p(d()),s.qy.button(u()),(0,s.DR)(i.In)(p()),s.qy.hr(m()),(0,s.DR)(a.P.div)(h());let x=e=>(0,l.jsx)("div",{...e,className:(0,s.xW)(e.className,e.noHover?"":"hover:hover:bg-secondaryBg dark:hover:bg-gray-100",e.hideActions?"grid grid-cols-[minmax(0,2fr)_minmax(0,3.5fr)]":"grid grid-cols-[minmax(0,2fr)_minmax(0,3fr)_minmax(4rem,auto)]","justify-items-stretch min-h-[2.25rem] px-4 items-center font-mono")})},18970:(e,t,n)=>{"use strict";n.d(t,{$o:()=>b,A3:()=>y,D1:()=>g,J6:()=>h,XI:()=>x,fI:()=>f,vc:()=>v,xC:()=>j});var r=n(86739),l=n(50979);n(25963);var i=n(2551),a=n(31754),s=n(95662),o=n(42419),c=n(36609);function d(){let e=(0,r._)(["grid grid-cols-[minmax(0,1fr)] overflow-x-auto flex-grow rounded-lg border border-gray-200"]);return d=function(){return e},e}function u(){let e=(0,r._)(['\n    "[&>tr]:border [&>tr]:border-b [&>tr]:border-gray-100 [&>tr]:bg-transparent [&>tr]:hover:bg-transparent"\n']);return u=function(){return e},e}function p(){let e=(0,r._)(["py-3 px-4 text-left font-semibold text-xs text-gray-600"]);return p=function(){return e},e}function m(){let e=(0,r._)(["flex items-center justify-center pt-4"]);return m=function(){return e},e}let h=c.qy.div(d()),x=(0,c.Wp)("table")(e=>["w-full border-collapse",e.isSelecting?"select-none":"select-auto"]),g=(0,c.Wp)("thead")(u()),v=(0,c.Wp)("tbody")(e=>[e.showRowBorder&&"[&>tr]:border-b [&>tr]:border-gray-100 [&>tr:last-child]:border-none"]),f=(0,c.Wp)("tr")(e=>[e.isInserting&&"border-t-2 border-pink-500",e.unSelectable&&"[&>tr]:cursor-initial",e.isActive&&"bg-gray-100","[&.selected]:bg-gray-100 [&.inserting]:bg-transparent",e.unSelectable||!1===e.isActive?"hover:bg-transparent":"hover:bg-gray-100"]),y=c.qy.th(p()),j=(0,c.Wp)("td")(()=>["py-3 px-4 cursor-pointer overflow-hidden overflow-ellipsis whitespace-nowrap"],e=>({width:e.width,minWidth:64,maxWidth:400,textAlign:e.align})),b=e=>{let{canPreviousPage:t,canNextPage:n,pageIndex:r,totalPages:a,gotoPage:s,previousPage:c,nextPage:d,...u}=e;return(0,l.jsxs)(w,{space:2,...u,children:[(0,l.jsx)(N,{type:"button",title:"First Page",icon:i.O_5,isHidden:!t,onClick:()=>s(0)}),(0,l.jsx)(N,{type:"button",title:"Previous Page",icon:i.JGc,isHidden:!t,onClick:()=>c()}),(0,l.jsxs)(o.EY,{className:"text-sm whitespace-nowrap",children:["Page ",r+1," ",null!=a&&(0,l.jsxs)(l.Fragment,{children:["of ",a]})]}),(0,l.jsx)(N,{type:"button",title:"Next Page",icon:i.c_$,isHidden:!n,onClick:()=>d()}),(0,l.jsx)(N,{type:"button",icon:i.hIh,title:"Last Page",isHidden:null==a||!n,onClick:()=>{null!=a&&s(a-1)}})]})},w=(0,c.DR)(s.z)(m()),N=(0,c.DR)(a.K0)(e=>[e.isHidden?"invisible":"visible"])},24703:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(25963),l=n(8718),i=n(61649);let a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],{isCommandPaletteOpen:n}=(0,i.oG)();(0,r.useEffect)(()=>{if(n)return;let t=(0,l.Ay)(window,Object.entries(e).reduce((e,t)=>{let[n,r]=t;return{...e,[n]:e=>{var t;let n=null==(t=e.target)?void 0:t.nodeName,l=e.metaKey||e.ctrlKey||e.metaKey;("INPUT"!==n&&"TEXTAREA"!==n||l)&&r(e)}}},{}));return()=>{t()}},[n,...t])}},25586:(e,t,n)=>{"use strict";n.d(t,{$:()=>c});var r=n(95925),l=n(97865),i=n(55850),a=n(66800),s=n.n(a);let o=e=>["privateNetworks",e],c=e=>{let{environmentId:t}=e,n=(0,r.jE)(),{graphqlClient:a}=(0,i.q)(),c=o(t),{result:d}=(0,l.W)(c,async()=>(await a.privateNetworks({environmentId:t})).privateNetworks,{staleTime:s()("30s"),refetchOnMount:!1});return[{privateNetworks:d},{createOrGetPrivateNetwork:async e=>{let r=(await a.privateNetworkCreateOrGet({input:e})).privateNetworkCreateOrGet;return await n.invalidateQueries({queryKey:o(t)}),r},deletePrivateNetworks:async()=>{await a.privateNetworksForEnvironmentDelete({environmentId:t}),await n.invalidateQueries({queryKey:o(t)})}}]}},26191:(e,t,n)=>{"use strict";n.d(t,{c:()=>y});var r=n(50979),l=n(81154),i=n(25963),a=n(55850),s=n(72898),o=n(2551),c=n(77505),d=n(65431),u=n(15857),p=n(31754),m=n(13077),h=n(47654),x=n(95662),g=n(42419),v=n(90029),f=n(88887);let y=e=>{let{serviceId:t,environmentId:n,serviceName:y,sourceRepo:j,onSuccess:b,isSourceSameAsUpstream:w}=e,{modalActions:N}=(0,c.U)(),[k,C]=(0,i.useState)(!1),{graphqlClient:S}=(0,a.q)(),E=(0,l.md)(u.K8),I=(0,l.md)(d.AQ),A=(0,s.n)(E,async e=>{let{serviceId:t,environmentId:n}=e;null!=I&&await S.githubRepoUpdate({input:{projectId:I,environmentId:n,serviceId:t}})}),D=async()=>{C(!0);try{await A({serviceId:t,environmentId:n}),b&&b(),N.createToast((0,r.jsx)(f.y8,{icon:o.rAV,variant:"success",title:"Success",description:"We've triggered an update for your project. ".concat(w?"A deployment will start soon!":"We will send you an email upon completion!")}))}catch(t){var e;N.createToast((0,r.jsx)(f.y8,{icon:o.X,variant:"error",title:"Error",description:null!=(e=t.message)?e:"Sorry! Something went wrong and we weren't able to trigger an update for your project."}))}C(!1),N.exitModal()};return(0,r.jsxs)(v.aF,{title:"Update template",preventClose:!0,children:[(0,r.jsx)(v.wt,{className:"mb-5",children:"Update template"}),(0,r.jsxs)(x.T,{space:5,children:[(0,r.jsxs)(x.T,{space:1,children:[(0,r.jsxs)(g.EY,{children:["Do you want to update ",(0,r.jsx)("strong",{children:y})," to its latest version?"]}),(0,r.jsx)(h.N,{variant:"coloured",href:j,children:(0,r.jsxs)(x.z,{space:1,align:"center",children:[(0,r.jsx)(g.ax,{children:"View source repo"}),(0,r.jsx)(m.In,{icon:o.c_$,size:"xs"})]})})]}),!w&&(0,r.jsx)(g.ax,{children:"Once confirmed, we will create a new branch on Github and a PR deployment on Railway. You will be notified via email once the update has been completed."}),(0,r.jsxs)(x.z,{space:4,justify:"end",children:[(0,r.jsx)(p.$n,{color:"gray",onClick:()=>N.exitModal(),children:"Cancel"}),(0,r.jsx)(p.$n,{color:"pink",onClick:D,disabled:k,isLoading:k,children:"Yes"})]})]})]})}},27569:(e,t)=>{"use strict";function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,l=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=l){var i=[],a=!0,s=!1;try{for(l=l.call(e);!(a=(n=l.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){s=!0,r=e}finally{try{a||null==l.return||l.return()}finally{if(s)throw r}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{flattenObject:function(){return l},unflattenObject:function(){return i},escapedPathSplit:function(){return a},unescapePath:function(){return s}});var l=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={},l=t?function(e){return e}:function(e){return e.replace(/\./g,"\\.")},i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s=!0,o=!1,c=void 0;try{for(var d,u=Object.entries(e)[Symbol.iterator]();!(s=(d=u.next()).done);s=!0){var p=r(d.value,2),m=p[0],h=p[1],x=l(m),g="".concat(t).concat(x).concat(a);Array.isArray(h)?n[g]=h:null===h?n[g]=null:"object"==typeof h&&0===Object.keys(h).length?n[g]={}:"object"==typeof h?i(h,"".concat(g,".")):n[g]=h}}catch(e){o=!0,c=e}finally{try{s||null==u.return||u.return()}finally{if(o)throw c}}};return i(e),n},i=function(e){var t={};return Object.entries(e).forEach(function(e){for(var n=r(e,2),l=n[0],i=n[1],o=a(l).map(s),c=t,d=0;d<o.length;d++){var u,p=o[d];d===o.length-1?c[p]=i:(c[p]=null!=(u=c[p])?u:{},c=c[p])}}),t},a=function(e){return e.split(RegExp("(?<!\\\\)\\."))},s=function(e){return e.replace(/\\./g,".")}},27644:(e,t,n)=>{"use strict";n.d(t,{T:()=>o});var r=n(50979),l=n(25963),i=n(32357),a=n(2551),s=n(36609);let o=(0,l.forwardRef)((e,t)=>{let{name:n,autocompleteOptions:l,onChange:o,onSubmit:c,value:d,size:u,showLabel:p,className:m,error:h}=e;return(0,r.jsx)(i.j,{ref:t,name:n,autoHeight:!0,enterToSubmit:!0,onChange:o,onSubmit:c,options:l,icon:a.rTt,label:{text:"Variable Value",hidden:!p},size:null!=u?u:"sm",autoComplete:"off",value:d,placeholder:"VALUE or ${{REF}}",error:h,className:(0,s.xW)("resize-none max-h-[30vh]",m)})})},29240:(e,t,n)=>{"use strict";n.d(t,{j:()=>a});var r=n(79745),l=n(25963);let i=r.IS_DEV?"localhost":"us-west1",a=e=>{let{serviceInstanceConfig:t}=e;return(0,l.useMemo)(()=>{let e=t.deploy;if((null==e?void 0:e.multiRegionConfig)==null){var n;return[null!=(n=null==e?void 0:e.region)?n:i]}return Object.keys(Object.fromEntries(Object.entries(e.multiRegionConfig).filter(e=>{let[t,n]=e;return null!=n})))},[t.deploy])}},32357:(e,t,n)=>{"use strict";n.d(t,{j:()=>y});var r=n(50979),l=n(25963),i=n(19391),a=n(37111),s=n(40974),o=n.n(s),c=n(63344),d=n(31754),u=n(2551),p=n(8718),m=n(13077),h=n(95662),x=n(13025),g=n(42419),v=n(6008),f=n(36609);let y=l.forwardRef((e,t)=>{let{value:n,defaultOpen:s,options:o,onChange:g,onSelect:y,icon:b,iconText:w,overflowHint:C,behavior:S="insert",minQueryLength:E=1,className:I,portalContainer:A,iconContainerClassName:D,includeFullMatch:R,...P}=e,O=(0,l.useRef)(null),[T,M]=(0,l.useState)(null),z=(0,l.useMemo)(()=>{let e=[];for(let t of o){let r=0,l=0;for(;(l=n.indexOf(t.value,r))>-1;)e.push({start:l,end:l+t.value.length}),r=l+t.value.length}return e},[n]);(0,l.useImperativeHandle)(t,()=>T);let[F,L]=(0,l.useState)(!1),[W,U]=(0,l.useState)(!1),[_,V]=(0,l.useState)(null),[B,G]=(0,l.useState)(0),[Y,$]=(0,l.useState)(0),[H,q]=(0,l.useState)(null!=n?n:"");(0,l.useEffect)(()=>{s&&L(!0)},[]),(0,l.useEffect)(()=>{L(F||s||!1)},[s]);let{prefix:K,suffix:X,matchedOptions:Z,selectableOptions:J}=(0,l.useMemo)(()=>{let e=H.slice(0,null!=B?B:0),t=H.slice(null!=Y?Y:0,H.length),{results:n,hasValidQuery:r}=N({options:o,prefix:e,suffix:t,minQueryLength:F?1:E,includeFullMatch:R}),l=r?n:o.filter(e=>{var t;return(null!=(t=e.numMatchStart)?t:0)<=1}).map(e=>({obj:e,query:"",score:0,target:e.value}));return{prefix:e,suffix:t,matchedOptions:n,selectableOptions:l}},[H,B,Y,F,JSON.stringify(o)]);(0,l.useEffect)(()=>{if(null!=T)return(0,p.Ay)(T,{Enter:e=>{if(0===J.length)return void L(!1);!F||e.shiftKey||e.ctrlKey||e.metaKey||e.altKey||(e.preventDefault(),e.stopPropagation(),null!==_&&_<J.length&&ee(J[_]))},ArrowUp:e=>{var t,n;if(!F)return;e.preventDefault(),V(e=>null===e?0:e-1);let r=(null!=(n=null==(t=O.current)?void 0:t.querySelectorAll("."+j.className))?n:[])[(null!=_?_:-1)-1];null==r||r.scrollIntoView({block:"nearest"})},ArrowDown:e=>{var t,n;if(!F)return;e.preventDefault(),V(e=>null===e?0:e+1);let r=(null!=(n=null==(t=O.current)?void 0:t.querySelectorAll("."+j.className))?n:[])[(null!=_?_:-1)+1];null==r||r.scrollIntoView({block:"nearest"})},Escape:e=>{F&&(e.stopPropagation(),en())},"Control+Space":e=>{F||(e.preventDefault(),et())}})},[T,F,_,J]),(0,l.useEffect)(()=>{0!==J.length&&null!=_&&(_<0?V(0):_>J.length-1&&V(J.length-1))},[_,J]),(0,l.useEffect)(()=>{!F&&Z.length>0&&et()},[Z.length,J.length]),(0,l.useEffect)(()=>{let e=()=>L(!1);return document.addEventListener("scroll",e),()=>document.removeEventListener("scroll",e)},[]);let Q=e=>{0===e.length&&H.length>0&&en(),q(e),g(e)},ee=e=>{var t;let n=null!=(t=e.query.length)?t:0,r=K.slice(0,K.length-n)+e.target,l="replace"===S?e.target:r+X;null!=T&&(T.value=l,T.setSelectionRange(r.length,r.length,"forward"),G(T.selectionStart),$(T.selectionEnd),T.focus()),Q(l),en(),null==y||y(e.obj)},et=()=>{F||(V(0),L(!0),null==T||T.focus())},en=()=>{F&&(L(!1),U(!1))},[er,el]=(0,l.useState)(),ei=(0,v.l)(100),{positionStyles:ea,numToShow:es}=(0,l.useMemo)(()=>{let e=null==T?void 0:T.getBoundingClientRect();if(null==e)return{numToShow:1/0};let t=Math.min(600,window.innerHeight-e.bottom-30),n=Math.floor(t/37-1);return C&&(n-=1),(W||n<3)&&(n=1/0),{numToShow:n,positionStyles:{top:"".concat(e.bottom,"px"),left:"".concat(e.left,"px"),minWidth:"".concat(e.width,"px"),maxHeight:"".concat(t,"px")}}},[T,F,W,ei]);return(0,r.jsxs)("div",{className:"relative w-full",children:[(0,r.jsx)(c.T,{name:P.name,ref:M,highlights:z,enterToSubmit:!0,autoComplete:"off",spellCheck:!1,...P,value:n,onChange:e=>Q(e.currentTarget.value),onBlur:()=>{null!=er&&clearTimeout(er),el(setTimeout(en,400))},onFocus:()=>{null!=er&&clearTimeout(er)},onSelect:e=>{G(e.currentTarget.selectionStart),$(e.currentTarget.selectionEnd)},className:(0,f.xW)("resize-none max-h-[30vh] !pr-7",I),textareaSiblings:(0,r.jsx)(r.Fragment,{children:b&&(0,r.jsx)(d.$n,{"aria-hidden":!0,tabIndex:-1,variant:"primary",title:"Open",size:"md"===P.size?"sm":"xs",type:"button",color:"gray",onClick:et,className:(0,f.xW)("z-10 absolute right-0 top-0 mt-1 mr-1 !bg-gray-100 border-0 text-gray-600 hover:text-gray-900",D),children:(0,r.jsxs)(h.z,{align:"center",children:[(0,r.jsx)(m.In,{icon:b,size:"xs",className:"!h-[14px] !w-[14px]"}),(0,r.jsx)(x.P.div,{animate:!n&&w?{marginLeft:"0.2rem"}:{marginLeft:0,opacity:0,width:0},className:"overflow-hidden whitespace-nowrap",children:w})]})})})}),F&&(0,r.jsxs)(i.b,{"aria-hidden":!0,container:A,children:[(0,r.jsx)("div",{onClick:en,className:"fixed top-0 left-0 right-0 bottom-0 z-50"}),(0,r.jsx)("div",{ref:O,style:ea,className:"fixed z-50 bg-background shadow-md dark:bg-gray-100 rounded border border-gray-200 mt-0.5 flex",children:(0,r.jsxs)(a.F,{thumbCSS:"brightness-95 dark:brightness-125",className:"h-auto w-full p-2",onScroll:e=>e.stopPropagation(),children:[0===J.length&&(0,r.jsx)(k,{className:"text-gray-500 italic py-0",children:"No suggestions"}),C&&J.length>es&&(0,r.jsxs)(k,{className:"text-gray-500",children:[(0,r.jsx)(m.In,{icon:u.R2D,size:"sm",className:"mr-2"}),(0,r.jsx)("span",{className:"text-xs",children:C})]}),J.slice(0,W?-1:es).map(e=>(0,r.jsx)(j,{hint:e.obj.hint,isFocused:null!==_&&J[_]===e,onClick:()=>{ee(e)},onHover:()=>V(J.indexOf(e)),onBlur:()=>V(null),textBeforeCursor:K,result:e},e.obj.value+e.obj.hint)),J.length>es&&(0,r.jsxs)(k,{hoverStyles:!0,onClick:e=>{e.stopPropagation(),e.preventDefault(),U(!0),null==T||T.focus()},className:"text-gray-500",children:[(0,r.jsx)(m.In,{icon:u.a4,size:"sm",className:"mr-2"}),(0,r.jsxs)("span",{className:"text-sm",children:["Show ",J.length-es," More"]})]})]})})]})]})}),j=e=>{let{isFocused:t,onClick:n,onHover:l,onBlur:i,result:a,hint:s,textBeforeCursor:c,...d}=e;return(0,r.jsxs)(k,{hasFocus:t,className:j.className,onClick:e=>{e.preventDefault(),e.stopPropagation(),n()},onMouseEnter:l,onMouseLeave:i,...d,children:[a.obj.icon&&(0,r.jsx)(m.In,{icon:a.obj.icon,size:"sm",className:"mr-2 text-gray-500"}),(0,r.jsx)("div",{className:"font-mono text-gray-600",children:null!=a._indexes?o().highlight(a,(e,t)=>(0,r.jsx)("span",{className:"underline",children:e},t)):a.target}),null!=s&&(0,r.jsx)(g.ax,{className:"pl-8 ml-auto text-gray-500",children:s})]})};j.className="autocomplete-item";let b=(e,t,n)=>{let r="";for(let l=0;l<e.length;l++){let i=e.length-1-l,a=e[i];if(n&&e.slice(i,i+n.length)===n)break;if(r=a+r,t&&e.slice(i,i+t.length)===t)return r}return""},w=(e,t,n)=>{for(let r=0;r<e.length;r++)if(n&&e.slice(r-n.length,r)===n||t&&e.slice(r-t.length,r)===t)return!1;return!0},N=e=>{let{options:t,prefix:n,suffix:r,minQueryLength:l,includeFullMatch:i=!1}=e,a=[],s=!1;for(let e of t){var c,d;let t=e.value.slice(0,null!=(c=e.numMatchStart)?c:1),u=e.value.slice(-(null!=(d=e.numMatchStop)?d:0));if(!w(r,t,u))continue;let p=""===t?n:b(n,t,u);if(p.length<l||!i&&e.value.length===p.length)continue;s=!0;let m=o().single(p,e.value);null!==m&&a.push({...m,obj:e,query:p})}return{results:a,hasValidQuery:s}},k=(0,f.Wp)("div")(e=>["w-full px-2 py-2 text-sm rounded-md flex items-center cursor-default",e.hasFocus&&"bg-gray-100 dark:bg-gray-200",e.hoverStyles&&"hover:bg-gray-100 dark:hover:bg-gray-200"])},33029:(e,t,n)=>{"use strict";n.d(t,{OZ:()=>u,wy:()=>d});var r=n(50979),l=n(70375),i=n(50655),a=n(2551),s=n(65910),o=n(47654),c=n(49767);let d=e=>{let{id:t,manifestFileInfo:n,onChange:i,value:d,readOnly:u,isStaged:p}=e,{routes:m}=(0,l.c)();return(0,r.jsxs)(c.XY,{id:t,children:[(0,r.jsxs)(c.O5,{children:[(0,r.jsx)(c.fA,{id:t,children:"Pre-deploy Command"}),(0,r.jsxs)(c.$0,{children:["Run a command in your image before your application deploys."," ",(0,r.jsxs)(o.N,{external:!0,variant:"highlight",...m.docs({page:"/guides/pre-deploy-command"}),children:[(0,r.jsx)("span",{className:"underline mr-1",children:"Docs"}),(0,r.jsx)(a.lth,{})]})]})]}),(0,r.jsx)(c.a,{fileInfo:null==n?void 0:n.deploy.preDeployCommand,children:(0,r.jsx)(s.j,{value:null!=d?d:"",label:{text:"Pre-deploy command",hidden:!0},readOnly:u||(null==n?void 0:n.deploy.preDeployCommand)!=null,isStaged:p,placeholder:"npm run migrate",onChange:i})})]})},u={id:"pre-deploy-command",group:"Deploy",tags:["predeploy","pre-deploy","command","pre-deploy command","predeploy command"],isAvailable(e){var t;let{serviceInstanceConfig:n}=e;return!(null==(t=n.deploy)?void 0:t.cronSchedule)},render:e=>{let{service:t,manifestFileInfo:n,serviceInstanceConfig:l,stagedServiceInstanceConfig:a,permissions:s}=e,{updateServiceConfig:o}=(0,i.w)(t.id),c=null==l?void 0:l.deploy;if(!(null==c?void 0:c.preDeployCommand))return null;let u=c.preDeployCommand;return 0===u.length&&(u=[""]),u.map((e,t)=>{var l;return(0,r.jsx)(d,{id:"pre-deploy-command",manifestFileInfo:n,readOnly:!s.Write,isStaged:(null==a||null==(l=a.deploy)?void 0:l.preDeployCommand)!=null,value:e,onChange:e=>o({deploy:{preDeployCommand:""===e.trim()?null:[e.trim()]}})},t)})[0]}}},33321:(e,t,n)=>{"use strict";n.d(t,{S:()=>i});var r=n(50979),l=n(36609);function i(e){var t;let{serviceInstanceConfig:n,serviceInstance:i,className:a}=e,o=null==i?void 0:i.railpackInfo;return(null==(t=n.build)?void 0:t.builder)!="RAILPACK"||null==o?null:(0,r.jsx)("div",{className:(0,l.xW)("flex gap-x-2 items-center text-gray-300",a),children:(0,r.jsx)(s,{railpackInfo:o})})}let a=["node","bun","python","ruby","rust","go","php","java","deno","ruby"],s=e=>{var t;let{railpackInfo:n}=e;return(0,r.jsx)(r.Fragment,{children:Object.entries(null!=(t=n.resolvedPackages)?t:{}).map(e=>{let[t,n]=e;return null!=n&&a.includes(t)?(0,r.jsxs)("span",{className:"flex items-center gap-x-2 text-sm",children:[(0,r.jsx)("img",{src:"https://devicons.railway.com/".concat(t),className:"w-4 h-4",alt:n.resolvedVersion}),t,"@",null==n?void 0:n.resolvedVersion]},t):null})})}},38023:(e,t,n)=>{"use strict";n.d(t,{E:()=>l});var r=n(25963);let l=e=>(0,r.useMemo)(()=>null!=e&&e.startsWith("*."),[e])},38982:(e,t,n)=>{"use strict";n.d(t,{z:()=>d});var r=n(50979);n(25963);var l=n(70375),i=n(47654),a=n(95662),s=n(42419),o=n(45588),c=n(45479);let d=()=>{let{routes:e}=(0,l.c)(),[{featureFlags:t}]=(0,o.Jd)(),n=t.includes(c.Fev.CredentialsTab),d="Warning: Postgres authentication change",u="Warning: MySQL authentication change",p="Warning: MongoDB authentication change",m=(0,r.jsxs)(a.T,{space:3,children:[(0,r.jsx)(s.EY,{children:"This will manually change the username variable without updating the actual database username."}),(0,r.jsxs)(a.T,{space:2,children:[(0,r.jsx)(s.EY,{className:"font-medium",children:"What will happen:"}),(0,r.jsxs)("ul",{className:"space-y-1 ml-4",children:[(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-red-500 mt-0.5",children:"⚠"}),(0,r.jsx)("span",{children:"Database will still use the old username internally"})]}),(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-red-500 mt-0.5",children:"⚠"}),(0,r.jsx)("span",{children:"Applications may try to connect with the new username and fail"})]})]})]}),n&&(0,r.jsxs)("div",{className:"bg-secondaryBg dark:bg-gray-100 border border-gray-100 rounded-lg p-4",children:[(0,r.jsx)(s.EY,{className:"font-semibold",children:"\uD83D\uDCA1 Recommended solution:"}),(0,r.jsxs)(s.EY,{className:"mt-1",children:["Use the"," ",(0,r.jsx)(i.N,{variant:"underline",className:"font-semibold",...e.projectServiceData({}),children:"Credentials panel in the Data tab"})," ","to safely regenerate the database username."]})]})]}),h=(0,r.jsxs)(a.T,{space:3,children:[(0,r.jsx)(s.EY,{children:"This will manually change the password variable without updating the actual database password."}),(0,r.jsxs)(a.T,{space:2,children:[(0,r.jsx)(s.EY,{className:"font-medium",children:"What will happen:"}),(0,r.jsxs)("ul",{className:"space-y-1 ml-4",children:[(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-red-500 mt-0.5",children:"⚠"}),(0,r.jsx)("span",{children:"Database will still use the old password internally"})]}),(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-red-500 mt-0.5",children:"⚠"}),(0,r.jsx)("span",{children:"Applications may try to connect with the new password and fail"})]})]})]}),n&&(0,r.jsxs)("div",{className:"bg-secondaryBg dark:bg-gray-100 border border-gray-100 rounded-lg p-4",children:[(0,r.jsx)(s.EY,{className:"font-semibold",children:"\uD83D\uDCA1 Recommended solution:"}),(0,r.jsxs)(s.EY,{className:"mt-1",children:["Use the"," ",(0,r.jsx)(i.N,{variant:"underline",className:"font-semibold",...e.projectServiceData({}),children:"Credentials panel in the Data tab"})," ","to safely regenerate the database password."]})]})]});return{variables:{PGUSER:{title:d,type:"user"},POSTGRES_USER:{title:d,type:"user"},PGPASSWORD:{title:d,type:"password"},POSTGRES_PASSWORD:{title:d,type:"password"},MYSQLUSER:{title:u,type:"user"},MYSQLPASSWORD:{title:u,type:"password"},MYSQL_ROOT_PASSWORD:{title:u,type:"password"},MONGOUSER:{title:p,type:"user"},MONGO_INITDB_ROOT_USERNAME:{title:p,type:"user"},MONGOPASSWORD:{title:p,type:"password"},MONGO_INITDB_ROOT_PASSWORD:{title:p,type:"password"},REDISUSER:{title:"Warning: Redis authentication change",type:"user"}},warnings:{USER_CHANGE_WARNING:m,PASSWORD_CHANGE_WARNING:h,COMBINED_CREDENTIALS_CHANGE_WARNING:(0,r.jsxs)(a.T,{space:3,children:[(0,r.jsx)(s.EY,{children:"This will manually change both the username and password variables without updating the actual database credentials."}),(0,r.jsxs)(a.T,{space:2,children:[(0,r.jsx)(s.EY,{className:"font-medium",children:"What will happen:"}),(0,r.jsxs)("ul",{className:"space-y-1 ml-4",children:[(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-red-500 mt-0.5",children:"⚠"}),(0,r.jsx)("span",{children:"Database will still use the old credentials internally"})]}),(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-red-500 mt-0.5",children:"⚠"}),(0,r.jsx)("span",{children:"Applications may try to connect with the new credentials and fail"})]})]})]}),n&&(0,r.jsxs)("div",{className:"bg-secondaryBg dark:bg-gray-100 border border-gray-100 rounded-lg p-4",children:[(0,r.jsx)(s.EY,{className:"font-semibold",children:"\uD83D\uDCA1 Recommended solution:"}),(0,r.jsxs)(s.EY,{className:"mt-1",children:["Use the"," ",(0,r.jsx)(i.N,{variant:"underline",className:"font-semibold",...e.projectServiceData({}),children:"Credentials panel in the Data tab"})," ","to safely regenerate the database credentials."]})]})]})}}}},39303:(e,t,n)=>{"use strict";n.d(t,{M:()=>x});var r=n(64162),l=n(95925),i=n(81154),a=n(72287),s=n(97865),o=n(55850),c=n(72898),d=n(32507),u=n(15857),p=n(66800),m=n.n(p);let h=[],x=e=>{var t,n,p,x,g,v,f,y,j,b,w;let{environmentId:N,projectId:k,serviceId:C,options:S={}}=e,{graphqlClient:E}=(0,o.q)(),I=(0,l.jE)(),A=["networking",N,C],D=(0,i.md)(d.Lp),R=(0,a.y3)(),P=!(null==D?void 0:D.latestDeployment)||(null==D||null==(n=D.latestDeployment)||null==(t=n.meta)?void 0:t.runtime)===r.PublicRuntime.V2,O=()=>{I.invalidateQueries({queryKey:(0,u.NU)(k)}),R.invalidateEnvironmentConfig()},{result:T,setQuery:M}=(0,s.W)(A,async()=>await E.networking({projectId:k,environmentId:N,serviceId:C}),{refetchInterval:null!=(j=S.refetchInterval)&&j,refetchOnMount:!1,staleTime:m()("30s"),enabled:null==(b=S.enabled)||b}),z=(0,c.n)(A,async e=>{let t=(await E.customDomainCreate({input:{environmentId:N,serviceId:C,domain:e.domain,projectId:k,targetPort:e.targetPort}})).customDomainCreate;return O(),t}),F=(0,c.n)(A,async e=>{let{id:t,targetPort:n}=e;await E.customDomainUpdate({id:t,environmentId:N,targetPort:n}),O()}),L=(0,c.n)(A,async e=>{null!=T.data&&M({...T.data,domains:{...T.data.domains,customDomains:T.data.domains.customDomains.filter(t=>t.id!==e)}}),await E.customDomainDelete({id:e}),O()}),W=(0,c.n)(A,async e=>{let{id:t,domain:n,targetPort:r}=e;null!=T.data&&M({...T.data,domains:{...T.data.domains,serviceDomains:T.data.domains.serviceDomains.map(e=>({...e,domain:n,targetPort:r}))}}),await E.serviceDomainUpdate({input:{environmentId:N,serviceId:C,serviceDomainId:t,domain:n,targetPort:r}}),O()}),U=(0,c.n)(A,async e=>{let{id:t}=e;null!=T.data&&M({...T.data,domains:{...T.data.domains,serviceDomains:T.data.domains.serviceDomains.filter(e=>e.id!==t)}}),await E.serviceDomainDelete({id:t}),O()}),_=(0,c.n)(A,async e=>{let{targetPort:t}=e;await E.serviceDomainCreate({input:{environmentId:N,serviceId:C,targetPort:t}}),O()}),V=(0,c.n)(A,async e=>{let{applicationPort:t}=e,n=(0,r.newEnvironmentConfig)(R.getStagedChanges()).updateService(C,{networking:{tcpProxies:{[t]:{}}}}).build();R.stageEnvironmentChanges({payload:n})}),B=(0,c.n)(A,async e=>{let{id:t}=e;null!=T.data&&M({...T.data,tcpProxies:T.data.tcpProxies.filter(e=>e.id!==t)}),await E.tcpProxyDelete({id:t}),R.invalidateEnvironmentConfig()}),G=(0,c.n)(A,async e=>{let{id:t}=e;await E.customDomainIssueCertificate({id:t}),await I.invalidateQueries({queryKey:(0,u.NU)(k)})}),Y=(0,c.n)(A,async e=>{let{id:t,edgeEntrypointId:n}=e;await E.updateDomainEdgeEntrypoint({domainId:t,projectId:k,environmentId:N,edgeEntrypointId:n}),R.invalidateEnvironmentConfig()}),$=(0,c.n)(A,async e=>{let{region:t}=e;return(await E.egressGatewayAssociationCreate({input:{environmentId:N,serviceId:C,region:t}})).egressGatewayAssociationCreate}),H=(0,c.n)(A,async()=>{await E.egressGatewayAssociationsClear({input:{environmentId:N,serviceId:C}})}),q=null!=(w=null==(g=T.data)||null==(x=g.serviceInstance)||null==(p=x.latestDeployment)?void 0:p.sockets)?w:h;return{...T,hasTargetPortFunctionalityAvailable:P,domains:null==(v=T.data)?void 0:v.domains,tcpProxies:null==(f=T.data)?void 0:f.tcpProxies,egressGateways:null==(y=T.data)?void 0:y.egressGateways,sockets:q,domainActions:{createCustomDomain:z,updateCustomDomain:F,deleteCustomDomain:L,createServiceDomain:_,updateServiceDomain:W,deleteServiceDomain:U,updateDomainEdgeEntrypoint:Y,createTcpProxy:V,deleteTcpProxy:B,issueCertificateForCustomDomain:G},egressGatewayActions:{createEgressAssociation:$,clearEgressAssociations:H}}}},41054:(e,t,n)=>{"use strict";n.d(t,{B:()=>i,L:()=>a});var r=n(25963),l=n(94834);let i=()=>{let[e,t]=(0,r.useState)({width:0,height:0}),n=(0,r.useRef)(null);return[e,(0,r.useCallback)(e=>{if(n.current&&(n.current.disconnect(),n.current=null),null!==e){let r=new l.default(e=>{if(!Array.isArray(e)||!e.length)return;let n=e[0];t({width:n.contentRect.width,height:n.contentRect.height})});n.current=r,r.observe(e),t({width:e.offsetWidth,height:e.offsetHeight})}return()=>{null!==e&&n.current&&n.current.unobserve(e)}},[])]},a=e=>{let[t,n]=(0,r.useState)({width:0,height:0}),i=(0,r.useCallback)(()=>{null!=e.current&&n((e=>({width:e.offsetWidth,height:e.offsetHeight}))(e.current))},[e,n]);return(0,r.useEffect)(()=>{if(null==e.current)return;let t=e.current;try{let e=new l.default(()=>{i()});return e.observe(t),()=>{e.unobserve(t)}}catch(e){}},[e.current,i]),(0,r.useEffect)(()=>{if(null!=e.current)return window.addEventListener("resize",i),()=>{window.removeEventListener("resize",i)}},[e.current,i]),(0,r.useEffect)(()=>{i();let e=setTimeout(()=>{i()},1e3);return()=>{clearTimeout(e)}},[e.current,i]),t}},42567:(e,t,n)=>{"use strict";Object.defineProperty(t,"Z",{enumerable:!0,get:function(){return r.createCanvasDocAPI}});var r=n(47497)},44661:(e,t,n)=>{"use strict";n.d(t,{S:()=>u});var r=n(50979),l=n(687),i=n(25963),a=n(71144),s=n(2551),o=n(13077),c=n(36609),d=n(76933);function u(e){let{disabled:t=!1,id:n,label:u,onChange:p,checked:m=!1,size:h="md",value:x,tooltip:g}=e,{track:v}=(0,a.j)(),f=(0,i.useCallback)(e=>{p&&(v({action:"Toggle",object:"checkbox",properties:{isChecked:e,id:n}}),p(!!e))},[p]),y=(0,c.xW)(["rounded","border","inline-flex items-center justify-center cursor-pointer","focus:outline-none focus-visible:ring-2 focus-visible:ring-pink-400","rdx-state-checked:bg-pink-500 border-pink-500","rdx-state-unchecked:border-gray-300","rdx-disabled:opacity-50","xs"===h&&"h-4 w-4","sm"===h&&"h-5 w-5","md"===h&&"h-6 w-6"]),j=(0,c.xW)(["text-white","xs"===h&&"h-3 w-3","sm"===h&&"h-4 w-4 p-0.5","md"===h&&"h-5 w-5 p-0.5"]),b=(0,c.xW)(["pl-3 select-none text-base cursor-pointer",t&&"opacity-50","xs"===h&&"text-xs","sm"===h&&"text-sm","md"===h&&"text-base",g&&"border-b border-dashed border-gray-300"]);return(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(l.bL,{"aria-labelledby":"".concat(n,"-label"),checked:m,className:y,disabled:t,id:n,value:x,onCheckedChange:f,children:(0,r.jsx)(l.C1,{children:(0,r.jsx)(o.In,{className:j,icon:s.Jlk,size:h})})}),u&&(0,r.jsx)(r.Fragment,{children:g?(0,r.jsx)(d.m,{side:"top",content:(0,r.jsx)(r.Fragment,{children:g}),children:(0,r.jsx)("label",{className:b,htmlFor:n,id:"".concat(n,"-label"),children:u})}):(0,r.jsx)("label",{className:b,htmlFor:n,id:"".concat(n,"-label"),children:u})})]})}},44765:(e,t,n)=>{"use strict";n.d(t,{e:()=>a});var r=n(12725),l=n(24554),i=n(44039);let a=(0,l.eU)(e=>{var t;let n=e(i.xX);if((null==n||null==(t=n.source)?void 0:t.upstreamUrl)==null||null==n.source.repo)return{upstreamGitUrl:null,sourceIsUpstreamUrl:!1};let l=(0,r.parseGitUrl)(n.source.upstreamUrl);return null==l?{upstreamGitUrl:null,sourceIsUpstreamUrl:!1}:{upstreamGitUrl:l,sourceIsUpstreamUrl:l.repo===n.source.repo}})},47497:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createCanvasDocAPI",{enumerable:!0,get:function(){return s}});var r=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=i(t);if(n&&n.has(e))return n.get(e);var r={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=l?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(r,a,s):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}(n(82801));function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(i=function(e){return e?n:t})(e)}function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,l=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=l){var i=[],a=!0,s=!1;try{for(l=l.call(e);!(a=(n=l.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){s=!0,r=e}finally{try{a||null==l.return||l.return()}finally{if(s)throw r}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e){var t=e.getMap("positions"),n=e.getMap("groupRefs"),l=e.getMap("groups"),i=e.getText("initializedAt");return{setPosition:function(e,n){t.set(e,n)},getPosition:function(e){var n;return null!=(n=t.get(e))?n:null},getAllPositions:function(){var e=new Map;return t.forEach(function(t,n){e.set(n,t)}),e},setMultiplePositions:function(n){e.transact(function(){n.forEach(function(e,n){t.set(n,e)})})},deletePosition:function(e){t.delete(e)},getPositionsCount:function(){return t.size},createGroup:function(t,i){e.transact(function(){var e=new r.Map;Object.entries(t).forEach(function(t){var n=a(t,2),r=n[0],l=n[1];e.set(r,l)}),l.set(t.id,e);var s=!0,o=!1,c=void 0;try{for(var d,u=i[Symbol.iterator]();!(s=(d=u.next()).done);s=!0){var p=d.value;n.set(p,t.id)}}catch(e){o=!0,c=e}finally{try{s||null==u.return||u.return()}finally{if(o)throw c}}})},updateGroup:function(t,n){var r=l.get(t);r&&e.transact(function(){Object.entries(n).forEach(function(e){var t=a(e,2),n=t[0],l=t[1];r.set(n,l)})})},removeGroup:function(t){e.transact(function(){l.delete(t);var e=[];n.forEach(function(n,r){n===t&&e.push(r)}),e.forEach(function(e){n.delete(e)})})},getGroup:function(e){var t=l.get(e);return t?t.toJSON():null},getAllGroups:function(){var e=new Map;return l.forEach(function(t,n){e.set(n,t.toJSON())}),e},hasGroup:function(e){return l.has(e)},setNodeGroup:function(e,t){n.set(e,t)},getNodeGroup:function(e){var t;return null!=(t=n.get(e))?t:null},removeNodeFromGroup:function(e){n.delete(e)},getAllGroupRefs:function(){var e=new Map;return n.forEach(function(t,n){e.set(n,t)}),e},serialize:function(){var e={};l.forEach(function(t,n){e[n]=t.toJSON()});var r={};n.forEach(function(e,t){r[t]=e});var i={};return t.forEach(function(e,t){i[t]=e}),{groups:e,groupRefs:r,positions:i}},import:function(i){e.transact(function(){t.clear(),n.clear(),l.clear();var e=!0,s=!1,o=void 0;try{for(var c,d=Object.entries(i.groups)[Symbol.iterator]();!(e=(c=d.next()).done);e=!0)!function(){var e=a(c.value,2),t=e[0],n=e[1],i=new r.Map;Object.entries(n).forEach(function(e){var t=a(e,2),n=t[0],r=t[1];i.set(n,r)}),l.set(t,i)}()}catch(e){s=!0,o=e}finally{try{e||null==d.return||d.return()}finally{if(s)throw o}}var u=!0,p=!1,m=void 0;try{for(var h,x=Object.entries(i.groupRefs)[Symbol.iterator]();!(u=(h=x.next()).done);u=!0){var g=a(h.value,2),v=g[0],f=g[1];n.set(v,f)}}catch(e){p=!0,m=e}finally{try{u||null==x.return||x.return()}finally{if(p)throw m}}var y=!0,j=!1,b=void 0;try{for(var w,N=Object.entries(i.positions)[Symbol.iterator]();!(y=(w=N.next()).done);y=!0){var k=a(w.value,2),C=k[0],S=k[1];t.set(C,S)}}catch(e){j=!0,b=e}finally{try{y||null==N.return||N.return()}finally{if(j)throw b}}})},reset:function(){e.transact(function(){t.clear(),n.clear(),l.clear()})},serializeCompressed:function(){return{positions:Array.from(t.entries()).map(function(e){var t=a(e,2),n=t[0],r=t[1];return"".concat(n,":x").concat(r.x,"y").concat(r.y)}).join(","),groups:Array.from(l.entries()).map(function(e){return a(e,2)[1].get("name")||"unnamed"}).join(","),groupRefs:Array.from(n.entries()).filter(function(e){return null!=a(e,2)[1]}).map(function(e){var t=a(e,2),n=t[0],r=t[1];return"".concat(n,":").concat(r)}).join(",")}},getInitializedAt:function(){return i.toString()},setInitializedAt:function(e){i.delete(0,i.length),i.insert(0,e)},observePositions:function(e){return t.observe(e),function(){return t.unobserve(e)}},observeGroups:function(e){return l.observeDeep(e),function(){return l.unobserveDeep(e)}},observeGroupRefs:function(e){return n.observe(e),function(){return n.unobserve(e)}},observeInitializedAt:function(e){return i.observe(e),function(){return i.unobserve(e)}},transact:function(t,n){e.transact(t,n)},_raw:{positions:t,groupRefs:n,groups:l,initializedAt:i}}}},47655:(e,t,n)=>{"use strict";n.d(t,{r:()=>j});var r=n(50979),l=n(94621),i=n(2551),a=n(36609),s=n(31754),o=n(13025),c=n(25963),d=n(28592),u=n(13077),p=n(71144);let m=e=>{let{value:t,variableName:n,...l}=e,[c,m]=(0,d.T)(),{track:h}=(0,p.j)(),x=async()=>{null!=t&&(m(t),h({action:"Copy",object:"Variable",properties:{variableName:n}}))};return(0,r.jsx)(r.Fragment,{children:c?(0,r.jsx)("span",{className:"inline-flex items-center justify-center px-1 w-xs",children:(0,r.jsx)(o.P.span,{initial:{y:10},animate:{y:0},children:(0,r.jsx)(u.In,{icon:i.Jlk,size:"sm"})})}):(0,r.jsx)(s.K0,{icon:i.QRo,size:"xs",title:"Copy Variable",onClick:e=>{e.stopPropagation(),x()},...l,className:(0,a.xW)("focus:ring-0",l.className)})})};var h=n(41220),x=n(80374),g=n(47654),v=n(95662),f=n(42419);let y=e=>{let{variableName:t,publicEndpointReferences:n,serviceId:l,serviceIdsAndNames:a,...o}=e,[d,u]=(0,c.useState)(!1),p=()=>{u(!1)};return n&&n.length?(0,r.jsxs)(h.bL,{open:d,children:[(0,r.jsx)(h.l9,{children:(0,r.jsx)(s.K0,{icon:i.R2D,size:"xs",title:"Public endpoint warning",color:"yellow",onClick:()=>{u(!d)},...o})}),(0,r.jsx)(h.ZL,{children:(0,r.jsxs)(h.UC,{sideOffset:5,className:"px-6 py-4 z-40 lg:min-w-[482px] w-[400px] shadow-sm bg-background rounded-lg border border-black border-opacity-[7%] dark:border-white dark:border-opacity-[7%]",onPointerDownOutside:p,onEscapeKeyDown:e=>{e.stopPropagation(),p()},onFocusOutside:p,onInteractOutside:p,children:[(0,r.jsxs)(v.T,{children:[(0,r.jsxs)(f.EY,{children:["This variable references a public endpoint through"," ",(0,x.V$)("this","these",n.length)," ",(0,x.td)("variable",n.length),":"]}),(0,r.jsx)(f.B8,{className:"my-4",children:n.map((e,t)=>(0,r.jsx)(f.ck,{className:"mb-1",children:e.map(e=>{let t=e.split("."),n=t[0],r=t[1];if(n===l)return r;let i=null==a?void 0:a[n];return"".concat(i,".").concat(r)}).join(" -> ")},t))}),(0,r.jsxs)(f.EY,{className:"mb-4",children:["Connecting to a public endpoint will incur egress fees. That might happen if this variable, ",t,", is used to establish a connection to a database or another service."]}),(0,r.jsxs)(f.EY,{children:["You can avoid the egress fees by switching to a private endpoint (e.g., RAILWAY_PRIVATE_DOMAIN). Check out our"," ",(0,r.jsx)(g.N,{variant:"underline",href:"https://docs.railway.com/guides/private-networking#using-reference-variables",children:"documentation"})," ","for more information!"]})]}),(0,r.jsx)(h.bm,{className:"inline-flex justify-center items-center absolute top-2 right-2 w-4 h-4 text-gray-400",onClick:p,children:(0,r.jsx)(i.X,{})}),(0,r.jsx)(h.i3,{className:"fill-black opacity-[7%] dark:fill-white dark:opacity-[7%]"})]})})]}):(0,r.jsx)(r.Fragment,{})},j=e=>{var t;let{renderedValue:n,variableName:o,value:c,isSealed:d,publicEndpointReferences:u,serviceId:p,serviceIdsAndNames:h,permissions:x}=e,[g,v]=(0,l.E)(!1,1e4),f=null!=n?n:c,j=null!=f&&g&&!d?f:"*******",b=!d&&(null==(t=null==x?void 0:x.Write)||t)&&null!=f;return(0,r.jsxs)("div",{className:"flex items-center h-full text-sm",children:[(0,r.jsx)("div",{className:"font-mono whitespace-pre min-w-[60px] max-h-[15vh] h-full",children:j.length>0?(0,r.jsx)("div",{className:(0,a.xW)("whitespace-pre-wrap break-all",g?"p-2 border rounded -ml-2 max-h-[15vh] overflow-y-auto":""),children:j}):(0,r.jsx)("span",{"aria-hidden":!0,className:"italic text-gray-500 select-none",children:"<empty string>"})}),b&&(0,r.jsxs)("div",{className:"flex whitespace-nowrap flex-nowrap justify-end ml-2 space-x-0.5",children:[(0,r.jsx)(s.K0,{icon:g?i.X_F:i.kU3,name:"".concat(g?"Mask":"Reveal"," Variable"),size:"xs",onClick:()=>v(!g),title:g?"Hide value":"Show value",className:"lg:opacity-0 lg:group-hover:opacity-100 lg:focus:opacity-100 lg:focus:ring-0 reveal"}),(0,r.jsx)(m,{variableName:o,value:f,title:"Copy value",className:(0,a.xW)("lg:opacity-0 lg:group-hover:opacity-100 lg:focus:opacity-100")}),!!u&&!!u.length&&(0,r.jsx)(y,{variableName:o,publicEndpointReferences:u,serviceId:p,serviceIdsAndNames:h})]})]})}},49368:(e,t,n)=>{"use strict";n.d(t,{Y:()=>i});var r=n(42567),l=n(82801);function i(){let e=new l.Doc({gc:!0}),t=(0,r.Z)(e);return{doc:e,undoManager:new l.UndoManager([t._raw.positions,t._raw.groups,t._raw.groupRefs]),...t}}},49767:(e,t,n)=>{"use strict";n.d(t,{$0:()=>A,FE:()=>D,Ij:()=>F,M7:()=>M,O5:()=>I,Sc:()=>W,X4:()=>C,XY:()=>E,a:()=>R,fA:()=>S,fV:()=>T,ix:()=>z,o8:()=>O,r5:()=>P,zl:()=>U});var r=n(86739),l=n(50979),i=n(30595),a=n(2551),s=n(45588),o=n(73648),c=n(36609),d=n(82660),u=n(13077),p=n(47654),m=n(81009),h=n(42419);function x(){let e=(0,r._)([""]);return x=function(){return e},e}function g(){let e=(0,r._)(["grid gap-1 mb-3"]);return g=function(){return e},e}function v(){let e=(0,r._)(["text-sm text-gray-600"]);return v=function(){return e},e}function f(){let e=(0,r._)(["flex flex-col"]);return f=function(){return e},e}function y(){let e=(0,r._)(["text-sm font-semibold mb-3"]);return y=function(){return e},e}function j(){let e=(0,r._)(["mb-4"]);return j=function(){return e},e}function b(){let e=(0,r._)(["space-y-1 mt-4 mb-8"]);return b=function(){return e},e}function w(){let e=(0,r._)(["\n  grid grid-cols-12 py-8 border-t border-gray-100 max-w-4xl\n"]);return w=function(){return e},e}function N(){let e=(0,r._)(["col-span-12 md:col-span-4 md:pb-0"]);return N=function(){return e},e}let k={Source:a.CyN,Networking:a.lgv,"Config-as-code":a.iUU,Build:a.azJ,Deploy:a.Esr,Danger:a.szm,Connection:a.dmT,Region:a.qzq,Size:a._qR,Data:a.WmV,Alerts:a.RIJ,"Feature-flags":a.lNU},C=e=>{let{group:t,children:n}=e;return(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("div",{id:t.toLowerCase(),className:"absolute -top-24","aria-hidden":!0}),(0,l.jsx)(u.In,{icon:k[t]?k[t]:a.jlt,className:(0,c.xW)("absolute !hidden sm:!flex top-[-6px] left-[-22px] bg-background dark:bg-secondaryBg border rounded-full p-[10px]","Danger"===t?"text-red-500 border-red-200":"text-gray-500 border-gray-200"),size:"40"}),"Danger"!==t&&(0,l.jsx)(h.f_,{as:"h1",className:"text-gray-600 font-medium mb-8 sm:pl-10",children:t}),(0,l.jsx)("div",{className:"grid gap-8 max-w-xl sm:pl-10",children:n})]})},S=e=>{let{id:t,className:n,children:r}=e;return(0,l.jsx)(p.N,{href:"#".concat(t),className:(0,c.xW)("text-sm font-semibold cursor-pointer",n),as:"h2",children:r})},E=c.qy.div(x()),I=c.qy.header(g()),A=c.qy.h2(v()),D=e=>{let{className:t,isStaged:n,isError:r,children:i,...a}=e;return(0,l.jsx)("div",{...a,className:(0,c.xW)("px-4 py-2 bg-secondaryBg dark:bg-[#201F2D] border border-gray-100 rounded-md shadow-sm",n&&"bg-pink-50 border-pink-100 text-pink-600",r&&"border-red-500",t),children:i})},R=e=>{var t;let{fileInfo:n,children:r}=e;return(null==n?void 0:n.pathInFile)==null?(0,l.jsx)(l.Fragment,{children:r}):(0,l.jsxs)("div",{className:"max-w-xl bg-[#f7f7f8] dark:bg-[#1C1A28] rounded-md pb-1",children:[(0,l.jsxs)("div",{className:"px-3 py-2 flex space-x-2 text-sm justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center truncate text-overflow",children:[(0,l.jsx)(u.In,{icon:a.R2D,size:"sm",className:"text-neutral-secondary mr-2"}),"The value is set in"," ",(0,l.jsx)("span",{className:"font-bold font-mono ml-1 truncate text-overflow",title:null!=(t=n.configFile)?t:void 0,children:n.configFile})]}),n.url?(0,l.jsxs)(p.N,{href:n.url,className:"text-gray-600",children:[(0,l.jsx)("span",{className:"mr-1 hover:underline",children:"Open\xa0file"}),(0,l.jsx)(a.lth,{})]}):null]}),(0,l.jsx)("div",{className:"cursor-not-allowed [&_*]:cursor-not-allowed !text-gray-600 mx-1 !bg-secondaryBg",children:(0,l.jsx)("div",{className:"pointer-events-none [&_*]:pointer-events-none",children:r})})]})},P=e=>{let{children:t,fallbackText:n="This feature is only available for the Pro plan",moreInformationLink:r="https://railway.com/workspace/plans"}=e,[{user:i}]=(0,s.Jd)(),{isPro:c}=(0,o.hA)();return c||(null==i?void 0:i.isAdmin)?(0,l.jsx)(l.Fragment,{children:t}):(0,l.jsx)(d.l,{variant:"primary",size:"sm",className:"mb-3 gap-3 ",children:(0,l.jsxs)("div",{className:"flex items-center justify-between gap-2 w-full flex-wrap",children:[(0,l.jsx)("p",{children:n}),(0,l.jsxs)(p.N,{url:r,className:"block group",children:[(0,l.jsx)("span",{className:"mr-1 group-hover:underline",children:"More information"}),(0,l.jsx)(a.lth,{})]})]})})},O=c.qy.div(f()),T=c.qy.label(y()),M=(0,c.DR)(h.xC)(j()),z=c.qy.header(b()),F=c.qy.div(w()),L=c.qy.div(N()),W="col-span-12 md:col-span-8 md:col-start-5 space-y-8",U=e=>{let{title:t,danger:n,children:r,...s}=e,[o,d]=(0,i.A)("@railway/serviceSettings/".concat(t),{defaultValue:!0});return(0,l.jsxs)(F,{...s,children:[(0,l.jsx)(L,{children:(0,l.jsxs)("button",{"aria-controls":t,"aria-expanded":!!o&&"true",onClick:()=>{d(!o)},className:"flex items-center space-x-3 w-full",children:[(0,l.jsx)(u.In,{icon:o?a.yQN:a.rXn,className:n?"text-red-500":"text-gray-500"}),(0,l.jsx)(h.TT,{className:n?"text-red-500":"",children:t})]})}),(0,l.jsx)(m.M,{isOpen:o,className:(0,c.xW)("col-span-12 md:col-span-8 md:col-start-5 space-y-8","pt-8 md:pt-0"),children:r})]})}},49817:(e,t,n)=>{"use strict";n.d(t,{G2:()=>g,jr:()=>v});var r=n(50979),l=n(25963),i=n(70375),a=n(50655),s=n(2551),o=n(31754),c=n(65910),d=n(13077),u=n(47654),p=n(49767),m=n(28266);let h=/^\s*[\w.${}-]+(?:\s+[\w.${}-]+)*(?:\s*&&\s*[\w.${}-]+(?:\s+[\w.${}-]+)*)*\s*$/;var x=n(64162);let g=e=>{let{id:t,manifestFileInfo:n,onChange:a,value:d,readOnly:m,isStaged:h}=e,{routes:x}=(0,i.c)(),[g,v]=(0,l.useState)(!1);return(0,r.jsxs)(p.XY,{id:t,children:[(0,r.jsxs)(p.O5,{children:[(0,r.jsx)(p.fA,{id:t,children:"Custom Start Command"}),(0,r.jsxs)(p.$0,{children:["Command that will be run to start new deployments."," ",(0,r.jsxs)(u.N,{external:!0,variant:"highlight",...x.docs({page:"/guides/start-command"}),children:[(0,r.jsx)("span",{className:"underline mr-1",children:"Docs"}),(0,r.jsx)(s.lth,{})]})]})]}),(0,r.jsx)(p.a,{fileInfo:null==n?void 0:n.deploy.startCommand,children:g||d?(0,r.jsx)(c.j,{autoFocus:g,value:null!=d?d:"",label:{text:"Start command",hidden:!0},readOnly:m||(null==n?void 0:n.deploy.startCommand)!=null,isStaged:h,placeholder:"npm run start",onChange:a}):(0,r.jsx)(o.$n,{disabled:m,size:"sm",variant:"outline",color:"gray",icon:s.FWt,onClick:()=>v(!0),children:"Start Command"})})]})},v={id:"deploy-start-command",group:"Deploy",tags:["start","command","start command","predeploy"],render:e=>{var t,n,l;let{service:i,manifestFileInfo:s,serviceInstanceConfig:o,stagedServiceInstanceConfig:c,permissions:d}=e,{updateServiceConfig:u}=(0,a.w)(i.id),p=null==o?void 0:o.deploy,m=null!=(l=null==p?void 0:p.startCommand)?l:"",x=!(null==(t=o.deploy)?void 0:t.cronSchedule),v=!(null==p?void 0:p.preDeployCommand),y=x&&v&&function(e){return h.test(e)?e.split("&&").map(e=>e.trim()).filter(e=>""!==e):[e]}(m);return(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)(g,{id:"deploy-start-command",manifestFileInfo:s,readOnly:!d.Write,isStaged:(null==c||null==(n=c.deploy)?void 0:n.startCommand)!=null,value:null==p?void 0:p.startCommand,onChange:e=>{u({deploy:{startCommand:""===e.trim()?null:e.trim()}})}}),y&&(0,r.jsx)(f,{commands:y,serviceId:i.id})]})},isAvailable(e){let{serviceInstanceConfig:t}=e;return!(0,x.isFunctionService)(t)}};function f(e){let{commands:t,serviceId:n}=e,{routes:l}=(0,i.c)(),{updateServiceConfig:o}=(0,a.w)(n),c=(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("span",{className:"underline group-hover:text-pink-600",children:["Run ",(0,r.jsx)("code",{children:t.slice(0,-1).join(" && ")})]})," ","in a pre-deploy step"]});return 1===t.length&&(c=(0,r.jsx)("span",{className:"underline group-hover:text-pink-600",children:"Add pre-deploy step"})),(0,r.jsxs)("div",{className:"group mt-3 text-sm text-gray-500 grid gap-1 grid-cols-[min-content,auto] cursor-pointer",onClick:e=>{o({deploy:{preDeployCommand:[1===t.length?"":t.slice(0,-1).join(" && ")],startCommand:t.at(-1)}}),(0,m.flushSync)(()=>{requestAnimationFrame(()=>{var e,t;null==(t=document.getElementById("pre-deploy-command"))||null==(e=t.querySelector("input"))||e.focus()})})},children:[(0,r.jsx)(d.In,{icon:s.FWt,size:"sm",className:"mt-0.5 group-hover:text-pink-600"}),(0,r.jsxs)("div",{children:[c," (",(0,r.jsxs)(u.N,{variant:"highlight",...l.docs({page:"/guides/pre-deploy-command"}),onClick:e=>{e.stopPropagation()},children:[(0,r.jsx)("span",{className:"mr-1",children:"Docs"}),(0,r.jsx)(s.lth,{})]}),")"]})]})}},50825:(e,t,n)=>{"use strict";n.d(t,{Q:()=>a});var r=n(22986),l=n(25963);let i=()=>window.location.hash.replace("#",""),a=()=>{let[e,t]=(0,l.useState)(i()),n=(0,r.useRouter)();return(0,l.useEffect)(()=>{let e=()=>{t(i())};return e(),window.addEventListener("hashchange",e),n.events.on("routeChangeComplete",e),()=>{window.removeEventListener("hashchange",e),n.events.off("routeChangeComplete",e)}},[n.events]),e}},55212:(e,t,n)=>{var r=n(25963);function l(e){return r.createElement("svg",e,[r.createElement("g",{clipPath:"url(#clip0_10_5253)",key:0},[r.createElement("path",{d:"M0 0H24V5.33333H0V0Z",fill:"#AE1C28",key:0}),r.createElement("path",{d:"M0 5.33325H24V10.6666H0V5.33325Z",fill:"white",key:1}),r.createElement("path",{d:"M0 10.6667H24V16.0001H0V10.6667Z",fill:"#21468B",key:2})]),r.createElement("rect",{x:"0.4",y:"0.4",width:"23.2",height:"15.2",rx:"2.8",stroke:"black",strokeOpacity:"0.075",strokeWidth:"0.8",key:1}),r.createElement("defs",{key:2},r.createElement("clipPath",{id:"clip0_10_5253"},r.createElement("rect",{width:"24",height:"16",rx:"3.2",fill:"white"})))])}l.defaultProps={width:"24",height:"16",viewBox:"0 0 24 16",fill:"none"},e.exports=l,l.default=l},56014:(e,t,n)=>{"use strict";n.d(t,{O:()=>k,W:()=>C});var r=n(50979),l=n(64162),i=n(81154),a=n(25963),s=n(61649),o=n(76488),c=n(70375),d=n(2551),u=n(44765),p=n(72287),m=n(31754),h=n(65910),x=n(13077),g=n(47654),v=n(95662),f=n(42419),y=n(13934),j=n(49767),b=n(50825),w=n(49385),N=n(1758);let k=e=>{let{value:t,onChange:n,readOnly:l,isStaged:i,autoFocus:a}=e,{routes:s}=(0,c.c)();return(0,r.jsxs)(j.XY,{id:"root-directory",className:"mt-8",children:[(0,r.jsxs)(j.O5,{children:[(0,r.jsx)(j.fA,{children:"Root Directory"}),(0,r.jsxs)(j.$0,{children:["Configure where we should look for your code."," ",(0,r.jsxs)(g.N,{variant:"highlight",...s.docs({page:"/deploy/builds#build-command"}),children:[(0,r.jsx)("span",{className:"underline mr-1",children:"Docs"}),(0,r.jsx)(d.lth,{})]})]})]}),(0,r.jsx)(h.j,{autoFocus:a,placeholder:"/",isStaged:i,value:null!=t?t:"",readOnly:l,label:{text:"Root directory",hidden:!0},onChange:n})]})},C={id:"source-repo",group:"Source",tags:["repo","github","git","root","directory"],render:e=>{var t,n,h,C;let{id:S,service:E,serviceInstanceConfig:I,stagedServiceInstanceConfig:A,permissions:D}=e,R=(0,l.getRepoSource)(I.source),P=(0,i.md)(u.e),O=(0,p.y3)(),{routes:T}=(0,c.c)(),{isCommandPaletteOpen:M,openOrUpdateActiveCommandGroup:z}=(0,s.oG)(),F=(0,N.F)(O),L=(0,a.useCallback)(e=>({value:"connect-repo-".concat(e.id),text:e.fullName,icon:d.gqo,isPrivate:e.isPrivate,group:"",action:()=>F.current.stageServiceChanges({serviceId:E.id,payload:{source:{repo:e.fullName,branch:e.defaultBranch,image:null}}})}),[F,E.id]),W=(0,w.DB)({prompt:"Enter a new GitHub repo",crumbs:["Edit GitHub repo"],renderRepoCommand:L}),U=(0,o.QB)({fullName:null==R?void 0:R.repo,enabled:D.Write&&!P.sourceIsUpstreamUrl}),_=(0,b.Q)(),[V,B]=(0,a.useState)("root-directory"===_);return((0,a.useEffect)(()=>{M&&z(W)},[M,W]),null==R)?null:(0,r.jsxs)(j.XY,{id:S,children:[(0,r.jsx)(j.O5,{children:(0,r.jsx)(j.fA,{id:S,children:"Source Repo"})}),(0,r.jsxs)(j.FE,{className:"flex",isStaged:(null==A||null==(t=A.source)?void 0:t.repo)!=null,isError:null!=U.error,children:[(0,r.jsxs)(g.N,{href:"https://github.com/".concat(R.repo),className:"flex items-center flex-grow space-x-3 min-w-0",children:[(0,r.jsx)(x.In,{icon:d.gqo}),(0,r.jsxs)(f.EY,{className:"truncate flex-grow space-x-2",children:[(0,r.jsx)("span",{className:"group-hover:underline",children:R.repo})," ",(0,r.jsx)("span",{"aria-hidden":!0,className:"hidden group-hover:inline text-gray-500",children:"↗"})]})]}),(0,r.jsx)(y.n4,{children:(0,r.jsxs)(v.z,{space:2,align:"center",children:[(0,r.jsx)(m.K0,{icon:d.W7n,title:"Edit",onClick:()=>{z(W)}}),(0,r.jsx)(m.$n,{size:"xs",variant:"outline",color:"gray",onClick:()=>O.stageServiceChanges({serviceId:E.id,payload:{source:{repo:null,branch:null,upstreamUrl:null,commitSha:null}}}),children:"Disconnect"})]})})]}),V||(null==(n=I.source)?void 0:n.rootDirectory)?(0,r.jsx)(k,{value:null==(h=I.source)?void 0:h.rootDirectory,autoFocus:V,readOnly:!D.Write,isStaged:(null==A||null==(C=A.source)?void 0:C.rootDirectory)!=null,onChange:e=>O.stageServiceChanges({serviceId:E.id,payload:{source:{rootDirectory:e}}})}):(0,r.jsx)(y.n4,{children:(0,r.jsxs)("div",{className:"mt-3 text-sm text-gray-500",children:[(0,r.jsx)(m.z9,{variant:"underline",onClick:()=>{B(!0)},children:"Add Root Directory"})," ","(used for build and deploy steps."," ",(0,r.jsxs)(g.N,{variant:"highlight",...T.docs({page:"/deploy/builds#root-directory"}),children:[(0,r.jsx)("span",{className:"mr-1",children:"Docs"}),(0,r.jsx)(d.lth,{})]}),")"]})})]})},isAvailable:e=>{let{serviceInstanceConfig:t}=e;return null!=(0,l.getRepoSource)(t.source)}}},59613:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"parse",{enumerable:!0,get:function(){return r.parse}}),function(e,t){Object.keys(e).forEach(function(n){"default"===n||Object.prototype.hasOwnProperty.call(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[n]}})})}(n(71823),t);var r=n(868)},61208:(e,t,n)=>{"use strict";n.d(t,{lN:()=>m});var r=n(50979),l=n(9451),i=n.n(l),a=n(55212),s=n.n(a),o=n(91597),c=n.n(o),d=n(42419);let u={USA:"\uD83C\uDDFA\uD83C\uDDF8",Netherlands:"\uD83C\uDDF3\uD83C\uDDF1",Singapore:"\uD83C\uDDF8\uD83C\uDDEC",home:"\uD83C\uDFE0","almost home":"\uD83D\uDED6"},p={USA:i(),Netherlands:s(),Singapore:c(),home:null,"almost home":null},m=e=>{let{country:t}=e,n=p[t];return n?(0,r.jsx)(n,{className:"w-6 min-h-6"}):(0,r.jsx)(d.EY,{role:"img","aria-label":t,children:u[t]})}},62827:(e,t,n)=>{"use strict";n.d(t,{g:()=>b});var r=n(50979),l=n(64162),i=n(25963),a=n(13077),s=n(2551),o=n(47654),c=n(18407),d=n(47655),u=n(31754),p=n(70375),m=n(36609),h=n(95662),x=n(42419),g=n(37590),v=n(79060);let{shape:f}=l.railwayServiceProvidedVariablesSchema,{shape:y}=l.railwayDeprecatedServiceProvidedVariablesSchema;function j(e){let{onClick:t,name:n,value:l}=e,{isTemplateCreatePage:i}=(0,p.c)(),o=f[n].description;return(0,r.jsxs)(c.Ff,{className:"py-2 rounded-md gap-1 group",children:[(0,r.jsxs)("div",{className:"flex flex-col text-sm",children:[(0,r.jsx)("p",{className:(0,m.xW)("text-foreground",!i&&"truncate"),children:n}),(0,r.jsx)("p",{className:(0,m.xW)("font-sans text-xs pt-1 text-gray-500",!i&&"truncate"),children:o})]}),(0,r.jsx)("div",{className:(0,m.xW)("pl-3 pr-2 w-full",i&&"rounded-md py-2 pl-4 pr-4 bg-gray-100 break-all"),children:i?(0,r.jsxs)(h.z,{align:"center",space:4,children:[(0,r.jsx)(a.In,{icon:s.Uzy,size:"sm",className:"text-gray-500"}),(0,r.jsx)(x.xC,{children:"Populated after deploy"})]}):(0,r.jsx)(d.r,{variableName:n,value:l})}),(0,r.jsx)("div",{className:"justify-end",children:(0,r.jsx)(u.$n,{className:"opacity-20 group-hover:opacity-100 transition-opacity font-sans",color:"gray",size:"xs",onClick:()=>{t({name:n,description:o})},variant:"outline",children:"Reference"})})]})}function b(e){let{onClick:t,variables:n}=e,{routes:l}=(0,p.c)(),[a,s]=(0,i.useState)(!1),c=void 0===n,d=Object.keys(null!=n?n:{}).filter(e=>!!f[e]&&!y[e]),u=d.length,m=e=>{s(!1),t(e)};return(0,r.jsxs)(v.Z,{disabled:c,open:a,onOpenChange:e=>{s(e)},triggerClassName:"pt-0 pl-0",title:(0,r.jsxs)(r.Fragment,{children:[c&&(0,r.jsx)(g.g,{height:"20px",width:"260px"}),!c&&(0,r.jsxs)("p",{className:"text-sm",children:[u," Railway Provided Variables available"]})]}),children:[(0,r.jsxs)("p",{className:"text-sm px-4 pt-6 pb-4 text-gray-500 border-t border-gray-100",children:["Railway provides additional system environment variables to all builds and deployments."," ",(0,r.jsx)(o.N,{...l.docs({page:"/reference/variables#railway-provided-variables"}),className:"inline-flex",variant:"underline",children:"Learn more ↗"})]}),(0,r.jsx)("div",{className:"flex flex-col pb-6",children:!c&&d.map(e=>(0,r.jsx)(j,{onClick:m,name:e,value:n[e]},e))})]})}},65910:(e,t,n)=>{"use strict";n.d(t,{j:()=>m});var r=n(50979),l=n(25963),i=n(42113),a=n(2551),s=n(31754),o=n(61259),c=n(86954),d=n(95662),u=n(63344),p=n(36609);let m=e=>{var t,n;let{value:m,onChange:h,onEdit:x,textarea:g,isStaged:v,validate:f,suffix:y,onUpdateDirty:j,...b}=e,{register:w,watch:N,setValue:k,handleSubmit:C,formState:{errors:S}}=(0,i.mN)({mode:"all",defaultValues:{text:null==m?void 0:m.toString()}}),E=N().text,I=(0,l.useMemo)(()=>(null==m?void 0:m.toString())!==E,[E,m]);(0,l.useEffect)(()=>{j&&j(I)},[I]);let A=()=>{k("text",null==m?void 0:m.toString())};return(0,l.useEffect)(()=>{k("text",null==m?void 0:m.toString(),{shouldDirty:!1,shouldValidate:!1})},[m]),(0,l.useEffect)(()=>{null!=x&&null!=E&&x(E)},[E]),(0,r.jsxs)(o.lV,{enableBindings:!0,onSubmit:C(e=>{let{text:t}=e;null!=h&&h(null!=t?t:"")}),onCancel:A,className:(0,p.xW)("flex space-x-2","string"!=typeof b.label&&b.label.hidden?"items-start":"items-end"),children:[g?(0,r.jsx)(u.T,{error:null==(t=S.text)?void 0:t.message,...b,className:(0,p.xW)(v&&"bg-pink-50 text-pink-600 border-pink-100 hover:border-pink-400",b.className),...w("text",{validate:null!=f?e=>f(null!=e?e:""):void 0})}):(0,r.jsx)(c.pd,{error:null!=S.text?S.text.message||!0:void 0,...b,className:(0,p.xW)(v&&"bg-pink-50 text-pink-600 border-pink-100 hover:border-pink-400",b.className),...w("text",{validate:null!=f?e=>f(null!=e?e:""):void 0}),suffix:y}),I&&(null==(n=S.text)?void 0:n.message)==null&&(0,r.jsxs)(d.z,{space:1,className:"mt-1",children:[(0,r.jsx)(s.K0,{icon:a.X,title:"Cancel",type:"button",onClick:A}),(0,r.jsx)(s.K0,{icon:a.Jlk,title:"Save",type:"submit"})]})]})}},67044:(e,t,n)=>{"use strict";n.d(t,{Lu:()=>d,YM:()=>u,pO:()=>o,ph:()=>c}),n(25963);var r=n(24703);n(76043);var l=n(70375),i=n(52992),a=n(2631),s=n(9157);let o=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],{projectId:t,routes:n,navActions:s}=(0,l.c)(),{isModalOpen:o}=(0,i.h)(),c=(0,a.o)(o,250);(0,r.Z)({Escape:()=>{!c&&e&&null!=t&&s.push(n.project({projectId:t}))}},[t,c,e])},c=function(e,t){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{projectId:o,routes:c,navActions:d}=(0,l.c)(),{performCollapseGroup:u}=(0,s.m)(),{isModalOpen:p}=(0,i.h)(),m=(0,a.o)(p,250);(0,r.Z)({Escape:()=>{!m&&n&&null!=t&&null!=o&&(null!=e?u({navigatingFromGroup:e,navigatingToGroup:t}):d.push(c.project({projectId:o,groupId:t})))}},[o,m,t,n])},d=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],{projectId:t,serviceId:n,routes:i,navActions:a,query:s}=(0,l.c)();(0,r.Z)({Escape:()=>{if("string"==typeof s.start&&"string"==typeof s.end)return void a.push(i.projectServiceSchedule({}));e&&null!=t&&null!=n&&a.push(i.projectServiceDeployments({projectId:t,serviceId:n}))}},[t,n,e])},u=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],{isTemplateCreatePage:t,navActions:n,routes:i}=(0,l.c)();(0,r.Z)({Escape:()=>{t&&e&&n.push(i.templateCreate({}))}},[e,t])}},71823:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{parseTemplateText:function(){return p},collapseFunctions:function(){return m},renderText:function(){return h},normalizeText:function(){return x},renderObject:function(){return g},stripNestedContext:function(){return v},leafValueFromPath:function(){return f},findReferences:function(){return y},findReferencesFullyQualified:function(){return j},containsReference:function(){return b},getNamespace:function(){return w},getAllNamespaces:function(){return N},findDirectNamespaceReference:function(){return k},findDirectReference:function(){return C},hasOnlyVariables:function(){return S},containsDirectReference:function(){return E},prefixNestedSelfReferencingVariablesWithNamespace:function(){return I},namespaceTopLevelReferences:function(){return A},replaceNamespaces:function(){return D},buildTemplateTag:function(){return R},escapeNamespace:function(){return P},unescapeNamespace:function(){return O},hasFunctions:function(){return T},buildReferenceTree:function(){return M},findNestedReferences:function(){return z}});var r=n(14872),l=n(27569),i=n(868);function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}function o(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,l=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=l){var i=[],a=!0,s=!1;try{for(l=l.call(e);!(a=(n=l.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){s=!0,r=e}finally{try{a||null==l.return||l.return()}finally{if(s)throw r}}return i}}(e,t)||u(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||u(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(e,t)}}var p=i.parse;function m(e){var t=(0,i.parse)(e).map(r.executeNodeFunction);return(0,i.nodesToString)(t)}function h(e,t){var n=(0,i.parse)(t).map(r.executeNodeFunction),l="",a=!0,s=!1,o=void 0;try{for(var c,d=n[Symbol.iterator]();!(a=(c=d.next()).done);a=!0){var u=c.value;if("text"===u.type)l+=u.value;else if("reference"===u.type){var p=f(u.parts,e);l+=null!=p?p:""}}}catch(e){s=!0,o=e}finally{try{a||null==d.return||d.return()}finally{if(s)throw o}}return l}function x(e){return(0,i.nodesToString)((0,i.parse)(e))}function g(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=s({},(0,l.flattenObject)(I(e))),r=Object.keys(n).sort(),i=0;i<t;i++){var a=!1,o=(0,l.unflattenObject)(n),c=!0,d=!1,u=void 0;try{for(var p,m=r[Symbol.iterator]();!(c=(p=m.next()).done);c=!0){var x=p.value,g=n[x];if("string"==typeof g){var v=h(o,g);v!==g&&(a=!0,n[x]=v)}}}catch(e){d=!0,u=e}finally{try{c||null==m.return||m.return()}finally{if(d)throw u}}if(!a)break}return(0,l.unflattenObject)(n)}var v=function(e){var t={},n=!0,r=!1,l=void 0;try{for(var i,a=Object.keys(e)[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s=i.value,o=e[s];"string"==typeof o&&(t[s]=o)}}catch(e){r=!0,l=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw l}}return t},f=function(e,t){if(0===e.length)return t;var n=t[e[0]];if("string"==typeof n||"[object Object]"===Object.prototype.toString.call(n))return f(e.slice(1),n)};function y(e){return(0,i.parse)(e).flatMap(function(e){return"reference"===e.type?e.parts.join("."):[]})}function j(e,t){return(0,i.parse)(e).flatMap(function(e){if("reference"===e.type)if(1===e.parts.length)return"".concat(t,".").concat(e.parts[0]);else return e.parts.join(".");return[]})}function b(e,t){return y(e).includes(t)}function w(e){return e.split(".")[0]}function N(e){return d(new Set(y(e).map(w)))}function k(e){var t=C(e);return null==t?null:O(t.split(".")[0])}function C(e){var t=y(e);return 1===t.length&&E(e,t[0])?t[0]:null}function S(e){return""===h({},e)}function E(e,t){if(!S(e))return!1;var n=y(e);return 1===n.length&&n[0]===t}var I=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=s({},e),r=!0,l=!1,i=void 0;try{for(var a,o=Object.entries(e)[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var d=c(a.value,2),u=d[0],p=d[1];null==p?n[u]=p:"string"!=typeof p?n[u]=I(p,""!==t?"".concat(t,".").concat(u):u):""!==t&&(n[u]=A(p,t))}}catch(e){l=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(l)throw i}}return n};function A(e,t){return(0,i.nodesToString)((0,i.parse)(e).map(function(e){if("reference"===e.type&&1===e.parts.length){var n=[t].concat(d(e.parts));return o(s({},e),{parts:n})}return e}))}function D(e,t){return(0,i.nodesToString)((0,i.parse)(e).map(function(e){if("reference"===e.type){var n,r=e.parts.map(function(e){return null!=(n=t[e])?n:e});return o(s({},e),{parts:r})}return e}))}function R(e){var t=e.variableName,n=e.namespace;return null==n?"${{".concat(t,"}}"):"${{".concat(P(n),".").concat(t,"}}")}function P(e){return e.match(/[.\s{}[\]]/)?'"'.concat(e,'"'):e}function O(e){return e.startsWith('"')&&e.endsWith('"')?e.slice(1,-1):e}var T=function(e){return(0,i.parse)(e).some(function(e){return"function"===e.type})};function M(e){var t={},n=!0,r=!1,l=void 0;try{for(var i,a=Object.entries(e)[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s=c(i.value,2),o=s[0],d=s[1];if(null!=d){var u=w(o),p=j(d,u);0!==p.length&&(t[o]=p)}}}catch(e){r=!0,l=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw l}}return t}function z(e,t){var n={},r=s({},(0,l.flattenObject)(I(e),!0)),i=Object.keys(r).sort(),a=M(r),o=!0,d=!1,u=void 0;try{for(var p,m=i[Symbol.iterator]();!(o=(p=m.next()).done);o=!0)for(var h=p.value,x=[[h,[h]]],g=new Set;x.length>0;){var v=c(x.pop(),2),f=v[0],y=v[1];if(!g.has(f)){g.add(f);var j=a[f];if(j){var b=!0,w=!1,N=void 0;try{for(var k,C=j[Symbol.iterator]();!(b=(k=C.next()).done);b=!0){var S=k.value,E=S.split("."),A=E[E.length-1],D=y.concat(S);t.includes(A)&&(n[h]||(n[h]=[]),n[h].push(D)),x.push([S,D])}}catch(e){w=!0,N=e}finally{try{b||null==C.return||C.return()}finally{if(w)throw N}}}}}}catch(e){d=!0,u=e}finally{try{o||null==m.return||m.return()}finally{if(d)throw u}}return n}},72370:(e,t,n)=>{"use strict";n.d(t,{t:()=>l});var r=n(64124);let l=n.n(r)()(()=>Promise.all([n.e(2222),n.e(6467)]).then(n.bind(n,6467)),{loadableGenerated:{webpack:()=>[6467]},ssr:!1})},73935:(e,t,n)=>{"use strict";n.d(t,{H:()=>nn,U:()=>nr});var r=n(50979),l=n(81154),i=n(25963),a=n(73648),s=n(4177),o=n(45588),c=n(44039),d=n(32507),u=n(47188),p=n(69249),m=n(47654),h=n(95662),x=n(42419),g=n(24703),v=n(2551),f=n(13077),y=n(86954);let j=e=>{let{onSearch:t}=e,n=(0,i.useRef)(null),[l,a]=(0,i.useState)("");(0,g.Z)({"/":e=>{var t;e.stopPropagation(),e.preventDefault(),null==(t=n.current)||t.focus()}});let s=e=>{a(e),t(e)};return(0,r.jsx)("div",{className:"bg-gray-50 dark:bg-secondaryBg border-b border-gray-100 px-9 py-3 sticky top-0 z-[99]",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(y.pd,{ref:n,label:{hidden:!0,text:"Filter settings"},placeholder:"Filter Settings...",className:"bg-background dark:bg-secondaryBg",size:"sm",value:l,onChange:e=>{s(e.target.value)}}),(0,r.jsx)("button",{className:"absolute top-[3px] right-1 z-[9999999] w-7 h-7 flex items-center justify-center rounded border bg-gray-50 dark:bg-background border-gray-100 text-gray-600",onClick:()=>{var e;""!==l&&s(""),null==(e=n.current)||e.focus()},children:""!==l?(0,r.jsx)(f.In,{icon:v.X,size:"xs"}):(0,r.jsx)("span",{children:"/"})})]})})};var b=n(49767),w=n(64162),N=n(70375),k=n(50655),C=n(31754),S=n(65910);let E=e=>{let{id:t,manifestFileInfo:n,onChange:l,value:a,readOnly:s,isStaged:o}=e,{routes:c}=(0,N.c)(),[d,u]=(0,i.useState)(!1);return(0,r.jsxs)(b.XY,{id:t,children:[(0,r.jsxs)(b.O5,{children:[(0,r.jsx)(b.fA,{id:t,children:"Custom Build Command"}),(0,r.jsxs)(b.$0,{children:["Override the default build command that is run when building your app."," ",(0,r.jsxs)(m.N,{external:!0,variant:"highlight",...c.docs({page:"/deploy/builds#build-command"}),children:[(0,r.jsx)("span",{className:"underline mr-1",children:"Docs"}),(0,r.jsx)(v.lth,{})]})]})]}),(0,r.jsx)(b.a,{fileInfo:null==n?void 0:n.build.buildCommand,children:d||a?(0,r.jsx)(S.j,{autoFocus:d,value:null!=a?a:"",label:{text:"Build command",hidden:!0},readOnly:s||(null==n?void 0:n.build.buildCommand)!=null,placeholder:"npm run build",isStaged:o,onChange:l}):(0,r.jsx)(C.$n,{size:"sm",variant:"outline",color:"gray",icon:v.FWt,disabled:s,onClick:()=>u(!0),children:"Build Command"})})]})};var I=n(14034),A=n(36609),D=n(40148),R=n(17057),P=n(33321);let O={NIXPACKS:{name:"Nixpacks",description:"Nix-based builder developed by Railway",link:"https://nixpacks.com",badge:(0,r.jsx)(D.Hf,{}),selectable:!0},RAILPACK:{name:"Railpack",description:"New app builder developed by Railway.",link:"https://railpack.com",badge:(0,r.jsx)(D.qR,{}),selectable:!0,disableBuilderV2:!0},HEROKU:{name:"Heroku Buildpacks",description:"Heroku-20 Cloudnative buildpacks.",link:"https://devcenter.heroku.com/articles/heroku-20-stack",badge:(0,r.jsx)(D.$u,{}),selectable:!1},PAKETO:{name:"Paketo Buildpacks",description:"Collection of Cloudnative buildpacks.",link:"https://paketo.io/",badge:(0,r.jsx)(D.$u,{}),selectable:!1},DOCKERFILE:{name:"Dockerfile",description:"Build with a Dockerfile using BuildKit.",link:"https://docs.docker.com/engine/reference/builder/",badge:null}};var T=n(95175),M=n(45636),z=n(71144),F=n(79006),L=n(80374);let W=["node","python","go","ruby","rust","java","c#","f#","deno","php","elixir","dart","clojure","staticfile"],U=e=>"..."===e||"@auto"===e,_=e=>{let{disabled:t=!1,serviceId:n,hasDeployment:l,matchedProviders:a,customPlan:s,nixpacksConfigFile:o,...c}=e,{updateServiceConfig:d}=(0,k.w)(n),{track:u}=(0,z.j)(),[p,m]=(0,i.useState)(null!=s.providers?s.providers:["..."]),g=e=>{m(e),setTimeout(()=>d({build:{nixpacksPlan:{...s,providers:e}}}))},v=0===p.length||p.every(U)&&0===a.length,f=p.filter(e=>U(e)).length>0,y=e=>{u({action:"Remove",object:"Provider",properties:{provider:e}}),g(p.filter(t=>t!==e))},[j,b]=(0,i.useState)(!1),w=l&&null==o,N=w&&p.length>1;return(0,r.jsx)(h.T,{...c,children:(0,r.jsxs)("div",{className:(0,A.xW)("grid grid-cols-[1fr_auto] gap-x-2 items-center border border-gray-100 pl-2 pr-2 pt-2 rounded-lg",!o&&"pb-2"),children:[(0,r.jsx)("div",{children:l?v?(0,r.jsx)(x.xC,{className:"py-1.5",children:"No providers"}):(0,r.jsx)(T.x,{as:"div",axis:"x",values:p,onReorder:e=>{g(e)},children:(0,r.jsx)("ul",{className:"flex items-center flex-wrap gap-2",children:p.map(e=>U(e)?(0,r.jsx)(M.N,{value:e,as:"li",onDrag:()=>b(!0),onDragEnd:()=>b(!1),drag:N&&!t,children:(0,r.jsx)("div",{className:"flex items-center space-x-2",children:a.map(n=>(0,r.jsx)(G,{disabled:t,name:(0,L.ZH)(n),devIcon:n,isAuto:!0,onRemove:()=>y(e),isDragging:j,enableEditing:w,enableDragging:N},n))})},e):(0,r.jsx)(M.N,{value:e,as:"li",onDrag:()=>b(!0),onDragEnd:()=>b(!1),drag:N&&!t,children:(0,r.jsx)(G,{name:(0,L.ZH)(e),devIcon:e,disabled:t,onRemove:()=>y(e),isDragging:j,enableEditing:w,enableDragging:N})},e))})}):(0,r.jsx)(x.xC,{className:"py-1.5",children:"Create a deployment to auto-detect providers"})}),w&&(0,r.jsx)(V,{disabled:t,existingProviders:[...a,...p],onAddProvider:e=>{u({action:"Add",object:"Provider",properties:{provider:e}}),g([...p,e])},showAuto:!f}),null!=o&&(0,r.jsxs)("div",{className:"row-start-2 col-span-2 mt-3 -mx-4 px-4 py-2 text-sm bg-gray-50 text-gray-600",children:["Edit ",(0,r.jsx)(x.YD,{children:"providers"})," in"," ",o," to change"]})]})})},V=e=>{let{disabled:t=!1,existingProviders:n,showAuto:l,onAddProvider:i}=e,{track:a}=(0,z.j)();return(0,r.jsxs)(R.ms,{onOpenChange:e=>{e&&a({action:"Open",object:"AddProviderDropdown"})},children:[(0,r.jsx)(R.Lk,{className:(0,A.xW)(["rounded-md border !border-pink-200 text-pink-500 p-1",t&&"cursor-not-allowed",!t&&"hover:(text-pink-500 border-pink-500)"]),disabled:t,title:"Add provider",icon:v.FWt,size:"sm"}),(0,r.jsxs)(R.pm,{align:"end",children:[l&&(0,r.jsx)(B,{name:"Auto",iconOverride:"Railway",onSelect:()=>i("..."),className:"bg-pink-100"}),W.filter(e=>!(null==n?void 0:n.includes(e))).map(e=>(0,r.jsx)(B,{name:e,onSelect:()=>i(e)},e))]})]})},B=e=>{let{name:t,iconOverride:n,onSelect:l,...i}=e;return(0,r.jsxs)(R.tJ,{onSelect:l,...i,children:[(0,r.jsx)(Y,{name:null!=n?n:t.toLowerCase()}),(0,r.jsx)("span",{className:"ml-1.5",children:(0,L.ZH)(t)})]})},G=e=>{let{name:t,devIcon:n,disabled:l=!1,isAuto:i,isDragging:a,enableDragging:s,enableEditing:o,onRemove:c,...d}=e;return(0,r.jsxs)("div",{...d,className:(0,A.xW)("group","relative flex items-center px-1.5 py-1.5 rounded-lg",i?"bg-pink-50 dark:bg-pink-100":"bg-gray-50 dark:bg-gray-100",a?"cursor-grabbing":s?"cursor-grab":void 0),children:[o&&(0,r.jsx)(f.In,{icon:v.ecn,size:"xs",className:(0,A.xW)("mr-1.5",s?"text-gray-300":"text-gray-200")}),null!=n&&(0,r.jsx)(Y,{name:n}),(0,r.jsx)(x.EY,{className:"whitespace-nowrap ml-1.5 mr-1",children:t}),o&&null!=c&&(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),e.preventDefault(),c&&!l&&c()},className:(0,A.xW)(["text-gray-200 dark:text-gray-300 p-1.5 rounded-md hover:bg-black hover:bg-opacity-[2%] hover:text-gray-300 hover:dark:text-gray-400",l&&"cursor-not-allowed"]),children:(0,r.jsx)(f.In,{icon:v.X,size:"xs"})})]})},Y=e=>{let{name:t,...n}=e,{colorMode:l}=(0,F.DP)();return(0,r.jsx)("img",{src:"https://devicons.railway.app/".concat(t,"?variant=").concat("light"===l?"dark":"light"),alt:"",...n,className:"w-5 h-5 pointer-events-none"})};var $=n(72287),H=n(50380),q=n(82660),K=n(89088);let X=()=>(0,r.jsx)(q.l,{variant:"warning",size:"sm",className:"mt-3",children:"Serverless is not available for services that have a cron schedule."});var Z=n(17657),J=n.n(Z),Q=n(10137);let ee=()=>(0,r.jsx)(q.l,{variant:"warning",size:"sm",className:"mt-3",children:"Cron schedules are not available for serverless services."});var et=n(91486),en=n(17851),er=n(56144),el=n(80430);let ei=[{value:w.PublicRuntime.LEGACY,text:"Legacy"},{value:w.PublicRuntime.V2,text:"V2"}],ea=en.z.nativeEnum(w.PublicRuntime).default(w.PublicRuntime.UNSPECIFIED);var es=n(52992),eo=n(46251),ec=n(87418),ed=n(81009);let eu={ALWAYS:{name:"Always",description:"Restart the container always.",disabled:e=>null!=e},NEVER:{name:"Never",description:"Never restart the container if it stops."},ON_FAILURE:{name:"On Failure",description:"Restart the container if it exits with a non-zero exit code."}};var ep=n(77505),em=n(88887);let eh=e=>{let{flag:t,service:n}=e,{modalActions:l}=(0,ep.U)(),{featureFlagAdd:i,featureFlagRemove:a}=(0,k.w)(n.id),s=async e=>{try{e?await i(t):await a(t),l.createToast((0,r.jsx)(em.y8,{variant:"success",title:"Success!",description:"Feature flag updated."}))}catch(e){var n;l.createToast((0,r.jsx)(em.y8,{variant:"error",title:"Error!",description:null!=(n=e.message)?n:"There was an issue updating the feature flag."}))}},o=w.activeServiceFeatureFlags[t],{cta:c}=o;return(0,r.jsxs)(h.T,{children:[(0,r.jsx)(K.N,{id:t,checked:n.featureFlags.includes(t),onCheckedChange:s,children:(0,r.jsxs)(h.T,{children:[(0,r.jsxs)(x.EY,{className:"font-semibold",children:[o.title,o.hasConductorAccess&&(0,r.jsx)("span",{className:"ml-1 text-red-500",children:"[CONDUCTOR ACCESS]"}),o.isAdminOnly&&!o.hasConductorAccess&&(0,r.jsx)("span",{className:"ml-1 text-red-500",children:"[ADMIN ONLY]"})]}),(0,r.jsx)(x.xC,{children:o.description})]})}),null!=c&&n.featureFlags.includes(t)&&(0,r.jsxs)(m.N,{className:"text-sm text-gray-500 ml-14 mt-2",variant:"highlight",href:c.link,external:!0,children:[(0,r.jsx)("span",{className:"underline",children:c.text}),(0,r.jsx)(v.lth,{})]})]})},ex=e=>w.ACTIVE_SERVICE_FEATURE_FLAGS.filter(t=>{let n=w.activeServiceFeatureFlags[t];return null!=e&&!!e.isAdmin||(null==e?void 0:e.isConductor)&&n.hasConductorAccess||!n.isAdminOnly}),eg=e=>{let{service:t}=e,[{user:n}]=(0,o.Jd)(),l=ex(n);return(0,r.jsx)("div",{className:"grid gap-6",children:l.map(e=>(0,r.jsx)(eh,{flag:e,service:t},e))})};var ev=n(49817),ef=n(33029),ey=n(24554),ej=n(42113),eb=n(93208),ew=n(28592),eN=n(12725),ek=n(97865),eC=n(2631),eS=n(55850),eE=function(e){return e.Loading="loading",e.Available="available",e.InValid="invalid",e.NotAvailable="taken",e}({}),eI=function(e){return e.Environment="environment",e.Custom="custom",e}({}),eA=n(25586),eD=n(98579),eR=function(e){return e.Loading="loading",e.Available="available",e.InValid="invalid",e.NotAvailable="taken",e}({}),eP=n(61259),eO=n(67970),eT=n(67906),eM=n(76933);let ez=(0,ey.eU)(e=>{var t,n;return null!=(n=null==(t=e(c.vA))?void 0:t.privateNetworkDisabled)&&n}),eF=e=>{var t,n,a;let{environment:s,service:o,serviceInstanceConfig:c,privateNetwork:d,isStaged:p}=e,[m,g]=(0,ew.T)(),[y,j]=(0,i.useState)(!1),b=(0,l.md)(u.mz),{modalActions:w}=(0,ep.U)(),N=async()=>{j(!0)},[{privateNetworkEndpoint:{data:k,isError:S,isLoading:E}}]=(0,eD.u)({privateNetworkId:d.publicId,environmentId:s.id,serviceId:o.id}),I=(0,$.aQ)(s.id),D=null!=(a=null==(t=c.networking)?void 0:t.privateNetworkEndpoint)?a:null==k?void 0:k.dnsName,R="".concat(d.dnsName,".internal"),P="".concat(D,".").concat(R),O=(null==k||null==(n=k.privateIps)?void 0:n.length)||!1,T=(0,i.useMemo)(()=>O?(0,r.jsx)(f.In,{icon:v.rAV,className:"text-green-600"}):(0,r.jsx)(f.In,{icon:v.zD7,className:"text-gray-600"}),[O]);if(E)return null;if(S)return(0,r.jsx)(q.l,{variant:"danger",children:"Failed to get private network endpoint"});if(!k||!D)return(0,r.jsx)(q.l,{variant:"primary",size:"sm",icon:v.lgv,className:"mb-3",children:(0,r.jsx)("div",{className:"flex items-center w-full flex-wrap gap-0.5",children:(0,r.jsx)("span",{children:"Private networking is initializing and will be ready once the deployment of this service is complete."})})});let M=async e=>{try{I.stageServiceChanges({serviceId:o.id,payload:{networking:{privateNetworkEndpoint:e}}})}catch(e){w.createToast((0,r.jsx)(em.y8,{variant:"error",title:"Error adding custom domain",description:e.message}))}};return(0,r.jsxs)("div",{className:(0,A.xW)("py-1 border border-gray-200 rounded-lg divide-y divide-gray-200",p&&"bg-pink-50 border-pink-100 text-pink-600"),children:[(0,r.jsxs)("div",{className:"group flex items-center space-x-3 px-4 py-3 hover:bg-secondaryBg dark:hover:bg-gray-100",children:[T,(0,r.jsxs)(h.T,{space:1,className:"flex-grow",children:[(0,r.jsxs)(h.z,{align:"center",justify:"between",space:4,className:"relative w-full",children:[(0,r.jsxs)(h.z,{className:"flex items-center gap-1.5",children:[(0,r.jsx)("div",{children:P}),(0,r.jsx)(eM.m,{content:"This DNS name resolves to an IPv6 address",children:(0,r.jsxs)("div",{className:"bg-pink-100 text-pink-600 text-xs font-semibold py-0.5 px-1.5 rounded flex items-center gap-1 cursor-help",children:[(0,r.jsx)(f.In,{icon:v.qzq,size:"xs"}),"IPv6"]})})]}),!y&&(0,r.jsxs)(h.z,{align:"center",justify:"between",space:1,className:"",children:[(0,r.jsx)(C.K0,{icon:m?v.Jlk:v.QRo,size:"xs",title:"Copy",type:"button",onClick:()=>g(P),className:"rounded-md opacity-0 group-hover:opacity-100 hover:bg-gray-200"}),b&&(0,r.jsx)(C.K0,{icon:v.ffu,title:"Edit",size:"xs",type:"button",onClick:N,className:"rounded-md opacity-0 group-hover:opacity-100 hover:bg-gray-200"})]})]}),(0,r.jsx)(x.ae,{children:O?(0,r.jsxs)(h.z,{space:0,align:"center",className:"flex-wrap",children:[(0,r.jsxs)("span",{children:["Ready to talk privately "," \xb7 "]}),(0,r.jsx)(eT.h,{x:1}),(0,r.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,r.jsx)("span",{className:"text-pink-600",children:"You can also simply call me"}),(0,r.jsx)("span",{className:"px-[3px] text-xs font-mono rounded-md bg-pink-100 border border-gray-100 text-pink-600",children:D}),"."]})]}):"This private URL will be functional after the next deployment of\n            this service."})]})]}),(0,r.jsx)(ed.M,{isOpen:y,children:(0,r.jsx)("div",{className:(0,A.xW)("p-4 space-y-4",!y&&"pointer-events-none"),children:(0,r.jsx)(eL,{environmentId:s.id,privateNetworkId:d.publicId,dnsName:D,suffix:R,isServiceDomain:!0,onSetDnsName:async e=>{await M(e),j(!1)},onCancel:()=>j(!1)})})})]})},eL=e=>{let{environmentId:t,privateNetworkId:n,dnsName:l,buttonText:a="Update",suffix:s,onSetDnsName:o,onCancel:c}=e,d=(0,i.useMemo)(()=>l,[l]),{register:u,handleSubmit:p,watch:m,formState:{errors:g}}=(0,ej.mN)({defaultValues:{dnsName:d}}),j=m().dnsName,b=(e=>{var t;let{environmentId:n,privateNetworkId:r,currentDnsPrefix:l,dnsPrefix:a,dnsSuffix:s,enabled:o=!0}=e,c=(0,eC.o)(a,200),{graphqlClient:d}=(0,eS.q)(),u=(0,i.useMemo)(()=>!a.startsWith("-")&&!a.endsWith("-")&&(0,eN.isValidDomain)("".concat(a,".").concat(s)),[a]),{result:p}=(0,ek.W)(["privateNetworkEndpointNameAvailable",n,r,c],async()=>{var e;return null!=(e=(await d.privateNetworkEndpointNameAvailable({environmentId:n||"",privateNetworkId:r||"",prefix:c||""})).privateNetworkEndpointNameAvailable)?e:void 0},{enabled:o&&!!r}),m=a!==c?null:null!=(t=p.data)?t:null;return a===l?{status:"available",message:"Endpoint name available!"}:u?null==m?{status:"loading",message:"Checking..."}:{status:m?"available":"taken",message:"Endpoint ".concat(m?"available!":"already used!")}:{status:"invalid",message:"Malformed endpoint name"}})({environmentId:t,privateNetworkId:n,dnsPrefix:j,currentDnsPrefix:l,dnsSuffix:s,enabled:j!==l}),[w,N]=(0,i.useState)(!1),k=async e=>{let{dnsName:t}=e;b.status===eR.Available&&(N(!0),await o(t),N(!1))};return(0,r.jsxs)(eP.lV,{onSubmit:p(k),enableBindings:!0,onCancel:c,children:[(0,r.jsxs)("div",{className:(0,A.xW)("flex items-center justify-between pr-4 mb-4 border border-gray-200 rounded-md","focus-within:border-pink-400",null!=g.dnsName&&"border-red-500 focus-within:border-red-500"),children:[(0,r.jsx)(y.pd,{...u("dnsName",{required:!0}),label:{text:"DNS",hidden:!0},error:null!=g.dnsName,className:"border-none pl-4"}),null!=s&&(0,r.jsxs)(x.EY,{className:"text-gray-500 whitespace-nowrap",children:[".",s]})]}),(0,r.jsxs)(h.z,{align:"center",justify:"between",space:4,children:[""===j?(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(h.z,{space:3,align:"center",className:"text-gray-500",children:[(0,r.jsx)(f.In,{icon:v.R2D}),(0,r.jsx)(x.ax,{children:"Enter your endpoint name"})]})}):(0,r.jsx)(eW,{...b}),(0,r.jsxs)(h.z,{align:"center",space:2,children:[(0,r.jsx)(C.$n,{size:"sm",color:"gray",variant:"outline",type:"button",onClick:c,children:"Cancel"}),(0,r.jsx)(C.$n,{size:"sm",color:"pink",variant:"primary",isLoading:w,disabled:b.status!==eR.Available,children:a})]})]})]})},eW=e=>{let{status:t,message:n}=e,l=(0,i.useMemo)(()=>({[eE.Available]:"text-green-500",[eE.Loading]:"text-gray-600",[eE.InValid]:"text-red-500",[eE.NotAvailable]:"text-red-500"})[t],[t]),a=(0,i.useMemo)(()=>({[eE.Available]:(0,r.jsx)(f.In,{icon:v.Jlk}),[eE.Loading]:(0,r.jsx)(eO.Rh,{}),[eE.InValid]:(0,r.jsx)(f.In,{icon:v.X}),[eE.NotAvailable]:(0,r.jsx)(f.In,{icon:v.X})})[t],[t]);return(0,r.jsxs)(h.z,{space:1.5,align:"center",className:l,children:[a,(0,r.jsx)(x.ax,{children:n})]})};var eU=n(45479),e_=n(39303),eV=n(71778),eB=n(90567),eG=n(18970),eY=n(90029);let e$=e=>{let{domain:t}=e,{id:n}=(0,eY.eR)(),{modalActions:l}=(0,ep.U)(),i=()=>l.exitModal(n),{routes:a}=(0,N.c)();return(0,r.jsxs)(eY.aF,{title:"Configure DNS Records",modalStyles:"p-6 md:!w-full md:!max-w-5xl",children:[(0,r.jsxs)(h.z,{align:"center",justify:"between",space:2,children:[(0,r.jsx)(eY.wt,{children:"Configure DNS Records"}),(0,r.jsx)(C.K0,{icon:v.X,title:"Close",onClick:i})]}),(0,r.jsx)(e=>{let{domain:t}=e;if(!t.domain)return null;let n=t.status.dnsRecords.reduce((e,t)=>(e[t.zone]?e[t.zone].push(t):e[t.zone]=[t],e),{});return(0,r.jsxs)(r.Fragment,{children:[Object.entries(n).map(e=>{let[t,n]=e;return((e,t)=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(x.EY,{className:"my-6 overflow-hidden overflow-ellipsis",children:["To finish setting up your custom domain, add the following DNS records to"," ",(0,r.jsx)(m.N,{variant:"coloured",href:"https://".concat(e),children:e})]}),(0,r.jsx)(eG.J6,{className:"overflow-x-auto",children:(0,r.jsx)(eG.XI,{children:(0,r.jsxs)(eG.vc,{showRowBorder:!0,children:[(0,r.jsxs)(eG.fI,{unSelectable:!0,children:[(0,r.jsx)(eG.xC,{className:"text-xs text-gray-600",children:"Type"}),(0,r.jsx)(eG.xC,{className:"text-xs text-gray-600",children:"Name"}),(0,r.jsx)(eG.xC,{className:"text-xs text-gray-600",children:"Value"})]}),t.map((e,t)=>(0,r.jsxs)(eG.fI,{unSelectable:!0,children:[(0,r.jsx)(eG.xC,{className:"text-sm font-mono",children:e.recordType.split("_").at(-1)}),(0,r.jsx)(eG.xC,{className:"text-sm font-mono",children:e.hostlabel?e.hostlabel:"@"}),(0,r.jsxs)(eG.xC,{children:[(0,r.jsxs)("div",{className:"flex items-center text-sm font-mono overflow-hidden overflow-ellipsis max-w-full min-w-0 mr-8",children:[e.requiredValue," ",(0,r.jsx)(C.i8,{size:"xs",text:e.requiredValue.trim(),className:"text-blue-600 bg-background right-3"})]}),e.currentValue!==e.requiredValue?(0,r.jsx)("div",{className:"text-yellow-600 text-sm",children:""===e.currentValue?"Record not yet detected":(0,r.jsxs)(r.Fragment,{children:['Incorrect value "',(0,r.jsx)("span",{className:"text-xs font-mono",title:e.currentValue,children:e.currentValue}),'"']})}):(0,r.jsx)("div",{className:"text-green-600 text-sm",children:(0,r.jsx)(r.Fragment,{children:"Record configured correctly"})})]}),(0,r.jsx)(eG.xC,{className:"flex items-center"})]},t))]})})})]}))(t,n)}),(0,r.jsxs)(x.xC,{className:"my-6",children:["*"," DNS changes can take up to 72 hours to propagate worldwide"]}),(0,r.jsxs)(h.z,{align:"center",justify:"between",children:[(0,r.jsx)(C.vx,{size:"sm",color:"gray",variant:"outline",...a.docs({page:"deploy/exposing-your-app#add-a-custom-domain"}),children:"Visit the Docs"}),(0,r.jsx)(C.$n,{size:"sm",onClick:i,children:"Dismiss"})]})," "]})},{domain:t})]})};var eH=n(79745),eq=n(41054),eK=n(38023);let eX=(e,t)=>"".concat(e,".").concat(t),eZ=e=>{let{serviceDomains:t,customDomains:n,domainActions:l,sockets:i}=e,{modalActions:a}=(0,ep.U)(),{isConfirmed:s}=(0,eb.S)(),o=async e=>{let{id:t,domain:n,targetPort:i}=e;try{await l.updateServiceDomain({id:t,domain:n,targetPort:i})}catch(e){a.createToast((0,r.jsx)(em.y8,{variant:"error",title:"Error editing service domain",description:e.message}))}},c=async e=>{let{id:t,targetPort:n}=e;try{await l.updateCustomDomain({id:t,targetPort:n})}catch(e){a.createToast((0,r.jsx)(em.y8,{variant:"error",title:"Error adding custom domain",description:e.message}))}},d=async e=>{if(await s({confirmLabel:"Delete",message:"Are you sure you want to remove the primary service domain?",title:"Remove Service Domain"}))try{await l.deleteServiceDomain({id:e.id})}catch(e){a.createToast((0,r.jsx)(em.y8,{variant:"error",title:"Error deleting service domain",description:e.message}))}},u=async e=>{if(await s({confirmLabel:"Delete",message:(0,r.jsxs)(r.Fragment,{children:["Are you sure you want to remove the custom domain"," ",(0,r.jsx)("strong",{children:e.domain}),"?"]}),title:"Remove Custom Domain"}))try{await l.deleteCustomDomain(e.id)}catch(e){a.createToast((0,r.jsx)(em.y8,{variant:"error",title:"Error removing custom domain",description:e.message}))}},p=async e=>{let t=e.edgeId===(0,eH.getEdgeEntrypointIdentifiers)().RailProxyMetal||e.edgeId===(0,eH.getEdgeEntrypointIdentifiers)().RailwayGateway;try{await l.updateDomainEdgeEntrypoint({id:e.id,edgeEntrypointId:t?(0,eH.getEdgeEntrypointIdentifiers)().RailProxy:(0,eH.getEdgeEntrypointIdentifiers)().RailwayGateway})}catch(e){a.createToast((0,r.jsx)(em.y8,{variant:"error",title:"Error switching edge network",description:e.message}))}};return(0,r.jsxs)("div",{className:"py-1 border border-gray-200 rounded-lg divide-y divide-gray-200",children:[t.map(e=>(0,r.jsx)(e5,{sockets:i,serviceDomain:e,onSetDomain:o,onDeleteDomain:d,onSwitchEdgeNetwork:p},e.id)),n.map(e=>(0,r.jsx)(eQ,{sockets:i,customDomain:e,onEdit:c,onRemoveCustomDomain:u,issueCertificate:l.issueCertificateForCustomDomain,onSwitchEdgeNetwork:p},e.id))]})},eJ=e=>{let{customDomain:t,state:n,issueCertificate:l}=e,{modalActions:i}=(0,ep.U)(),a=(0,r.jsx)(m.N,{variant:"coloured",href:"https://docs.railway.com/deploy/exposing-your-app",children:"View Documentation"});switch(n){case"cloudflare":return(0,r.jsxs)(r.Fragment,{children:["Cloudflare proxy detected"," \xb7 ",a]});case"dnsIsWaiting":return(0,r.jsxs)(r.Fragment,{children:["Waiting for DNS update"," \xb7 ",(0,r.jsx)(C.z9,{variant:"coloured",onClick:()=>{i.openModal((0,r.jsx)(e$,{domain:t}))},children:"Show instructions"})]});case"dnsRequiresUpdate":return(0,r.jsxs)(r.Fragment,{children:["Incorrect DNS setup"," \xb7 ",(0,r.jsx)(C.z9,{variant:"coloured",onClick:()=>{i.openModal((0,r.jsx)(e$,{domain:t}))},children:"Show setup issues"})]});case"validatingDomainOwnership":return(0,r.jsx)(r.Fragment,{children:"Validating domain ownership"});case"certificateIssuing":return(0,r.jsxs)(r.Fragment,{children:["Issuing TLS certificate"," \xb7 ",a]});case"certificateFailed":return(0,r.jsx)(q.l,{variant:"warning",hideIcon:!0,className:"py-1.5 text-sm",children:(0,r.jsxs)(h.z,{className:"w-full",align:"center",children:[(0,r.jsx)("div",{children:"Failed to issue TLS certificate"}),(0,r.jsx)(C.$n,{onClick:()=>l({id:t.id}),className:"ml-auto",color:"yellow",variant:"outline",size:"xs",children:"Try Again"})]})});case"complete":return(0,r.jsx)(r.Fragment,{children:"Setup complete"})}},eQ=e=>{let{customDomain:t,sockets:n,onEdit:a,onRemoveCustomDomain:s,issueCertificate:o,onSwitchEdgeNetwork:c}=e,d=(0,l.md)(u.mz),[p,g]=(0,i.useState)(!1),[y,j]=(0,ew.T)(),[b,w]=(0,i.useState)(!!t.targetPort),{domain:N,status:k}=t,S=(0,eK.E)(N),E=(0,i.useMemo)(()=>k.dnsRecords.every(e=>e.status===eU.F7W.DnsRecordStatusRequiresUpdate&&""===e.currentValue),[k.dnsRecords]),I=(0,i.useMemo)(()=>k.dnsRecords.some(e=>e.status===eU.F7W.DnsRecordStatusRequiresUpdate&&""!==e.currentValue),[k.dnsRecords]),D="dnsIsWaiting";D=k.cdnProvider===eU.tG7.DetectedCdnProviderCloudflare?"cloudflare":E?"dnsIsWaiting":I?"dnsRequiresUpdate":k.certificateStatus===eU.CFW.CertificateStatusTypeValidatingOwnership?"validatingDomainOwnership":k.certificateStatus===eU.CFW.CertificateStatusTypeIssuing?"certificateIssuing":k.certificateStatus===eU.CFW.CertificateStatusTypeIssueFailed?"certificateFailed":"complete";let R=t.edgeId==(0,eH.getEdgeEntrypointIdentifiers)().RailProxyMetal||t.edgeId==(0,eH.getEdgeEntrypointIdentifiers)().RailwayGateway,P=(0,i.useMemo)(()=>{switch(D){case"cloudflare":return(0,r.jsx)(f.In,{icon:v.Esr,className:"text-green-600"});case"dnsIsWaiting":case"validatingDomainOwnership":return(0,r.jsx)(f.In,{icon:v.R2D,className:"text-gray-600"});case"dnsRequiresUpdate":return(0,r.jsx)(f.In,{icon:v.hcu,className:"text-yellow-600"});case"certificateFailed":return(0,r.jsx)(f.In,{icon:v.hcu,className:"text-red-600"});case"certificateIssuing":return(0,r.jsx)(f.In,{icon:v.zD7,className:"text-gray-600"});case"complete":return(0,r.jsx)(f.In,{icon:v.rAV,className:"text-green-600"})}},[D]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"group flex items-center space-x-3 px-4 py-3 hover:bg-secondaryBg dark:hover:bg-gray-100",children:[P,(0,r.jsxs)(h.T,{space:1,className:"flex-grow",children:[(0,r.jsxs)(h.z,{align:"center",justify:"between",space:4,className:"relative w-full",children:[S?t.domain:(0,r.jsx)(m.G,{href:"https://".concat(t.domain),children:t.domain}),(0,r.jsxs)(h.z,{space:1,className:"ml-auto",children:[(0,r.jsx)(C.K0,{icon:y?v.Jlk:v.QRo,size:"xs",title:"Copy",type:"button",onClick:()=>j(t.domain),className:"rounded-md hover:bg-gray-200"}),d&&(0,r.jsxs)(r.Fragment,{children:[R?null:(0,r.jsx)(C.K0,{icon:v.KqI,title:"Upgrade to Metal Edge",size:"xs",type:"button",className:"rounded-md hover:bg-gray-200 [&>div]:text-pink-700",onClick:()=>c(t)}),(0,r.jsx)(C.K0,{icon:v.ffu,title:"Edit",size:"xs",type:"button",onClick:()=>g(!0),className:"rounded-md hover:bg-gray-200"}),(0,r.jsx)(C.K0,{icon:v.TBR,title:"Delete",size:"xs",onClick:()=>s(t),className:"rounded-md hover:bg-gray-200"})]})]})]}),(0,r.jsxs)(x.ae,{className:"",children:[t.targetPort?(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("span",{className:"text-gray-600 inline-flex items-center space-x-1 align-middle",children:[(0,r.jsx)(f.In,{icon:v.Qpb,size:"sm"}),(0,r.jsxs)(x.ae,{children:["Port"," ",(0,r.jsx)("span",{className:"font-mono",children:t.targetPort})]})]})}):null,R?(0,r.jsxs)(r.Fragment,{children:[t.targetPort?" \xb7 ":"",(0,r.jsx)("div",{className:"items-center inline-flex gap-0.5",children:(0,r.jsx)("span",{className:"bg-clip-text text-transparent bg-gradient-to-r from-pink-600 to-pink-700",children:"Metal Edge"})})," \xb7 "]}):null,(0,r.jsx)(eJ,{customDomain:t,state:D,issueCertificate:o})]})]})]}),(0,r.jsx)(ed.M,{isOpen:p,children:(0,r.jsx)("div",{className:(0,A.xW)("p-4 space-y-4",!p&&"pointer-events-none"),children:(0,r.jsx)(e2,{sockets:n,domain:t,showPortSelector:b,setShowPortSelector:w,onSetDomain:async e=>{let{targetPort:n}=e;await a({id:t.id,targetPort:n}),g(!1)},onCancel:()=>g(!1)})})})]})},e0=e=>{let{sockets:t,hasTargetPortFunctionalityAvailable:n,onAddDomain:l,onCancel:i}=e;return(0,r.jsxs)("div",{className:"p-4 rounded-lg bg-secondaryBg dark:bg-gray-100",children:[(0,r.jsx)(x.ax,{className:"mb-4 font-semibold",children:"Add Custom Domain"}),(0,r.jsx)(e2,{sockets:t,showPortSelector:n,onSetDomain:l,onCancel:i,buttonText:"Add Domain"})]})},e1=e=>{let{sockets:t,onCreateServiceDomain:n,onCancel:l}=e,[a,s]=(0,i.useState)(!1),{handleSubmit:o,formState:{isValid:c},setValue:d}=(0,ej.mN)({}),u=async e=>{s(!0);try{await n({targetPort:parseInt(e.targetPort.toString())})}catch(e){}s(!1)};return(0,r.jsxs)(eP.lV,{enableBindings:!0,className:"p-4 rounded-lg bg-secondaryBg space-y-2 dark:bg-gray-100",onCancel:l,onSubmit:o(u),children:[(0,r.jsx)(x.ax,{className:"font-semibold",children:"Generate Service Domain"}),(0,r.jsx)(e4,{sockets:t,onSelect:e=>e&&d("targetPort",e)}),(0,r.jsxs)(h.z,{justify:"between",className:"mt-4 w-full",children:[(0,r.jsxs)(h.z,{space:3,align:"center",className:"text-gray-500",children:[(0,r.jsx)(f.In,{icon:v.R2D}),(0,r.jsx)(x.ax,{children:"Choose your target port"})]}),(0,r.jsxs)(h.z,{align:"center",space:2,children:[(0,r.jsx)(C.$n,{size:"sm",color:"gray",variant:"outline",type:"button",onClick:l,children:"Cancel"}),(0,r.jsx)(C.$n,{size:"sm",color:"pink",variant:"primary",isLoading:a,disabled:!c||a,children:"Generate Domain"})]})]})]})},e5=e=>{let{sockets:t,serviceDomain:n,onSetDomain:a,onDeleteDomain:s,onSwitchEdgeNetwork:o}=e,c=(0,l.md)(u.mz),[d,p]=(0,i.useState)(!1),[g,y]=(0,i.useState)(!!n.targetPort),j=async()=>{p(!0)},[b,w]=(0,ew.T)(),N=n.edgeId==(0,eH.getEdgeEntrypointIdentifiers)().RailProxyMetal||n.edgeId==(0,eH.getEdgeEntrypointIdentifiers)().RailwayGateway;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:(0,A.xW)("group","flex items-center w-full","px-4 py-3",!d&&"hover:bg-secondaryBg dark:hover:bg-gray-100"),children:[(0,r.jsx)(f.In,{icon:v.qzq,className:"mr-3 text-gray-500"}),(0,r.jsxs)("div",{children:[(0,r.jsx)(m.G,{href:"https://".concat(n.domain),className:(0,A.xW)("flex-grow text-left text-sm",d&&"text-gray-500"),children:n.domain}),(0,r.jsxs)(x.ae,{children:[n.targetPort?(0,r.jsxs)("span",{className:"text-gray-600 items-center space-x-1 inline-flex align-middle",children:[(0,r.jsx)(f.In,{icon:v.Qpb,size:"sm"}),(0,r.jsxs)(x.ae,{children:["Port"," ",(0,r.jsx)("span",{className:"font-mono",children:n.targetPort})]})]}):null,N?(0,r.jsxs)(r.Fragment,{children:[n.targetPort?" \xb7 ":"",(0,r.jsx)("div",{className:"items-center inline-flex gap-0.5",children:(0,r.jsx)("span",{className:"bg-clip-text text-transparent bg-gradient-to-r from-pink-600 to-pink-700",children:"Metal Edge"})})]}):null]})]}),!d&&(0,r.jsxs)(h.z,{space:1,className:"ml-auto",children:[(0,r.jsx)(C.K0,{icon:b?v.Jlk:v.QRo,size:"xs",title:"Copy",type:"button",onClick:()=>w(n.domain),className:"rounded-md hover:bg-gray-200"}),c&&(0,r.jsxs)(r.Fragment,{children:[N?null:(0,r.jsx)(C.K0,{icon:v.KqI,title:"Upgrade to Metal Edge",size:"xs",type:"button",className:"rounded-md hover:bg-gray-200 [&>div]:text-pink-700",onClick:()=>o(n)}),(0,r.jsx)(C.K0,{icon:v.ffu,title:"Edit",size:"xs",type:"button",onClick:j,className:"rounded-md hover:bg-gray-200"}),(0,r.jsx)(C.K0,{icon:v.TBR,size:"xs",title:"Delete",type:"button",onClick:()=>s(n),className:"rounded-md hover:bg-gray-200"})]})]})]}),(0,r.jsx)(ed.M,{isOpen:d,children:(0,r.jsx)("div",{className:(0,A.xW)("p-4 space-y-4",!d&&"pointer-events-none"),children:(0,r.jsx)(e2,{domain:n,suffix:n.suffix,sockets:t,isServiceDomain:!0,showPortSelector:g,setShowPortSelector:y,onSetDomain:async e=>{let{targetPort:t,domain:r}=e;await a({id:n.id,targetPort:t,domain:r}),p(!1)},onCancel:()=>p(!1)})})})]})},e3=e=>{let{sockets:t,permissions:n,isCreatingServiceDomain:i,setIsCreatingServiceDomain:a,setIsAddingCustomDomain:s,isWithinCustomDomainLimit:o,isWithinServiceDomainLimit:d,onCreateServiceDomain:u,hasTargetPortFunctionalityAvailable:p,serviceDomainPending:m}=e,x=(0,l.md)(c.xX),g=async()=>{var e;if(!p)return u({});let n=(null!=(e=null==x?void 0:x.variables)?e:{}).PORT,r=(null==n?void 0:n.value)!=null?parseInt(n.value):NaN;return isNaN(r)?1===t.length?u({targetPort:t[0].port}):void a(!0):u({targetPort:r})};return(0,r.jsx)(h.T,{space:2,children:(0,r.jsxs)(h.z,{space:2,children:[d&&(0,r.jsx)(C.$n,{variant:"outline",size:"sm",icon:v.KqI,disabled:!n.Write||i,onClick:g,children:m&&!i?"Generating...":"Generate Domain"}),(0,r.jsx)(C.$n,{name:"Add Custom Domain",variant:"outline",size:"sm",icon:v.FWt,disabled:!n.Write||!o,onClick:()=>s(!0),children:"Custom Domain"})]})})},e2=e=>{var t,n,l,a,s;let{domain:o,buttonText:c="Update",suffix:d,sockets:u,showPortSelector:p,setShowPortSelector:m,isServiceDomain:g,onSetDomain:j,onCancel:b}=e,w=(0,i.useMemo)(()=>{var e;return g?(e=>{var t;return null!=(t=null==e?void 0:e.domain.replace(".".concat(null==e?void 0:e.suffix),""))?t:""})(o):null!=(e=null==o?void 0:o.domain)?e:""},[o,g]),{register:N,setValue:k,handleSubmit:S,watch:E,formState:{errors:I}}=(0,ej.mN)({defaultValues:{domain:w,targetPort:null!=(n=null==o||null==(t=o.targetPort)?void 0:t.toString())?n:void 0}}),D=E().domain,R=((e,t,n)=>{var r;let{graphqlClient:l}=(0,eS.q)(),a=(0,eC.o)(e,200),s=(0,i.useMemo)(()=>{switch(n){case"environment":case"custom":return(0,eN.isValidDomain)(e,{wildcard:(0,eN.isWildcardDomain)(e)});default:throw Error("Domain check not specified!")}},[e]),{result:o}=(0,ek.W)(["domainAvailable",a,n],async()=>{switch(n){case"environment":return(await l.serviceDomainAvailable({domain:a})).serviceDomainAvailable;case"custom":return(await l.customDomainAvailable({domain:a})).customDomainAvailable;default:throw Error("Invalid Query Type for Domain")}},{enabled:s&&e!==t}),c=e!==a?null:null!=(r=o.data)?r:null;return e===t?{status:"available",message:"Domain Available!"}:s?null==c?{status:"loading",message:"Checking..."}:{status:c.available?"available":"taken",message:c.message}:{status:"invalid",message:"Malformed Domain"}})(g?eX(D,null!=(l=null==o?void 0:o.suffix)?l:""):D,null!=(a=null==o?void 0:o.domain)?a:"",g?eI.Environment:eI.Custom),[P,O]=(0,i.useState)(!1),T=async e=>{var t;let{domain:n,targetPort:r}=e;O(!0),await j({domain:g?eX(n,null!=(t=null==o?void 0:o.suffix)?t:""):n,targetPort:r?parseInt(r):void 0}),O(!1)};return(0,r.jsxs)(eP.lV,{onSubmit:S(T),enableBindings:!0,onCancel:b,className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,r.jsxs)("div",{className:(0,A.xW)("flex items-center grow justify-between border border-gray-200 rounded-md","focus-within:border-pink-400",g&&"pr-4"),children:[(0,r.jsx)(y.pd,{...N("domain",{required:!0}),label:{text:"Domain",hidden:!0},error:null!=I.domain,className:"border-none",placeholder:d?void 0:"example.com",disabled:!g&&null!=o}),null!=d&&(0,r.jsxs)(x.EY,{className:"text-gray-500 whitespace-nowrap",children:[".",d]})]}),!p&&m&&(0,r.jsxs)("div",{className:"group text-right text-sm text-gray-500 hover:text-pink-600 cursor-pointer flex items-center gap-1.5 whitespace-nowrap",onClick:e=>{m(!p)},children:[(0,r.jsx)(f.In,{icon:v.Qpb,size:"sm"}),"Edit Port"]})]}),p?(0,r.jsx)(e4,{sockets:u,initialPort:null!=(s=null==o?void 0:o.targetPort)?s:void 0,onSelect:e=>e&&k("targetPort",e.toString())}):null,(0,r.jsxs)(h.z,{align:"center",justify:"between",space:4,children:[""===D?(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(h.z,{space:3,align:"center",className:"text-gray-500",children:[(0,r.jsx)(f.In,{icon:v.R2D}),(0,r.jsxs)(x.ax,{children:["Enter your ",g?"service":"custom"," domain"]})]})}):(0,r.jsx)(e6,{...R}),(0,r.jsxs)(h.z,{align:"center",space:2,children:[(0,r.jsx)(C.$n,{size:"sm",color:"gray",variant:"outline",type:"button",onClick:b,children:"Cancel"}),(0,r.jsx)(C.$n,{size:"sm",color:"pink",variant:"primary",isLoading:P,disabled:R.status!==eE.Available,children:c})]})]})]})},e6=e=>{let{status:t,message:n}=e,l=(0,i.useMemo)(()=>({[eE.Available]:"text-green-500",[eE.Loading]:"text-gray-600",[eE.InValid]:"text-red-500",[eE.NotAvailable]:"text-red-500"})[t],[t]),a=(0,i.useMemo)(()=>({[eE.Available]:(0,r.jsx)(f.In,{icon:v.Jlk}),[eE.Loading]:(0,r.jsx)(eO.Rh,{}),[eE.InValid]:(0,r.jsx)(f.In,{icon:v.X}),[eE.NotAvailable]:(0,r.jsx)(f.In,{icon:v.X})})[t],[t]);return(0,r.jsxs)(h.z,{space:1.5,align:"center",className:l,children:[a,(0,r.jsx)(x.ax,{children:n})]})},e4=e=>{var t;let{sockets:n,initialPort:l,onSelect:a}=e,[s,o]=(0,i.useState)(l&&null!=(t=n.find(e=>e.port===l))?t:null),[c,d]=(0,i.useState)(0===n.length||l&&!s),[u,p]=(0,i.useState)(null),m=(0,i.useRef)(null),h=(0,eq.L)(m);return(0,i.useEffect)(()=>{a(u)},[u]),(0,r.jsxs)(r.Fragment,{children:[n.length?(0,r.jsxs)(R.ms,{children:[(0,r.jsx)(R.uu,{ref:m,className:"w-full",children:s?s.port:c?"Custom port":"Select a port"}),(0,r.jsxs)(R.pm,{style:{width:"".concat(h.width,"px")},children:[(0,r.jsx)("div",{className:"w-[".concat(h.width,"px] block")}),(0,r.jsxs)(x.ae,{className:"font-semibold ml-3 my-2",children:[n.length>1?"Some ports were":"A port was"," detected by"," ",(0,r.jsxs)("span",{className:" bg-clip-text text-transparent bg-gradient-to-r from-pink-600 to-pink-700",children:["Railway magic"," ✨"]})]}),n.map(e=>(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(R.tJ,{onSelect:()=>{a(e.port),o(e),d(!1)},children:[e.port,(0,r.jsxs)("span",{className:"font-mono text-gray-600",children:[" ","(",e.processName,")"]})]},e.port)})),(0,r.jsx)(R.rx,{}),(0,r.jsx)(R.tJ,{icon:v.FWt,onSelect:()=>{d(!0),o(null)},children:"Custom port"})]})]}):null,c?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x.ax,{className:"text-gray-700",children:"Enter the port your app is listening on"}),(0,r.jsx)(y.pd,{label:{hidden:!0,text:"Target port"},"data-testid":"port-selector-input",placeholder:"8080",type:"number",min:0,max:65535,defaultValue:l,onChange:e=>{let{target:t}=e;return p(parseInt(t.value))}})]}):null]})};var e9=n(18134),e7=n(66800),e8=n.n(e7);let te=e8()("10s");var tt=n(61649),tn=n(74858),tr=n(70212),tl=n(49385),ti=n(1758),ta=n(76488),ts=n(44765),to=n(37590),tc=n(16587),td=n(98498),tu=n(13025),tp=n(80428),tm=n(63345),th=n(95925),tx=n(49404),tg=n(18731),tv=n(43308),tf=n(13780);let ty=(e,t,n)=>["dockerImageUpdateCheck",e,t,n],tj=()=>{let e=(0,th.jE)();return t=>{let n=e.getQueryData(t);null!=n&&e.setQueryData(t,{...n,serviceInstance:{...n.serviceInstance,imageUpdateStatus:{...n.serviceInstance.imageUpdateStatus,updates:{},hasUpdates:!1}}})}};var tb=n(13934);let tw={patch:"Patch",minor:"Minor",major:"Major","same-tag":"Update"},tN=e=>tw[e]||"Update",tk=(0,ey.eU)([]),tC=e=>{var t,n;let{updateInfo:a,service:s,environment:o,serviceInstanceConfig:c,latestDeploy:d}=e,u=(0,$.y3)(),p=((e,t,n)=>{let{graphqlClient:l}=(0,eS.q)(),{modalActions:a}=(0,ep.U)(),{isConfirmed:s}=(0,eb.S)(),o=(0,th.jE)(),c=(0,i.useRef)(null),d=tj();return(0,tx.n)({mutationFn:async i=>{let{updatedTag:o}=i;if(await s({title:"Update Image",message:(0,r.jsxs)(r.Fragment,{children:["This will create a new deploy with the ",(0,r.jsx)("b",{children:o})," tag."]}),confirmLabel:"Update",theme:"info"}))return c.current=a.createToast((0,r.jsx)(em.y8,{title:"Updating image version...",variant:"neutral"})),d(ty(e,t,null==n?void 0:n.id)),l.serviceInstanceDeploy({serviceId:e,environmentId:t,latestCommit:!0})},onSuccess:n=>{null!=n&&(c.current&&(a.exitToast(c.current),c.current=null),a.createToast((0,r.jsx)(em.y8,{title:"Image update deployed",variant:"success"})),o.invalidateQueries({queryKey:(0,tg.l4)({environmentId:t})}),o.invalidateQueries({queryKey:ty(e,t)}))},onError:()=>{c.current&&(a.exitToast(c.current),c.current=null),a.createToast((0,r.jsx)(em.y8,{title:"Failed to update image version",variant:"error"}))}})})(s.id,o.id,d),m=((e,t,n)=>{let{graphqlClient:l}=(0,eS.q)(),{modalActions:i}=(0,ep.U)(),{isConfirmed:a}=(0,eb.S)(),s=(0,th.jE)(),o=ty(e,t,null==n?void 0:n.id),c=tj();return(0,tx.n)({mutationFn:async n=>{let{shas:r}=n,i=1===r.length?"version":"versions";if(await a({title:"Skip Image Update",message:"Are you sure you want to skip this ".concat(i,"? You won't see notifications for these specific updates anymore."),confirmLabel:"Skip",theme:"info"}))return await s.cancelQueries({queryKey:o}),c(o),await l.serviceInstanceImageUpdateSkip({input:{serviceId:e,environmentId:t,shas:r}})},onSuccess:e=>{null!=e&&(s.invalidateQueries({queryKey:o}),i.createToast((0,r.jsx)(em.y8,{title:"Image updates skipped",variant:"success"})))},onError:(e,t,n)=>{s.invalidateQueries({queryKey:o}),i.createToast((0,r.jsx)(em.y8,{title:"Failed to skip image updates",variant:"error"}))}})})(s.id,o.id,d),h=(0,l.Xr)(tk),x=[...a.updates.minor?[a.updates.minor]:[],...a.updates.patch?[a.updates.patch]:[]],g=[...x,...a.updates.sameTag?[a.updates.sameTag]:[]],y=g[0],[j,b]=(0,i.useState)(y),w=g.length>0;if(!y||!j)return null;let N=()=>{var e,t,n,r;let l=[null==(e=a.updates.patch)?void 0:e.sha,null==(t=a.updates.minor)?void 0:t.sha,null==(n=a.updates.major)?void 0:n.sha,null==(r=a.updates.sameTag)?void 0:r.sha].filter(Boolean);l.length>0&&m.mutate({shas:l})},k=null!=(n=null==c||null==(t=c.source)?void 0:t.image)?n:"";return(0,r.jsxs)(tu.P.div,{initial:"hidden",animate:"visible",variants:{hidden:{y:-8},visible:{y:0}},className:(0,A.xW)("flex items-center justify-between px-4 py-1.5","rounded-b-md bg-pink-50 border border-pink-100 border-t-0",(null==j?void 0:j.type)==="major"&&"bg-yellow-50 border-yellow-100"),children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)(f.In,{icon:v.tXn,className:(0,A.xW)((null==j?void 0:j.type)==="major"?"text-yellow-400":"text-pink-500")}),(0,r.jsx)("h3",{className:(0,A.xW)("text-sm font-medium",(null==j?void 0:j.type)==="major"?"text-yellow-800":"text-pink-800"),children:x.length>1?"".concat(x.map(e=>tN(e.type)).join(" and ")," Updates Available"):"same-tag"===j.type?"Update Available":"".concat(tN(j.type)," Update Available")})]}),(0,r.jsx)(tb.n4,{children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(C.$n,{name:"Update Image",size:"xs",variant:"outline",color:(null==j?void 0:j.type)==="major"?"red":"pink",onClick:()=>{var e,t;let n=null==(e=c.source)?void 0:e.image;if(null==n)return;let r=(0,td.parseDockerImage)(n);if(null==r)return;let l=null!=(t=r.tag)?t:"latest",i=j.tag;if(l===i){let e="".concat(a.current.sha,"-").concat(j.sha);h(t=>[...t,e]),p.mutate({updatedTag:i});return}let o=r.domain?"".concat(r.domain,"/").concat(r.path,":").concat(i):"".concat(r.path,":").concat(i);u.stageServiceChanges({serviceId:s.id,payload:{source:{image:o}}})},isLoading:p.isPending,className:(0,A.xW)("min-w-max",w?"rounded-r-none border-r-0":""),trackingProperties:{image:k,version:j.tag,type:j.type},children:p.isPending?"Updating...":j.toVersion?"Upgrade to ".concat(j.toVersion):"Upgrade to ".concat(j.tag)}),w&&(0,r.jsxs)(R.ms,{children:[(0,r.jsx)(R.ox,{size:"xs",variant:"outline",color:(null==j?void 0:j.type)==="major"?"red":"pink",disabled:p.isPending,className:"min-w-0 px-2 rounded-l-none focus:outline-none focus:ring-0 focus-visible:ring-0",name:"Update Image Dropdown"}),(0,r.jsx)(R.pm,{align:"end",children:1===g.length?(0,r.jsx)(R.tJ,{onSelect:N,className:"text-gray-500",name:"Skip Image Updates",trackingProperties:{image:k,version:j.tag},children:"Skip this version"}):(0,r.jsxs)(r.Fragment,{children:[(x.length>0?x:g).map(e=>(0,r.jsxs)(R.tJ,{onSelect:()=>b(e),className:(0,A.xW)(),name:"Update Image Dropdown Item ".concat(e.type),trackingProperties:{image:k,version:e.tag},children:["Upgrade to ",e.toVersion||e.tag," (",tN(e.type),")"]},e.type)),(0,r.jsx)(R.mB,{}),(0,r.jsx)(R.tJ,{onSelect:N,className:"text-gray-500",name:"Skip Image Updates",trackingProperties:{image:k,version:j.tag},children:"Skip these versions"})]})})]})]})})]})},tS=e=>{let{imageUpdateStatus:t,stagedUpgradeInfo:n,hasStagedImage:l,latestDeploy:i,isLoadingImageUpdate:a,isDelayedAfterApplying:s,hasImagePathChanged:o}=e,c=null==i?void 0:i.meta;return o?null:null!=n?(0,r.jsxs)(x.EY,{className:(0,A.xW)("text-xs text-gray-500",l&&"text-pink-600"),children:["Upgrading to"," ",(0,r.jsx)("span",{className:"font-bold",children:n.toVersion||n.tag})," ","(",(0,r.jsx)("span",{className:"underline",children:(0,td.formatSha)(n.sha)}),")"]}):a||s?(0,r.jsx)(to.g,{width:"100%",height:"18px",className:"max-w-[156px] text-xs text-gray-500"}):null!=t?(0,r.jsxs)(x.EY,{className:(0,A.xW)("text-xs text-gray-500",l&&"text-pink-600"),children:["Version:"," ",t.current.version||(0,td.formatSha)(t.current.sha),t.current.version&&(0,r.jsxs)("span",{className:"ml-1",children:["(",(0,td.formatSha)(t.current.sha),")"]})]}):(null==c?void 0:c.imageDigest)!=null?(0,r.jsxs)(x.EY,{className:(0,A.xW)("text-xs text-gray-500",l&&"text-pink-600"),children:["Version: ",(0,td.formatSha)(c.imageDigest)]}):(null==i?void 0:i.status)===eU.Uty.Initializing||(null==i?void 0:i.status)===eU.Uty.Building||(null==i?void 0:i.status)===eU.Uty.Deploying?(0,r.jsxs)(x.EY,{className:(0,A.xW)("text-xs text-gray-500 flex items-center gap-2",l&&"text-pink-600"),children:[(0,r.jsx)(eO.Rh,{size:10})," ",(0,r.jsx)("span",{children:"Deploying"})]}):null};var tE=n(56014),tI=n(15857),tA=n(25952),tD=n(26191);let tR=e=>{let{service:t,environmentId:n,repoName:a,upstreamUrl:s}=e,o=(0,ta.KP)(),[d,u]=(0,i.useState)(null),[p,m]=(0,i.useState)(!1),{modalActions:g}=(0,ep.U)(),{graphqlClient:v}=(0,eS.q)(),f=(0,l.md)(tI.T6),y=(0,l.md)(c.vA),j=(0,i.useMemo)(()=>{let e=[{name:t.name,id:t.id}];if(null==f||null==y||null==y.services)return e;let n=(0,eN.parseGitUrl)(s);if(null==n)return e;for(let r of Object.keys(y.services)){if(r===t.id)continue;let{source:l}=y.services[r];if(null==l||null==l.upstreamUrl||null==l.repo)continue;let i=(0,eN.parseGitUrl)(l.upstreamUrl);if(null!=i&&i.repo===l.repo&&i.repo===n.repo){let t=f.services.find(e=>e.id===r);if(null==t)continue;e.push({id:r,name:t.name})}}return e},[y,t,s,f]),b=async()=>{if(null!=d){m(!0);try{let e=j.map(e=>e.id);await v.templateServiceSourceEject({input:{upstreamUrl:s,repoName:a,repoOwner:d,serviceIds:e,projectId:t.projectId}}),g.createToast((0,r.jsx)(em.y8,{variant:"success",title:"Service ejected",description:"Your service has been ejected from the template and a new repository created in the ".concat(d," organization.")})),g.exitModal()}catch(t){var e;g.createToast((0,r.jsx)(em.y8,{title:"Error ejecting service",variant:"error",description:null!=(e=t.message)?e:"There was an error ejecting your service."}))}m(!1)}};return(0,r.jsxs)(eY.aF,{title:"Eject service from template",children:[(0,r.jsxs)(h.T,{space:4,children:[(0,r.jsx)(eY.wt,{children:"Eject service from Template"}),(0,r.jsx)(eY.xW,{children:"Ejecting will remove the connection to the upstream URL and create a new repository in your account. Please choose the organization to create the repository into:"})]}),o.isLoading&&(0,r.jsxs)(h.T,{space:4,children:[(0,r.jsxs)(h.T,{children:[(0,r.jsx)(to.g,{width:"100%",height:"48px"}),(0,r.jsx)(to.g,{width:"100%",height:"48px"}),(0,r.jsx)(to.g,{width:"100%",height:"48px"})]}),(0,r.jsx)(to.g,{width:"100%",height:"76px"}),(0,r.jsx)(to.g,{width:"100%",height:"48px"})]}),o.error&&(0,r.jsx)(x.yn,{children:"There was an error fetching your orgs."}),null!=o.data&&(0,r.jsxs)(eP.lV,{className:"mt-6 space-y-6 w-full",onSubmit:b,children:[(0,r.jsx)(tA.z6,{defaultValue:null!=d?d:void 0,onValueChange:e=>u(e),className:"space-y-1",children:o.data.map(e=>(0,r.jsx)("label",{htmlFor:e,className:(0,A.xW)("flex items-center justify-between","px-4 py-3 rounded-md","cursor-pointer hover:bg-pink-50",null!=d&&e===d?"bg-pink-50":"bg-gray-50"),children:(0,r.jsxs)(h.z,{align:"center",space:3,children:[(0,r.jsx)(tA.qj,{value:e,id:e,children:(0,r.jsx)(tA.kl,{})}),(0,r.jsx)(x.EY,{children:e})]})},e))}),(0,r.jsx)(q.l,{variant:"info",children:(0,r.jsxs)("span",{children:["Your ",(0,L.td)("service",j.length),":"," ",(0,r.jsx)("strong",{children:j.map(e=>e.name).join(", ")})," ","will be ejected from the upstream URL in ALL environments and re-deployed upon successful ejection."]})}),(0,r.jsxs)(h.z,{justify:"end",align:"center",space:4,className:"w-full",children:[(0,r.jsx)(C.$n,{type:"button",variant:"outline",onClick:()=>g.exitModal(),children:"Cancel"}),(0,r.jsx)(C.$n,{type:"submit",disabled:null==d||p,isLoading:p,children:"Eject service"})]})]})]})},tP=e=>{var t,n;let{isStaged:l,serviceInstanceConfig:i,onSubmit:a}=e,s=null==(n=i.deploy)||null==(t=n.registryCredentials)?void 0:t.password;return(0,r.jsxs)("div",{className:"flex flex-col gap-y-3",children:[(0,r.jsx)(S.j,{label:{text:"GitHub Access Token",hidden:!1},isStaged:l,onChange:e=>{a(td.DEFAULT_GHCR_USERNAME,e)},type:"password",value:s}),(0,r.jsx)(q.l,{className:"items-center",variant:"info",children:(0,r.jsxs)("span",{className:"text-sm text-blue-500",children:["To learn more about authenticating with GitHub Container Registry, visit the"," ",(0,r.jsx)(m.N,{href:"https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-container-registry#authenticating-to-the-container-registry",variant:"underline",children:"GitHub documentation ↗"}),"."]})})]})},tO=e=>{var t,n,l;let{isStaged:a,onSubmit:s,serviceInstanceConfig:o}=e,[c,d]=(0,i.useState)({username:!1,password:!0}),u=null==o||null==(t=o.deploy)?void 0:t.registryCredentials,{formState:{errors:p,isDirty:m,isValid:h},handleSubmit:x,register:g}=(0,ej.mN)({defaultValues:{username:null==u?void 0:u.username,password:null==u?void 0:u.password}}),f=x(e=>{let{username:t,password:n}=e;s(t,n)}),j=(0,A.xW)([a&&"bg-pink-50 text-pink-600 border-pink-100 hover:border-pink-400"]);return(0,r.jsxs)(eP.lV,{className:"flex flex-col gap-y-3",onSubmit:f,children:[(0,r.jsx)(y.pd,{className:j,contentRight:(0,r.jsx)(C.K0,{icon:c.username?v.kU3:v.X_F,onClick:()=>{d(e=>({...e,username:!e.username}))},title:c.username?"Show username":"Hide username",type:"button"}),error:null==(n=p.username)?void 0:n.message,label:"Username",type:c.username?"password":"text",...g("username",{required:"This value is required."})}),(0,r.jsx)(y.pd,{className:j,contentRight:(0,r.jsx)(C.K0,{icon:c.password?v.kU3:v.X_F,onClick:()=>{d(e=>({...e,password:!e.password}))},title:c.password?"Show password":"Hide password",type:"button"}),error:null==(l=p.password)?void 0:l.message,label:"Password",type:c.password?"password":"text",...g("password",{required:"This value is required."})}),(0,r.jsx)(C.$n,{className:"mt-2",disabled:h?!m:!h,type:"submit",children:"Set credentials"})]})},tT=e=>{var t,n;let{id:l,imageDetails:a,isStaged:s,isPro:o=!1,service:c,serviceInstanceConfig:d}=e,u=(0,td.validateGHCR)(null!=(n=a.domain)?n:""),{updateServiceConfig:p}=(0,k.w)(c.id),[m,h]=(0,i.useState)(!1),{routes:x}=(0,N.c)(),g=null==d||null==(t=d.deploy)?void 0:t.registryCredentials,f=(e,t)=>{p({deploy:{registryCredentials:{username:e,password:t}}})},y=m||g;return(0,r.jsxs)("div",{id:l,children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-sm font-semibold",children:"Registry Credentials"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Private Docker Registry credentials used to deploy your Docker image."})]}),(m||g)&&(0,r.jsx)(C.K0,{icon:v.Hsy,onClick:()=>{g&&p({deploy:{registryCredentials:null}}),h(!1)},variant:"outline",title:"Remove registry credentials",type:"button"})]}),y&&u&&(0,r.jsx)(tP,{isStaged:s,onSubmit:f,serviceInstanceConfig:d}),y&&!u&&(0,r.jsx)(tO,{isStaged:s,onSubmit:f,serviceInstanceConfig:d}),!o&&(0,r.jsx)(q.l,{className:"items-center",variant:"info",children:(0,r.jsxs)("div",{className:"flex items-center justify-between gap-x-3",children:[(0,r.jsx)("p",{className:"text-sm text-blue-500",children:"Private Docker Registry credentials are only supported on the Pro plan. If you would like to deploy a private registry, please upgrade to the Pro plan."}),(0,r.jsx)(C.vx,{className:"py-5 text-center",color:"blue",size:"xs",variant:"outline",...x.pricing({}),children:"Upgrade to Pro"})]})}),o&&!m&&!g&&(0,r.jsx)(q.l,{className:"items-center",variant:"info",children:(0,r.jsxs)("div",{className:"flex items-center justify-between gap-x-3",children:[(0,r.jsx)("p",{className:"text-sm text-blue-500",children:"If you are trying to deploy a private Docker image, please add your Docker Registry credentials."}),(0,r.jsx)(C.$n,{className:"py-5",color:"blue",size:"xs",variant:"outline",onClick:()=>{h(!0)},children:"Add credentials"})]})})]})};var tM=n(29240);let tz=()=>(0,r.jsx)(q.l,{variant:"warning",size:"sm",className:"mb-3",children:"Static IPs are not available for services deploying to multiple regions."});var tF=n(4766),tL=n(13786),tW=n(75749),tU=n(36299);let t_=e=>{let{min:t,max:n,step:l,disabled:i=!1,value:a,onValueChange:s,onValueCommit:o}=e;return(0,r.jsxs)(tU.bL,{className:"relative flex items-center select-none touch-none h-5 w-full rdx-disabled:opacity-30",min:t,max:n,step:l,value:a,onValueChange:s,onValueCommit:o,disabled:i,children:[(0,r.jsx)(tU.CC,{className:"relative grow rounded-full bg-black/15 dark:bg-gray-200 h-2",children:(0,r.jsx)(tU.Q6,{className:"absolute rounded-full h-full bg-pink-500 dark:bg-pink-300"})}),(0,r.jsx)(tU.zi,{className:"block w-4 h-4 rounded bg-background dark:bg-pink-300 border-2 border-pink-500 dark:border-white"})]})};var tV=n(10733);let tB=e=>{let{currentValue:t,existingValue:n,label:l,unit:i,onCancel:a,limitLabel:s="Plan limit",...o}=e;return(0,r.jsxs)(h.T,{space:2,className:(0,A.xW)("p-4 rounded-t-md transition-colors ease-out",n!==t&&"bg-pink-100"),children:[(0,r.jsxs)(h.z,{justify:"between",align:"center",className:"h-5",children:[(0,r.jsxs)(x.xC,{children:[l,":"," ",(0,r.jsxs)("span",{className:(0,A.xW)("font-semibold text-foreground",n!==t&&"text-pink-700"),children:[t," ",i]})]}),n!==t&&a?(0,r.jsx)(h.z,{space:3,align:"center",children:(0,r.jsx)(C.z9,{className:"text-sm text-gray-500",variant:"highlight",onClick:a,children:"Cancel"})}):(0,r.jsxs)(x.xC,{children:[s,": ",o.max," ",i]})]}),(0,r.jsx)(t_,{...o})]})},tG=e=>{let{open:t,onOpenChange:n,title:l,message:i,onOk:a}=e;return(0,r.jsx)(tV.a.Root,{open:t,onOpenChange:n,title:l,children:(0,r.jsxs)(h.T,{space:4,className:"max-w-lg",children:[(0,r.jsx)("div",{className:"space-y-3",children:i}),(0,r.jsx)("div",{className:"flex items-center justify-end w-full",children:(0,r.jsx)(C.$n,{color:"pink",onClick:()=>{null==a||a(),n(!1)},children:"Ok"})})]})})},tY=e=>{var t,n,a,s,o,d,u,p,x,g,y,j,k,C,S,E,I,A,D,R,P,O,T,M,z,F,L,W;let{id:U,serviceId:_,environmentId:V,projectId:B,serviceInstanceConfig:G,planLimits:Y,teamId:H,canEdit:K,isTrial:X,manifestFileInfo:Z}=e,J=null==(t=(0,l.md)(c.EQ).services)?void 0:t[_],[Q,ee]=(0,i.useState)(!1),{limitOverride:et}=(0,tL.B)({projectId:B,serviceId:_,environmentId:V,enabled:!0}),en=null==et||null==(a=et.data)||null==(n=a.serviceInstanceLimitOverride)?void 0:n.admin,er=null!=(T=null==en||null==(s=en.containers)?void 0:s.cpu)?T:Y.containers.cpu,el=null!=(M=null==en||null==(o=en.containers)?void 0:o.memoryBytes)?M:Y.containers.memoryBytes,ei=(0,tF.bytesToGigaBytes)(el),ea=null!=(z=null==J||null==(p=J.deploy)||null==(u=p.limitOverride)||null==(d=u.containers)?void 0:d.cpu)?z:Y.containers.cpu,eo=(null==en||null==(x=en.containers)?void 0:x.cpu)!=null,[ec,ed]=(0,i.useState)(null!=(F=null==G||null==(j=G.deploy)||null==(y=j.limitOverride)||null==(g=y.containers)?void 0:g.cpu)?F:ea),eu=null!=(L=null==J||null==(S=J.deploy)||null==(C=S.limitOverride)||null==(k=C.containers)?void 0:k.memoryBytes)?L:Y.containers.memoryBytes,ep=(null==en||null==(E=en.containers)?void 0:E.memoryBytes)!=null,[em,eh]=(0,i.useState)(null!=(W=null==G||null==(D=G.deploy)||null==(A=D.limitOverride)||null==(I=A.containers)?void 0:I.memoryBytes)?W:eu),ex=(0,tF.bytesToGigaBytes)(em),eg=(null==Z||null==(R=Z.deploy)?void 0:R.limitOverride)!=null,ev=null==G||null==(P=G.deploy)?void 0:P.multiRegionConfig,ef=ev?Object.values(ev).reduce((e,t)=>{var n;return e+(null!=(n=null==t?void 0:t.numReplicas)?n:0)},0):1;(0,i.useEffect)(()=>{var e,t,n,r,l,i,a,s;ed(null!=(a=null==G||null==(n=G.deploy)||null==(t=n.limitOverride)||null==(e=t.containers)?void 0:e.cpu)?a:ea),eh(null!=(s=null==G||null==(i=G.deploy)||null==(l=i.limitOverride)||null==(r=l.containers)?void 0:r.memoryBytes)?s:eu)},[G,ea,eu]);let{showModal:ey}=(0,es.h)(),{routes:ej}=(0,N.c)(),eb=(0,$.y3)(),ew=async e=>{if(ef*e>tF.MAX_TOTAL_CPU)return void ey(tG,{title:"Quota Exceeded",message:(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("p",{children:"This configuration would put you above your quota."}),(0,r.jsx)("p",{children:"To raise CPU, please lower your replica count first."}),(0,r.jsxs)("p",{children:["Need more?"," ",(0,r.jsx)("a",{href:"https://cal.com/team/railway/work-with-railway",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-600 underline",children:"Talk to us"})]})]})});eb.stageEnvironmentChanges({payload:(0,w.newEnvironmentConfig)(eb.getStagedChanges()).updateService(_,{deploy:{limitOverride:{containers:{cpu:e}}}}).build()})},eN=async e=>{if(ef*e>tF.MAX_TOTAL_MEMORY_GB)return void ey(tG,{title:"Quota Exceeded",message:(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("p",{children:"This configuration would put you above your quota."}),(0,r.jsx)("p",{children:"Please lower your replica count if you'd like to raise memory per replica."}),(0,r.jsxs)("p",{children:["Need more than that?"," ",(0,r.jsx)("a",{href:"https://cal.com/team/railway/work-with-railway",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-600 underline",children:"Talk to us"})]})]})});let t=e=>{let t=(0,tF.bytesInGigaByte)(e);eb.stageEnvironmentChanges({payload:(0,w.newEnvironmentConfig)(eb.getStagedChanges()).updateService(_,{deploy:{limitOverride:{containers:{memoryBytes:t}}}}).build()})};if(e<=2&&!Q)return void ey(tG,{title:"Limit Memory to ".concat(e," GB"),message:"If your service uses more than the max memory limit, it may crash. Are you sure you want to set this limit?",onOk:()=>{ee(!0),t(e)}});t(e)},ek=null!=en;return(0,r.jsxs)(b.XY,{id:U,children:[(0,r.jsxs)(b.O5,{children:[(0,r.jsx)(b.fA,{id:U,children:"Resource Limits"}),(0,r.jsxs)(b.$0,{children:["Max amount of vCPU and Memory to allocate to each replica for this service.",ek&&(0,r.jsx)(q.l,{className:"items-center mt-3",variant:"info",children:(0,r.jsx)("p",{className:"text-sm text-blue-500",children:"Admin overrides are in effect for this service."})})]})]}),(0,r.jsx)(b.a,{fileInfo:null==Z||null==(O=Z.deploy)?void 0:O.limitOverride,children:(0,r.jsxs)(h.T,{space:4,children:[(0,r.jsxs)("div",{className:"border border-gray-200 rounded-md",children:[(0,r.jsx)(tB,{label:"CPU",unit:"vCPU",currentValue:ec,existingValue:ea,min:.5,step:1,limitLabel:eo?"Admin limit":"Plan limit",max:er,disabled:!K||eg,value:[ec],onValueChange:e=>ed(e[0]),onValueCommit:e=>ew(e[0]),onCancel:eg?void 0:()=>ew(ea)}),(0,r.jsx)(tW.c,{className:"my-0"}),(0,r.jsx)(tB,{label:"Memory",unit:"GB",currentValue:ex,existingValue:(0,tF.bytesToGigaBytes)(eu),min:.5,step:1,limitLabel:ep?"Admin limit":"Plan limit",max:ei,disabled:!K||eg,value:[ex],onValueChange:e=>eh((0,tF.bytesInGigaByte)(e[0])),onValueCommit:e=>eN(e[0]),onCancel:eg?void 0:()=>eN((0,tF.bytesToGigaBytes)(eu))})]}),(0,r.jsxs)(h.z,{align:"center",space:2,children:[(0,r.jsx)(f.In,{icon:v.tXn,className:"text-pink-500"}),(0,r.jsx)(m.N,{...ej.workspacePlan({teamId:H}),variant:"coloured",className:"text-sm",children:X?"Upgrade to toggle resource limits":"Increase your resources"})]})]})})]})};var t$=n(16436),tH=n.n(t$),tq=n(78086),tK=n(61208),tX=n(87248),tZ=n(32704),tJ=n.n(tZ),tQ=n(15945);let t0=e=>{let{regions:t,selectedRegion:n,onChange:l,isStaged:a,readOnly:s}=e,o=(0,i.useMemo)(()=>t.map(e=>({value:e.name,label:(0,er.sn)(e),render:(0,r.jsxs)("div",{className:"grid grid-cols-[24px_1fr_auto] gap-2 items-center py-1.5",children:[(0,r.jsx)(tK.lN,{country:e.country}),(0,r.jsx)(x.EY,{children:(0,er.sn)(e)}),e.railwayMetal?null:(0,r.jsx)(h.z,{className:"uppercase bg-neutral-button rounded-full font-semibold text-neutral-secondary text-center min-w-[4rem] max-h-max my-auto",center:!0,children:(0,r.jsx)(x.tj,{children:"Legacy"})}),e.teamId?(0,r.jsx)(h.z,{className:"uppercase bg-pink-500 rounded-full font-semibold text-white text-center min-w-[6rem] max-h-max my-auto",children:(0,r.jsx)(x.tj,{children:"Dedicated"})}):null]})})),[t]);return(0,r.jsx)(tc._,{options:o,value:n,onChange:e=>{l(e)},isStaged:a,disabled:s})},t1=e=>{let{value:t,max:n,onChange:l,disabled:a,isStaged:s,readOnly:o,region:c,onValidate:d,showToast:u}=e,[p,m]=(0,i.useState)(null==t?"":t.toString()),h=(0,i.useMemo)(()=>tJ()(l,tv.Xc),[]);return(0,r.jsx)(y.pd,{label:{text:"Replicas",hidden:!0},type:"number",placeholder:"1",suffix:(0,L.td)("Instance",null!=t?t:1),suffixStyles:(0,A.xW)("text-gray-500 text-sm z-10 pointer-events-none",s&&"text-pink-600"),value:p,onChange:e=>(e=>{if(""===e){m(e),h(1);return}let t=parseInt(e,10);if(!isNaN(t)&&t>0){let e=Math.min(Math.max(t,1),n);if(d){let t=d(e,c);if(!t.valid){t.error&&u&&u(t.error);return}}m(e.toString()),h(e),e!==t&&m(e.toString())}})(e.target.value),onWheel:e=>{e.target.blur()},min:1,max:n,disabled:a,readOnly:o,className:(0,A.xW)(s&&"bg-pink-50 text-pink-600 border-pink-100 hover:border-pink-400")})},t5=e=>{let{regions:t,selectedRegion:n,numReplicas:l,stackerAssignment:a,onRegionChange:s,onNumReplicasChange:c,onStackerAssignmentChange:d,onRemoveRegion:u,canRemoveRegion:p,hasVolume:m,isStaged:x,maxReplicas:g,readOnly:f,hasCronSchedule:y,hasEgressGateways:j,hasMetalVolume:b,onValidateReplicas:w,showToast:N}=e,[k]=(0,o.Jd)(),[S,E]=(0,i.useState)(null!=a);return(0,r.jsxs)(h.T,{space:2,children:[(0,r.jsxs)(h.z,{space:2,align:"center",children:[(0,r.jsx)("div",{className:"w-full",children:(0,r.jsx)(t0,{regions:t,selectedRegion:n,onChange:e=>s({oldRegion:n,newRegion:e,numReplicas:l}),isStaged:x,readOnly:f||j})}),(0,r.jsx)("div",{className:"w-28 flex-shrink-0",children:(0,r.jsx)(t1,{value:l,max:g,onChange:e=>c({region:n,updatedNumReplicas:e}),disabled:m||y||"ALL_STACKERS"===a,isStaged:x,readOnly:f,region:n,onValidate:w,showToast:N})}),p&&(0,r.jsx)(C.K0,{title:"Remove Region",type:"button",variant:"ghost",icon:v.lMJ,onClick:()=>u(n)}),k.isAdmin&&(0,r.jsx)(C.K0,{title:"Stacker Assignment",type:"button",variant:S?"primary":"ghost",color:"pink",icon:v.qgk,onClick:()=>{d({region:n,stackerAssignment:null}),E(!S)}})]}),S&&k.isAdmin&&(0,r.jsx)(t3,{region:n,selected:a,isStaged:x,hasVolume:m,onChange:e=>{d({region:n,stackerAssignment:e})}})]})},t3=e=>{let{region:t,selected:n,isStaged:l,hasVolume:a,onChange:s}=e,{stackers:o}=(0,tQ.gp)({region:t}),{isConfirmed:c}=(0,eb.S)(),d=(0,i.useMemo)(()=>o&&0!==o.length?[{value:"",label:"Random scheduling"},...o.map(e=>{var t,n;return{value:null!=(t=null==e?void 0:e.IP)?t:"",label:null!=(n=null==e?void 0:e.hostname)?n:""}}),...a?[]:[{value:"ALL_STACKERS",label:"All Stackers in this region",render:(0,r.jsxs)("div",{className:"flex items-center gap-2 px-4 py-1 text-pink-500",children:[(0,r.jsx)(f.In,{icon:v.hcu,className:"w-5 h-5"}),(0,r.jsx)(x.EY,{children:"All Stackers in this region"}),(0,r.jsx)(f.In,{icon:v.hcu,className:"w-5 h-5"})]})}]]:[],[o,a]);return o&&0!==o.length?(0,r.jsxs)(h.z,{space:2,align:"center",className:"pl-8 w-full text-pink-500",children:[(0,r.jsx)(f.In,{icon:v.Sbc,className:"-mt-1"}),(0,r.jsx)(x.EY,{className:"text-pink-500 shrink-0",children:"Deploy to:"}),(0,r.jsx)("div",{className:"w-full",children:(0,r.jsx)(tc._,{options:d,isStaged:l,value:null!=n?n:"",onChange:async e=>{("ALL_STACKERS"!==e||await c({confirmLabel:"Deploy to All Stackers",message:(0,r.jsxs)(h.T,{space:2,children:[(0,r.jsx)("p",{children:"This will create as many replicas as there are stackers in this region."}),(0,r.jsx)("p",{className:"text-red-500",children:"It should be used with caution, as it can lead to high resource usage."}),(0,r.jsx)("p",{children:"Are you sure you want to proceed?"})]}),title:"Deploy to All Stackers"}))&&s(""!==e?e:null)}})})]}):null},t2=()=>(0,r.jsx)(q.l,{variant:"primary",size:"sm",className:"mb-3 gap-3 ",children:(0,r.jsxs)("div",{className:"flex items-center justify-between gap-2 w-full flex-wrap",children:[(0,r.jsx)("p",{children:"Multi-region replicas are only available on the Pro plan."}),(0,r.jsxs)(m.N,{url:"https://railway.com/workspace/plans",className:"block group",children:[(0,r.jsx)("span",{className:"mr-1 group-hover:underline",children:"Learn More"}),(0,r.jsx)(v.lth,{})]})]})}),t6=()=>(0,r.jsx)(q.l,{className:"items-center mt-3",variant:"info",children:(0,r.jsx)("p",{className:"text-sm text-blue-500",children:"Replication is not available for services that have a cron schedule or a volume attached."})}),t4=()=>(0,r.jsx)(q.l,{className:"items-start mt-3 border !border-warn-light",variant:"warning",children:(0,r.jsxs)(h.T,{space:1,className:"!text-yellow-700 text-base",children:[(0,r.jsx)("div",{className:"font-medium",children:"Heads up!"}),(0,r.jsx)("p",{children:"Migrating this service will cause some downtime while we move its volume's content to the new region."})]})}),t9=()=>(0,r.jsx)(q.l,{variant:"warning",size:"sm",className:"mb-3",children:"You must disable Static Outbound IPs to switch regions."}),t7=()=>(0,r.jsx)(q.l,{variant:"primary",size:"sm",className:"mb-3 gap-3 ",children:(0,r.jsxs)("div",{className:"flex items-center justify-between gap-2 w-full flex-wrap",children:[(0,r.jsx)("p",{children:"Regions and Replicas are only available on paid plans."}),(0,r.jsxs)(m.N,{url:"https://railway.com/workspace/plans",className:"block group",children:[(0,r.jsx)("span",{className:"mr-1 group-hover:underline",children:"Learn More"}),(0,r.jsx)(v.lth,{})]})]})}),t8=e=>{var t,n,s,d,u,p,m,x,g,f,y,j;let{id:N,service:k,environment:S,serviceInstanceConfig:E,manifestFileInfo:I,permissions:A,stagedServiceInstanceConfig:D}=e,R=(0,$.aQ)(S.id),{modalActions:P}=(0,ep.U)(),O=(0,l.md)(c.Af),T=null==O?void 0:O.volumeInstances.find(e=>e.serviceId===k.id),M=(0,l.md)(tq.Or),{egressGateways:z}=(0,e_.M)({projectId:S.projectId,environmentId:S.id,serviceId:k.id}),[{user:F}]=(0,o.Jd)(),{isPro:L,isFree:W,workspace:U}=(0,a.hA)(),_=e=>{P.createToast((0,r.jsx)(em.y8,{variant:"error",title:"Replica Limit Exceeded",description:e}))},V=()=>{var e,t,n,r;let l=er.B9,i=null!=(n=null==(e=E.deploy)?void 0:e.numReplicas)?n:1;return{region:null!=(r=null==(t=E.deploy)?void 0:t.region)?r:l,numReplicas:i}},[B,G]=(0,i.useState)(new Set([])),[Y,H]=(0,i.useState)(!1),q=null==(t=E.deploy)?void 0:t.multiRegionConfig,K=null==D||null==(n=D.deploy)?void 0:n.multiRegionConfig,X=(0,i.useMemo)(()=>{if(null==q&&null==K){let{region:e,numReplicas:t}=V();return 1===B.size&&B.has(e)||G(new Set([e])),{[e]:{numReplicas:t}}}let e=tH()({},q,K),t=new Set(Object.keys(e)),n=Array.from(B).filter(e=>!t.has(e));return(0===B.size||n.length>0)&&G(t),e},[K,q]),Z=null!=E.volumeMounts||(null==D?void 0:D.volumeMounts)!=null,J=null!=(f=null==(s=E.deploy)?void 0:s.runtime)?f:null==D||null==(d=D.deploy)?void 0:d.runtime,Q=(null==(u=E.deploy)?void 0:u.cronSchedule)!=null||(null==D||null==(p=D.deploy)?void 0:p.cronSchedule)!=null,ee=null!=z&&z.length>0,et=()=>{var e,t,n,r;let l=null==(e=R.getStagedChanges().services)?void 0:e[k.id],i=null==l||null==(t=l.deploy)?void 0:t.multiRegionConfig;if(!(null==(n=E.deploy)?void 0:n.multiRegionConfig)&&!i){let{region:e,numReplicas:t}=V();return{[e]:{numReplicas:t}}}return tH()({},null==(r=E.deploy)?void 0:r.multiRegionConfig,i)},en=(0,i.useMemo)(()=>{let e=null!=M?M:[],t=et(),n=Object.keys(t),r=Z&&n.some(t=>{var n;return null==(n=e.find(e=>e.region===t))?void 0:n.railwayMetal}),l=[];for(let o of e){var i,a,s;if(n.includes(o.name)&&null!=t[o.name])continue;let{deploymentConstraints:e,railwayMetal:c}=o;if((null==e?!void 0:!e.adminOnly)||(null==F?void 0:F.isAdmin)){if(null==(i=E.deploy)?void 0:i.useLegacyStacker){(null==e||null==(s=e.deprecationInfo)?void 0:s.isDeprecated)&&l.push(o);continue}(null==e||null==(a=e.deprecationInfo)||!a.isDeprecated||(null==U?void 0:U.allowDeprecatedRegions))&&(!r||(null==F?void 0:F.isAdmin)||c)&&(L||c||(null==F?void 0:F.isAdmin))&&l.push(o)}}return l},[M,L,Z,J,F,E,D,U]),el=(0,i.useMemo)(()=>Object.values(et()).reduce((e,t)=>{var n;return e+(null!=(n=null==t?void 0:t.numReplicas)?n:0)},0),[E,D]),ei=e=>{var t;let n=null==M?void 0:M.find(t=>t.name===e),r=null==n||null==(t=n.deploymentConstraints)?void 0:t.runtimeExclusivity;return(null==r?void 0:r.includes(null!=J?J:""))?null:null==r?void 0:r[0]},es=e=>{let{oldRegion:t,newRegion:n,numReplicas:r}=e,l=et();H(!Object.keys(l).includes(n)),G(e=>{let r=Array.from(e),l=r.indexOf(t);return r[l]=n,new Set(r)});let i=ei(n),a={...l,[t]:null,[n]:{numReplicas:r}};R.stageEnvironmentChanges({payload:(0,w.newEnvironmentConfig)(R.getStagedChanges()).updateService(k.id,{deploy:{multiRegionConfig:a,...i?{runtime:ea.parse(i)}:{}}}).build()})},ec=(0,l.md)(eo.G),{limitOverride:ed}=(0,tL.B)({projectId:k.projectId,serviceId:k.id,environmentId:S.id,enabled:!0}),eu=null==ed||null==(m=ed.data)?void 0:m.serviceInstanceLimitOverride,eh=null!=(j=null!=(y=null==eu||null==(x=eu.deploys)?void 0:x.replicas)?y:null==ec||null==(g=ec.deploys)?void 0:g.replicas)?j:50,ex=(e,t)=>{var n,r,l,i,a,s,o,c,d,u,p,m,h,x;let g=null==D||null==(n=D.deploy)?void 0:n.limitOverride,v=null==E||null==(r=E.deploy)?void 0:r.limitOverride,f=null!=(p=null!=(u=null!=(d=null==g||null==(l=g.containers)?void 0:l.cpu)?d:null==v||null==(i=v.containers)?void 0:i.cpu)?u:null==ec||null==(a=ec.containers)?void 0:a.cpu)?p:32,y=null!=(x=null!=(h=null!=(m=null==g||null==(s=g.containers)?void 0:s.memoryBytes)?m:null==v||null==(o=v.containers)?void 0:o.memoryBytes)?h:null==ec||null==(c=ec.containers)?void 0:c.memoryBytes)?x:32e9,j=(0,tF.bytesToGigaBytes)(y),b=Object.entries(et()).filter(e=>{let[n]=e;return n!==t}).reduce((e,t)=>{var n;let[,r]=t;return e+(null!=(n=null==r?void 0:r.numReplicas)?n:0)},0)+e,w=b*f,N=b*j;return w>tF.MAX_TOTAL_CPU?(tF.MAX_TOTAL_CPU,{valid:!1,error:"Cannot set ".concat(e," replicas: Total CPU would be ").concat(w," vCPU (exceeds ").concat(tF.MAX_TOTAL_CPU," limit). To scale to ").concat(e," replicas, reduce CPU per replica in Resource Limits or contact support to discuss your scaling needs.")}):N>tF.MAX_TOTAL_MEMORY_GB?(tF.MAX_TOTAL_MEMORY_GB,{valid:!1,error:"Cannot set ".concat(e," replicas: Total memory would be ").concat(N," GB (exceeds ").concat(tF.MAX_TOTAL_MEMORY_GB," GB limit). To scale to ").concat(e," replicas, reduce memory per replica in Resource Limits or contact support to discuss your scaling needs.")}):{valid:!0}},eg=e=>{let{region:t,updatedNumReplicas:n,stackerAssignment:r}=e,l=et(),i={...l,[t]:{...l[t],...null==n||n>eh?{}:{numReplicas:n},...void 0!==r?{stackerAssignment:r}:{}}};R.stageEnvironmentChanges({payload:(0,w.newEnvironmentConfig)(R.getStagedChanges()).updateService(k.id,{deploy:{multiRegionConfig:i}}).build()})},ev=e=>{G(t=>(t.delete(e),t));let t={...et(),[e]:null};R.stageEnvironmentChanges({payload:(0,w.newEnvironmentConfig)(R.getStagedChanges()).updateService(k.id,{deploy:{multiRegionConfig:t}}).build()})},ef=(0,i.useMemo)(()=>{let e=et();return Object.keys(e).filter(t=>null!=e[t]).length>1},[E,D]),ey=(0,i.useMemo)(()=>(null==I?void 0:I.deploy.multiRegionConfig)!=null||!A.Write||W,[null==I?void 0:I.deploy.multiRegionConfig,A.Write,W]),ej=(0,l.Xr)(er.I7),eb=Z&&B.size?ej(B.values().next().value):null,ew=!!(null==eb?void 0:eb.railwayMetal);return(0,r.jsxs)(b.XY,{id:N,children:[(0,r.jsxs)(b.O5,{children:[(0,r.jsx)(b.fA,{id:N,children:"Regions"}),(0,r.jsx)(b.$0,{children:"Configure how many instances of this service are deployed in each region."})]}),(0,r.jsx)(b.a,{fileInfo:null==I?void 0:I.deploy.multiRegionConfig,children:(0,r.jsx)(tX.I,{volumeInstanceId:null==T?void 0:T.id,volumeInstanceExternalId:null==T?void 0:T.externalId,view:"service_panel",className:"p-3.5",fallback:(0,r.jsx)(h.T,{className:"w-full px-1",space:4,children:Array.from(B).map(e=>{var t,n;let l=X[e],i=null==M?void 0:M.find(t=>t.name===e);if(null==i||null==l)return null;let a=l.numReplicas,s=l.stackerAssignment;return(0,r.jsx)(t5,{regions:[...en,i],selectedRegion:e,stackerAssignment:s,numReplicas:a,onRegionChange:es,onNumReplicasChange:eg,onStackerAssignmentChange:eg,onRemoveRegion:ev,canRemoveRegion:ef,hasVolume:Z,hasMetalVolume:ew,hasCronSchedule:Q,hasEgressGateways:ee,maxReplicas:null==a?eh:eh-(el-a),readOnly:ey,isStaged:(null==D||null==(n=D.deploy)||null==(t=n.multiRegionConfig)?void 0:t[e])!=null,onValidateReplicas:ex,showToast:_},e)})})})}),(0,r.jsx)("div",{className:"mt-3",children:Z&&Y?(0,r.jsx)(t4,{}):W?(0,r.jsx)(t7,{}):ee?(0,r.jsx)(t9,{}):Z||Q?(0,r.jsx)(t6,{}):L?en.length>0&&el<eh&&!ey?(0,r.jsx)(C.$n,{type:"button",variant:"outline",size:"sm",icon:v.FWt,className:"max-w-max",onClick:()=>{var e,t;let n=en[0],r=ei(n.name);if((null==(e=E.deploy)?void 0:e.multiRegionConfig)==null&&(null==D||null==(t=D.deploy)?void 0:t.multiRegionConfig)==null){let{region:e,numReplicas:t}=V();G(new Set([e,n.name])),R.stageEnvironmentChanges({payload:(0,w.newEnvironmentConfig)(R.getStagedChanges()).updateService(k.id,{deploy:{multiRegionConfig:{[e]:{numReplicas:t},[n.name]:{numReplicas:1}},...r?{runtime:ea.parse(r)}:{}}}).build()});return}G(e=>e.add(n.name));let l={...et(),[n.name]:{numReplicas:1}};R.stageEnvironmentChanges({payload:(0,w.newEnvironmentConfig)(R.getStagedChanges()).updateService(k.id,{deploy:{multiRegionConfig:l,...r?{runtime:ea.parse(r)}:{}}}).build()})},children:"Add Region"}):null:(0,r.jsx)(t2,{})})]})},ne=[{id:"source-empty",group:"Source",tags:["repo","image","git","github","docker"],render:e=>{var t;let{id:n,service:l,serviceInstanceConfig:a}=e,s=(0,$.y3)(),c=(0,ti.F)(s),d=(0,i.useCallback)(e=>({value:"connect-repo-".concat(e.id),text:e.fullName,icon:v.gqo,isPrivate:e.isPrivate,group:"",action:()=>{var t;return c.current.stageServiceChanges({serviceId:l.id,payload:{source:{repo:e.fullName,branch:e.defaultBranch,...(null==a||null==(t=a.source)?void 0:t.image)?{image:null}:{}}}})}}),[c,l.id,null==a||null==(t=a.source)?void 0:t.image]),u=(0,tl.DB)({prompt:"Select a repo",crumbs:["Connect Repo"],renderRepoCommand:d}),{isCommandPaletteOpen:p,openOrUpdateActiveCommandGroup:m,openCommandPalette:h}=(0,tt.oG)(),x=(0,w.getRepoSource)(a.source),g=(0,w.getImageSource)(a.source),{modalActions:f}=(0,ep.U)(),[{user:y}]=(0,o.Jd)();(0,i.useEffect)(()=>{p&&m(u)},[p,u]);let j=()=>{if(null!=y&&(!y.agreedFairUse||!y.termsAgreedOn))return void f.openSidePanel((0,r.jsx)(tr.C,{}))},N=(0,tn._x)(e=>{var t,n;s.stageServiceChanges({serviceId:l.id,payload:{source:{image:e,...(null==a||null==(t=a.source)?void 0:t.repo)!=null?{repo:null,branch:null}:{},...(null==a||null==(n=a.source)?void 0:n.upstreamUrl)!=null?{upstreamUrl:null}:{}}}})});return null!=x||null!=g?null:(0,r.jsxs)(b.XY,{id:n,children:[(0,r.jsxs)(b.O5,{children:[(0,r.jsx)(b.fA,{id:n,children:"Connect Source"}),(0,r.jsx)(b.$0,{children:"Connect your service to a GitHub repo or Docker image"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(C.$n,{variant:"outline",size:"sm",icon:v.gqo,onClick:()=>{j(),m(u)},className:"max-w-max",children:"Connect Repo"}),(0,r.jsx)(C.$n,{variant:"outline",size:"sm",icon:v.azJ,onClick:()=>{null!=N&&(j(),h(N))},className:"max-w-max",children:"Connect Image"})]})]})},isAvailable:e=>{let{serviceInstanceConfig:t}=e;return null==(0,w.getRepoSource)(t.source)&&null==(0,w.getImageSource)(t.source)}},tE.W,{id:"source-upstream",group:"Source",tags:["repo","upstream"],render:e=>{var t;let{id:n,service:a,environment:s,stagedServiceInstanceConfig:o}=e,{upstreamGitUrl:c,sourceIsUpstreamUrl:d}=(0,l.md)(ts.e),[u,p]=(0,i.useState)(!1),[g,y]=(0,i.useState)(!1),[j,w]=(0,i.useState)(!1),[N,k]=(0,i.useState)(!1),{modalActions:S}=(0,ep.U)(),{graphqlClient:E}=(0,eS.q)(),I=async()=>{try{p(!0);let e=(await E.serviceInstanceIsUpdatable({serviceId:a.id,environmentId:s.id})).serviceInstanceIsUpdatable;y(e)}catch(e){y(!1)}p(!1),k(!0)};return null==c?null:(0,r.jsxs)(b.XY,{id:n,children:[(0,r.jsx)(b.O5,{children:(0,r.jsx)(b.fA,{id:n,children:"Upstream Repo"})}),(0,r.jsxs)(b.FE,{className:"flex",isStaged:(null==o||null==(t=o.source)?void 0:t.repo)!=null,children:[(0,r.jsxs)(m.N,{href:c.cloneUrl,className:"flex items-center flex-grow space-x-3 min-w-0",children:[(0,r.jsx)(f.In,{icon:v.gqo}),(0,r.jsxs)(x.EY,{className:"truncate flex-grow space-x-2",children:[(0,r.jsx)("span",{className:"group-hover:underline",children:c.repo})," ",(0,r.jsx)("span",{"aria-hidden":!0,className:"hidden group-hover:inline text-gray-500",children:"↗"})]})]}),d&&!s.isEphemeral&&(0,r.jsx)(tb.n4,{children:(0,r.jsx)(C.$n,{size:"xs",variant:"outline",color:"red",icon:v.fQS,onClick:()=>{null!=c&&S.openModal((0,r.jsx)(tR,{service:a,environmentId:s.id,repoName:c.name,upstreamUrl:c.cloneUrl}))},children:"Eject"})})]}),null!=s&&!s.isEphemeral&&(0,r.jsx)(tb.n4,{children:(0,r.jsxs)(h.T,{className:"mt-2",children:[(0,r.jsxs)(ed.M,{isOpen:N,className:"overflow-hidden",children:[j&&(0,r.jsx)(h.z,{justify:"between",align:"center",className:"bg-blue-50 border border-blue-100 rounded-md px-3 py-1",children:(0,r.jsx)(x.ax,{className:"text-blue-600",children:"Upstream repository is being updated. We will send you an email when done."})}),!j&&g&&(0,r.jsxs)(h.z,{justify:"between",align:"center",className:"bg-pink-50 border border-pink-100 rounded-md px-3 py-1",children:[(0,r.jsx)(x.ax,{className:"text-pink-600",children:"New version of the upstream repo available!"}),(0,r.jsxs)(C.z9,{color:"pink",size:"xs",icon:v.e9t,onClick:()=>{null!=c&&S.openModal((0,r.jsx)(tD.c,{serviceId:a.id,environmentId:s.id,serviceName:a.name,sourceRepo:c.cloneUrl,isSourceSameAsUpstream:d,onSuccess:()=>w(!0)}))},className:"hover:underline text-sm text-pink-500 flex items-center space-x-2",children:[(0,r.jsx)(f.In,{icon:v.e9t}),(0,r.jsx)(x.ax,{children:"Update"})]})]}),!j&&!g&&(0,r.jsxs)(h.z,{justify:"between",align:"center",className:"bg-blue-50 border border-blue-100 rounded-md px-3 py-1",children:[(0,r.jsx)(x.ax,{className:"text-blue-600",children:"You're on the latest version of this repository."}),(0,r.jsx)(C.K0,{icon:v.X,variant:"ghost",size:"xs",title:"Dismiss",onClick:()=>k(!1)})]})]}),(0,r.jsx)(ed.M,{isOpen:!N,children:(0,r.jsx)(C.$n,{type:"button",variant:"outline",size:"xs",icon:v.e9t,onClick:I,isLoading:u,disabled:u,className:"max-w-max",children:"Check for updates"})})]})})]})},isAvailable:e=>{var t;let{serviceInstanceConfig:n}=e;return(null==(t=n.source)?void 0:t.upstreamUrl)!=null}},{id:"source-branch",group:"Source",tags:["repo","branch"],render:e=>{var t,n,i,a,s,o,c,d,p;let{id:m,service:g,serviceInstanceConfig:y,stagedServiceInstanceConfig:j,environment:N}=e,k=(0,l.md)(u.mz),S=(0,w.getRepoSource)(y.source),E=(0,l.md)(ts.e),I=(0,$.y3)(),D=(0,ta.Zb)({fullRepoName:null!=(o=null==S?void 0:S.repo)?o:"",enabled:null!=S&&(null==(t=y.source)?void 0:t.branch)==null}),R=(0,ta.QB)({fullName:null==S?void 0:S.repo,enabled:k&&!E.sourceIsUpstreamUrl}),{modalActions:P}=(0,ep.U)(),O=(null!=(c=R.data)?c:[]).find(e=>{var t;return e.name===(null==(t=y.source)?void 0:t.branch)}),T=null!=(d=null==(n=R.data)?void 0:n.map(e=>e.name))?d:[];return(O||null==R.data||(null==(i=y.source)?void 0:i.branch)==null||T.push(null==(p=y.source)?void 0:p.branch),null==S)?null:(0,r.jsxs)(b.XY,{id:m,children:[(0,r.jsxs)(b.O5,{children:[(0,r.jsxs)(b.fA,{id:m,children:["Branch connected to ",N.name]}),(0,r.jsx)(b.$0,{children:E.sourceIsUpstreamUrl?(0,r.jsx)(r.Fragment,{children:"Updates will be pulled from the latest commit on this GitHub branch."}):(0,r.jsx)(r.Fragment,{children:"Changes made to this GitHub branch will be automatically pushed to this environment."})})]}),R.isLoading?(0,r.jsx)(to.g,{width:"100%",height:"44px"}):null!=R.error?(0,r.jsx)(q.l,{variant:"danger",size:"sm",className:"h-md items-center",children:"Not Found"===R.error.message?"Repo not found":R.error.message}):(null==(a=y.source)?void 0:a.branch)==null?(0,r.jsx)(C.$n,{type:"button",variant:"outline",size:"sm",disabled:!k||E.sourceIsUpstreamUrl,onClick:async()=>{if(null==D.data)return void P.createToast((0,r.jsx)(em.y8,{variant:"error",title:"Error",description:"".concat(S.repo," not found. Are you sure the repo exists and you have access to it?")}));I.stageServiceChanges({serviceId:g.id,payload:{source:{branch:D.data.defaultBranch}}})},className:"max-w-max",children:"Connect Environment to Branch"}):(0,r.jsxs)(h.T,{space:1,children:[(0,r.jsx)(b.FE,{className:(0,A.xW)("flex items-center justify-between gap-4 py-0",!O&&!E.sourceIsUpstreamUrl&&"border-red-500"),isStaged:(null==j||null==(s=j.source)?void 0:s.branch)!=null,children:E.sourceIsUpstreamUrl?(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(h.z,{align:"center",space:2,className:"w-full py-2",children:[(0,r.jsx)(f.In,{icon:v.lg3}),(0,r.jsx)(x.EY,{children:y.source.branch})]})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(h.z,{align:"center",space:2,className:"w-full",children:[(0,r.jsx)(f.In,{icon:v.lg3}),(0,r.jsx)(tc._,{name:"branch",parentStyles:"w-full p-2",selectStyles:"border-none",value:y.source.branch,disabled:!k||E.sourceIsUpstreamUrl,searchable:!0,onChange:e=>{I.stageServiceChanges({serviceId:g.id,payload:{source:{branch:e}}})},options:null==R.data?[{value:y.source.branch}]:T.map(e=>({value:e}))})]}),(0,r.jsx)(C.$n,{type:"button",variant:"outline",size:"xs",color:"gray",disabled:!k||E.sourceIsUpstreamUrl,onClick:()=>{I.stageServiceChanges({serviceId:g.id,payload:{source:{branch:null}}})},className:"max-w-max",children:"Disconnect"})]})}),null!=R.data&&!O&&(0,r.jsx)("p",{className:"text-red-600 text-sm",children:"Connected branch does not exist"})]})]})},isAvailable:e=>{let{serviceInstanceConfig:t}=e;return null!=(0,w.getRepoSource)(t.source)}},{id:"source-repo-checksuites",group:"Source",tags:["repo","check suites","action","github"],render:e=>{var t,n,l,i;let{id:a,service:s,serviceInstanceConfig:o,stagedServiceInstanceConfig:c,permissions:d}=e,u=(0,$.y3)();return(0,r.jsxs)(b.XY,{id:a,children:[(0,r.jsxs)(b.O5,{children:[(0,r.jsx)(b.fA,{id:a,children:"Wait for CI"}),(0,r.jsx)(b.$0,{children:"Trigger deployments after all GitHub actions have completed successfully."})]}),(0,r.jsx)(b.FE,{className:"flex",isStaged:(null==c||null==(t=c.source)?void 0:t.checkSuites)!=null,children:(0,r.jsx)(K.N,{id:"check-suites",disabled:!d.Write,checked:null!=(i=null==(n=o.source)?void 0:n.checkSuites)&&i,onCheckedChange:e=>{u.stageServiceChanges({serviceId:s.id,payload:{source:{checkSuites:e}}})},children:"Wait for CI"})}),(null==(l=o.source)?void 0:l.checkSuites)&&(0,r.jsxs)(x.ae,{className:"mt-2",children:["Make sure you have"," ",(0,r.jsx)(m.N,{href:"https://github.com/settings/installations",variant:"underline",children:"accepted our updated GitHub permissions"})," ","required for this feature."]})]})},isAvailable:e=>{var t,n;let{serviceInstanceConfig:r}=e;if((null==(t=r.source)?void 0:t.repo)==null||(null==(n=r.source)?void 0:n.branch)==null)return!1;if(null==r.source.upstreamUrl)return!0;let l=(0,eN.parseGitUrl)(r.source.upstreamUrl);return null==l||l.repo!==r.source.repo}},{id:"source-image",group:"Source",tags:["docker","image"],render:e=>{var t,n,a,s;let{id:c,service:d,environment:u,serviceInstanceConfig:p,stagedServiceInstanceConfig:x,latestDeploy:g}=e,y=(0,w.getImageSource)(p.source),j=(0,$.y3)(),N=(0,tm.w)(null!=(s=null==y?void 0:y.image)?s:""),{openCommandPalette:k}=(0,tt.oG)(),{isImageUpdatesFlagEnabled:S,hasImageUpdates:E,imageUpdateStatus:I,dockerImageUpdateCheck:D,hasImagePathChanged:R,isDelayedAfterApplying:P}=(e=>{var t,n,r,a;let{serviceId:s,environmentId:c,latestDeploy:d,serviceInstanceConfig:u}=e,[{featureFlags:p}]=(0,o.Jd)(),m=p.includes(eU.Fev.ImageUpdates),h=(0,l.md)(tv.iy),x=(0,tf.r)(h===eU.oSY.Applying,e8()("2s")),{graphqlClient:g}=(0,eS.q)(),v=m&&null!=d&&d.status===eU.Uty.Success,f=(0,ek.W)(ty(s,c,null==d?void 0:d.id),async()=>g.dockerImageUpdateCheck({serviceId:s,environmentId:c}),{staleTime:e8()("10m"),enabled:v}),y=(0,i.useMemo)(()=>{var e;let t=null==(e=u.source)?void 0:e.image;return null==t?null:(0,td.parseDockerImage)(t)},[null==(t=u.source)?void 0:t.image]),j=null==(r=f.result.data)||null==(n=r.serviceInstance)?void 0:n.imageUpdateStatus,b=null==j||null==(a=j.current)?void 0:a.path,w=(null==y?void 0:y.path)!==b;return{isImageUpdatesFlagEnabled:m,dockerImageUpdateCheck:f,hasImageUpdates:null==j?void 0:j.hasUpdates,imageUpdateStatus:w?null:j,isDelayedAfterApplying:x,hasImagePathChanged:w}})({serviceId:d.id,environmentId:u.id,latestDeploy:null!=g?g:null,serviceInstanceConfig:p});(e=>{let{serviceId:t,environmentId:n,serviceName:l,dockerImageUpdateCheck:a,enabled:s}=e,{addCommand:o}=(0,tt.oG)(),{modalActions:c}=(0,ep.U)(),{graphqlClient:d}=(0,eS.q)();(0,i.useEffect)(()=>{if(!s)return;let e=o({value:"check-image-updates",text:"Check for image updates",icon:v.tXn,action:async()=>{let e=null;try{var i,s;e=c.createToast((0,r.jsx)(em.y8,{title:"Checking for image updates for ".concat(l,"..."),variant:"neutral"}));let o=await d.dockerImageUpdateCheck({serviceId:t,environmentId:n,skipCache:!0});a.setQuery(o);let u=null==o||null==(s=o.serviceInstance)||null==(i=s.imageUpdateStatus)?void 0:i.hasUpdates;c.exitToast(e),c.createToast((0,r.jsx)(em.y8,{title:u?"Updates available for ".concat(l):"No updates available for ".concat(l),variant:u?"success":"neutral"}))}catch(t){e&&c.exitToast(e)}}});return()=>{e()}},[s,t,n])})({serviceName:d.name,dockerImageUpdateCheck:D,serviceId:d.id,environmentId:u.id,enabled:S});let O=(0,i.useMemo)(()=>{var e;let t=null==x||null==(e=x.source)?void 0:e.image;if(!t||!I)return null;let n=(0,td.parseDockerImage)(t);return n&&[I.updates.minor,I.updates.patch,I.updates.sameTag,I.updates.major].filter(e=>null!=e).find(e=>e.tag===n.tag)||null},[null==x||null==(t=x.source)?void 0:t.image,I]),T=(null==x||null==(n=x.source)?void 0:n.image)!=null;return null==y||null==N?null:(0,r.jsxs)(b.XY,{id:c,className:"",children:[(0,r.jsx)(b.O5,{children:(0,r.jsx)(b.fA,{id:c,children:"Source Image"})}),(0,r.jsxs)("div",{className:"grid ",children:[(0,r.jsxs)(b.FE,{className:(0,A.xW)("flex overflow-x-hidden",S&&"min-h-[66px]",E&&!T&&"rounded-b-none"),isStaged:(null==x||null==(a=x.source)?void 0:a.image)!=null,children:[(0,r.jsxs)(m.N,{href:(0,td.getDockerImageUrl)(N),className:"flex items-center flex-grow space-x-3 min-w-0",children:[(0,r.jsx)(f.In,{icon:v.azJ,className:"text-gray-500"}),(0,r.jsxs)("div",{className:"group truncate flex-grow",children:[(0,r.jsxs)(tu.P.p,{layout:"position",className:"space-x-2",transition:{type:"spring",mass:.5,bounce:0,stiffness:120},children:[(0,r.jsx)("span",{className:"group-hover:underline",title:y.image,children:y.image})," ",(0,r.jsx)("span",{"aria-hidden":!0,className:"hidden group-hover:inline text-gray-500",children:"↗"})]}),S&&(0,r.jsx)(tS,{imageUpdateStatus:I,stagedUpgradeInfo:O,hasStagedImage:T,hasImagePathChanged:R,latestDeploy:null!=g?g:null,isLoadingImageUpdate:D.result.isLoading,isDelayedAfterApplying:P})]})]}),(0,r.jsx)(tb.n4,{children:(0,r.jsxs)(h.z,{space:2,align:"center",children:[(0,r.jsx)(C.K0,{icon:v.W7n,title:"Edit",onClick:()=>{k({id:"edit-source-image",type:"input",prompt:"Enter a new source image",crumbs:["Edit source image"],initialValue:y.image,action:e=>{null!=(0,td.parseDockerImage)(null!=e?e:"")&&j.stageServiceChanges({serviceId:d.id,payload:{source:{image:e}}})}})},iconStyles:"text-gray-500"}),(0,r.jsx)(C.$n,{size:"xs",variant:"outline",color:"gray",onClick:()=>j.stageServiceChanges({serviceId:d.id,payload:{source:{image:null}}}),children:"Disconnect"})]})})]}),(0,r.jsx)(tp.N,{initial:!1,children:E&&I&&!T&&!P&&(0,r.jsx)(tC,{updateInfo:I,service:d,environment:u,serviceInstanceConfig:p,latestDeploy:null!=g?g:null})})]})]})}},{id:"registry-credentials",isAvailable:e=>{let{isPro:t,permissions:n}=e;return n.Read&&t},group:"Source",tags:["docker","registry"],render:e=>{var t,n,l;let{serviceInstanceConfig:i,stagedServiceInstanceConfig:a}=e,s=(0,td.parseDockerImage)(null!=(l=null==(t=i.source)?void 0:t.image)?l:"");return s?(0,r.jsx)(tT,{isStaged:!!(null==a||null==(n=a.deploy)?void 0:n.registryCredentials),imageDetails:s,...e}):null}},{id:"source-cli-root-directory",group:"Source",tags:["root","directory"],render:e=>{var t,n,l;let{id:i,service:a,serviceInstanceConfig:s,stagedServiceInstanceConfig:o,permissions:c}=e,d=(0,$.y3)(),{routes:u}=(0,N.c)();return(0,r.jsxs)(b.XY,{id:i,children:[(0,r.jsxs)(b.O5,{children:[(0,r.jsx)(b.fA,{id:i,children:"Root Directory"}),(0,r.jsxs)(b.$0,{children:["The subdirectory that is deployed when you deploy from the CLI."," ",(0,r.jsxs)(m.N,{variant:"highlight",...u.docs({page:"/deploy/builds#build-command"}),children:[(0,r.jsx)("span",{className:"underline mr-1",children:"Docs"}),(0,r.jsx)(v.lth,{})]})]})]}),(0,r.jsx)(S.j,{placeholder:"/",isStaged:(null==o||null==(t=o.source)?void 0:t.rootDirectory)!=null,value:null!=(l=null==(n=s.source)?void 0:n.rootDirectory)?l:"",readOnly:!c.Write,label:{text:"Root directory",hidden:!0},onChange:e=>d.stageServiceChanges({serviceId:a.id,payload:{source:{rootDirectory:e}}})})]})},isAvailable:e=>{var t,n;let{serviceInstanceConfig:r}=e;return(null==(t=r.source)?void 0:t.repo)==null&&(null==(n=r.source)?void 0:n.image)==null}},{id:"networking-public",group:"Networking",tags:["domains","http","public","custom","domain","tcp proxy","port","networking"],render:e=>{var t,n,a,s,o;let{id:c,service:d,project:p,environment:g}=e,{routes:f}=(0,N.c)(),y=(0,eV.fH)(),[j,w]=(0,i.useState)(!1),{domains:k,tcpProxies:C,domainActions:S,sockets:E,hasTargetPortFunctionalityAvailable:I}=(0,e_.M)({projectId:g.projectId,environmentId:g.id,serviceId:d.id,options:{refetchInterval:j}}),A=null!=C&&null!=(a=C[0])?a:null,[D,R]=(0,i.useState)(!1),[P,O]=(0,i.useState)(!1),[T,M]=(0,i.useState)(!1),[z,F]=(0,i.useState)(!1),[{suggestAddServiceDomain:L}]=(0,eB.K)({serviceId:d.id}),W=(0,l.md)(u.DM),U=(0,l.md)(eo.G),{modalActions:_}=(0,ep.U)(),V=e=>{_.createToast((0,r.jsx)(em.y8,{icon:v.hcu,title:"Add custom domain",description:e,actionTitle:"Upgrade plan",href:f.workspaceBilling({}).url}))},B=async e=>{let{targetPort:t}=e;try{M(!0),await S.createServiceDomain({targetPort:t})}catch(e){_.createToast((0,r.jsx)(em.y8,{variant:"error",title:"Error adding service domain",description:e.message}))}finally{M(!1),O(!1)}},G=async e=>{let{domain:t,targetPort:n}=e;if(!y.allowed)return void V(y.message);try{let e=await S.createCustomDomain({domain:t,targetPort:n});R(!1),_.openModal((0,r.jsx)(e$,{domain:e}))}catch(e){_.createToast((0,r.jsx)(em.y8,{variant:"error",title:"Error adding custom domain",description:e.message}))}},Y=async e=>{let{applicationPort:t}=e;if(!y.allowed)return void V(y.message);try{await S.createTcpProxy({applicationPort:t}),F(!1)}catch(e){_.createToast((0,r.jsx)(em.y8,{variant:"error",title:"Error adding TCP proxy",description:e.message}))}},H=null==(t=Object.entries(null!=(s=(0,$.y3)().getStagedChanges().services)?s:{}).find(e=>{let[t]=e;return t===d.id}))?void 0:t[1],K=Object.keys(null!=(o=null==H||null==(n=H.networking)?void 0:n.tcpProxies)?o:{}),X=!!((null==C?void 0:C.length)||K.length),Z=null!=k&&(k.serviceDomains.length>0||k.customDomains.length>0),J=null!=k&&k.customDomains.length>0;(0,i.useEffect)(()=>{w(!!J&&te)},[J]);let Q=null==U||null==k||k.customDomains.length<U.networking.customDomains;return(0,r.jsxs)(b.XY,{id:c,children:[(0,r.jsxs)(b.O5,{children:[(0,r.jsx)(b.fA,{id:c,children:"Public Networking"}),!Z&&!X&&(0,r.jsx)(b.$0,{children:"Access to this service publicly through HTTP or TCP"})]}),!I&&!X&&!Z&&L&&(0,r.jsx)(q.l,{variant:"primary",size:"sm",icon:v.sxL,className:"mb-4",children:(0,r.jsxs)("p",{children:["This service is listening on ",(0,r.jsx)(x.R0,{children:"PORT"})," but does not yet have a domain. ",(0,r.jsx)("br",{}),"Add a domain to expose it to the internet."]})}),(0,r.jsxs)(h.T,{space:4,children:[Z&&null!=k&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(b.$0,{children:"Access your application over HTTP with the following domains"}),(0,r.jsx)(eZ,{serviceDomains:k.serviceDomains,customDomains:k.customDomains,domainActions:S,sockets:E})]}),X&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(b.$0,{children:"Connect to your service over TCP using a proxied domain and port"}),(0,r.jsx)(e9.U3,{tcpProxies:C,stagedTcpPorts:K,service:d,networkingActions:S})]}),P&&(0,r.jsx)(e1,{sockets:E,onCreateServiceDomain:B,onCancel:()=>O(!1)}),D&&(0,r.jsx)(e0,{sockets:E,hasTargetPortFunctionalityAvailable:I,onAddDomain:G,onCancel:()=>R(!1)}),z&&(0,r.jsx)(e9.en,{onAddTcpProxy:Y,onCancel:()=>F(!1)}),!D&&!z&&(0,r.jsxs)(h.z,{space:2,children:[(0,r.jsx)(e3,{sockets:E,permissions:W,isCreatingServiceDomain:P,setIsAddingCustomDomain:R,setIsCreatingServiceDomain:O,onCreateServiceDomain:B,isWithinCustomDomainLimit:Q,isWithinServiceDomainLimit:null==k||k.serviceDomains.length<1,hasTargetPortFunctionalityAvailable:I,serviceDomainPending:T}),!X&&(0,r.jsx)(e9.jK,{tcpProxy:A,permissions:W,setIsAddingTcpProxy:F})]}),!Q&&(0,r.jsx)(q.l,{size:"sm",variant:"info",children:(null==p?void 0:p.subscriptionType)===eU.dh$.Free?(0,r.jsxs)(x.ax,{children:["Custom domains are not available on the free plan."," ",(0,r.jsx)(m.N,{variant:"underline",...f.workspaceUpgrade({}),children:"Please upgrade to add one."})]}):(0,r.jsxs)(x.ax,{children:["You have hit the custom domain limit for your plan."," ",(null==p?void 0:p.subscriptionType)===eU.dh$.Pro?(0,r.jsx)(m.N,{variant:"underline",...f.demo({}),children:"Need more? We can help!"}):(0,r.jsx)(m.N,{variant:"underline",...(null==p?void 0:p.subscriptionType)===eU.dh$.Hobby?f.workspacePlan({}):f.workspaceUpgrade({}),children:"Please upgrade to add more."})]})})]})]})},isAvailable:e=>{let{isServiceInstanceBeingCreated:t,permissions:n}=e;return n.Read&&!t}},{id:"networking-private",group:"Networking",tags:["private","network","networking"],render:e=>{let{id:t,service:n,environment:i,serviceInstanceConfig:a,stagedServiceInstanceConfig:s}=e,{isConfirmed:o}=(0,eb.S)(),c=(0,l.md)(ez),d=(0,$.y3)(),[{privateNetworks:{data:u,isError:p,isLoading:m}}]=(0,eA.$)({environmentId:i.id}),x=async()=>{await o({input:"enable private networking for the environment",message:(0,r.jsxs)(h.T,{space:2,children:[(0,r.jsxs)("p",{children:["Private networking may introduce a ",(0,r.jsx)("b",{children:"small delay"})," (","<","100ms) for DNS resolution when your application starts."]}),(0,r.jsxs)("p",{children:["Make sure to add a small sleep in your entry point or to have your application retry its first network connections."," "]}),(0,r.jsxs)("p",{children:["Note that this impacts ",(0,r.jsx)("b",{children:"both public"})," and ",(0,r.jsx)("b",{children:"private DNS"})," ","names."]})]}),theme:"info",title:"Enable Private Networking",type:"input"})&&d.stageEnvironmentChanges({payload:(0,w.newEnvironmentConfig)(d.getStagedChanges()).setPrivateNetworkDisabled(!c).build()})};return(0,r.jsxs)(b.XY,{id:t,children:[(0,r.jsxs)(b.O5,{children:[(0,r.jsx)(b.fA,{id:t,children:"Private Networking"}),(0,r.jsx)(b.$0,{children:"Communicate with this service from within the Railway network."})]}),m?null:p?(0,r.jsx)(q.l,{variant:"danger",children:"Failed to get private networks"}):(0,r.jsxs)(h.T,{space:4,children:[null==u?void 0:u.map(e=>{var t;return(0,r.jsx)(eF,{environment:i,service:n,serviceInstanceConfig:a,privateNetwork:e,isStaged:(null==s||null==(t=s.networking)?void 0:t.privateNetworkEndpoint)!=null},e.publicId)}),c&&(0,r.jsx)(C.$n,{name:"Enable Private Networking",variant:"outline",size:"sm",icon:v.jGG,onClick:x,className:"max-w-max",children:"Enable Private Networking"})]})]})},isAvailable:e=>{let{isServiceInstanceBeingCreated:t,permissions:n}=e;return n.Read&&!t}},{id:"networking-public",group:"Networking",tags:["domains","http","public","custom","domain","tcp proxy","port","networking"],render:e=>{let{id:t}=e;return(0,r.jsxs)(b.XY,{id:t,children:[(0,r.jsx)(b.O5,{children:(0,r.jsx)(b.fA,{id:t,children:"Networking Settings"})}),(0,r.jsx)(q.l,{variant:"info",children:"Deploy the service to see networking settings."})]})},isAvailable:e=>{let{isServiceInstanceBeingCreated:t}=e;return!0===t}},{id:"static-ips",group:"Networking",tags:["public","networking","ip","ipv4","static"],render:e=>{let{id:t,service:n,environment:l,permissions:s,serviceInstanceConfig:o}=e,{egressGateways:c,egressGatewayActions:d}=(0,e_.M)({projectId:l.projectId,environmentId:l.id,serviceId:n.id}),{modalActions:u}=(0,ep.U)(),[p,m]=(0,i.useState)(!1),[g,y]=(0,i.useState)(!1),[j,w]=(0,ew.T)();(0,i.useEffect)(()=>{m(!1)},[null==c?void 0:c.length]);let{isPro:N}=(0,a.hA)(),k=async e=>{var t,n,l,i;if(p)return;if(m(!0),!e){try{await d.clearEgressAssociations({}),y(!0)}catch(e){m(!1),u.createToast((0,r.jsx)(em.y8,{variant:"error",title:"Could not disable static IPs",description:e.message}))}return}let a=er.s9,s=null==(t=o.deploy)?void 0:t.multiRegionConfig,c=null==(n=o.deploy)?void 0:n.region;if(null!=s){let e=Object.keys(s);e.length>1&&(u.createToast((0,r.jsx)(em.y8,{variant:"error",title:"Could not enable static IPs",description:"Static IPs are not available for services deploying to multiple regions."})),m(!1)),a=null!=(i=null!=(l=e[0])?l:c)?i:a}else null!=c&&(a=c);try{await d.createEgressAssociation({region:a}),y(!0)}catch(e){m(!1),u.createToast((0,r.jsx)(em.y8,{variant:"error",title:"Could not enable static IPs",description:e.message}))}},S=(0,tM.j)({serviceInstanceConfig:o}).length>1;return N||(null==c?void 0:c.length)?(0,r.jsxs)(b.XY,{id:t,children:[(0,r.jsxs)(b.O5,{children:[(0,r.jsx)(b.fA,{id:t,children:"Static Outbound IPs"}),(0,r.jsx)(b.$0,{children:"This will assign a permanent IP address which your service will use for outbound traffic, however it cannot be used for inbound traffic."})]}),(0,r.jsxs)(h.T,{space:3,children:[(0,r.jsx)(b.r5,{children:(0,r.jsx)(b.FE,{children:(0,r.jsxs)(h.z,{children:[(0,r.jsx)(K.N,{id:"staticIps",disabled:!s.Write||p||S,checked:!!(null==c?void 0:c.length),onCheckedChange:k,children:"Enable Static IPs"}),g?(0,r.jsxs)(h.z,{className:"!text-yellow-500 flex items-center text-nowrap gap-x-2",children:[(0,r.jsx)(f.In,{icon:v.hcu,size:"sm"}),(0,r.jsx)(x.tj,{children:"Re-deploy to take effect"})]}):null]})})}),S&&(0,r.jsx)(tz,{}),(null==c?void 0:c.length)&&c.length>0?(0,r.jsx)(eG.J6,{children:(0,r.jsxs)(eG.XI,{children:[(0,r.jsx)(eG.D1,{children:(0,r.jsxs)(eG.fI,{unSelectable:!0,children:[(0,r.jsx)(eG.A3,{children:"IP Address"}),(0,r.jsx)(eG.A3,{children:"Type"}),(0,r.jsx)(eG.A3,{children:"Region"})]})}),(0,r.jsx)(eG.vc,{showRowBorder:!0,children:(0,r.jsx)(r.Fragment,{children:null==c?void 0:c.map(e=>(0,r.jsxs)(eG.fI,{unSelectable:!0,children:[(0,r.jsx)(eG.xC,{children:(0,r.jsxs)(h.z,{children:[(0,r.jsx)("span",{className:"select-text",children:e.ipv4}),(0,r.jsx)(C.K0,{icon:j?v.Jlk:v.QRo,size:"xs",title:"Copy",type:"button",onClick:()=>w(e.ipv4)})]})}),(0,r.jsx)(eG.xC,{className:"text-gray-600",children:(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("span",{children:"Shared"}),(0,r.jsx)(eM.m,{content:(0,r.jsx)("span",{children:"This IP may be shared with other customers"}),children:(0,r.jsx)(f.In,{icon:v.R2D,size:"xs"})})]})}),(0,r.jsx)(eG.xC,{className:"text-gray-600",children:e.region})]},e.ipv4))})})]})}):null]})]}):null},isAvailable:e=>{let{isServiceInstanceBeingCreated:t,permissions:n}=e;return n.Read&&!t}},{id:"build-builder",group:"Build",tags:["nixpacks","docker","dockerfile"],render:e=>{var t,n;let{id:l,service:a,manifestFileInfo:s,serviceInstanceConfig:c,serviceInstance:d,latestDeploy:u}=e,p=null==c?void 0:c.build,{updateServiceConfig:g}=(0,k.w)(a.id),y=(0,i.useMemo)(()=>{var e,t,n,r,l,i;return null!=u&&"dockerfile"===(null!=(i=null!=(l=null==u||null==(n=u.meta)||null==(t=n.serviceManifest)||null==(e=t.build)?void 0:e.builder)?l:null==u||null==(r=u.meta)?void 0:r.builder)?i:"").toLowerCase()},[u]),j=y?"DOCKERFILE":null!=(t=null==p?void 0:p.builder)?t:"NIXPACKS",w=null!=(n=O[j])?n:O.NIXPACKS,[{user:N}]=(0,o.Jd)(),S=Object.entries(O).filter(e=>{var t;let[n,r]=e;return r.selectable&&(!r.adminOnly||(null==N?void 0:N.isAdmin))&&(!r.disableBuilderV2||(null==(t=c.build)?void 0:t.buildEnvironment)!=="V2")}),E=S.length>1&&!y;return(0,r.jsxs)(b.XY,{id:l,children:[(0,r.jsx)(b.O5,{children:(0,r.jsx)(b.fA,{id:l,children:"Builder"})}),(0,r.jsx)(b.a,{fileInfo:s.build.builder,children:(0,r.jsxs)(R.ms,{children:[(0,r.jsx)(I.l9,{className:"w-full text-left focus:outline-none focus-visible:ring-pink-500",disabled:!E,children:(0,r.jsxs)("div",{className:"grid gap-4 grid-cols-[1fr_auto] items-center w-full space-x-8 px-6 py-4 bg-secondaryBg dark:bg-gray-100 rounded-md",children:[(0,r.jsxs)(h.T,{space:1.5,className:"w-full",children:[(0,r.jsxs)(h.z,{align:"center",children:[(0,r.jsx)(x.EY,{className:"mr-2",children:w.name}),y?(0,r.jsx)(r.Fragment,{children:(null==p?void 0:p.dockerfilePath)!=null?(0,r.jsx)(D.fM,{className:"text-blue-500 bg-blue-100 font-medium",children:p.dockerfilePath}):(0,r.jsx)(D.sB,{})}):(0,r.jsx)(r.Fragment,{children:w.badge}),"RAILPACK"===j&&(0,r.jsx)(P.S,{serviceInstanceConfig:c,serviceInstance:d,className:"ml-4"})]}),(0,r.jsxs)(x.ae,{children:[w.description," ",(0,r.jsxs)(m.N,{href:w.link,external:!0,variant:"highlight",children:[(0,r.jsx)("span",{className:"underline mr-1",children:"Docs"}),(0,r.jsx)(v.lth,{})]})]})]}),("HEROKU"===j||"PAKETO"===j)&&(0,r.jsx)(C.$n,{variant:"outline",size:"sm",className:"max-w-max",onClick:()=>g({build:{builder:"NIXPACKS"}}),children:"Upgrade to Nixpacks"}),E&&(0,r.jsx)(f.In,{icon:v.yQN,size:"sm"})]})}),(0,r.jsx)(R.pm,{align:"end",children:S.map(e=>{let[t,n]=e;return(0,r.jsx)(R.tJ,{className:"h-auto",onSelect:()=>{g({build:{builder:t}})},children:(0,r.jsxs)(h.T,{space:1.5,className:"w-full",children:[(0,r.jsxs)(h.z,{space:2,align:"center",children:[(0,r.jsx)("p",{className:(0,A.xW)(t===j&&"text-pink-500"),children:n.name}),n.badge]}),(0,r.jsxs)(x.ae,{children:[n.description," ",(0,r.jsxs)(m.N,{href:n.link,external:!0,variant:"highlight",onClick:e=>e.stopPropagation(),children:[(0,r.jsx)("span",{className:"underline mr-1",children:"Docs"}),(0,r.jsx)(v.lth,{})]})]})]})},t)})})]})})]})},isAvailable:e=>{let{serviceInstanceConfig:t}=e;return null==(0,w.getImageSource)(t.source)}},{id:"build-providers",group:"Build",tags:["nixpacks","language","provider"],render:e=>{var t,n,l,i,a,s;let{id:o,service:c,serviceInstanceConfig:d,latestDeploy:u,manifestFileInfo:p,permissions:m}=e,h=null!=(i=null==u?void 0:u.meta)?i:{};return(0,r.jsxs)(b.XY,{id:o,children:[(0,r.jsxs)(b.O5,{children:[(0,r.jsx)(b.fA,{id:o,children:"Providers"}),(0,r.jsx)(b.$0,{children:"Language providers that will be used to build the service"})]}),(0,r.jsx)(b.a,{fileInfo:p.build.nixpacksPlan,children:(0,r.jsx)(_,{disabled:!m.Write,hasDeployment:null!=u,serviceId:c.id,matchedProviders:null!=(a=h.nixpacksProviders)?a:[],customPlan:null!=(s=null==(t=d.build)?void 0:t.nixpacksPlan)?s:{},nixpacksConfigFile:null==(l=h.serviceManifest)||null==(n=l.build)?void 0:n.nixpacksConfigPath})})]})},isAvailable:e=>{var t,n,r,l,i,a;let{serviceInstanceConfig:s,latestDeploy:o}=e,c=null!=(a=null!=(i=null==o||null==(r=o.meta)||null==(n=r.serviceManifest)||null==(t=n.build)?void 0:t.builder)?i:null==o||null==(l=o.meta)?void 0:l.builder)?a:"",d="dockerfile"===c.toLowerCase();return null==(0,w.getImageSource)(s.source)&&"NIXPACKS"===c&&!d}},{id:"build-command",group:"Build",tags:["nixpacks","railpack","build","command","build command"],render:e=>{var t;let{id:n,manifestFileInfo:l,serviceInstanceConfig:i,stagedServiceInstanceConfig:a,permissions:s,service:o}=e,{updateServiceConfig:c}=(0,k.w)(o.id),d=null==i?void 0:i.build;return(0,r.jsx)(E,{id:n,manifestFileInfo:l,readOnly:!s.Write,isStaged:(null==a||null==(t=a.build)?void 0:t.buildCommand)!=null,value:null==d?void 0:d.buildCommand,onChange:e=>c({build:{buildCommand:e.trim()}})})},isAvailable:e=>{var t,n,r,l,i,a,s;let{serviceInstanceConfig:o,latestDeploy:c}=e,d=null==o?void 0:o.build,u="dockerfile"===(null!=(a=null!=(i=null==c||null==(r=c.meta)||null==(n=r.serviceManifest)||null==(t=n.build)?void 0:t.builder)?i:null==c||null==(l=c.meta)?void 0:l.builder)?a:"").toLowerCase()?"DOCKERFILE":null!=(s=null==d?void 0:d.builder)?s:"NIXPACKS";return null==(0,w.getImageSource)(o.source)&&("DOCKERFILE"!==u||!!(null==d?void 0:d.buildCommand))}},{id:"build-watch-paths",group:"Build",tags:["ignore","watch","skip"],render:e=>{var t,n,l,a;let{id:s,service:o,manifestFileInfo:c,serviceInstanceConfig:d,stagedServiceInstanceConfig:u,permissions:p}=e,{updateServiceConfig:h}=(0,k.w)(o.id),x=null==d?void 0:d.build,[g,f]=(0,i.useState)(!1),{routes:y}=(0,N.c)(),j=null!=(l=null==d||null==(t=d.source)?void 0:t.rootDirectory)?l:"";return(0,r.jsxs)(b.XY,{id:s,children:[(0,r.jsxs)(b.O5,{children:[(0,r.jsx)(b.fA,{id:s,children:"Watch Paths"}),(0,r.jsxs)(b.$0,{children:["Gitignore-style rules to trigger a new deployment based on what file paths have changed."," ",(0,r.jsxs)(m.N,{external:!0,variant:"highlight",...y.docs({page:"/deploy/build-configuration#configure-watch-paths"}),children:[(0,r.jsx)("span",{className:"underline mr-1",children:"Docs"}),(0,r.jsx)(v.lth,{})]})]})]}),(0,r.jsx)(b.a,{fileInfo:c.build.watchPatterns,children:g||(null==x?void 0:x.watchPatterns)?(0,r.jsx)(S.j,{textarea:!0,autoFocus:g,value:(null!=(a=null==x?void 0:x.watchPatterns)?a:[]).join("\n"),isStaged:(null==u||null==(n=u.build)?void 0:n.watchPatterns)!=null,readOnly:!p.Write||null!=c.build.watchPatterns,label:{text:"Watch patterns",hidden:!0},placeholder:"/"===j?"src/**":"".concat(j,"/src/**"),onChange:e=>h({build:{watchPatterns:e.split("\n")}}),className:"min-h-[2.8rem] max-h-[22rem]"}):(0,r.jsx)(C.$n,{size:"sm",variant:"outline",color:"gray",icon:v.FWt,disabled:!p.Write,onClick:()=>f(!0),children:"Watch Paths"})})]})},isAvailable:e=>{let{serviceInstanceConfig:t}=e;return null==(0,w.getImageSource)(t.source)}},ef.OZ,ev.jr,{id:"deploy-region-config",group:"Deploy",render:e=>(0,r.jsx)(t8,{...e}),tags:["multi-region","region","replica"]},{id:"deploy-runtime",group:"Deploy",render:e=>{var t,n,i,a,s;let{id:o,service:c,manifestFileInfo:d,serviceInstanceConfig:u,stagedServiceInstanceConfig:p}=e,m=(0,l.Xr)(er.I7),{updateServiceConfig:h}=(0,k.w)(c.id),x=m(null!=(a=null==p||null==(t=p.deploy)?void 0:t.region)?a:er.s9);if(!x)return null;let g=ei.map(e=>{var t;return{...e,disabled:(null==(t=x.deploymentConstraints)?void 0:t.runtimeExclusivity)&&!x.deploymentConstraints.runtimeExclusivity.includes(e.value)}}),v=null!=(s=null==(n=u.deploy)?void 0:n.runtime)?s:"DOCKER";return(0,r.jsxs)(b.XY,{id:o,children:[(0,r.jsxs)(b.O5,{children:[(0,r.jsx)(b.fA,{id:o,children:"Runtime"}),(0,r.jsx)(b.$0,{children:"How your app is deployed"})]}),(0,r.jsx)(b.a,{fileInfo:d.deploy.runtime,children:(0,r.jsx)(el.l,{className:(0,A.xW)((null==p||null==(i=p.deploy)?void 0:i.runtime)!=null&&"bg-pink-50 text-pink-600 border-pink-100 hover:border-pink-400"),label:"",options:g,value:v,onChange:e=>h({deploy:{runtime:ea.parse(e)}})})})]})},tags:["runtime"],isAvailable:e=>{var t,n,r;let{serviceInstanceConfig:l}=e;return!(null==(t=l.deploy)?void 0:t.runtime)||(null==(n=l.deploy)?void 0:n.runtime)===w.PublicRuntime.LEGACY||(null==(r=l.deploy)?void 0:r.runtime)===w.PublicRuntime.UNSPECIFIED}},{id:"deploy-teardown",group:"Deploy",tags:["overlap","teardown","draining","seconds"],render:e=>{var t,n,l,i,a,s,o,c,d,u,p,x,g,f;let{id:j,service:C,serviceInstanceConfig:E,stagedServiceInstanceConfig:I,manifestFileInfo:A,permissions:D}=e,{updateServiceConfig:R}=(0,k.w)(C.id),P=null==(n=E.deploy)||null==(t=n.overlapSeconds)?void 0:t.toString(),O=null==(i=E.deploy)||null==(l=i.drainingSeconds)?void 0:l.toString(),T=!D.Write,{routes:M}=(0,N.c)(),z=(null==A?void 0:A.deploy.overlapSeconds)!=null||(null==A?void 0:A.deploy.drainingSeconds)!=null,F=z||(null==(a=E.deploy)?void 0:a.overlapSeconds)!=null||(null==(s=E.deploy)?void 0:s.drainingSeconds)!=null,L=(null==I||null==(o=I.deploy)?void 0:o.overlapSeconds)!=null||(null==I||null==(c=I.deploy)?void 0:c.drainingSeconds)!=null,W=Object.values(null!=(p=E.volumeMounts)?p:{}).length>0;return(0,r.jsxs)(b.XY,{id:j,children:[(0,r.jsxs)(b.O5,{children:[(0,r.jsx)(b.fA,{id:j,children:"Teardown"}),(0,r.jsxs)(b.$0,{children:["Configure old deployment termination when a new one is started."," ",(0,r.jsxs)(m.N,{...M.docs({page:"/guides/deployment-teardown"}),variant:"highlight",external:!0,children:[(0,r.jsx)("span",{className:"underline mr-1",children:"Docs"}),(0,r.jsx)(v.lth,{})]})]})]}),(0,r.jsxs)(h.T,{space:2,children:[(0,r.jsx)(b.a,{fileInfo:z?null!=(x=null==A?void 0:A.deploy.drainingSeconds)?x:null==A?void 0:A.deploy.overlapSeconds:void 0,children:(0,r.jsx)(b.FE,{isStaged:L,children:(0,r.jsx)(K.N,{id:"teardown-enable",disabled:!D.Write||z,checked:F,onCheckedChange:e=>{e?R({deploy:{overlapSeconds:w.DEFAULT_DEPLOYMENT_OVERLAP_SECONDS,drainingSeconds:w.DEFAULT_DEPLOYMENT_DRAINING_SECONDS}}):R({deploy:{overlapSeconds:null,drainingSeconds:null}})},children:"Enable Teardown"})})}),F?(0,r.jsxs)(b.FE,{isStaged:L,className:W?"":"grid gap-8 grid-cols-2",children:[!W&&(0,r.jsxs)(h.z,{space:3,align:"center",children:[(0,r.jsx)(y.JU,{className:"text-base text-gray-500 font-normal mb-0",children:"Overlap"}),(0,r.jsx)(S.j,{value:null!=(g=null==P?void 0:P.toString())?g:w.DEFAULT_DEPLOYMENT_OVERLAP_SECONDS.toString(),label:{text:"Overlap",hidden:!0},readOnly:T||(null==A?void 0:A.deploy.overlapSeconds)!=null,isStaged:(null==I||null==(d=I.deploy)?void 0:d.overlapSeconds)!=null,placeholder:w.DEFAULT_DEPLOYMENT_OVERLAP_SECONDS.toString(),type:"number",min:0,onChange:e=>{R({deploy:{overlapSeconds:""!==e?parseInt(e.trim()):null}})},suffix:"sec"})]}),(0,r.jsxs)(h.z,{space:3,align:"center",children:[(0,r.jsx)(y.JU,{className:"text-base text-gray-500 font-normal mb-0",children:"Draining"}),(0,r.jsx)(S.j,{value:null!=(f=null==O?void 0:O.toString())?f:w.DEFAULT_DEPLOYMENT_DRAINING_SECONDS.toString(),label:{text:"Draining",hidden:!0},readOnly:T||(null==A?void 0:A.deploy.drainingSeconds)!=null,isStaged:(null==I||null==(u=I.deploy)?void 0:u.drainingSeconds)!=null,placeholder:w.DEFAULT_DEPLOYMENT_DRAINING_SECONDS.toString(),type:"number",min:0,onChange:e=>{R({deploy:{drainingSeconds:""!==e?parseInt(e.trim()):null}})},suffix:"sec"})]})]}):null]})]})}},{id:"deploy-resource-limits",group:"Deploy",tags:["resource","cpu","memory","limit"],render:e=>{var t;let{id:n,service:i,environment:a,permissions:s,serviceInstanceConfig:o,manifestFileInfo:c}=e,d=(0,l.md)(eo.G),u=(0,l.md)(tI.T6);return null==d||null==u?null:(0,r.jsx)(tY,{id:n,serviceId:i.id,environmentId:a.id,projectId:i.projectId,serviceInstanceConfig:o,planLimits:d,teamId:null!=(t=u.teamId)?t:void 0,canEdit:s.Admin&&u.subscriptionType!==eU.dh$.Trial,isTrial:u.subscriptionType===eU.dh$.Trial,manifestFileInfo:c})}},{id:"deploy-cron-schedule",group:"Deploy",tags:["schedule","cron"],render:e=>{var t,n,l,a;let{id:s,service:o,serviceInstanceConfig:c,stagedServiceInstanceConfig:d,manifestFileInfo:u,permissions:p}=e,{updateServiceConfig:m}=(0,k.w)(o.id),g=null==c?void 0:c.deploy,[f,y]=(0,i.useState)(!1),[j,w]=(0,i.useState)(""),N=e=>{e||w("");try{if(!(0,Q.ZS)(e))return w(""),"The minimum interval for a cron schedule is 5 minutes.";if(!(0,Q.JO)(e))return w(""),"A cron schedule can have a maximum of 5 entries.";w(J().toString(e,{use24HourTimeFormat:!0}))}catch(e){return w(""),"Sorry, but that's not a valid cron expression."}};(0,i.useEffect)(()=>{var e;N(null!=(e=null==g?void 0:g.cronSchedule)?e:"")},[null==g?void 0:g.cronSchedule]);let E=null!=(l=null==(t=c.deploy)?void 0:t.sleepApplication)&&l;return(0,r.jsxs)(b.XY,{id:s,children:[(0,r.jsxs)(b.O5,{children:[(0,r.jsx)(b.fA,{id:s,children:"Cron Schedule"}),(0,r.jsx)(b.$0,{children:"Run the service according to the specified cron schedule."})]}),(0,r.jsx)(b.a,{fileInfo:u.deploy.cronSchedule,children:f||(null==g?void 0:g.cronSchedule)?(0,r.jsxs)(h.T,{space:2,children:[(0,r.jsx)(S.j,{autoFocus:f,value:null!=(a=null==g?void 0:g.cronSchedule)?a:"",label:{text:"Cron schedule",hidden:!0},isStaged:(null==d||null==(n=d.deploy)?void 0:n.cronSchedule)!=null,placeholder:"0 1 * * *",readOnly:!p.Write||null!=u.deploy.cronSchedule,onChange:e=>{let t=(null!=e?e:"").trim();m({deploy:{cronSchedule:""!==t?t:null}})},validate:e=>{if(!e)return;let t=N(e);if(t)return t}}),j&&(0,r.jsx)(x.xC,{className:"pb-1 pl-3",children:j})]}):(0,r.jsx)(C.$n,{disabled:!p.Write||E,size:"sm",variant:"outline",color:"gray",icon:v.FWt,onClick:()=>y(!0),children:"Cron Schedule"})}),E&&(0,r.jsx)(ee,{})]})}},et.Yh,{id:"deploy-app-sleeping",group:"Deploy",tags:["sleep","sleeping","serverless"],render:e=>{var t,n,l,i,s,o,c;let{id:d,service:u,serviceInstanceConfig:p,stagedServiceInstanceConfig:h,manifestFileInfo:x,permissions:g}=e,{updateServiceConfig:f}=(0,k.w)(u.id),{routes:y}=(0,N.c)(),{isFree:j}=(0,a.hA)(),w=(null==(t=p.deploy)?void 0:t.cronSchedule)!=null||(null==h||null==(n=h.deploy)?void 0:n.cronSchedule)!=null,C=null!=(o=null==(l=p.deploy)?void 0:l.sleepApplication)&&o;return(0,r.jsxs)(b.XY,{id:d,children:[(0,r.jsxs)(b.O5,{children:[(0,r.jsx)(b.fA,{id:d,children:"Serverless"}),(0,r.jsxs)(b.$0,{children:["Containers will scale down to zero and then scale up based on traffic. Requests while the container is sleeping will be queued and served when the container wakes up."," ",(0,r.jsxs)(m.N,{external:!0,variant:"highlight",...y.docs({page:"/reference/app-sleeping"}),children:[(0,r.jsx)("span",{className:"underline mr-1",children:"Docs"}),(0,r.jsx)(v.lth,{})]})]})]}),(0,r.jsx)(b.a,{fileInfo:x.deploy.sleepApplication,children:(0,r.jsx)(b.FE,{isStaged:(null==h||null==(i=h.deploy)?void 0:i.sleepApplication)!=null,children:(0,r.jsx)(K.N,{id:"app-sleeping",disabled:!g.Write||!C&&w,checked:null!=(c=null==(s=p.deploy)?void 0:s.sleepApplication)&&c,onCheckedChange:e=>f({deploy:{sleepApplication:e}}),children:"Enable Serverless"})})}),!C&&j&&!w&&(0,r.jsx)(q.l,{variant:"primary",size:"sm",className:"mt-3 gap-3",children:(0,r.jsxs)("div",{className:"flex items-center justify-between gap-2 w-full flex-wrap",children:[(0,r.jsx)("p",{children:"Upgrade to a paid plan to disable serverless."}),(0,r.jsxs)(m.N,{url:"https://railway.com/workspace/plans",className:"block group",children:[(0,r.jsx)("span",{className:"mr-1 group-hover:underline",children:"Learn More"}),(0,r.jsx)(v.lth,{})]})]})}),!C&&w&&(0,r.jsx)(X,{})]})}},{id:"use-legacy-stacker",group:"Deploy",tags:["legacy-stacker","admin"],render:e=>{var t,n,l;let{id:i,service:a,serviceInstanceConfig:s,stagedServiceInstanceConfig:c,manifestFileInfo:d,permissions:u}=e,{updateServiceConfig:p}=(0,k.w)(a.id),[{user:m}]=(0,o.Jd)();if(!(null==m?void 0:m.isAdmin))return null;let h=null!=(l=null==(t=s.deploy)?void 0:t.useLegacyStacker)&&l;return(0,r.jsxs)(b.XY,{id:i,children:[(0,r.jsxs)(b.O5,{children:[(0,r.jsx)(b.fA,{id:i,children:"Use Legacy Stacker (Admin Only)"}),(0,r.jsx)(b.$0,{children:"Force this service to use the legacy stacker implementation. Mostly useful for running LLMs."})]}),(0,r.jsx)(b.a,{fileInfo:d.deploy.useLegacyStacker,children:(0,r.jsx)(b.FE,{isStaged:(null==c||null==(n=c.deploy)?void 0:n.useLegacyStacker)!=null,children:(0,r.jsx)(K.N,{id:"use-legacy-stacker",disabled:!u.Write,checked:h,onCheckedChange:e=>p({deploy:{useLegacyStacker:e}}),children:"Enable Legacy Stacker"})})})]})}},{id:"deploy-restart-policy",group:"Deploy",tags:["restart","policy"],render:e=>{var t,n,i,a,s,o;let{id:c,service:d,serviceInstanceConfig:u,stagedServiceInstanceConfig:p,manifestFileInfo:g,permissions:f}=e,{updateServiceConfig:y}=(0,k.w)(d.id),{showModal:j}=(0,es.h)(),{routes:C}=(0,N.c)(),E=(0,l.md)(eo.G),I=null==E?void 0:E.containers.maxRestartPolicyRetries,D=Math.min(null!=I?I:10,10),P=function(e){var t,n,r;return(null==(t=e.deploy)?void 0:t.restartPolicyType)?e.deploy.restartPolicyType:(null==(n=e.deploy)?void 0:n.cronSchedule)?"NEVER":null!=(r=w.defaultServiceManifest.deploy.restartPolicyType)?r:"ON_FAILURE"}(u),O=eu[P],T=null==u?void 0:u.deploy,M=!!((null==T?void 0:T.cronSchedule)||(null==g||null==(t=g.deploy)?void 0:t.restartPolicyType)),z=null!=(s=null==T?void 0:T.restartPolicyMaxRetries)?s:D,F=null,L=I?"Your plan only supports up to ".concat(I," retries"):null;return null!=I&&("ALWAYS"===P?F='The "Always" policy is not available on your plan.':z>I&&(F=L)),(0,r.jsxs)(b.XY,{id:c,children:[(0,r.jsxs)(b.O5,{children:[(0,r.jsx)(b.fA,{id:c,children:"Restart Policy"}),(0,r.jsxs)(b.$0,{children:["Configure what to do when the process exits."," ",(0,r.jsxs)(m.N,{...C.docs({page:"/deploy/deployments#restart-policy"}),variant:"highlight",external:!0,children:[(0,r.jsx)("span",{className:"underline mr-1",children:"Docs"}),(0,r.jsx)(v.lth,{})]})]})]}),(0,r.jsx)(b.a,{fileInfo:g.deploy.restartPolicyType,children:(0,r.jsxs)(b.FE,{className:"flex items-center justify-between gap-4",isStaged:(null==p||null==(n=p.deploy)?void 0:n.restartPolicyType)!=null,children:[(0,r.jsxs)(h.T,{space:1,className:"w-full",children:[(0,r.jsx)(h.z,{space:2,align:"center",children:(0,r.jsx)(x.EY,{children:O.name})}),(0,r.jsxs)(x.ae,{children:[O.description," "]})]}),f.Write&&(0,r.jsxs)(R.ms,{children:[(0,r.jsx)(R.FH,{icon:v.yQN,title:"Restart Policy",size:"sm",variant:"ghost",disabled:M}),(0,r.jsx)(R.pm,{align:"end",className:"max-w-[400px]",children:Object.entries(eu).filter(e=>{let[t]=e;return P!==t}).map(e=>{var t,n;let[l,i]=e;return(0,r.jsx)(R.tJ,{className:"h-auto",disabled:M||(null==(t=i.disabled)?void 0:t.call(i,I)),onSelect:()=>{y({deploy:{restartPolicyType:l}})},children:(0,r.jsxs)(h.T,{space:1.5,className:"py-2",title:(null==(n=i.disabled)?void 0:n.call(i,I))?"Not supported by your plan":void 0,children:[(0,r.jsx)(h.z,{space:2,align:"center",children:(0,r.jsx)(x.EY,{children:i.name})}),(0,r.jsx)(x.ae,{children:i.description})]})},l)})})]})]})}),(null==(i=u.deploy)?void 0:i.cronSchedule)?(0,r.jsx)(q.l,{className:"mt-3 items-center rounded-md",variant:"info",size:"sm",children:"Services with a cron schedule do not have a restart policy."}):L?(0,r.jsx)(q.l,{variant:F?"danger":"info",size:"sm",className:"mt-3 rounded-md border border-red-100",children:(0,r.jsxs)("div",{className:"flex items-center justify-between gap-2 w-full flex-wrap",children:[(0,r.jsx)("p",{children:null!=F?F:L}),(0,r.jsx)("span",{className:"cursor-pointer",onClick:()=>j(ec.p,{title:"Upgrade to configure unlimited restarts",description:L}),children:(0,r.jsx)("span",{className:"mr-1 hover:underline",children:"Upgrade"})})]})}):null,(0,r.jsxs)(ed.M,{className:(0,A.xW)("ON_FAILURE"===P?"mt-4":""),isOpen:"ON_FAILURE"===P,children:[(0,r.jsx)(b.O5,{children:(0,r.jsx)(b.$0,{children:"Number of times to try and restart the service if it stopped due to an error."})}),(0,r.jsx)(b.a,{fileInfo:g.deploy.restartPolicyMaxRetries,children:(0,r.jsx)(S.j,{type:"number",min:1,label:{text:"Max restart retries",hidden:!0},value:(null!=(o=null==T?void 0:T.restartPolicyMaxRetries)?o:D).toString(),validate:e=>""==e||null==I||parseInt(e.trim())<=I,isStaged:(null==p||null==(a=p.deploy)?void 0:a.restartPolicyMaxRetries)!=null,readOnly:!f.Write||null!=g.deploy.restartPolicyMaxRetries,onChange:e=>y({deploy:{restartPolicyMaxRetries:""!==e?parseInt(e.trim()):null}})})})]})]})}},{id:"config-as-code-file",group:"Config-as-code",tags:["config","file","railway.json","railway.toml"],render:e=>{var t;let{id:n,service:l,serviceInstanceConfig:a,stagedServiceInstanceConfig:s,permissions:o}=e,c=l.id,{updateServiceConfig:d}=(0,k.w)(c),[u,p]=(0,i.useState)(!1),{routes:h}=(0,N.c)();return(0,r.jsxs)(b.XY,{id:n,children:[(0,r.jsxs)(b.O5,{children:[(0,r.jsx)(b.fA,{id:n,children:"Railway Config File"}),(0,r.jsxs)(b.$0,{children:["Manage your build and deployment settings through a config file."," ",(0,r.jsxs)(m.N,{variant:"highlight",...h.docs({page:"/guides/config-as-code"}),children:[(0,r.jsx)("span",{className:"underline mr-1",children:"Docs"}),(0,r.jsx)(v.lth,{})]})]})]}),u||a.configFile?(0,r.jsx)(S.j,{autoFocus:u,placeholder:"railway.toml",isStaged:(null==s?void 0:s.configFile)!=null,value:null!=(t=a.configFile)?t:"",readOnly:!o.Write,label:{text:"Railway config file path",hidden:!0},onChange:e=>d({configFile:e})}):(0,r.jsx)(C.$n,{size:"sm",variant:"outline",color:"gray",icon:v.FWt,disabled:!o.Write,onClick:()=>p(!0),children:"Add File Path"})]})},isAvailable:e=>{let{serviceInstanceConfig:t}=e;return null==(0,w.getImageSource)(t.source)}},{id:"feature-flags",group:"Feature-flags",tags:["feature","flag"],render:e=>{let{id:t,service:n}=e;return(0,r.jsx)(b.XY,{id:t,children:(0,r.jsx)(eg,{service:n})})},isAvailable:e=>{let{user:t}=e;return ex(t).length>0}},{id:"danger-delete-service",group:"Danger",tags:["delete","danger"],render:e=>{let{id:t,service:n,permissions:l}=e,{navActions:i,routes:a}=(0,N.c)(),s=(0,$.y3)(),o=async()=>{i.push(a.project({})),s.stageEnvironmentChanges({payload:(0,w.newEnvironmentConfig)(s.getStagedChanges()).deleteService(n.id).build()})};return(0,r.jsxs)(b.XY,{id:t,children:[(0,r.jsxs)(b.O5,{children:[(0,r.jsx)(b.fA,{id:t,className:"text-red-500",children:"Delete Service"}),(0,r.jsxs)(b.$0,{className:"text-red-600",children:["Deleting this service will"," ",(0,r.jsx)("b",{className:"font-semibold",children:"permanently delete"})," all its deployments and remove it from"," ",(0,r.jsx)("b",{className:"font-semibold",children:"this environment"}),". This cannot be undone."]})]}),(0,r.jsx)(H.V,{message:"Only workspace admins can delete services",showTooltip:!l.Admin,children:(0,r.jsx)(C.$n,{color:"red",size:"sm",onClick:()=>o(),disabled:!l.Admin,className:"max-w-max mt-6 font-bold",children:"Delete service"})})]})}}];var nt=n(17771);let nn=e=>{let{project:t,service:n,environment:m}=e,[{user:g,isBeta:v}]=(0,o.Jd)(),{isPro:f}=(0,a.hA)(),[y,w]=(0,i.useState)(""),N=(0,l.md)((0,c.KI)({serviceId:n.id,environmentId:m.id})),k=(0,l.md)((0,c.cs)({serviceId:n.id,environmentId:m.id})),C=(0,l.md)((0,d.m5)(n.id)),S=(0,l.md)((0,c.Io)(n.id)),E=(0,i.useMemo)(()=>{if(!y)return ne;let e=(0,p.W)(y,ne.map(e=>{var t;return{text:e.id,value:e.id,tags:[...null!=(t=e.tags)?t:[],e.group]}}),[],{threshold:.3,keys:[{name:"tags",weight:1}]});return ne.filter(t=>e.map(e=>e.value).includes(t.id))},[y]),I={isPro:f,project:t,environment:m,service:n,serviceInstance:C,serviceInstanceConfig:N,stagedServiceInstanceConfig:k,manifestFileInfo:(0,s.A)({deployment:S}),permissions:(0,l.md)(u.DM),latestDeploy:S,isServiceInstanceBeingCreated:!0===N.isCreated,user:g},A=E.filter(e=>null==e.isAvailable||e.isAvailable(I));return(0,r.jsxs)("div",{className:"relative -mx-5 -mt-8 md:-mx-12",children:[(0,r.jsx)(j,{onSearch:e=>w(e)}),(0,r.jsxs)("div",{className:"relative grid gap-16 grid-cols-1 lg:grid-cols-[1fr_auto]",children:[0===A.length?(0,r.jsx)(h.T,{space:1,justify:"center",className:"text-center m-4 py-14 rounded-lg border border-dashed border-gray-200",children:(0,r.jsx)(x.xC,{className:"leading-6 font-semibold",children:"No settings matching your search"})}):(0,r.jsx)("div",{className:"grid gap-16 mx-6 sm:mx-12 mt-12 pb-40 sm:pb-12 border-l-none sm:border-l-2 border-black border-opacity-[8%] dark:border-white dark:border-opacity-[8%]",children:nt.p.map(e=>{let t=A.filter(t=>t.group===e);return 0===t.length?(0,r.jsx)(i.Fragment,{},e):(0,r.jsx)(b.X4,{group:e,children:(0,r.jsx)(r.Fragment,{children:t.filter(e=>!e.isBeta||v).map(e=>{let t=e.render;return(0,r.jsx)(t,{id:e.id,...I},e.id)})})},e)})}),(0,r.jsx)(nr,{settingsGroup:nt.p})]})]})},nr=e=>{let{settingsGroup:t}=e;return(0,r.jsx)("aside",{className:"hidden lg:block",children:(0,r.jsx)("ul",{className:"grid gap-3 sticky top-28 mt-12 mr-12",children:t.map(e=>(0,r.jsx)("li",{className:"text-sm text-gray-500",children:(0,r.jsx)(m.N,{variant:"highlight",href:"#".concat(e.toLowerCase()),children:e})},e))})})}},76706:(e,t,n)=>{"use strict";n.d(t,{d:()=>i});var r=n(25963),l=n(94834);let i=e=>{let[t,n]=(0,r.useState)({top:0,left:0,width:0,height:0}),i=(0,r.useCallback)(()=>{null!=e.current&&n((e=>{let t=e.getBoundingClientRect();return{top:t.top,left:t.left,width:t.width,height:t.height}})(e.current))},[e.current,n]);return(0,r.useEffect)(()=>{if(null==e.current)return;let t=e.current;try{let e=new l.default(()=>{i()});return e.observe(t),()=>{e.unobserve(t)}}catch(e){}},[e.current,i]),(0,r.useEffect)(()=>{if(null!=e.current)return window.addEventListener("scroll",i),window.addEventListener("resize",i),()=>{window.removeEventListener("scroll",i),window.removeEventListener("resize",i)}},[e.current,i]),(0,r.useEffect)(()=>{i();let e=setTimeout(()=>{i()},1e3);return()=>{clearTimeout(e)}},[e.current,i]),t}},79060:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var r=n(50979),l=n(2092),i=n(25963),a=n(13077),s=n(2551),o=n(36609);let c=e=>{let{title:t,triggerClassName:n,children:c,disabled:d,hasChevron:u=!0,open:p,onOpenChange:m}=e,[h,x]=(0,i.useState)("");return(0,r.jsx)(l.bL,{className:"w-full",collapsible:!0,value:null!=p?p?"item":"":h,onValueChange:e=>{null!=p?null==m||m("item"===e):x(e)},type:"single",children:(0,r.jsxs)(l.q7,{value:"item",children:[(0,r.jsxs)(l.l9,{disabled:d,className:(0,o.xW)("focus-visible:outline-none focus-visible:text-pink-500 rounded-lg group flex items-center gap-x-2 text-gray-500 px-6 py-4 w-full",n),children:[(0,r.jsx)(a.In,{className:(0,o.xW)("group-rdx-state-open:rotate-90 group-rdx-state-closed:rotate-0 transition-transform",!u&&"opacity-0"),color:"currentColor",icon:s.c_$}),t]}),(0,r.jsx)(l.UC,{className:"overflow-hidden rdx-state-open:animate-accordion-slide-down rdx-state-closed:animate-accordion-slide-up",children:c})]})})}},81009:(e,t,n)=>{"use strict";n.d(t,{M:()=>d});var r=n(50979),l=n(13025),i=n(25963),a=n(36609);let s={open:{opacity:1,height:"auto"},collapsed:{opacity:0,height:0}},o={duration:.25,ease:"easeInOut"},c=0,d=e=>{let{isOpen:t,children:n,className:d,...u}=e,p=(0,i.useMemo)(()=>"slidingContainer-".concat(c++),[]);return(0,r.jsx)(l.P.div,{"aria-controls":p,"aria-expanded":!!t,initial:t?"open":"collapsed",animate:t?"open":"collapsed",exit:"collapsed",variants:s,transition:o,style:{margin:t?void 0:0},...u,className:(0,a.xW)(d,t?"":"pointer-events-none"),children:n})}},83279:(e,t,n)=>{"use strict";n.d(t,{j:()=>r});let r=e=>{try{return JSON.parse(e),!0}catch(e){}return!1}},87248:(e,t,n)=>{"use strict";n.d(t,{I:()=>_});var r=n(50979),l=n(25963),i=n(36609),a=n(79864),s=n(45479),o=n(95662),c=n(51012),d=n(2551),u=n(81154),p=n(56144),m=n(80428),h=n(13025),x=n(34680);let g=e=>{let{value:t,indicatorClasses:n,markers:a}=e,s=(0,l.useRef)(t),[o,c]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{t<s.current&&100===s.current&&(c(!0),setTimeout(()=>c(!1),800)),s.current=t},[t]),(0,r.jsxs)("div",{className:"relative h-1.5 w-full overflow-hidden rounded-full bg-gray-100",children:[(0,r.jsx)(h.P.div,{className:(0,i.xW)("h-full bg-pink-500 origin-left",n),initial:!1,animate:{width:"".concat(o?0:t,"%"),transition:{duration:.1*!o,ease:[.65,0,.35,1]}}}),null==a?void 0:a.map((e,t)=>(0,r.jsx)("div",{className:"absolute top-0 bottom-0 w-0.5 bg-pink-600 h-3",style:{left:"".concat(e,"%")}},t)),(0,r.jsx)(m.N,{children:o&&(0,r.jsx)(h.P.div,{className:(0,i.xW)("absolute inset-0 bg-pink-500",n),initial:{x:"0%"},animate:{x:"100%"},exit:{x:"100%"},transition:{duration:.66,ease:[.65,0,.35,1]}})})]})};g.Skeleton=function(e){let{indicatorClasses:t}=e,[n,a]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{let e=setInterval(()=>{a(e=>!e)},1e3);return()=>{clearInterval(e)}},[]),(0,r.jsx)("div",{className:"relative h-1.5 w-full overflow-hidden rounded-full bg-gray-100",children:(0,r.jsx)(m.N,{children:n&&(0,r.jsx)(h.P.div,{className:(0,i.xW)("absolute inset-y-0 w-[25%] bg-gray-200 rounded-full",t),initial:{x:"-100%"},animate:{x:"400%"},exit:{x:"400%"},transition:{duration:.66,ease:[.65,0,.35,1]}})})})};var v=n(69903),f=n(51342),y=n(11589),j=n(47868),b=n(88261),w=n(69167),N=n(31074),k=n(63006),C=n(66138),S=n(80761),E=n(4485),I=n(55355),A=n(82662),D=n(50253),R=n.n(D),P=n(4883);let O=(0,A.A)(e=>new Date(e.timestamp)).left,T=e=>{let{progress:t,width:n}=e,i={top:5,right:0,bottom:5,left:0},s=(0,l.useRef)(null),o=new Date().getTime()/1e3-new Date(t.history[0].timestamp).getTime()/1e3,[c,d]=(0,l.useState)(!1);(0,l.useEffect)(()=>{let e=setInterval(()=>{let e=new Date(t.history[t.history.length-1].timestamp).getTime()/1e3;d(new Date().getTime()/1e3-e>5)});return()=>clearInterval(e)},[t.history]);let{showTooltip:u,hideTooltip:p,tooltipData:m,tooltipLeft:h=0,tooltipTop:g=5}=(0,C.A)();if(!history||history.length<2)return null;let A=[...t.history].sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime()),D=Math.min(...A.map(e=>new Date(e.timestamp).getTime())),P=Math.max(...A.map(e=>new Date(e.timestamp).getTime())),T=Math.max(...A.map(e=>e.transferRateMbps||0)),M=A.reduce((e,t)=>e+(t.transferRateMbps||0),0)/A.length,z=(0,f.A)({domain:[new Date(D),new Date(P)],range:[i.left,n-i.right]}),F=(0,y.A)({domain:[0,1.1*T],range:[40-i.bottom,i.top]}),L=e=>z(new Date(e.timestamp)),W=e=>F(e.transferRateMbps||0),U=100-100*(t.currentSnapshot.compressedBytesTransferred/t.currentSnapshot.bytesTransferred||1),_=e=>{let{x:t}=(0,I.A)(e)||{x:0},n=z.invert(t),r=O(A,n,1),l=A[r-1],i=A[r],a=l;i&&l?a=n.valueOf()-new Date(l.timestamp).valueOf()>new Date(i.timestamp).valueOf()-n.valueOf()?i:l:i&&(a=i),u({tooltipData:a,tooltipLeft:L(a),tooltipTop:W(a)})};return(0,r.jsxs)("div",{className:"w-full h-10 mt-1 relative mb-4",ref:s,children:[(0,r.jsxs)("svg",{width:"100%",height:40,className:"overflow-visible",children:[(0,r.jsx)(k.A,{id:"area-gradient",from:"var(--pink-400)",to:"var(--pink-100)",toOpacity:.2}),(0,r.jsxs)(j.A,{children:[(0,r.jsx)(w.A,{data:A,x:L,y:W,yScale:F,curve:b.G,fill:"url(#area-gradient)"}),(0,r.jsx)(v.A,{data:A,x:L,y:W,curve:b.G,stroke:"var(--pink-500)",strokeWidth:1.5}),(0,r.jsx)("line",{x1:i.left,y1:F(M),x2:n-i.right,y2:F(M),stroke:"var(--pink-500)",strokeWidth:1,strokeDasharray:"4,4",opacity:.7}),(0,r.jsxs)("text",{x:n-i.right,y:40-i.bottom+10,textAnchor:"end",dominantBaseline:"middle",fontSize:"10px",children:[(0,r.jsx)("tspan",{fill:"var(--pink-400)",children:"Avg speed "}),(0,r.jsxs)("tspan",{fill:"var(--pink-600)",children:[(0,x.p1)(1e3*M*1e3,{maximumFractionDigits:1}),"/s"]})," ",(0,r.jsxs)("tspan",{dx:6,fill:"var(--pink-400)",children:["Comp. ratio"," "]}),(0,r.jsxs)("tspan",{fill:"var(--pink-600)",children:[U.toFixed(2),"%"]})," ",(0,r.jsxs)("tspan",{dx:6,fill:"var(--pink-400)",children:["Elapsed time"," "]}),(0,r.jsx)("tspan",{fill:"var(--pink-600)",children:(0,a.a)(o)})]}),(0,r.jsx)("rect",{width:n,height:40,fill:"transparent",onMouseMove:_,onMouseLeave:p,onTouchStart:_,onTouchMove:_}),c&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("rect",{x:-10,y:-10,rx:10,width:n+20,height:60,fill:"white",opacity:.5}),(0,r.jsx)("text",{x:n/2,y:20,fill:"var(--pink-500)",textAnchor:"middle",dominantBaseline:"top",fontSize:"24px",children:(0,r.jsx)("tspan",{dy:"0.3em",children:"Paused"})})]}),m&&(0,r.jsx)(N.A,{cx:h,cy:g,r:4,fill:"var(--pink-500)",strokeWidth:2,pointerEvents:"none"})]})]}),m&&(0,r.jsxs)(S.A,{top:20-i.top-30,left:h,style:{...E.k,background:"rgba(0, 0, 0, 0.85)",color:"white",borderRadius:"4px",fontSize:"12px",padding:"4px 8px",pointerEvents:"none",whiteSpace:"nowrap"},children:[(0,r.jsx)("div",{children:(0,r.jsx)("strong",{children:R()(m.timestamp).format("MMM D, h:mm:ss A")})}),(0,r.jsxs)("div",{children:[(0,x.p1)(1e3*(m.transferRateMbps||0)*1e3,{maximumFractionDigits:1}),"/s"]}),(0,r.jsxs)("div",{className:"text-xs opacity-75",children:["Avg:"," ",(0,x.p1)(1e3*M*1e3,{maximumFractionDigits:1}),"/s"]})]},Math.random())]})},M=e=>(0,r.jsx)("div",{children:(0,r.jsx)(P.A,{children:t=>{let{width:n,height:l}=t;return(0,r.jsx)(T,{...e,width:n})}})});var z=n(45588),F=n(13077),L=n(47654),W=n(73742),U=n(32507);function _(e){let{volumeInstanceId:t,volumeInstanceExternalId:n,className:l,fallback:i=null}=e,{volumeInstances:a}=(0,u.md)(U.Bo),o=a.find(e=>e.id===t),d=(null==o?void 0:o.state)!==s.sDj.Migrating&&(null==o?void 0:o.state)!==s.sDj.MigrationPending,p=(0,c.H)(n,{disabled:d});return d?(0,r.jsx)(r.Fragment,{children:i}):(0,r.jsx)(V,{className:l,progress:p,volumeInstanceId:t})}function V(e){var t,n,c,v;let{className:f,volumeInstanceId:y,progress:j}=e,{volumeInstances:b}=(0,u.md)(U.Bo),w=b.find(e=>e.id===y),[{user:N}]=(0,z.Jd)(),k=(0,u.Xr)(p.kW),[C,S]=(0,l.useState)(!1),E=(0,l.useMemo)(()=>{if(!(null==N?void 0:N.isAdmin)||(null==j?void 0:j.status)!==s.LER.TransferringOnline)return[];let e=[];return null==j||j.snapshotsSizes.forEach((t,n)=>{e.push((null==j?void 0:j.snapshotsSizes[n])+(e[n-1]||0))}),e.map(e=>e/((null==j?void 0:j.onlineTotalBytes)||1)*100)},[null==j?void 0:j.snapshotsSizes]),I=k(null!=(t=null==j?void 0:j.srcRegion)?t:""),A=k(null!=(n=null==j?void 0:j.destRegion)?n:""),D=(null==j?void 0:j.status)===s.LER.Completed,R=(null==w?void 0:w.state)===s.sDj.MigrationPending,P=(null==j?void 0:j.status)==="ERROR",O=(null==j?void 0:j.estimatedTimeRemainingMs)?null==j?void 0:j.estimatedTimeRemainingMs:0,T=O?O<6e4?(0,a.e)(O,{unitDisplay:"narrow"}):(0,a.a)(O/1e3):void 0;return(0,r.jsx)(o.T,{className:(0,i.xW)("p-5 border border-neutral-light rounded-lg transition-all tabular-nums font-medium text-sm overflow-clip",D&&"border-success-light bg-success-surface !p-3",R&&"border-info-light bg-info-surface !p-3",f),justify:"center",children:(0,r.jsxs)(m.N,{mode:"popLayout",children:[R?(0,r.jsx)(h.P.div,{className:"flex flex-col gap-1.5 min-h-0 w-full",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{scale:.9,duration:.5},children:(0,r.jsx)("div",{className:"text-info",children:"Waiting to migrate to new region. Your service will remain online until it starts."})},"queued"):D?(0,r.jsx)(h.P.div,{className:"flex flex-col gap-1.5 min-h-0 w-full",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{scale:.9,duration:.5},children:(0,r.jsxs)(o.z,{align:"center",space:3,children:[(0,r.jsx)(d.rAV,{className:"text-success w-5"}),(0,r.jsxs)("div",{className:"text-success",children:["Migration to ",A," is complete"]})]})},"completed"):(0,r.jsxs)(h.P.div,{className:(0,i.xW)("flex flex-col min-h-0 w-full gap-3"),animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.5},children:[(0,r.jsxs)(o.z,{justify:"between",className:"overflow-hidden max-w-full",children:[(0,r.jsxs)("div",{className:"grow",children:[(0,r.jsx)("span",{className:(0,i.xW)("relative"),children:(0,r.jsxs)(m.N,{mode:"popLayout",children:[!j&&(0,r.jsx)(h.P.span,{className:(0,i.xW)("inline-block"),initial:{y:-20,opacity:0},animate:{y:0,opacity:1},exit:{y:20,opacity:0},transition:{duration:.5},children:"Migrating service..."},"online"),(null==j?void 0:j.status)==="TRANSFERRING_ONLINE"&&(0,r.jsx)(h.P.span,{className:(0,i.xW)("inline-block"),initial:{y:-20,opacity:0},animate:{y:0,opacity:1},exit:{y:20,opacity:0},transition:{duration:.5},children:"Copying data"},"online"),(null==j?void 0:j.status)==="TRANSFERRING_OFFLINE"&&(0,r.jsxs)(h.P.span,{className:(0,i.xW)("inline-block"),initial:{y:-20,opacity:0},animate:{y:0,opacity:1},exit:{y:20,opacity:0},transition:{duration:.5},children:["Copying remaining data"," "]},"offline"),(null==j?void 0:j.status)==="ERROR"&&(0,r.jsx)(h.P.span,{className:(0,i.xW)("inline-block text-red-600"),initial:{y:-20,opacity:0},animate:{y:0,opacity:1},exit:{y:20,opacity:0},transition:{duration:.5},children:"Failed to copy data"},"error")]})})," ",j&&(0,r.jsx)(h.P.span,{layout:!0,transition:{duration:.2},children:(0,r.jsxs)("span",{className:"text-neutral-secondary",children:["from"," ",(0,r.jsx)("span",{title:(null==N?void 0:N.isAdmin)?j.srcStackerId:"",className:(null==N?void 0:N.isAdmin)?"underline decoration-dotted cursor-pointer":"",children:I})," ","to"," ",(0,r.jsx)("span",{className:(null==N?void 0:N.isAdmin)?"underline decoration-dotted cursor-pointer":"",title:(null==N?void 0:N.isAdmin)?j.destStackerId:"",children:A})]})})]}),j&&null!=T&&(0,r.jsxs)("div",{className:"text-nowrap",children:[(0,r.jsx)("span",{children:T})," ",(0,r.jsx)("span",{className:"text-neutral-secondary",children:"remaining"})]})]}),j?(0,r.jsx)(g,{value:null!=(c=null==j?void 0:j.percentComplete)?c:0,markers:E}):(0,r.jsx)(g.Skeleton,{}),j&&(0,r.jsx)(m.N,{children:(0,r.jsx)(h.P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.1},className:"w-full",children:(0,r.jsxs)(o.z,{justify:"between",align:"center",className:"text-xs",children:[(0,r.jsxs)(o.z,{space:1,align:"center",children:[(null==N?void 0:N.isAdmin)&&(0,r.jsx)(F.In,{icon:d.c_$,size:"sm",className:(0,i.xW)("transition-all cursor-pointer",C?"rotate-90":""),onClick:()=>{S(!C)}}),(0,r.jsx)("span",{children:(0,x.v7)("TRANSFERRING_ONLINE"===j.status?j.onlineBytesTransferred:j.offlineBytesTransferred,{maximumFractionDigits:2,minimumFractionDigits:2})})," ",(0,r.jsxs)("span",{className:"text-neutral-secondary",children:["of"," ",(0,x.v7)("TRANSFERRING_ONLINE"===j.status?j.onlineTotalBytes:j.offlineTotalBytes,{maximumFractionDigits:2,minimumFractionDigits:2})," ","(",(0,x.p1)((null!=(v=j.transferRateMbps)?v:0)*1e6,{maximumFractionDigits:1}),"/s)"]}),(null==N?void 0:N.isAdmin)&&y&&(0,r.jsx)(L.N,{href:(0,W.Ej)({volumeInstanceId:y}),children:(0,r.jsx)(F.In,{icon:d.lth,size:"xs"})})]}),(0,r.jsxs)("span",{children:[j.percentComplete.toFixed(0),"%"]})]})})}),(0,r.jsx)(m.N,{children:C&&(null==j?void 0:j.history)&&(null==j?void 0:j.history.length)>1&&(0,r.jsxs)(h.P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.1},className:"overflow-hidden w-full",children:[(0,r.jsx)(M,{progress:j}),(0,r.jsx)(o.T,{space:2,children:(0,r.jsxs)(o.z,{space:2,align:"center",children:[(0,r.jsxs)(o.z,{space:1,className:"shrink-0",align:"center",children:[(0,r.jsx)("span",{children:"Snapshot"}),(0,r.jsxs)("span",{className:"text-neutral-secondary",children:[j.currentSnapshot.index+1," of"," ",j.nbSnapshots+ +("TRANSFERRING_OFFLINE"!==j.status)]}),(0,r.jsxs)("span",{className:"text-pink-500 text-xs",children:["(",(0,x.v7)(j.snapshotsSizes[j.currentSnapshot.index]),")"]})]}),(0,r.jsx)(g,{value:j.currentSnapshot.percentComplete,indicatorClasses:"bg-pink-300"})]})})]})})]},"progress"),P&&(0,r.jsx)("div",{className:"mt-2 text-red-600",children:j.error||"An error occurred during the data migration"})]})})}},89088:(e,t,n)=>{"use strict";n.d(t,{N:()=>c});var r=n(50979),l=n(76702),i=n(95662),a=n(36609);let s={md:{classes:"min-w-10 w-10 h-6",width:40},sm:{classes:"min-w-8 w-8 h-5",width:32},xs:{classes:"min-w-7 w-7 h-4",width:28}},o={md:"min-w-5 w-5 h-5",sm:"min-w-4 w-4 h-4",xs:"min-w-3 w-3 h-3"},c=e=>{let{size:t="md",children:n,...c}=e;return(0,r.jsxs)(i.z,{align:"center",space:4,className:(0,a.xW)("w-full",c.disabled&&"opacity-40",c.className),children:[(0,r.jsx)(l.bL,{...c,className:(0,a.xW)("rounded-full shadow","focus:outline-none focus:ring-2 focus:ring-pink-400",s[t].classes,c.checked?"bg-pink-500":"bg-gray-300"),children:(0,r.jsx)(l.zi,{className:(0,a.xW)("block rounded-full bg-white shadow","transition-transform duration-100 transform translate-x-1",o[t]),style:{transform:c.checked?"translateX(calc((".concat(s[t].width,"px - 4px) / 2))"):""}})}),(0,r.jsx)("label",{htmlFor:c.id,className:(0,a.xW)("w-full cursor-pointer select-none",c.disabled&&"cursor-not-allowed"),children:n})]})}},91486:(e,t,n)=>{"use strict";n.d(t,{Yh:()=>g,jN:()=>x});var r=n(50979),l=n(12725),i=n(25963),a=n(70375),s=n(50655),o=n(2551),c=n(36609),d=n(31754),u=n(65910),p=n(47654),m=n(49767);let h=e=>{let{id:t,manifestFileInfo:n,onChange:i,value:s,readOnly:c,isStaged:d}=e,{routes:h}=(0,a.c)();return(0,r.jsxs)(m.XY,{id:t,className:"pb-8 border-b border-gray-100",children:[(0,r.jsxs)(m.O5,{children:[(0,r.jsx)(m.fA,{children:"Healthcheck Timeout"}),(0,r.jsxs)(m.$0,{children:["Number of seconds we will wait for the healthcheck to complete."," ",(0,r.jsxs)(p.N,{external:!0,variant:"highlight",...h.docs({page:"/deploy/healthchecks#timeout"}),children:[(0,r.jsx)("span",{className:"underline mr-1",children:"Docs"}),(0,r.jsx)(o.lth,{})]})]})]}),(0,r.jsx)(m.a,{fileInfo:null==n?void 0:n.deploy.healthcheckTimeout,children:(0,r.jsx)(u.j,{type:"number",placeholder:"300",label:{text:"Healthcheck Timeout",hidden:!0},value:null!=s?s:"",isStaged:d,validate:e=>null==e||(0,l.validateHealthcheckTimeout)(parseInt(e)),readOnly:c||(null==n?void 0:n.deploy.healthcheckTimeout)!=null,onChange:i})})]})},x=e=>{let{id:t,manifestFileInfo:n,onChange:l,value:s,readOnly:h,isStaged:x,className:g}=e,{routes:v}=(0,a.c)(),[f,y]=(0,i.useState)(!1);return(0,r.jsxs)(m.XY,{id:t,className:(0,c.xW)(s&&"pt-8 border-t border-gray-100",g),children:[(0,r.jsxs)(m.O5,{children:[(0,r.jsx)(m.fA,{id:t,children:"Healthcheck Path"}),(0,r.jsxs)(m.$0,{children:["Endpoint to be called before a deploy completes to ensure the new deployment is live."," ",(0,r.jsxs)(p.N,{external:!0,variant:"highlight",...v.docs({page:"/deploy/healthchecks"}),children:[(0,r.jsx)("span",{className:"underline mr-1",children:"Docs"}),(0,r.jsx)(o.lth,{})]})]})]}),(0,r.jsx)(m.a,{fileInfo:null==n?void 0:n.deploy.healthcheckPath,children:f||s?(0,r.jsx)(u.j,{autoFocus:f,label:{text:"Healthcheck Path",hidden:!0},value:null!=s?s:"",isStaged:x,readOnly:h||(null==n?void 0:n.deploy.healthcheckPath)!=null,onChange:l}):(0,r.jsx)(d.$n,{disabled:h,size:"sm",variant:"outline",color:"gray",icon:o.FWt,onClick:()=>y(!0),children:"Healthcheck Path"})})]})},g={id:"deploy-healthcheck",group:"Deploy",tags:["healthcheck","timeout"],render:e=>{var t,n,l;let{service:i,serviceInstanceConfig:a,stagedServiceInstanceConfig:o,manifestFileInfo:c,permissions:d}=e,{updateServiceConfig:u}=(0,s.w)(i.id),p=null==a?void 0:a.deploy;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x,{id:"deploy-healthcheck",manifestFileInfo:c,readOnly:!d.Write,isStaged:(null==o||null==(t=o.deploy)?void 0:t.healthcheckPath)!=null,value:null==p?void 0:p.healthcheckPath,onChange:e=>u({deploy:{healthcheckPath:e.trim()||null}})}),(null==p?void 0:p.healthcheckPath)&&(0,r.jsx)(h,{id:"deploy-healthcheck-timeout",manifestFileInfo:c,readOnly:!d.Write,isStaged:(null==o||null==(n=o.deploy)?void 0:n.healthcheckTimeout)!=null,value:null==p||null==(l=p.healthcheckTimeout)?void 0:l.toString(),onChange:e=>u({deploy:{healthcheckTimeout:""!==e?parseInt(e.trim()):null}})})]})}}},91597:(e,t,n)=>{var r=n(25963);function l(e){return r.createElement("svg",e,[r.createElement("g",{clipPath:"url(#clip0_10_5240)",key:0},[r.createElement("path",{d:"M-0.533203 0H20.8001V16H-0.533203V0Z",fill:"black",key:0}),r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M0 0H24V16H0V0Z",fill:"white",key:1}),r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M0 0H24V8H0V0Z",fill:"#DF0000",key:2}),r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.93319 1.33994C5.30179 1.47563 4.7363 1.82442 4.33166 2.32775C3.92701 2.83107 3.70786 3.45829 3.71099 4.1041C3.71411 4.7499 3.93933 5.37497 4.34883 5.87436C4.75833 6.37374 5.32717 6.71704 5.95985 6.84661C5.59741 6.95148 5.21783 6.98378 4.84287 6.94164C4.46792 6.8995 4.10498 6.78376 3.77485 6.60104C3.44473 6.41833 3.15393 6.17224 2.91912 5.8769C2.68431 5.58155 2.51011 5.24275 2.40652 4.87994C2.20078 4.15064 2.29216 3.36954 2.6607 2.70742C3.02923 2.04531 3.64494 1.55605 4.37319 1.34661C4.90652 1.19327 5.39985 1.18994 5.93652 1.33994H5.93319Z",fill:"white",key:3}),r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.49987 3.66654L5.6632 4.16654L5.22987 3.85988L4.8032 4.17321L4.95987 3.66654L4.5332 3.35654L5.0632 3.34988L5.22987 2.84988L5.39654 3.34988H5.9232L5.49987 3.66654ZM6.0832 5.39988L6.24987 5.90321L5.81654 5.59654L5.38654 5.90654L5.54654 5.40321L5.11987 5.08988L5.64987 5.08654L5.8132 4.58321L5.97987 5.08321H6.5132L6.0832 5.39988ZM8.0332 5.38654L8.19654 5.89321L7.7632 5.58321L7.33654 5.89321L7.4932 5.38988L7.06654 5.07988L7.59654 5.07321L7.7632 4.57321L7.92987 5.07321H8.45654L8.0332 5.38654ZM8.6132 3.66654L8.77654 4.16988L8.3432 3.86321L7.91654 4.17321L8.07654 3.66988L7.64654 3.35654L8.17987 3.35321L8.33987 2.84988L8.50654 3.34988H9.03987L8.6132 3.66654ZM7.06987 2.52321L7.23654 3.02988L6.8032 2.71988L6.3732 3.03321L6.5332 2.52654L6.10654 2.21321L6.6332 2.20988L6.79987 1.70654L6.96654 2.20654H7.49987L7.06987 2.52321Z",fill:"white",key:4})]),r.createElement("rect",{x:"0.4",y:"0.4",width:"23.2",height:"15.2",rx:"2.8",stroke:"black",strokeOpacity:"0.075",strokeWidth:"0.8",key:1}),r.createElement("defs",{key:2},r.createElement("clipPath",{id:"clip0_10_5240"},r.createElement("rect",{width:"24",height:"16",rx:"3.2",fill:"white"})))])}l.defaultProps={width:"24",height:"16",viewBox:"0 0 24 16",fill:"none"},e.exports=l,l.default=l},94621:(e,t,n)=>{"use strict";n.d(t,{E:()=>l});var r=n(25963);let l=(e,t)=>{let[n,l]=(0,r.useState)(e),i=(0,r.useRef)(null);return(0,r.useEffect)(()=>()=>{null!=i.current&&(clearTimeout(i.current),i.current=null)},[]),[n,n=>{l(n),i.current=setTimeout(()=>{l(e)},t)}]}},98579:(e,t,n)=>{"use strict";n.d(t,{u:()=>c});var r=n(95925),l=n(97865),i=n(55850),a=n(66800),s=n.n(a);let o=(e,t,n)=>["privateNetworkEndpoint",n,e,t],c=e=>{let{privateNetworkId:t,environmentId:n,serviceId:a}=e,c=(0,r.jE)(),{graphqlClient:d}=(0,i.q)(),u=o(n,a,t),{result:p}=(0,l.W)(u,async()=>(await d.privateNetworkEndpoint({privateNetworkId:t||"",environmentId:n,serviceId:a})).privateNetworkEndpoint||void 0,{enabled:!!t,staleTime:s()("30s"),refetchOnMount:!1});return[{privateNetworkEndpoint:p},{createOrGetEndpoint:async e=>{let t=(await d.privateNetworkEndpointCreateOrGet({input:e})).privateNetworkEndpointCreateOrGet;return await c.invalidateQueries({queryKey:o(e.environmentId,e.serviceId,e.privateNetworkId)}),t},renameEndpoint:async(e,t,r)=>{let l=(await d.privateNetworkEndpointRename({id:e,dnsName:t,privateNetworkId:r})).privateNetworkEndpointRename;return await c.invalidateQueries({queryKey:o(n,a,r)}),l},deleteEndpoint:async e=>{let r=(await d.privateNetworkEndpointDelete({id:e})).privateNetworkEndpointDelete;return await c.invalidateQueries({queryKey:o(n,a,t)}),r}}]}},98888:(e,t,n)=>{"use strict";n.d(t,{B:()=>i});var r=n(25963),l=n(70375);let i=e=>{let{pathname:t}=(0,l.c)(),n=(0,r.useCallback)((e,n)=>"Data"===e?t.includes("/data"):t===n.route.url,[t]);return{tabs:(0,r.useMemo)(()=>Object.entries(e).filter(e=>{let[,t]=e;return t.enabled}).map(e=>{let[t,r]=e,l=n(t,r);return{text:t,link:r.route,badge:r.badge,active:l}}),[e,n]),currentTab:(0,r.useMemo)(()=>{let t=Object.entries(e).find(e=>{let[t,r]=e;return n(t,r)});return null!=t?t[0]:null},[e,n])}}}}]);