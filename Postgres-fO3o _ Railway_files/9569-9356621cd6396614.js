"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9569],{758:(e,t,n)=>{n.d(t,{B1:()=>c,dq:()=>p,hF:()=>u,pN:()=>d,vP:()=>m});var l=n(53036),r=n(25963),s=n(45479),a=n(91630),o=n(55850),i=n(97865);let d="deployment";function c(e){return[d,e]}let u=e=>{var t;let{data:n,isLoading:l}=m(e),[o,i]=(0,r.useState)(void 0);return(0,a.R)(s.NqL,{variables:{id:null!=e?e:""},onError:()=>{},onNext:e=>{let{data:t}=e,n=null==t?void 0:t.deployment;n&&i(n)},disabled:null==e}),{deployment:(null==n?void 0:n.deployment)!=null?{...n.deployment,...(null==o?void 0:o.id)===n.deployment.id?{status:null!=(t=o.status)?t:n.deployment.status}:{}}:void 0,isLoading:l}};function m(e){let{graphqlClient:t}=(0,o.q)(),n=c(e);return(0,l.I)({queryKey:n,queryFn:async()=>{if(e)return await t.deployment({id:e})},enabled:null!=e,retry:1})}let p=(e,t)=>{let{graphqlClient:n}=(0,o.q)();return(0,i.W)(["singleDeployment",e],async()=>e?(await n.singleDeployment({id:e})).deployment:null,{enabled:null!=t?t:!!e})}},6075:(e,t,n)=>{n.d(t,{z:()=>i});var l=n(50979),r=n(25963),s=n(70375),a=n(47654),o=n(37590);function i(e){var t;let{events:n,deploymentId:o}=e,[i,c]=(0,r.useState)(null);(0,r.useLayoutEffect)(()=>{i&&(i.scrollTop=i.scrollHeight)},[i]);let{routes:u}=(0,s.c)(),m=n.filter(e=>"vertex"===e.type);if(0===m.length)return null;let p=n.filter(e=>"log"===e.type),y=m[0];return(0,l.jsx)(a.N,{className:"block mt-2 overflow-y-auto bg-blend-multiply bg-red-200 font-mono sm:rounded-lg border-red-300 border hover:opacity-90 active:bg-red-300",tabIndex:-1,...u.projectServiceDeployments({deploymentId:o,hash:"build",context:y.timestamp}),children:(0,l.jsxs)("div",{className:"min-w-0 max-w-full px-3 py-2 text-xs",children:[(0,l.jsx)("div",{className:"flex min-w-0 text-nowrap dark:text-red-600 text-red-500",children:(0,l.jsx)("span",{className:"truncate",children:y.message})}),(0,l.jsxs)("pre",{className:"w-full overflow-x-auto rounded-lg px-0.5 leading-normal text-red-700 max-h-[204px]",tabIndex:-1,ref:c,children:[p.length>=20&&(0,l.jsx)("div",{children:"... truncated to 20 logs, click to view more ..."}),p.map((e,t)=>(0,l.jsx)("div",{children:e.message},t)),(0,l.jsx)("b",{children:d.reduce((e,t)=>{let[n,l]=t;return e.replace(n,l)},null!=(t=y.error)?t:"")})]})]})})}let d=[['process "/bin/bash -ol pipefail -c ','"']];i.Skeleton=()=>(0,l.jsx)(o.g,{width:"100%",height:64,className:"mt-2 bg-blend-multiply opacity-50"})},10605:(e,t,n)=>{n.d(t,{I:()=>p});var l=n(50979);n(25963);var r=n(95925),s=n(88887),a=n(45479),o=n(77505),i=n(18571),d=n(55850),c=n(72898),u=n(37915);function m(e){return["deployment",e]}let p=e=>{let{projectId:t,environmentId:n,serviceId:p,snapshotId:y}=e,{graphqlClient:x}=(0,d.q)(),g=(0,r.jE)(),v=()=>g.invalidateQueries({queryKey:(0,u.mi)(null!=n?n:"")}),{projectDeploymentsQueryKey:h,setProjectDeployment:f}=(0,i.z4)({projectId:t,environmentId:n,serviceId:p,disabled:!0}),b=e=>{f(e,e=>({...e,status:a.Uty.Removed,url:null})),g.setQueryData(m(e),e=>({...e,status:a.Uty.Removed}))},{modalActions:j}=(0,o.U)(),w=(0,c.F)(h,async e=>{await x.deploymentRollback({id:e}),g.invalidateQueries({queryKey:m(e)}),v()},e=>{j.createToast((0,l.jsx)(s.y8,{title:"Error ".concat("Rolling back deployment",": ").concat(e.message),variant:"error"}))}),N=(0,c.F)(h,async e=>{await x.deploymentApprove({id:e}),g.invalidateQueries({queryKey:m(e)}),v()}),D=(0,c.F)(h,async e=>{b(e),await x.deploymentRemove({id:e}),g.invalidateQueries({queryKey:m(e)}),v()}),k=(0,c.F)(h,async e=>{b(e),await x.deploymentCancel({id:e}),g.invalidateQueries({queryKey:m(e)}),v()}),I=(0,c.n)(h,async e=>(await x.deploymentSnapshotCodeUri({deploymentId:e})).deploymentSnapshotCodeUri),S=(0,c.n)(h,async e=>{await x.deploymentRestart({id:e}),v()}),z=(0,c.n)(h,async e=>{let t=(await x.deploymentRedeploy({id:e})).deploymentRedeploy;return v(),t.id}),A=(0,c.n)(h,async e=>{null!=p&&null!=n&&(await x.serviceInstanceDeploy({serviceId:p,environmentId:n,commitSha:e}),v())}),U=(0,c.n)(h,async()=>{null!=p&&null!=n&&(await x.serviceInstanceDeploy({serviceId:p,environmentId:n,latestCommit:!0}),v())});return{approveDeployment:N,removeDeployment:D,cancelDeployment:k,rollbackDeployment:w,getDeploymentSnapshotCodeUrl:I,restartDeployment:S,redeployDeployment:z,deployCommit:A,deployFromSource:U,downloadDeploymentLogs:async e=>{let t=(await x.deploymentLogs({deploymentId:e,limit:5e3})).deploymentLogs.map(e=>"".concat(e.timestamp," [").concat(e.severity,"] ").concat(e.message)).join("\n");return(t=t.replace(/^\s*\n/,"")).replace(/\u001b[^m]*?m/g,"").replace(/"([^"]+)":/g,"$1:")},downloadBuildLogs:async e=>{let t=(await x.buildLogs({deploymentId:e,filter:y&&"@snapshot:".concat(y),limit:5e3})).buildLogs.map(e=>"".concat(e.timestamp," [").concat(e.severity,"] ").concat(e.message)).join("\n");return(t=t.replace(/^\s*\n/,"")).replace(/\u001b[^m]*?m/g,"").replace(/"([^"]+)":/g,"$1:")}}}},13934:(e,t,n)=>{n.d(t,{n4:()=>i});var l=n(50979),r=n(81154);n(25963);var s=n(47188),a=n(42419);let o=e=>{let{accessLevel:t,message:n,children:o}=e;if(!(0,r.md)(s.DM)[t])if(null!=n)return(0,l.jsx)(a.EY,{className:"py-4",children:n});else return null;return(0,l.jsx)(l.Fragment,{children:o})},i=e=>(0,l.jsx)(o,{...e,accessLevel:s.hx.Write})},25579:(e,t,n)=>{n.d(t,{c:()=>o,d:()=>s});var l=n(25963),r=n(76043),s=function(e){return e[e.Safari=0]="Safari",e[e.MobileSafari=1]="MobileSafari",e[e.Firefox=2]="Firefox",e[e.Chromium=3]="Chromium",e}({});let a={1:e=>{let t=!!e.match(/iPad/i)||!!e.match(/iPhone/i),n=!!e.match(/WebKit/i);return t&&n&&!e.match(/CriOS/i)},0:e=>/^((?!chrome|android).)*safari/i.test(e),2:e=>e.toLowerCase().indexOf("firefox")>-1,3:e=>e.toLowerCase().indexOf("chrome")>-1},o=e=>{let t=(0,r.a)(),n=(0,l.useMemo)(()=>{var e;return null!=navigator&&null!=(e=navigator.userAgent)?e:""},[]),s=(0,l.useMemo)(()=>a[e](n),[n]);return t&&s}},25646:(e,t,n)=>{n.d(t,{j:()=>s});var l=n(50979),r=n(28443);let s=e=>{let{triggerContent:t,cardContent:n}=e;return(0,l.jsxs)(r.bL,{children:[(0,l.jsx)(r.l9,{children:t}),(0,l.jsx)(r.ZL,{children:(0,l.jsxs)(r.UC,{className:"z-40 relative shadow-lg bg-secondaryBg p-4 rounded-lg text-foreground font-sans",children:[n,(0,l.jsx)(r.i3,{})]})})]})}},37245:(e,t,n)=>{n.d(t,{En:()=>l.E,E0:()=>p,bY:()=>k,UC:()=>A,$:()=>C,PE:()=>N.P,nW:()=>T});var l=n(82410),r=n(50979),s=n(2551),a=n(42419),o=n(62190),i=n(45479),d=n(46040),c=n(70375),u=n(36609),m=n(31754);function p(e){let{deployment:t,currentEvent:n,isDisabled:p=!1}=e,{routes:y}=(0,c.c)(),{actions:x,isLoading:g}=(0,d.f)(t),v=o.Ag.includes(t.status),h=t.status===i.Uty.Crashed||t.status===i.Uty.Failed;if(o.vZ.includes(t.status))return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(m.$n,{color:"gray",isLoading:g,disabled:p||g,icon:s.X,size:"sm",onClick:e=>{e.preventDefault(),x.rejectDeployment()},variant:"outline",children:"Skip"}),(0,r.jsx)(m.$n,{color:"green",isLoading:g,disabled:p||g,icon:s.Jlk,size:"sm",onClick:e=>{e.preventDefault(),x.approveDeployment()},variant:"outline",children:"Deploy"}),(0,r.jsx)(a.EY,{className:"mr-3",children:"View Details"})]});if(!v&&h&&x.restartDeployment)return(0,r.jsx)(m.$n,{color:"red",isLoading:g,disabled:p||g,size:"sm",onClick:e=>{var t;e.preventDefault(),null==(t=x.restartDeployment)||t.call(x)},variant:"outline",children:"Restart"});let f=(0,l.x)(t,n),b=t.serviceId?y.projectServiceDeployments({deploymentId:t.id,hash:f}):y.projectDeploy({deploymentId:t.id,hash:f}),j=(0,u.xW)(["hidden sm:block whitespace-nowrap"]),w=t.status===i.Uty.Success?"green":t.status===i.Uty.Sleeping?"yellow":o.sp.includes(t.status)?"blue":o.vZ.includes(t.status)?"yellow":t.status===i.Uty.Crashed||t.status===i.Uty.Failed?"red":"gray";return(0,r.jsx)(m.vx,{...b,className:j,color:w,variant:"outline",size:"sm",children:"View logs"})}var y=n(2092),x=n(25963),g=n(13077),v=n(80374),h=n(89118),f=n(72783),b=n(98078),j=n(758),w=n(6075),N=n(60299);let D={[i.Uty.Building]:"bg-blue-50",[i.Uty.Crashed]:"bg-red-50",[i.Uty.Deploying]:"bg-blue-50",[i.Uty.Failed]:"bg-red-50",[i.Uty.Success]:"bg-green-50",[i.Uty.Initializing]:"bg-blue-50",[i.Uty.Sleeping]:"bg-yellow-50"};function k(e){var t;let{currentEvent:n,deployment:l,isComplete:a=!1,error:o,events:i,map:d,startedAt:c,hasDeploymentFailed:m,isSleeping:p}=e,[b,j]=(0,x.useState)(m?"checklist":""),w=""!==b,k=(0,x.useRef)(m&&(null==(t=l.meta)?void 0:t.reason)!=="migrate"),S=(0,u.xW)(["flex","group","items-center","justify-between","gap-x-4","rounded-md","pl-24","pr-3","py-2","w-full",D[l.status],N.M[l.status]]);(0,x.useEffect)(()=>{k.current!==m&&m&&j("checklist")});let z=Object.keys(d);return(0,r.jsx)(y.bL,{className:"mb-1 mx-1 rounded-md",collapsible:!0,onValueChange:j,onClick:e=>{e.preventDefault()},type:"single",value:b,children:(0,r.jsxs)(y.q7,{value:"checklist",children:[(0,r.jsxs)(y.l9,{className:S,children:[m?(0,r.jsx)(f.B.Error,{event:o,startedAt:c}):(0,r.jsxs)(r.Fragment,{children:[!a&&!o&&!p&&(0,r.jsx)(f.B.InProgress,{currentEvent:n,events:i,isExpanded:w}),a&&!o&&!p&&(0,r.jsx)(f.B.Complete,{}),p&&!o&&(0,r.jsx)(f.B.Sleeping,{})]}),(0,r.jsx)(g.In,{className:"group-rdx-state-open:rotate-180 group-rdx-state-closed:rotate-0 text-foreground transition-transform",color:"currentColor",icon:s.yQN,size:"sm"})]}),(0,r.jsx)(y.UC,{className:"bg-background overflow-hidden rounded-md mt-1 rdx-state-open:animate-accordion-slide-down rdx-state-closed:animate-accordion-slide-up",children:z.map(e=>{var t,n;return(0,r.jsx)(h.e,{isExpanded:w,hasInset:!0,item:d[e],title:(0,v.VR)(e).replaceAll("_","-"),hasDeploymentFailed:m,deploymentId:l.id,children:"BUILD"===e&&m&&!(null==(n=l.meta)||null==(t=n.configErrors)?void 0:t.length)&&(0,r.jsx)(I,{deploymentId:l.id})},e)})})]})})}function I(e){var t;let{deploymentId:n}=e,l=(0,x.useRef)(250),s=(0,j.vP)(n),[a,o]=(0,x.useState)(!1),i=null==(t=s.data)?void 0:t.deployment,d=(0,b.p)({environmentId:String(null==i?void 0:i.environmentId),snapshotId:String(null==i?void 0:i.snapshotId),afterDate:null==i?void 0:i.createdAt,enabled:!!i,refetchInterval(e){var t;return(null==(t=e.state.data)?void 0:t.length)||l.current>=4e3?(o(!1),!1):(l.current*=2,o(!0),l.current)}});return d.isLoading||a?(0,r.jsx)(w.z.Skeleton,{}):d.data?(0,r.jsx)(r.Fragment,{children:d.data.map((e,t)=>(0,r.jsx)(w.z,{events:e,deploymentId:n},t))}):null}n(98498);var S=n(21507);n(97589);var z=n(36893);function A(e){var t;let{deployment:n}=e,{meta:l}=n,s=n.status===i.Uty.Sleeping,a=(0,S.c5)(n.meta);return(0,r.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,r.jsxs)("p",{className:"text-sm text-left text-foreground truncate max-w-72",children:["GitHub"===a&&(null==l?void 0:l.commitMessage),"Docker"===a&&(null==l?void 0:l.image)&&(0,S.o6)(l.image),"CLI"===a&&(0,r.jsx)("span",{className:"font-mono",children:"railway up"})]}),(0,r.jsxs)("p",{className:"text-gray-500 text-sm",children:[(0,r.jsx)(z.s,{children:s?null!=(t=n.statusUpdatedAt)?t:n.updatedAt:n.createdAt})," ","via"," ",(0,r.jsxs)("span",{className:"text-gray-500",children:["GitHub"===a&&"GitHub","Docker"===a&&"Docker","CLI"===a&&"CLI"]})]})]})}var U=n(35645);function C(e){let{deployment:t}=e,{creator:n,meta:l}=t,a=(0,S.c5)(t.meta),o="GitHub"===a?null==l?void 0:l.commitAuthor:void 0,i=o||(null==n?void 0:n.name),d=o?"https://github.com/".concat(o,".png"):null==n?void 0:n.avatar;return(0,r.jsxs)("div",{className:"relative h-9 w-9",children:[(0,r.jsx)(U.e,{avatar:d,name:i,className:"absolute left-0 top-0",size:"xs"}),"GitHub"===a&&(0,r.jsx)(g.In,{className:"border border-secondaryBg bg-white dark:bg-black rounded-full absolute bottom-0 right-0",icon:s.gqo,size:"lg"}),"Docker"===a&&(0,r.jsx)(g.In,{className:"border border-secondaryBg text-white bg-blue-600 p-1 rounded-full absolute bottom-0 right-0",icon:s.Jgz,size:"lg"}),"CLI"===a&&(0,r.jsx)(g.In,{className:"border border-secondaryBg bg-gray-600 text-white p-1 rounded-full absolute bottom-0 right-0",icon:s.BKt,size:"lg"})]})}var E=n(53036),L=n(55850);let R=["bg-gray-200","font-medium","flex","items-center","justify-center","py-1","px-2","rounded-md","text-gray-500","text-xs","uppercase"];function T(e){var t;let{deployment:n}=e,l=(0,S.Iw)(n),s=o.sp.includes(n.status)||(null==(t=n.meta)?void 0:t.cronSchedule)&&"ready"===n.status,a=o.vZ.includes(n.status),d=n.status===i.Uty.Crashed,c=d||n.status===i.Uty.Failed,m=n.status===i.Uty.Success,p=n.status===i.Uty.Sleeping,y=n.status===i.Uty.Queued,x=(0,u.xW)([R,s&&"text-blue-500 bg-blue-100 dark:text-blue-700 dark:bg-blue-200",a&&"text-yellow-500 bg-yellow-100 dark:text-yellow-700 dark:bg-yellow-200",c&&"text-red-500 bg-red-100 dark:text-red-700 dark:bg-red-200",m&&"text-green-500 bg-green-100 dark:text-green-700 dark:bg-green-200",p&&"text-yellow-500 bg-yellow-100 dark:text-yellow-700 dark:bg-yellow-200",y&&"text-gray-500 bg-gray-100 dark:text-gray-700 dark:bg-gray-200"]);return(0,r.jsxs)("div",{className:x,"data-testid":"deployment-status",children:[l,d&&(0,r.jsx)(F,{deploymentId:n.id})]})}function F(e){var t;let{deploymentId:n}=e,{graphqlClient:l}=(0,L.q)(),s=(0,E.I)({queryKey:["deployment","instances",n],queryFn:async()=>l.deploymentInstances({deploymentId:n}).then(e=>e.deployment.instances),refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1});if(!s.data||1===s.data.length)return null;let a=null==(t=s.data)?void 0:t.filter(e=>e.status===i.FZy.Crashed||e.status===i.FZy.Removed).length;return(0,r.jsxs)("div",{className:"ml-1 bg-red-50 px-1 py-px rounded-full text-xs font-medium",children:[a,"/",s.data.length]})}},38987:(e,t,n)=>{n.d(t,{$G:()=>d});var l=n(17851);let r=l.z.object({type:l.z.literal("status"),id:l.z.string(),vertex:l.z.string(),message:l.z.string().optional(),current:l.z.number().optional(),timestamp:l.z.string(),started:l.z.string().transform(e=>new Date(e)).optional(),completed:l.z.string().optional()}),s=l.z.object({type:l.z.literal("log"),vertex:l.z.string(),message:l.z.string(),stream:l.z.number(),timestamp:l.z.string()}),a=l.z.object({type:l.z.literal("vertex"),digest:l.z.string(),message:l.z.string(),current:l.z.number().optional(),started:l.z.string().transform(e=>new Date(e)).optional(),completed:l.z.string().transform(e=>new Date(e)).optional(),error:l.z.string().optional(),cached:l.z.boolean().optional(),timestamp:l.z.string()}),o=l.z.discriminatedUnion("type",[s,a,r]),i=l.z.object({message:l.z.string(),severity:l.z.string().nullish(),tags:l.z.record(l.z.unknown()).nullish(),timestamp:l.z.string(),attributes:l.z.array(l.z.object({key:l.z.string(),value:l.z.string()}))}),d=l.z.array(i.transform(e=>{let t=(e=>{let t={};for(let n of e)try{t[n.key]=JSON.parse(n.value)}catch(e){t[n.key]=n.value}return t})(e.attributes),n=o.safeParse({...e,...t});return n.success?{...e,...n.data}:null})).transform(e=>{let t=[];for(let n of e)n&&t.push(n);return t})},46040:(e,t,n)=>{n.d(t,{f:()=>m});var l=n(50979),r=n(25963),s=n(88887),a=n(45479),o=n(2551),i=n(77505),d=n(93208),c=n(10605),u=n(70375);let m=e=>{var t,n,m;let[p,y]=(0,r.useState)(!1),{routes:x,navActions:g}=(0,u.c)(),{isConfirmed:v}=(0,d.S)(),{modalActions:h}=(0,i.U)(),f=(0,c.I)({projectId:e.projectId,environmentId:null!=(t=e.environmentId)?t:void 0,serviceId:null!=(n=e.serviceId)?n:void 0,snapshotId:null!=(m=e.snapshotId)?m:void 0}),b=(e,t,n)=>async()=>{if(!e||await v(e)){try{y(!0);let e=await t();null!=n&&n(e)}catch(e){h.createToast((0,l.jsx)(s.y8,{title:e.message,variant:"error"}))}y(!1)}},j=async()=>{let t=await f.getDeploymentSnapshotCodeUrl(e.id);null!=t&&window.location.assign(t)},w=e.status,N=(0,r.useMemo)(()=>e.canRollback&&"REMOVED"===w?b({confirmLabel:"Rollback",message:"Are you sure you want to revert to this deployment? This will restore both the build and variables.",title:"Rollback Deployment"},()=>f.rollbackDeployment(e.id),()=>h.createToast((0,l.jsx)(s.y8,{icon:o.rAV,variant:"success",title:"Rollback successful",description:"Your deployment was rolled back!"}))):null,[e.canRollback,w,e.id]),D=(0,r.useMemo)(()=>b(null,()=>f.approveDeployment(e.id),()=>h.createToast((0,l.jsx)(s.y8,{icon:o.rAV,variant:"success",title:"Deployment approved",description:"Your deployment was approved!"}))),[w,e.id]),k=(0,r.useMemo)(()=>b(null,()=>f.removeDeployment(e.id),()=>h.createToast((0,l.jsx)(s.y8,{icon:o.rAV,variant:"success",title:"Deployment rejected",description:"Your deployment was rejected!"}))),[w,e.id]),I=(0,r.useMemo)(()=>{let t=["SUCCESS","INITIALIZING","QUEUED"].includes(w);return"SUCCESS"===w||"FAILED"===w||"SKIPPED"===w||"INITIALIZING"===w||"QUEUED"===w||"CRASHED"===w||"SLEEPING"===w||"WAITING"===w?b({confirmLabel:"Remove",message:"Are you sure you want to remove this deployment? ".concat(t?"After removing, it will immediately go offline.":""),title:"Remove Deployment"},()=>f.removeDeployment(e.id),()=>h.createToast((0,l.jsx)(s.y8,{icon:o.rAV,variant:"success",title:"Deployment removed",description:"Your deployment was removed!"}))):null},[w,e.id]),S=(0,r.useMemo)(()=>"BUILDING"!==w&&"DEPLOYING"!==w?null:b({confirmLabel:"Abort",message:"Are you sure you want to abort this deployment? Aborting this deployment is permanent and cannot be undone.",title:"Abort deployment"},()=>f.cancelDeployment(e.id),()=>h.createToast((0,l.jsx)(s.y8,{icon:o.rAV,variant:"success",title:"Cancelled",description:"Your deployment was cancelled!"}))),[w,e.id]),z=e.status===a.Uty.Success,A=(0,r.useMemo)(()=>{var t;return"SUCCESS"!==w&&"CRASHED"!==w||(null==(t=e.meta)?void 0:t.cronSchedule)!=null?null:b({cancelLabel:"Cancel",confirmLabel:"Restart",message:"Are you sure you want to restart this deployment? This will restart your ".concat(z?"container":"crashed container","."),title:"Restart deployment"},()=>f.restartDeployment(e.id),()=>h.createToast((0,l.jsx)(s.y8,{icon:o.rAV,variant:"success",title:"Restart successful",description:"Your deployment was restarted successfully!"})))},[w,e.id]),U=(0,r.useMemo)(()=>{var t;let n=(null!=(t=e.meta)?t:{}).commitHash;return null==n||e.status!==a.Uty.Skipped?null:b({cancelLabel:"Cancel",confirmLabel:"Deploy",message:"Are you sure you want to deploy this commit? This will deploy the code even though a GitHub status check failed.",theme:"info",title:"Deploy commit"},async()=>{await f.deployCommit(n)},()=>h.createToast((0,l.jsx)(s.y8,{icon:o.rAV,variant:"success",title:"Deploy started",description:"The build for your new deployment has started"})))},[e.id,w]),C=(0,r.useMemo)(()=>e.canRedeploy?b({cancelLabel:"Cancel",confirmLabel:"Redeploy",message:"Are you sure you want to redeploy this deployment? This will rebuild and deploy your code with the exact same configuration.",theme:"info",title:"Redeploy deployment"},async()=>await f.redeployDeployment(e.id),t=>{var n;h.createToast((0,l.jsx)(s.y8,{icon:o.rAV,variant:"success",title:"Redeploy started",description:"The build for your new deployment has started",actionTitle:"View deployment",...x.projectServiceDeployments({projectId:e.projectId,serviceId:null!=(n=e.serviceId)?n:void 0,environmentId:e.environmentId,deploymentId:t})}))}):null,[e.id,e.canRedeploy,w]);return{actions:{openDeployment:t=>{g.push(null!=e.serviceId?x.projectServiceDeployments({deploymentId:e.id,hash:t}):x.projectDeploy({deploymentId:e.id,hash:t}),{scroll:!1})},rollbackDeployment:N,removeDeployment:I,cancelDeployment:S,approveDeployment:D,rejectDeployment:k,restartDeployment:A,downloadSnapshot:j,redeployDeployment:C,deployCommit:U,downloadDeploymentLogs:(0,r.useMemo)(()=>{var t;return"SUCCESS"!==w&&"CRASHED"!==w||(null==(t=e.meta)?void 0:t.cronSchedule)!=null?null:b({cancelLabel:"Cancel",confirmLabel:"Download",message:"Download the deployment logs",title:"Download deployment logs"},async()=>{let t=await f.downloadDeploymentLogs(e.id);if(t){var n;let e=new Blob([t],{type:"text/plain"}),l=window.URL.createObjectURL(e),r=document.createElement("a");r.href=l;let s=Date.now(),a=document.querySelector("meta[property='og:title']"),o=null!=a?null==(n=a.getAttribute("content"))?void 0:n.toLowerCase():"";r.download="deployment_logs_".concat(o,"_").concat(s,".log"),document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(l)}},()=>h.createToast((0,l.jsx)(s.y8,{icon:o.rAV,variant:"success",title:"Deployment logs downloaded!",description:"Deployment logs downloaded!"})))},[w,e.id]),downloadBuildLogs:(0,r.useMemo)(()=>b({cancelLabel:"Cancel",confirmLabel:"Download",message:"Download the build logs",title:"Download build logs"},async()=>{let t=await f.downloadBuildLogs(e.id);if(t){var n;let e=new Blob([t],{type:"text/plain"}),l=window.URL.createObjectURL(e),r=document.createElement("a");r.href=l;let s=Date.now(),a=document.querySelector("meta[property='og:title']"),o=null!=a?null==(n=a.getAttribute("content"))?void 0:n.toLowerCase():"";r.download="build_logs_".concat(o,"_").concat(s,".log"),document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(l)}},()=>h.createToast((0,l.jsx)(s.y8,{icon:o.rAV,variant:"success",title:"Build logs downloaded!",description:"Build logs downloaded!"}))),[w,e.id])},isLoading:p}}},60299:(e,t,n)=>{n.d(t,{M:()=>o,P:()=>d});var l=n(50979),r=n(25963),s=n(45479),a=n(36609);let o={[s.Uty.Building]:"focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500",[s.Uty.Crashed]:"focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-red-500",[s.Uty.Deploying]:"focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500",[s.Uty.Failed]:"focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-red-500",[s.Uty.Success]:"focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-green-500",[s.Uty.Initializing]:"focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500",[s.Uty.Sleeping]:"focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-yellow-500",[s.Uty.NeedsApproval]:"focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-yellow-500"},i={[s.Uty.Building]:"bg-blue-50",[s.Uty.Crashed]:"bg-red-50",[s.Uty.Deploying]:"bg-blue-50",[s.Uty.Failed]:"bg-red-50",[s.Uty.Success]:"bg-green-50",[s.Uty.Initializing]:"bg-blue-50",[s.Uty.Sleeping]:"bg-yellow-50",[s.Uty.NeedsApproval]:"bg-yellow-50"},d=(0,r.forwardRef)((e,t)=>{var n;let{children:r,deployment:s}=e,o=(null==(n=s.meta)?void 0:n.cronSchedule)&&"ready"===s.status,d=(0,a.xW)(["flex","items-center","justify-between","rounded-md","h-full","px-3","py-4","w-full","bg-gray-100","select-none",o?i.BUILDING:i[s.status]]);return(0,l.jsx)("div",{className:d,ref:t,children:r})})},72783:(e,t,n)=>{n.d(t,{B:()=>c});var l=n(50979),r=n(62190),s=n(2551),a=n(36609),o=n(13077),i=n(52846);function d(e){let{event:t,startedAt:n}=e,{completedAt:a}=t,d=r.t5[t.step];return(0,l.jsxs)("div",{className:"flex items-center justify-between text-sm text-red-500 w-full",children:[(0,l.jsxs)("div",{className:"flex items-center gap-x-8",children:[(0,l.jsx)(o.In,{className:"text-red-500",icon:s.c2w,size:"sm"}),(0,l.jsxs)("p",{children:["Deployment failed during ",(0,r.JI)(d)," process"]})]}),n&&a&&(0,l.jsxs)("p",{className:"text-red-300",children:["(",(0,l.jsx)(i.d,{timeStyle:"clock",startedAt:n,finishedAt:a}),")"]})]})}let c={Complete:function(){return(0,l.jsxs)("div",{className:"flex items-center gap-x-6 text-sm text-green-500",children:[(0,l.jsx)(o.In,{icon:s.rAV,color:"currentColor",size:"sm"}),(0,l.jsx)("p",{children:"Deployment successful"})]})},Sleeping:function(){return(0,l.jsxs)("div",{className:"flex items-center gap-x-6 text-sm text-yellow-500",children:[(0,l.jsx)(o.In,{icon:s.IPp,color:"currentColor",size:"sm"}),(0,l.jsx)("p",{children:"Deployment sleeping"})]})},Error:function(e){return null==e.event?(0,l.jsx)("div",{className:"flex items-center justify-between text-sm text-red-500 w-full",children:(0,l.jsxs)("div",{className:"flex items-center gap-x-8",children:[(0,l.jsx)(o.In,{className:"text-red-500",icon:s.c2w,size:"sm"}),(0,l.jsx)("p",{children:"Deployment failed"})]})}):(0,l.jsx)(d,{event:e.event,startedAt:e.startedAt})},InProgress:function(e){let{currentEvent:t,events:n,isExpanded:s=!1}=e,o=t?n.indexOf(t.step):0,i=(0,a.xW)(["flex flex-col items-start","h-5","transition-all duration-300",s&&"opacity-0",!s&&"opacity-100"]);return(0,l.jsxs)("div",{className:"flex items-center gap-x-2 overflow-hidden text-sm",children:[(0,l.jsx)("p",{className:"text-gray-500",children:"Deployment in progress: "}),(0,l.jsx)("div",{className:i,style:{transform:"translateY(".concat("-".concat(20*o,"px"),")")},children:n.map(e=>(0,l.jsx)("div",{className:"h-5",children:(0,l.jsx)("p",{className:"text-gray-500",children:r.nM[e]})},e))})]})}}},78781:(e,t,n)=>{n.d(t,{P2:()=>S,Xd:()=>k,lD:()=>I,rU:()=>N,w5:()=>D});var l=n(86739),r=n(50979),s=n(12725),a=n(13025),o=n(25963),i=n(61649),d=n(1142),c=n(25579),u=n(70375),m=n(2551),p=n(36609),y=n(18946),x=n(31754),g=n(13077),v=n(95662),h=n(42419),f=n(79931),b=n(79823),j=n(67970);function w(){let e=(0,l._)(["\n  grid grid-cols-[minmax(0px,_1fr)] md:grid-cols-[auto]\n  w-full min-h-full bg-background dark:bg-secondaryBg\n  sm:overflow-auto sm:h-full\n"]);return w=function(){return e},e}let N=o.forwardRef((e,t)=>{let{children:n,...l}=e;return(0,r.jsx)("div",{ref:t,...l,className:(0,p.xW)(l.className,"metro-pane-wrapper","grid justify-items-end inset-0 relative row-start-2 sm:row-start-1 overflow-hidden","px-0 min-w-full w-auto min-h-full","sm:h-full","md:mx-5 md:min-w-[initial]","lg:mx-0 col-start-2"),children:n})}),D=o.forwardRef((e,t)=>{let{isBehind:n,animateFromTop:l,focusFromBehind:s,isInFront:i,onMouseEnter:u,onMouseLeave:m,disableTransition:x,children:g,...v}=e,h=(0,d.z)("md"),f=!(0,d.z)("xl"),b=(0,c.c)(c.d.Safari);return(0,o.useEffect)(()=>{b&&!n&&setTimeout(async()=>{let e=document.querySelector(".metro-pane");null!=e&&(e.style.display="block",await new Promise(e=>setTimeout(e,10)),e.style.display="grid")},10)},[b,n]),(0,r.jsx)(a.P.div,{ref:t,onMouseEnter:u,onMouseLeave:m,className:(0,p.xW)("metro-pane","top-0 bottom-0 right-0 z-[30]","md:mt-6 md:border md:rounded-t-xl overflow-hidden","lg:border-r-0 lg:border-l lg:border-t lg:rounded-none lg:rounded-tl-xl",n&&"md:border lg:border lg:rounded-t-xl lg:block",(s||i)&&"z-[31]","w-full xl:w-[calc(100%-24px)]"),...v,...h&&n?{"aria-hidden":"true"}:{},transition:x?{duration:0}:{type:"spring",damping:40,stiffness:440},initial:!h&&"enter",animate:"visible",exit:"leave",variants:{enter:{x:l&&!h?y.VF:"20%",y:l&&!h?-y.VF:0,opacity:0,position:"absolute",pointerEvents:"auto",userSelect:"none"},visible:{x:n&&f?-y.VF:0,y:s?0:n&&f?y.VF:0,position:n?"absolute":"static",pointerEvents:"auto",opacity:1,userSelect:"initial"},leave:{x:l&&!h?y.VF:"20%",y:l&&!h?-y.VF:0,position:"absolute",opacity:0,pointerEvents:"none",userSelect:"none"}},children:g})}),k=p.qy.div(w()),I=e=>{let{title:t,icon:n,banner:l,action:a,tabs:o,onIconEdit:d,iconUrl:c,onTitleEdit:y,validateTitle:j,children:w,className:N,headerClassName:D,contentClassName:I,link:S,closeLink:z,resource:A}=e,{routes:U,pathname:C,isTemplateCreatePage:E}=(0,u.c)(),{openCommandPalette:L}=(0,i.oG)();return(0,r.jsxs)(k,{className:(0,p.xW)(N,null!=l?"grid-rows-[auto_auto_minmax(0px,_1fr)]":"grid-rows-[auto_minmax(0px,_1fr)]"),children:[null!=l&&l,(0,r.jsxs)(v.T,{className:(0,p.xW)("pt-8 md:px-12 md:pt-12 z-50 border-b !border-gray-100 md:!border-gray-200",D),children:[(0,r.jsxs)(v.z,{align:"center",justify:"between",space:4,className:"mb-6 px-5 md:px-0 w-full",children:[(0,r.jsxs)(v.z,{align:"center",space:4,children:[null!=n&&(0,r.jsx)(r.Fragment,{children:null!=d?(0,r.jsx)("button",{onClick:()=>void L({id:"edit-icon",type:"input",crumbs:["volume"===A?"Edit volume icon":"Edit service icon"],prompt:"https://icon.png",initialValue:null!=c?c:"",component:b.u,action:e=>{let t=(0,b.s)(null!=e?e:"");null!=t&&d&&d((0,s.validateUrl)(t)?t:null)}}),className:"flex items-center outline-none rounded-md focus-visible:ring-2 focus-visible:ring-gray-300",children:(0,r.jsx)(g.In,{icon:n,size:"xl",className:"rounded-full text-foreground"})}):(0,r.jsx)(g.In,{icon:n,size:"xl",className:"rounded-full text-foreground"})}),null!=y?(0,r.jsx)(h._B,{as:"h1",className:"flex items-center flex-grow",children:(0,r.jsxs)("button",{"data-testid":"edit-title",onClick:()=>void L({id:"edit-title",type:"input",crumbs:["volume"===A?"Edit volume title":"Edit service title"],prompt:"Enter a new name",initialValue:t,action:e=>{e&&y&&y(e)},validate:j}),className:"focus:outline-none flex items-center rounded-md outline-none hover:bg-gray-200 focus-visible:ring-2 focus-visible:ring-gray-300 group",children:[t,(0,r.jsx)(g.In,{icon:m.ffu,className:"ml-5 text-gray-500 p-1 !hidden group-hover:!flex",size:"26"})]})}):(0,r.jsxs)(v.z,{align:"center",space:2,children:[(0,r.jsx)(h._B,{as:"h1",className:"flex items-center flex-grow",children:t}),S&&(0,r.jsx)(x.sh,{external:!0,icon:m.GrD,iconStyles:"text-gray-500",size:"xs",...S})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[a&&a,(0,r.jsx)(x.sh,{...z||(E?U.templateCreate({}):U.project({})),"data-testid":"close-metro-pane",icon:m.X})]})]}),null!=o&&o.length>0&&(0,r.jsx)(f.o,{tabs:o,className:"px-5 md:px-0 mb-[-2px]"})]}),(0,r.jsx)("div",{className:"metro-pane-content sm:overflow-auto",children:(0,r.jsx)("div",{className:(0,p.xW)("h-full px-5 pt-8 md:px-12",I),children:w})},C)]})},S=()=>(0,r.jsx)(k,{className:"h-full w-full",children:(0,r.jsx)(j.m6,{})})},79931:(e,t,n)=>{n.d(t,{o:()=>p});var l=n(86739),r=n(50979),s=n(29654),a=n(13025);n(25963);var o=n(2551),i=n(36609),d=n(13077),c=n(47654),u=n(95662);function m(){let e=(0,l._)(["\n  hidden md:block\n  absolute bottom-0 w-full h-px bg-foreground\n"]);return m=function(){return e},e}let p=e=>{let{tabs:t,...n}=e,l="header-tabs-".concat(t.length),a="header-indicator-".concat(t.length);return(0,r.jsx)(y,{...n,children:(0,r.jsx)(s.o,{id:l,children:t.map(e=>(0,r.jsxs)(x,{className:"tab-item tab-item-".concat(e.text.replace(/\s+/,"-")),...e.link,active:e.active,name:"".concat(e.text," Tab"),children:[(0,r.jsxs)(u.z,{align:"center",className:"whitespace-nowrap",children:[e.text,void 0!==e.count&&(0,r.jsx)("span",{className:"ml-2 px-2 py-0.5 text-xs bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-full",children:e.count}),e.badge&&(0,r.jsx)(d.In,{icon:o.R2D,size:"sm",className:"ml-1 text-pink-600"})]}),e.active&&(0,r.jsx)(g,{layoutId:a,initial:!1,transition:{type:"spring",stiffness:500,damping:30}})]},e.text))})})},y=e=>{let{children:t,...n}=e;return(0,r.jsx)(u.z,{align:"center",...n,className:(0,i.xW)("header-tabs","space-x-3 md:space-x-8 md:min-h-[39px] pb-3 w-full md:pb-0 overflow-x-auto overflow-y-hidden border-b border-gray-100 md:border-transparent",n.className),children:t})},x=(0,i.DR)(c.N)(e=>{let{active:t}=e;return["relative","inline-block h-10 px-3 py-2 rounded-md",t?"text-foreground bg-gray-100":"text-gray-600 bg-secondaryBg","md:h-auto md:bg-transparent md:p-0 md:pb-3 md:hover:text-foreground md:focus:outline-none md:focus:ring-0 md:focus:text-foreground",t?"md:text-foreground":"text-gray-500"]}),g=(0,i.DR)(a.P.div)(m())},82410:(e,t,n)=>{n.d(t,{E:()=>m,x:()=>p});var l=n(50979),r=n(62190),s=n(46040),a=n(2551),o=n(17057),i=n(13934),d=n(45479),c=n(36609),u=n(60299);function m(e){let{deployment:t,currentEvent:n}=e,{actions:d}=(0,s.f)(t);return r.vZ.includes(t.status)?null:(0,l.jsxs)(o.ms,{children:[(0,l.jsx)(o.Lk,{className:(0,c.xW)("flex items-center justify-center","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-500",u.M[t.status]),icon:a.GvN,title:"Deployment actions",onClick:e=>{e.preventDefault()}}),(0,l.jsxs)(o.pm,{align:"end",children:[(0,l.jsx)(o.tJ,{name:"View logs",onSelect:()=>{d.openDeployment(p(t,n))},children:"View logs"}),d.restartDeployment&&(0,l.jsx)(o.tJ,{name:"Restart",onSelect:d.restartDeployment,children:"Restart"}),d.redeployDeployment&&(0,l.jsx)(o.tJ,{name:"Redeploy",onSelect:d.redeployDeployment,children:"Redeploy"}),d.deployCommit&&(0,l.jsx)(o.tJ,{name:"Deploy commit",onSelect:d.deployCommit,children:"Deploy commit"}),t.canRollback&&d.rollbackDeployment&&(0,l.jsx)(i.n4,{children:(0,l.jsx)(o.tJ,{name:"Rollback",onSelect:d.rollbackDeployment,children:"Rollback"})}),d.cancelDeployment&&(0,l.jsx)(i.n4,{children:(0,l.jsx)(o.tJ,{className:"text-red-500",name:"Abort",onSelect:d.cancelDeployment,children:"Abort"})}),d.removeDeployment&&(0,l.jsx)(i.n4,{children:(0,l.jsx)(o.tJ,{className:"text-red-500",onSelect:d.removeDeployment,name:"Remove",children:"Remove"})})]})]})}function p(e,t){var n,l,s;let a="deploy";if(![d.Uty.Building,d.Uty.Initializing,d.Uty.NeedsApproval,d.Uty.Failed].includes(e.status)||(null==(n=e.meta)?void 0:n.image)||(a="build"),t){let n=r.t5[null!=(s=null==t?void 0:t.step)?s:d.uEY.SnapshotCode];"DEPLOY"===n||"POST_DEPLOY"===n||(null==(l=e.meta)?void 0:l.image)||(a="build")}return a}},83119:(e,t,n)=>{n.d(t,{g$:()=>h,u7:()=>f,vm:()=>g});var l=n(50979),r=n(13075),s=n(91729),a=n(25963),o=n(25646),i=n(95662),d=n(42419),c=n(31754),u=n(70375),m=n(13077),p=n(2551),y=n(36609);let x=()=>{let{routes:e}=(0,u.c)();return(0,l.jsxs)(i.T,{className:"max-w-sm",space:4,children:[(0,l.jsxs)(i.T,{space:2,children:[(0,l.jsx)(d.EY,{className:"font-semibold",children:"Error"}),(0,l.jsx)(d.ax,{children:"Your build failed as we could not find a start command to run your deployment with."})]}),(0,l.jsxs)(i.z,{align:"center",justify:"end",space:2,children:[(0,l.jsx)(c.vx,{variant:"outline",size:"sm",color:"gray",...e.docs({page:"reference/errors/no-start-command-could-be-found"}),children:"Read the docs"}),(0,l.jsx)(c.vx,{size:"sm",...e.projectServiceSettings({section:"deploy-start-command"}),children:"Add a start command"})]})]})},g={"No start command was found":(0,l.jsx)(x,{}),"No start command could be found":(0,l.jsx)(x,{}),"Nixpacks was unable to generate a build plan for this app.":(0,l.jsx)(()=>{let{routes:e}=(0,u.c)();return(0,l.jsxs)(i.T,{className:"max-w-sm",space:4,children:[(0,l.jsxs)(i.T,{space:2,children:[(0,l.jsx)(d.EY,{className:"font-semibold",children:"Error"}),(0,l.jsx)(d.ax,{children:"This usually happens when using a monorepo without the correct root directory set."})]}),(0,l.jsxs)(i.z,{align:"center",justify:"end",space:2,children:[(0,l.jsx)(c.vx,{variant:"outline",size:"sm",...e.docs({page:"reference/errors/nixpacks-was-unable-to-generate-a-build-plan"}),children:"Read the docs"}),(0,l.jsx)(c.vx,{size:"sm",...e.projectServiceSettings({section:"root-directory"}),children:"Configure root directory"})]})]})},{}),"ENOTFOUND redis.railway.internal":(0,l.jsx)(()=>{let{routes:e}=(0,u.c)();return(0,l.jsxs)(i.T,{className:"max-w-sm",space:4,children:[(0,l.jsxs)(i.T,{space:2,children:[(0,l.jsx)(d.EY,{className:"font-semibold",children:"Error"}),(0,l.jsxs)(d.ax,{children:["Your deployment crashed because it could not resolve the",(0,l.jsx)(d.R0,{children:"redis.railway.internal"})," hostname to connect to your Redis instance."]})]}),(0,l.jsx)(i.z,{align:"center",justify:"end",space:2,children:(0,l.jsx)(c.vx,{size:"sm",...e.docs({page:"reference/errors/enotfound-redis-railway-internal"}),children:"Read the docs"})})]})},{})},v=RegExp("(".concat(Object.keys(g).join("|"),")"),"g"),h=e=>{let{content:t,className:n}=e;return(0,l.jsxs)("span",{className:(0,y.xW)("inline-flex items-center gap-2 py-1 px-2 bg-red-200 rounded-lg cursor-help",n),children:[(0,l.jsx)(d.tj,{children:t}),(0,l.jsx)(m.In,{icon:p.R2D,size:"sm"})]})},f=e=>{let{content:t}=e,n=(0,a.useMemo)(()=>t.split(v).map((e,t)=>g[e]?(0,l.jsx)(o.j,{triggerContent:(0,l.jsx)(h,{content:e}),cardContent:g[e]},t):(0,l.jsx)(a.Fragment,{children:(0,r.Ay)(e)},t)),[t]);return(0,l.jsx)(s.E,{children:n})}},89118:(e,t,n)=>{n.d(t,{e:()=>I});var l=n(50979),r=n(25963),s=n(62190),a=n(2551),o=n(36609),i=n(25646),d=n(42419),c=n(83119),u=n(13077),m=n(67970),p=n(80374),y=n(47654),x=n(70375),g=n(52846);function v(e){return!!(e.startedAt&&e.completedAt)}function h(e){return!!(e.startedAt&&!e.completedAt)}function f(e){let{item:t}=e,{startedAt:n}=t;return(0,l.jsxs)("p",{className:"tabular-nums text-gray-500 dark:text-gray-400",children:["(",(0,l.jsx)(g.d,{timeStyle:"clock",children:n}),")"]})}function b(e){let{hasError:t,item:n}=e,{completedAt:r,startedAt:s}=n;return(0,l.jsxs)("p",{className:(0,o.xW)(["tabular-nums",t&&"text-red-500"]),children:["(",(0,l.jsx)(g.d,{timeStyle:"clock",startedAt:s,finishedAt:r}),")"]})}let j={"No start command could be found":"deploy-start-command"},w="Please check the build logs for more details.",N=[...Object.keys(j),w,...Object.keys(c.vm)],D=RegExp("(".concat(N.join("|"),")"),"g"),k=e=>{var t,n;let{errorEvent:s,deploymentId:a,children:o}=e,u=(e=>{let{error:t,deploymentId:n}=e,{routes:s}=(0,x.c)();return t.split(D).map(e=>j[e]?(0,r.createElement)(y.N,{...s.projectServiceSettings({section:j[e]}),className:"underline",key:e},e):c.vm[e]?(0,l.jsx)("span",{className:"-ml-1",children:(0,l.jsx)(i.j,{triggerContent:(0,l.jsx)(c.g$,{content:(0,l.jsx)(d.ax,{children:e})}),cardContent:c.vm[e]})},e):e===w?(0,r.createElement)(y.N,{...s.projectServiceDeployments({deploymentId:n,hash:"build"}),className:"underline focus-visible:ring-0 focus-visible:outline-red-500 focus-visible:outline-2 focus-visible:outline-offset-4 focus-visible:rounded-sm",key:e},e):e)})({error:null!=(n=null==(t=s.payload)?void 0:t.error)?n:"",deploymentId:a});return(0,l.jsx)("div",{className:"flex flex-col",children:(0,l.jsxs)("div",{className:"border-l ml-[7px] border-red-300 pl-10 pr-3 py-2 mb-2",children:[(0,l.jsx)("p",{className:"font-mono text-red-500 whitespace-pre-wrap",children:u}),o]})})};function I(e){var t;let{hasInset:n=!1,item:r,title:i,hasDeploymentFailed:d,deploymentId:c,children:y}=e,{events:x}=r,g=d&&r.startedAt&&!r.completedAt||!1,j=Object.values(x).find(e=>{var t;return!!(null==(t=e.payload)?void 0:t.error)}),w=!!j,N=w||g?a.X:r.startedAt&&r.completedAt?a.Jlk:r.startedAt&&!r.completedAt?m.Rh:a.jlt,D=(0,o.xW)(["flex flex-col","text-sm","px-4",w&&"bg-red-100",n&&"pl-24",g&&"bg-red-100"]),I=(0,o.xW)(["border-t border-transparent","flex items-center justify-between","h-full w-full","ml-8","text-gray-500"]),S=(0,o.xW)([w&&"text-red-500",!w&&r.startedAt&&r.completedAt&&"text-green-500",!w&&!(r.startedAt&&r.completedAt)&&"text-gray-300",g&&"text-red-500"]),z=null==(t=r.events.at(-1))?void 0:t.step,A=z&&!w&&!g&&h(r);return"Pre-deploy"!==i||r.startedAt?(0,l.jsxs)("div",{className:D,children:[(0,l.jsxs)("div",{className:"flex items-center h-11",children:[(0,l.jsx)(u.In,{className:S,color:"currentColor",icon:N,size:"sm"}),(0,l.jsxs)("div",{className:I,children:[(0,l.jsx)("div",{className:"flex items-center gap-x-1",children:(0,l.jsxs)("p",{className:(0,o.xW)(["text-gray-500",v(r)&&"text-foreground",!v(r)&&"text-gray-500",w&&"text-red-500 font-medium"]),children:[i,A&&(0,l.jsxs)("span",{children:[" ›"," ",s.nM[z]]}),j&&(0,l.jsxs)("span",{children:[" ›"," ",(0,p.VR)(j.step.replaceAll("_"," "))]})]})}),!g&&h(r)&&(0,l.jsx)(f,{item:r}),v(r)&&(0,l.jsx)(b,{hasError:w,item:r}),!h(r)&&!v(r)&&(0,l.jsx)("p",{className:"text-gray-300",children:"Not started"})]})]}),j&&(0,l.jsx)(k,{errorEvent:j,deploymentId:c,children:y})]}):null}},91729:(e,t,n)=>{n.d(t,{E:()=>s});var l=n(86739);function r(){let e=(0,l._)(["ansi-color-wrapper"]);return r=function(){return e},e}let s=n(36609).qy.span(r())},98078:(e,t,n)=>{n.d(t,{p:()=>a});var l=n(53036),r=n(38987),s=n(55850);function a(e){let{snapshotId:t,limit:n=1,logsLimit:a=20,enabled:o,refetchInterval:i,...d}=e,{graphqlClient:c}=(0,s.q)();return(0,l.I)({queryKey:["buildKitErrors",t],async queryFn(){let e=await c.environmentLogs({...d,beforeLimit:0,afterLimit:n,filter:'@source:"buildkit" AND @type:"vertex" AND @level:"error" AND @snapshot:'.concat(t)});return e.environmentLogs.length?await Promise.all(e.environmentLogs.map(async e=>{var n;let l=null==(n=e.attributes.find(e=>"digest"===e.key))?void 0:n.value,s=await c.environmentLogs({environmentId:d.environmentId,beforeLimit:a,anchorDate:e.timestamp,filter:'@source:"buildkit" AND @type:"log" AND @vertex:'.concat(l," AND @snapshot:").concat(t)}),o=r.$G.safeParse([...s.environmentLogs,e]);return o.success?o.data:[]})):[]},staleTime:4e3,refetchOnMount(e){var t;return!(null==(t=e.state.data)?void 0:t.length)},refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchInterval:i,enabled:o})}}}]);