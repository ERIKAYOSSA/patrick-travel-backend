"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3655],{81849:(e,t,r)=>{e=r.nmd(e);var n,i,o,a=Object.create,s=Object.defineProperty,u=Object.defineProperties,l=Object.getOwnPropertyDescriptor,c=Object.getOwnPropertyDescriptors,f=Object.getOwnPropertyNames,h=Object.getOwnPropertySymbols,p=Object.getPrototypeOf,d=Object.prototype.hasOwnProperty,g=Object.prototype.propertyIsEnumerable,y=(e,t,r)=>t in e?s(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,b=(e,t)=>{for(var r in t||(t={}))d.call(t,r)&&y(e,r,t[r]);if(h)for(var r of h(t))g.call(t,r)&&y(e,r,t[r]);return e},v=(e,t)=>u(e,c(t)),_=(e,t)=>function(){return t||(0,e[f(e)[0]])((t={exports:{}}).exports,t),t.exports},m=(e,t)=>{for(var r in t)s(e,r,{get:t[r],enumerable:!0})},j=(e,t,r,n)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let i of f(t))d.call(e,i)||i===r||s(e,i,{get:()=>t[i],enumerable:!(n=l(t,i))||n.enumerable});return e},w=(e,t,r)=>(r=null!=e?a(p(e)):{},j(!t&&e&&e.__esModule?r:s(r,"default",{value:e,enumerable:!0}),e)),P=(e,t,r)=>(y(e,"symbol"!=typeof t?t+"":t,r),r),O=_({"../node_modules/timing-function/lib/UnitBezier.js"(e,t){t.exports=function(){function e(e,t,r,n){this.set(e,t,r,n)}return e.prototype.set=function(e,t,r,n){this._cx=3*e,this._bx=3*(r-e)-this._cx,this._ax=1-this._cx-this._bx,this._cy=3*t,this._by=3*(n-t)-this._cy,this._ay=1-this._cy-this._by},e.epsilon=1e-6,e.prototype._sampleCurveX=function(e){return((this._ax*e+this._bx)*e+this._cx)*e},e.prototype._sampleCurveY=function(e){return((this._ay*e+this._by)*e+this._cy)*e},e.prototype._sampleCurveDerivativeX=function(e){return(3*this._ax*e+2*this._bx)*e+this._cx},e.prototype._solveCurveX=function(e,t){var r,n,i,o,a,s;for(i=void 0,o=void 0,a=void 0,s=void 0,r=void 0,n=void 0,a=e,n=0;n<8;){if(Math.abs(s=this._sampleCurveX(a)-e)<t)return a;if(Math.abs(r=this._sampleCurveDerivativeX(a))<t)break;a-=s/r,n++}if(i=0,o=1,(a=e)<i)return i;if(a>o)return o;for(;i<o&&!(Math.abs((s=this._sampleCurveX(a))-e)<t);)e>s?i=a:o=a,a=(o-i)*.5+i;return a},e.prototype.solve=function(e,t){return this._sampleCurveY(this._solveCurveX(e,t))},e.prototype.solveSimple=function(e){return this._sampleCurveY(this._solveCurveX(e,1e-6))},e}()}}),S=_({"../node_modules/levenshtein-edit-distance/index.js"(e,t){var r,n;r=[],n=[],t.exports=function(e,t,i){var o,a,s,u,l,c,f,h;if(e===t)return 0;if(o=e.length,a=t.length,0===o)return a;if(0===a)return o;for(i&&(e=e.toLowerCase(),t=t.toLowerCase()),f=0;f<o;)n[f]=e.charCodeAt(f),r[f]=++f;for(h=0;h<a;)for(s=t.charCodeAt(h),u=l=h++,f=-1;++f<o;)c=s===n[f]?l:l+1,l=r[f],r[f]=u=l>u?c>u?u+1:c:c>l?l+1:c;return u}}}),T=_({"../node_modules/propose/propose.js"(e,t){var r=S();t.exports=function(){var e,t,n,i,o,a=0,s=arguments[0],u=arguments[1],l=u.length,c=arguments[2];c&&(i=c.threshold,o=c.ignoreCase),void 0===i&&(i=0);for(var f=0;f<l;++f)(e=(t=o?r(s,u[f],!0):r(s,u[f]))>s.length?1-t/u[f].length:1-t/s.length)>a&&(a=e,n=u[f]);return a>=i?n:null}}}),A=_({"../node_modules/fast-deep-equal/index.js"(e,t){t.exports=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){if(t.constructor!==r.constructor)return!1;if(Array.isArray(t)){if((n=t.length)!=r.length)return!1;for(i=n;0!=i--;)if(!e(t[i],r[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if((n=(o=Object.keys(t)).length)!==Object.keys(r).length)return!1;for(i=n;0!=i--;)if(!Object.prototype.hasOwnProperty.call(r,o[i]))return!1;for(i=n;0!=i--;){var n,i,o,a=o[i];if(!e(t[a],r[a]))return!1}return!0}return t!=t&&r!=r}}}),k={};m(k,{createRafDriver:()=>iS,getProject:()=>o4,notify:()=>ij,onChange:()=>o9,types:()=>iV,val:()=>ae}),e.exports=j(s({},"__esModule",{value:!0}),k);var x={};m(x,{createRafDriver:()=>iS,getProject:()=>o4,notify:()=>ij,onChange:()=>o9,types:()=>iV,val:()=>ae});var D=r(62006),C=new class{constructor(){P(this,"atom",new D.Atom({projects:{}}))}add(e,t){this.atom.setByPointer(t=>t.projects[e],t)}get(e){return this.atom.get().projects[e]}has(e){return!!this.get(e)}},I=new WeakMap;function B(e){return I.get(e)}function E(e,t){I.set(e,t)}var M=[],F=Array.isArray,V="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g,z="object"==typeof self&&self&&self.Object===Object&&self,U=V||z||Function("return this")(),R=U.Symbol,N=Object.prototype,q=N.hasOwnProperty,L=N.toString,$=R?R.toStringTag:void 0,K=function(e){var t=q.call(e,$),r=e[$];try{e[$]=void 0;var n=!0}catch(e){}var i=L.call(e);return n&&(t?e[$]=r:delete e[$]),i},W=Object.prototype.toString,H=R?R.toStringTag:void 0,G=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":H&&H in Object(e)?K(e):W.call(e)},J=function(e){return null!=e&&"object"==typeof e},X=function(e){return"symbol"==typeof e||J(e)&&"[object Symbol]"==G(e)},Y=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Q=/^\w*$/,Z=function(e,t){if(F(e))return!1;var r=typeof e;return!!("number"==r||"symbol"==r||"boolean"==r||null==e||X(e))||Q.test(e)||!Y.test(e)||null!=t&&e in Object(t)},ee=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},et=function(e){if(!ee(e))return!1;var t=G(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},er=U["__core-js_shared__"],en=function(){var e=/[^.]+$/.exec(er&&er.keys&&er.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),ei=Function.prototype.toString,eo=function(e){if(null!=e){try{return ei.call(e)}catch(e){}try{return e+""}catch(e){}}return""},ea=/^\[object .+?Constructor\]$/,es=Object.prototype,eu=Function.prototype.toString,el=es.hasOwnProperty,ec=RegExp("^"+eu.call(el).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ef=function(e){return!!ee(e)&&(!en||!(en in e))&&(et(e)?ec:ea).test(eo(e))},eh=function(e,t){var r=null==e?void 0:e[t];return ef(r)?r:void 0},ep=eh(Object,"create"),ed=Object.prototype.hasOwnProperty,eg=Object.prototype.hasOwnProperty;function ey(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ey.prototype.clear=function(){this.__data__=ep?ep(null):{},this.size=0},ey.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=!!t,t},ey.prototype.get=function(e){var t=this.__data__;if(ep){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return ed.call(t,e)?t[e]:void 0},ey.prototype.has=function(e){var t=this.__data__;return ep?void 0!==t[e]:eg.call(t,e)},ey.prototype.set=function(e,t){var r=this.__data__;return this.size+=+!this.has(e),r[e]=ep&&void 0===t?"__lodash_hash_undefined__":t,this};var eb=function(e,t){return e===t||e!=e&&t!=t},ev=function(e,t){for(var r=e.length;r--;)if(eb(e[r][0],t))return r;return -1},e_=Array.prototype.splice;function em(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}em.prototype.clear=function(){this.__data__=[],this.size=0},em.prototype.delete=function(e){var t=this.__data__,r=ev(t,e);return!(r<0)&&(r==t.length-1?t.pop():e_.call(t,r,1),--this.size,!0)},em.prototype.get=function(e){var t=this.__data__,r=ev(t,e);return r<0?void 0:t[r][1]},em.prototype.has=function(e){return ev(this.__data__,e)>-1},em.prototype.set=function(e,t){var r=this.__data__,n=ev(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};var ej=eh(U,"Map"),ew=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e},eP=function(e,t){var r=e.__data__;return ew(t)?r["string"==typeof t?"string":"hash"]:r.map};function eO(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function eS(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw TypeError("Expected a function");var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],o=r.cache;if(o.has(i))return o.get(i);var a=e.apply(this,n);return r.cache=o.set(i,a)||o,a};return r.cache=new(eS.Cache||eO),r}eO.prototype.clear=function(){this.size=0,this.__data__={hash:new ey,map:new(ej||em),string:new ey}},eO.prototype.delete=function(e){var t=eP(this,e).delete(e);return this.size-=!!t,t},eO.prototype.get=function(e){return eP(this,e).get(e)},eO.prototype.has=function(e){return eP(this,e).has(e)},eO.prototype.set=function(e,t){var r=eP(this,e),n=r.size;return r.set(e,t),this.size+=+(r.size!=n),this},eS.Cache=eO;var eT=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,eA=/\\(\\)?/g,ek=function(e){var t=eS(e,function(e){return 500===r.size&&r.clear(),e}),r=t.cache;return t}(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(eT,function(e,r,n,i){t.push(n?i.replace(eA,"$1"):r||e)}),t}),ex=function(e,t){for(var r=-1,n=null==e?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i},eD=1/0,eC=R?R.prototype:void 0,eI=eC?eC.toString:void 0,eB=function e(t){if("string"==typeof t)return t;if(F(t))return ex(t,e)+"";if(X(t))return eI?eI.call(t):"";var r=t+"";return"0"==r&&1/t==-eD?"-0":r},eE=function(e){return null==e?"":eB(e)},eM=function(e,t){return F(e)?e:Z(e,t)?[e]:ek(eE(e))},eF=1/0,eV=function(e){if("string"==typeof e||X(e))return e;var t=e+"";return"0"==t&&1/e==-eF?"-0":t},ez=function(e,t){t=eM(t,e);for(var r=0,n=t.length;null!=e&&r<n;)e=e[eV(t[r++])];return r&&r==n?e:void 0},eU=function(e,t,r){var n=null==e?void 0:ez(e,t);return void 0===n?r:n};function eR(e,t){return 0===t.length?e:eU(e,t)}var eN=class{constructor(){P(this,"_values",{})}get(e,t){if(this.has(e))return this._values[e];{let r=t();return this._values[e]=r,r}}has(e){return this._values.hasOwnProperty(e)}},eq=r(62006),eL=function(){try{var e=eh(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),e$=function(e,t,r){"__proto__"==t&&eL?eL(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r},eK=Object.prototype.hasOwnProperty,eW=function(e,t,r){var n=e[t];eK.call(e,t)&&eb(n,r)&&(void 0!==r||t in e)||e$(e,t,r)},eH=/^(?:0|[1-9]\d*)$/,eG=function(e,t){var r=typeof e;return!!(t=null==t?0x1fffffffffffff:t)&&("number"==r||"symbol"!=r&&eH.test(e))&&e>-1&&e%1==0&&e<t},eJ=function(e,t,r,n){if(!ee(e))return e;t=eM(t,e);for(var i=-1,o=t.length,a=o-1,s=e;null!=s&&++i<o;){var u=eV(t[i]),l=r;if("__proto__"===u||"constructor"===u||"prototype"===u)break;if(i!=a){var c=s[u];void 0===(l=n?n(c,u,s):void 0)&&(l=ee(c)?c:eG(t[i+1])?[]:{})}eW(s,u,l),s=s[u]}return e},eX=new WeakMap,eY=r(62006),eQ=w(O()),eZ=(0,eY.prism)(()=>void 0),e0={beforeFirstKeyframe:e=>({started:!0,validFrom:-1/0,validTo:e.position,der:(0,eY.prism)(()=>({left:e.value,progression:0}))}),lastKeyframe:e=>({started:!0,validFrom:e.position,validTo:1/0,der:(0,eY.prism)(()=>({left:e.value,progression:0}))}),between(e,t,r){if(!e.connectedRight)return{started:!0,validFrom:e.position,validTo:t.position,der:(0,eY.prism)(()=>({left:e.value,progression:0}))};let n=r=>(r-e.position)/(t.position-e.position);if(!e.type||"bezier"===e.type){let i=new eQ.default(e.handles[2],e.handles[3],t.handles[0],t.handles[1]),o=(0,eY.prism)(()=>{let o=n(r.getValue()),a=i.solveSimple(o);return{left:e.value,right:t.value,progression:a}});return{started:!0,validFrom:e.position,validTo:t.position,der:o}}let i=(0,eY.prism)(()=>{let i=Math.floor(n(r.getValue()));return{left:e.value,right:t.value,progression:i}});return{started:!0,validFrom:e.position,validTo:t.position,der:i}},error:{started:!0,validFrom:-1/0,validTo:1/0,der:eZ}};function e1(e,t,r){let n=r.get(e);if(n&&n.override===t)return n.merged;let i=b({},e);for(let n of Object.keys(t)){let o=t[n],a=e[n];i[n]="object"==typeof o&&"object"==typeof a?e1(a,o,r):void 0===o?a:o}return r.set(e,{override:t,merged:i}),i}function e2(e,t){let r=e;for(let e of t)r=r[e];return r}var e6=r(62006),e5=r(62006),e3=r(62006),e8=/\s/,e4=function(e){for(var t=e.length;t--&&e8.test(e.charAt(t)););return t},e7=/^\s+/,e9=0/0,te=/^[-+]0x[0-9a-f]+$/i,tt=/^0b[01]+$/i,tr=/^0o[0-7]+$/i,tn=parseInt,ti=function(e){if("number"==typeof e)return e;if(X(e))return e9;if(ee(e)){var t,r="function"==typeof e.valueOf?e.valueOf():e;e=ee(r)?r+"":r}if("string"!=typeof e)return 0===e?e:+e;e=(t=e)?t.slice(0,e4(t)+1).replace(e7,""):t;var n=tt.test(e);return n||tr.test(e)?tn(e.slice(2),n?2:8):te.test(e)?e9:+e},to=1/0,ta=function(e){var t,r=(t=e)?(t=ti(t))===to||t===-to?(t<0?-1:1)*17976931348623157e292:t==t?t:0:0===t?t:0,n=r%1;return r==r?n?r-n:r:0},ts=function(e){return e},tu=eh(U,"WeakMap"),tl=Object.create,tc=function(){function e(){}return function(t){if(!ee(t))return{};if(tl)return tl(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}(),tf=function(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t},th=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e},tp=function(e,t,r,n){var i=!r;r||(r={});for(var o=-1,a=t.length;++o<a;){var s=t[o],u=n?n(r[s],e[s],s,r,e):void 0;void 0===u&&(u=e[s]),i?e$(r,s,u):eW(r,s,u)}return r},td=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=0x1fffffffffffff},tg=function(e){return null!=e&&td(e.length)&&!et(e)},ty=Object.prototype,tb=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||ty)},tv=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n},t_=function(e){return J(e)&&"[object Arguments]"==G(e)},tm=Object.prototype,tj=tm.hasOwnProperty,tw=tm.propertyIsEnumerable,tP=t_(function(){return arguments}())?t_:function(e){return J(e)&&tj.call(e,"callee")&&!tw.call(e,"callee")},tO=t&&!t.nodeType&&t,tS=tO&&e&&!e.nodeType&&e,tT=tS&&tS.exports===tO?U.Buffer:void 0,tA=(tT?tT.isBuffer:void 0)||function(){return!1},tk={};tk["[object Float32Array]"]=tk["[object Float64Array]"]=tk["[object Int8Array]"]=tk["[object Int16Array]"]=tk["[object Int32Array]"]=tk["[object Uint8Array]"]=tk["[object Uint8ClampedArray]"]=tk["[object Uint16Array]"]=tk["[object Uint32Array]"]=!0,tk["[object Arguments]"]=tk["[object Array]"]=tk["[object ArrayBuffer]"]=tk["[object Boolean]"]=tk["[object DataView]"]=tk["[object Date]"]=tk["[object Error]"]=tk["[object Function]"]=tk["[object Map]"]=tk["[object Number]"]=tk["[object Object]"]=tk["[object RegExp]"]=tk["[object Set]"]=tk["[object String]"]=tk["[object WeakMap]"]=!1;var tx=function(e){return function(t){return e(t)}},tD=t&&!t.nodeType&&t,tC=tD&&e&&!e.nodeType&&e,tI=tC&&tC.exports===tD&&V.process,tB=function(){try{var e=tC&&tC.require&&tC.require("util").types;if(e)return e;return tI&&tI.binding&&tI.binding("util")}catch(e){}}(),tE=tB&&tB.isTypedArray,tM=tE?tx(tE):function(e){return J(e)&&td(e.length)&&!!tk[G(e)]},tF=Object.prototype.hasOwnProperty,tV=function(e,t){var r=F(e),n=!r&&tP(e),i=!r&&!n&&tA(e),o=!r&&!n&&!i&&tM(e),a=r||n||i||o,s=a?tv(e.length,String):[],u=s.length;for(var l in e)(t||tF.call(e,l))&&!(a&&("length"==l||i&&("offset"==l||"parent"==l)||o&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||eG(l,u)))&&s.push(l);return s},tz=function(e,t){return function(r){return e(t(r))}},tU=tz(Object.keys,Object),tR=Object.prototype.hasOwnProperty,tN=function(e){if(!tb(e))return tU(e);var t=[];for(var r in Object(e))tR.call(e,r)&&"constructor"!=r&&t.push(r);return t},tq=function(e){return tg(e)?tV(e):tN(e)},tL=function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t},t$=Object.prototype.hasOwnProperty,tK=function(e){if(!ee(e))return tL(e);var t=tb(e),r=[];for(var n in e)"constructor"==n&&(t||!t$.call(e,n))||r.push(n);return r},tW=function(e){return tg(e)?tV(e,!0):tK(e)},tH=function(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e},tG=tz(Object.getPrototypeOf,Object),tJ=Object.prototype,tX=Function.prototype.toString,tY=tJ.hasOwnProperty,tQ=tX.call(Object),tZ=function(e){if(!J(e)||"[object Object]"!=G(e))return!1;var t=tG(e);if(null===t)return!0;var r=tY.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&tX.call(r)==tQ},t0=function(e,t,r){var n=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(r=r>i?i:r)<0&&(r+=i),i=t>r?0:r-t>>>0,t>>>=0;for(var o=Array(i);++n<i;)o[n]=e[n+t];return o},t1=function(e,t,r){var n=e.length;return r=void 0===r?n:r,!t&&r>=n?e:t0(e,t,r)},t2=RegExp("[\\u200d\ud800-\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]"),t6=function(e){return t2.test(e)},t5="\ud800-\udfff",t3="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",t8="\ud83c[\udffb-\udfff]",t4="[^"+t5+"]",t7="(?:\ud83c[\udde6-\uddff]){2}",t9="[\ud800-\udbff][\udc00-\udfff]",re="(?:"+t3+"|"+t8+")?",rt="[\\ufe0e\\ufe0f]?",rr="(?:\\u200d(?:"+[t4,t7,t9].join("|")+")"+rt+re+")*",rn=RegExp(t8+"(?="+t8+")|"+("(?:"+[t4+t3+"?",t3,t7,t9,"["+t5+"]"].join("|"))+")"+(rt+re+rr),"g"),ri=function(e,t,r){var n,i,o;return void 0===r&&(r=t,t=void 0),void 0!==r&&(r=(r=ti(r))==r?r:0),void 0!==t&&(t=(t=ti(t))==t?t:0),n=ti(e),i=t,o=r,n==n&&(void 0!==o&&(n=n<=o?n:o),void 0!==i&&(n=n>=i?n:i)),n};function ro(e){var t=this.__data__=new em(e);this.size=t.size}ro.prototype.clear=function(){this.__data__=new em,this.size=0},ro.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},ro.prototype.get=function(e){return this.__data__.get(e)},ro.prototype.has=function(e){return this.__data__.has(e)},ro.prototype.set=function(e,t){var r=this.__data__;if(r instanceof em){var n=r.__data__;if(!ej||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new eO(n)}return r.set(e,t),this.size=r.size,this};var ra=t&&!t.nodeType&&t,rs=ra&&e&&!e.nodeType&&e,ru=rs&&rs.exports===ra?U.Buffer:void 0,rl=ru?ru.allocUnsafe:void 0,rc=function(e,t){if(t)return e.slice();var r=e.length,n=rl?rl(r):new e.constructor(r);return e.copy(n),n},rf=function(e,t){for(var r=-1,n=null==e?0:e.length,i=0,o=[];++r<n;){var a=e[r];t(a,r,e)&&(o[i++]=a)}return o},rh=function(){return[]},rp=Object.prototype.propertyIsEnumerable,rd=Object.getOwnPropertySymbols,rg=rd?function(e){return null==e?[]:rf(rd(e=Object(e)),function(t){return rp.call(e,t)})}:rh,ry=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)tH(t,rg(e)),e=tG(e);return t}:rh,rb=function(e,t,r){var n=t(e);return F(e)?n:tH(n,r(e))},rv=function(e){return rb(e,tq,rg)},r_=function(e){return rb(e,tW,ry)},rm=eh(U,"DataView"),rj=eh(U,"Promise"),rw=eh(U,"Set"),rP="[object Map]",rO="[object Promise]",rS="[object Set]",rT="[object WeakMap]",rA="[object DataView]",rk=eo(rm),rx=eo(ej),rD=eo(rj),rC=eo(rw),rI=eo(tu),rB=G;(rm&&rB(new rm(new ArrayBuffer(1)))!=rA||ej&&rB(new ej)!=rP||rj&&rB(rj.resolve())!=rO||rw&&rB(new rw)!=rS||tu&&rB(new tu)!=rT)&&(rB=function(e){var t=G(e),r="[object Object]"==t?e.constructor:void 0,n=r?eo(r):"";if(n)switch(n){case rk:return rA;case rx:return rP;case rD:return rO;case rC:return rS;case rI:return rT}return t});var rE=rB,rM=Object.prototype.hasOwnProperty,rF=function(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&rM.call(e,"index")&&(r.index=e.index,r.input=e.input),r},rV=U.Uint8Array,rz=function(e){var t=new e.constructor(e.byteLength);return new rV(t).set(new rV(e)),t},rU=function(e,t){var r=t?rz(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)},rR=/\w*$/,rN=function(e){var t=new e.constructor(e.source,rR.exec(e));return t.lastIndex=e.lastIndex,t},rq=R?R.prototype:void 0,rL=rq?rq.valueOf:void 0,r$=function(e,t){var r=t?rz(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)},rK=function(e,t,r){var n=e.constructor;switch(t){case"[object ArrayBuffer]":return rz(e);case"[object Boolean]":case"[object Date]":return new n(+e);case"[object DataView]":return rU(e,r);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return r$(e,r);case"[object Map]":case"[object Set]":return new n;case"[object Number]":case"[object String]":return new n(e);case"[object RegExp]":return rN(e);case"[object Symbol]":return rL?Object(rL.call(e)):{}}},rW=tB&&tB.isMap,rH=rW?tx(rW):function(e){return J(e)&&"[object Map]"==rE(e)},rG=tB&&tB.isSet,rJ=rG?tx(rG):function(e){return J(e)&&"[object Set]"==rE(e)},rX="[object Arguments]",rY="[object Function]",rQ="[object Object]",rZ={};rZ[rX]=rZ["[object Array]"]=rZ["[object ArrayBuffer]"]=rZ["[object DataView]"]=rZ["[object Boolean]"]=rZ["[object Date]"]=rZ["[object Float32Array]"]=rZ["[object Float64Array]"]=rZ["[object Int8Array]"]=rZ["[object Int16Array]"]=rZ["[object Int32Array]"]=rZ["[object Map]"]=rZ["[object Number]"]=rZ[rQ]=rZ["[object RegExp]"]=rZ["[object Set]"]=rZ["[object String]"]=rZ["[object Symbol]"]=rZ["[object Uint8Array]"]=rZ["[object Uint8ClampedArray]"]=rZ["[object Uint16Array]"]=rZ["[object Uint32Array]"]=!0,rZ["[object Error]"]=rZ[rY]=rZ["[object WeakMap]"]=!1;var r0=function e(t,r,n,i,o,a){var s,u=1&r,l=2&r,c=4&r;if(n&&(s=o?n(t,i,o,a):n(t)),void 0!==s)return s;if(!ee(t))return t;var f=F(t);if(f){if(s=rF(t),!u)return tf(t,s)}else{var h,p,d,g,y,b=rE(t),v=b==rY||"[object GeneratorFunction]"==b;if(tA(t))return rc(t,u);if(b==rQ||b==rX||v&&!o){if(s=l||v||"function"!=typeof(h=t).constructor||tb(h)?{}:tc(tG(h)),!u)return l?(d=(p=s)&&tp(t,tW(t),p),tp(t,ry(t),d)):(y=(g=s)&&tp(t,tq(t),g),tp(t,rg(t),y))}else{if(!rZ[b])return o?t:{};s=rK(t,b,u)}}a||(a=new ro);var _=a.get(t);if(_)return _;a.set(t,s),rJ(t)?t.forEach(function(i){s.add(e(i,r,n,i,t,a))}):rH(t)&&t.forEach(function(i,o){s.set(o,e(i,r,n,o,t,a))});var m=c?l?r_:rv:l?tW:tq,j=f?void 0:m(t);return th(j||t,function(i,o){j&&(i=t[o=i]),eW(s,o,e(i,r,n,o,t,a))}),s};function r1(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new eO;++t<r;)this.add(e[t])}r1.prototype.add=r1.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},r1.prototype.has=function(e){return this.__data__.has(e)};var r2=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1},r6=function(e,t,r,n,i,o){var a=1&r,s=e.length,u=t.length;if(s!=u&&!(a&&u>s))return!1;var l=o.get(e),c=o.get(t);if(l&&c)return l==t&&c==e;var f=-1,h=!0,p=2&r?new r1:void 0;for(o.set(e,t),o.set(t,e);++f<s;){var d=e[f],g=t[f];if(n)var y=a?n(g,d,f,t,e,o):n(d,g,f,e,t,o);if(void 0!==y){if(y)continue;h=!1;break}if(p){if(!r2(t,function(e,t){if(!p.has(t)&&(d===e||i(d,e,r,n,o)))return p.push(t)})){h=!1;break}}else if(!(d===g||i(d,g,r,n,o))){h=!1;break}}return o.delete(e),o.delete(t),h},r5=function(e){var t=-1,r=Array(e.size);return e.forEach(function(e,n){r[++t]=[n,e]}),r},r3=function(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r},r8=R?R.prototype:void 0,r4=r8?r8.valueOf:void 0,r7=function(e,t,r,n,i,o,a){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)break;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":if(e.byteLength!=t.byteLength||!o(new rV(e),new rV(t)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return eb(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var s=r5;case"[object Set]":var u=1&n;if(s||(s=r3),e.size!=t.size&&!u)break;var l=a.get(e);if(l)return l==t;n|=2,a.set(e,t);var c=r6(s(e),s(t),n,i,o,a);return a.delete(e),c;case"[object Symbol]":if(r4)return r4.call(e)==r4.call(t)}return!1},r9=Object.prototype.hasOwnProperty,ne=function(e,t,r,n,i,o){var a=1&r,s=rv(e),u=s.length;if(u!=rv(t).length&&!a)return!1;for(var l=u;l--;){var c=s[l];if(!(a?c in t:r9.call(t,c)))return!1}var f=o.get(e),h=o.get(t);if(f&&h)return f==t&&h==e;var p=!0;o.set(e,t),o.set(t,e);for(var d=a;++l<u;){var g=e[c=s[l]],y=t[c];if(n)var b=a?n(y,g,c,t,e,o):n(g,y,c,e,t,o);if(!(void 0===b?g===y||i(g,y,r,n,o):b)){p=!1;break}d||(d="constructor"==c)}if(p&&!d){var v=e.constructor,_=t.constructor;v!=_&&"constructor"in e&&"constructor"in t&&!("function"==typeof v&&v instanceof v&&"function"==typeof _&&_ instanceof _)&&(p=!1)}return o.delete(e),o.delete(t),p},nt="[object Arguments]",nr="[object Array]",nn="[object Object]",ni=Object.prototype.hasOwnProperty,no=function(e,t,r,n,i,o){var a=F(e),s=F(t),u=a?nr:rE(e),l=s?nr:rE(t);u=u==nt?nn:u,l=l==nt?nn:l;var c=u==nn,f=l==nn,h=u==l;if(h&&tA(e)){if(!tA(t))return!1;a=!0,c=!1}if(h&&!c)return o||(o=new ro),a||tM(e)?r6(e,t,r,n,i,o):r7(e,t,u,r,n,i,o);if(!(1&r)){var p=c&&ni.call(e,"__wrapped__"),d=f&&ni.call(t,"__wrapped__");if(p||d){var g=p?e.value():e,y=d?t.value():t;return o||(o=new ro),i(g,y,r,n,o)}}return!!h&&(o||(o=new ro),ne(e,t,r,n,i,o))},na=function e(t,r,n,i,o){return t===r||(null!=t&&null!=r&&(J(t)||J(r))?no(t,r,n,i,e,o):t!=t&&r!=r)},ns=function(e,t,r,n){var i=r.length,o=i,a=!n;if(null==e)return!o;for(e=Object(e);i--;){var s=r[i];if(a&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++i<o;){var u=(s=r[i])[0],l=e[u],c=s[1];if(a&&s[2]){if(void 0===l&&!(u in e))return!1}else{var f=new ro;if(n)var h=n(l,c,u,e,t,f);if(!(void 0===h?na(c,l,3,n,f):h))return!1}}return!0},nu=function(e){return e==e&&!ee(e)},nl=function(e){for(var t=tq(e),r=t.length;r--;){var n=t[r],i=e[n];t[r]=[n,i,nu(i)]}return t},nc=function(e,t){return function(r){return null!=r&&r[e]===t&&(void 0!==t||e in Object(r))}},nf=function(e){var t=nl(e);return 1==t.length&&t[0][2]?nc(t[0][0],t[0][1]):function(r){return r===e||ns(r,e,t)}},nh=function(e,t){return null!=e&&t in Object(e)},np=function(e,t,r){t=eM(t,e);for(var n=-1,i=t.length,o=!1;++n<i;){var a=eV(t[n]);if(!(o=null!=e&&r(e,a)))break;e=e[a]}return o||++n!=i?o:!!(i=null==e?0:e.length)&&td(i)&&eG(a,i)&&(F(e)||tP(e))},nd=function(e){return function(t){return null==t?void 0:t[e]}},ng=function(e){return Z(e)?nd(eV(e)):function(t){return ez(t,e)}},ny=function(e){if("function"==typeof e)return e;if(null==e)return ts;if("object"==typeof e){var t,r;return F(e)?(t=e[0],r=e[1],Z(t)&&nu(r)?nc(eV(t),r):function(e){var n=eU(e,t);return void 0===n&&n===r?null!=e&&np(e,t,nh):na(r,n,3)}):nf(e)}return ng(e)},nb=function(e,t,r){for(var n=-1,i=Object(e),o=r(e),a=o.length;a--;){var s=o[++n];if(!1===t(i[s],s,i))break}return e},nv=function(){return U.Date.now()},n_=Math.max,nm=Math.min,nj=function(e,t,r){var n,i,o,a,s,u,l=0,c=!1,f=!1,h=!0;if("function"!=typeof e)throw TypeError("Expected a function");function p(t){var r=n,o=i;return n=i=void 0,l=t,a=e.apply(o,r)}function d(e){var r=e-u,n=e-l;return void 0===u||r>=t||r<0||f&&n>=o}function g(){var e,r,n,i=nv();if(d(i))return y(i);s=setTimeout(g,(e=i-u,r=i-l,n=t-e,f?nm(n,o-r):n))}function y(e){return(s=void 0,h&&n)?p(e):(n=i=void 0,a)}function b(){var e,r=nv(),o=d(r);if(n=arguments,i=this,u=r,o){if(void 0===s)return l=e=u,s=setTimeout(g,t),c?p(e):a;if(f)return clearTimeout(s),s=setTimeout(g,t),p(u)}return void 0===s&&(s=setTimeout(g,t)),a}return t=ti(t)||0,ee(r)&&(c=!!r.leading,o=(f="maxWait"in r)?n_(ti(r.maxWait)||0,t):o,h="trailing"in r?!!r.trailing:h),b.cancel=function(){void 0!==s&&clearTimeout(s),l=0,n=u=i=s=void 0},b.flush=function(){return void 0===s?a:y(nv())},b},nw=function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0},nP=function(e,t){var r,n={};return t=ny(t,3),r=function(e,r,i){e$(n,r,t(e,r,i))},e&&nb(e,r,tq),n},nO=function(e,t){var r,n;return t=eM(t,e),r=e,null==(e=(n=t).length<2?r:ez(r,t0(n,0,-1)))||delete e[eV(nw(t))]},nS=Math.floor,nT=function(e,t){var r="";if(!e||t<1||t>0x1fffffffffffff)return r;do t%2&&(r+=e),(t=nS(t/2))&&(e+=e);while(t);return r},nA=nd("length"),nk="\ud800-\udfff",nx="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",nD="\ud83c[\udffb-\udfff]",nC="[^"+nk+"]",nI="(?:\ud83c[\udde6-\uddff]){2}",nB="[\ud800-\udbff][\udc00-\udfff]",nE="(?:"+nx+"|"+nD+")?",nM="[\\ufe0e\\ufe0f]?",nF="(?:\\u200d(?:"+[nC,nI,nB].join("|")+")"+nM+nE+")*",nV=RegExp(nD+"(?="+nD+")|"+("(?:"+[nC+nx+"?",nx,nI,nB,"["+nk+"]"].join("|"))+")"+(nM+nE+nF),"g"),nz=function(e){for(var t=nV.lastIndex=0;nV.test(e);)++t;return t},nU=function(e){return t6(e)?nz(e):nA(e)},nR=Math.ceil,nN=function(e,t){var r,n=(t=void 0===t?" ":eB(t)).length;if(n<2)return n?nT(t,e):t;var i=nT(t,nR(e/nU(t)));return t6(t)?t1(t6(r=i)?r.match(rn)||[]:r.split(""),0,e).join(""):i.slice(0,e)},nq=function(e,t,r){e=eE(e);var n=(t=ta(t))?nU(e):0;return t&&n<t?nN(t-n,r)+e:e},nL=function(e,t){return null==e||nO(e,t)},n$=class{constructor(e){P(this,"_cache",new eN),P(this,"_keepHotUntapDebounce"),E(this,e)}get type(){return"Theatre_SheetObject_PublicAPI"}get props(){return B(this).propsP}get sheet(){return B(this).sheet.publicApi}get project(){return B(this).sheet.project.publicApi}get address(){return b({},B(this).address)}_valuesPrism(){return this._cache.get("_valuesPrism",()=>{let e=B(this);return(0,e3.prism)(()=>(0,e3.val)(e.getValues().getValue()))})}onValuesChange(e,t){return o9(this._valuesPrism(),e,t)}get value(){let e=this._valuesPrism();if(!e.isHot){null!=this._keepHotUntapDebounce&&this._keepHotUntapDebounce.flush();let t=e.keepHot();this._keepHotUntapDebounce=nj(()=>{t(),this._keepHotUntapDebounce=void 0},5e3)}return this._keepHotUntapDebounce&&this._keepHotUntapDebounce(),e.getValue()}set initialValue(e){B(this).setInitialValue(e)}};function nK(e){let t=new WeakMap;return r=>(t.has(r)||t.set(r,e(r)),t.get(r))}function nW(e){return"compound"===e.type||"enum"===e.type}function nH(e,t){if(!e)return;let[r,...n]=t;return void 0===r?e:nW(e)?nH("enum"===e.type?e.cases[r]:e.props[r],n):void 0}var nG=nK(e=>{if("enum"===e.type)throw Error("Not implemented yet for enums");for(let t in e.props){let r=e.props[t];if(!nW(r)||nG(r))return!0}return!1}),nJ=class{constructor(e,t,r){this.sheet=e,this.template=t,this.nativeObject=r,P(this,"$$isPointerToPrismProvider",!0),P(this,"address"),P(this,"publicApi"),P(this,"_initialValue",new e5.Atom({})),P(this,"_cache",new eN),P(this,"_logger"),P(this,"_internalUtilCtx"),this._logger=e._logger.named("SheetObject",t.address.objectKey),this._logger._trace("creating object"),this._internalUtilCtx={logger:this._logger.utilFor.internal()},this.address=v(b({},t.address),{sheetInstanceId:e.address.sheetInstanceId}),this.publicApi=new n$(this)}get type(){return"Theatre_SheetObject"}getValues(){return this._cache.get("getValues()",()=>(0,e5.prism)(()=>{let e=(0,e5.val)(this.template.getDefaultValues()),t=e1(e,(0,e5.val)(this._initialValue.pointer),e5.prism.memo("withInitialCache",()=>new WeakMap,[])),r=e1(t,(0,e5.val)(this.template.getStaticValues()),e5.prism.memo("withStatics",()=>new WeakMap,[]));{let e=e5.prism.memo("seq",()=>this.getSequencedValues(),[]),t=e5.prism.memo("withSeqsCache",()=>new WeakMap,[]);r=e1(r,(0,e5.val)((0,e5.val)(e)),t)}return((e,t)=>{let r=e6.prism.memo(e,()=>new e6.Atom(t),[]);return r.set(t),r})("finalAtom",r).pointer}))}getValueByPointer(e){let t=(0,e5.val)(this.getValues()),{path:r}=(0,e5.getPointerParts)(e);return(0,e5.val)(e2(t,r))}pointerToPrism(e){let{path:t}=(0,e5.getPointerParts)(e);return(0,e5.prism)(()=>{let e=(0,e5.val)(this.getValues());return(0,e5.val)(e2(e,t))})}getSequencedValues(){return(0,e5.prism)(()=>{let e=e5.prism.memo("tracksToProcess",()=>this.template.getArrayOfValidSequenceTracks(),[]),t=(0,e5.val)(e),r=new e5.Atom({}),n=(0,e5.val)(this.template.configPointer);return e5.prism.effect("processTracks",()=>{let e=[];for(let{trackId:i,pathToProp:o}of t){let t=this._trackIdToPrism(i),a=nH(n,o),s=a.deserializeAndSanitize,u=a.interpolate,l=()=>{let e=t.getValue();if(!e)return r.setByPointer(e=>e2(e,o),void 0);let n=s(e.left),i=void 0===n?a.default:n;if(void 0===e.right)return r.setByPointer(e=>e2(e,o),i);let l=s(e.right),c=void 0===l?a.default:l;return r.setByPointer(e=>e2(e,o),u(i,c,e.progression))},c=t.onStale(l);l(),e.push(c)}return()=>{for(let t of e)t()}},[n,...t]),r.pointer})}_trackIdToPrism(e){var t;let r=this.template.project.pointers.historic.sheetsById[this.address.sheetId].sequence.tracksByObject[this.address.objectKey].trackData[e],n=this.sheet.getSequence().positionPrism;return t=this._internalUtilCtx,(0,eY.prism)(()=>{let e=(0,eY.val)(r);return eY.prism.memo("driver",()=>{var r,i,o;return e?"BasicKeyframedTrack"===e.type?(r=t,i=e,o=n,(0,eY.prism)(()=>{let e=eY.prism.ref("state",{started:!1}),t=e.current,r=o.getValue();return(!t.started||r<t.validFrom||t.validTo<=r)&&(e.current=t=function(e,t,r){let n=t.getValue();if(0===r.keyframes.length)return{started:!0,validFrom:-1/0,validTo:1/0,der:eZ};let i=0;for(;;){let e=r.keyframes[i];if(!e)return e0.error;let o=i===r.keyframes.length-1;if(n<e.position)if(0===i)return e0.beforeFirstKeyframe(e);else return e0.error;if(e.position===n)if(o)return e0.lastKeyframe(e);else return e0.between(e,r.keyframes[i+1],t);{if(i===r.keyframes.length-1)return e0.lastKeyframe(e);let o=i+1;if(!(r.keyframes[o].position<=n))return e0.between(e,r.keyframes[i+1],t);i=o;continue}}}(0,o,i)),t.der.getValue()})):(t.logger.error("Track type not yet supported."),(0,eY.prism)(()=>void 0)):(0,eY.prism)(()=>void 0)},[e]).getValue()})}get propsP(){return this._cache.get("propsP",()=>(0,e5.pointer)({root:this,path:[]}))}validateValue(e,t){}setInitialValue(e){this.validateValue(this.propsP,e),this._initialValue.set(e)}};function nX(e){return function(t,r){return e(t,r())}}var nY={_hmm:nQ(524),_todo:nQ(522),_error:nQ(521),errorDev:nQ(529),errorPublic:nQ(545),_kapow:nQ(268),_warn:nQ(265),warnDev:nQ(273),warnPublic:nQ(289),_debug:nQ(137),debugDev:nQ(145),_trace:nQ(73),traceDev:nQ(81)};function nQ(e){return Object.freeze({audience:(8&e)==8?"internal":(16&e)==16?"dev":"public",category:(4&e)==4?"troubleshooting":(2&e)==2?"todo":"general",level:(512&e)==512?512:(256&e)==256?256:(128&e)==128?128:64})}function nZ(e,t){return((32&t)==32||((16&t)==16?e.dev:(8&t)==8&&e.internal))&&e.min<=t}var n0={loggingConsoleStyle:!0,loggerConsoleStyle:!0,includes:Object.freeze({internal:!1,dev:!1,min:256}),filtered:function(){},include:function(){return{}},create:null,creatExt:null,named(e,t,r){return this.create({names:[...e.names,{name:t,key:r}]})},style:{bold:void 0,italic:void 0,cssMemo:new Map([["",""]]),collapseOnRE:/[a-z- ]+/g,color:void 0,collapsed(e){if(e.length<5)return e;let t=e.replace(this.collapseOnRE,"");return this.cssMemo.has(t)||this.cssMemo.set(t,this.css(e)),t},css(e){var t,r,n,i;let o=this.cssMemo.get(e);if(o)return o;let a="color:".concat(null!=(r=null==(t=this.color)?void 0:t.call(this,e))?r:"hsl(".concat((e.charCodeAt(0)+e.charCodeAt(e.length-1))%360,", 100%, 60%)"));return(null==(n=this.bold)?void 0:n.test(e))&&(a+=";font-weight:600"),(null==(i=this.italic)?void 0:i.test(e))&&(a+=";font-style:italic"),this.cssMemo.set(e,a),a}}};function n1(e=console,t={}){let r=v(b({},n0),{includes:b({},n0.includes)}),n={styled:n5.bind(r,e),noStyle:n3.bind(r,e)},i=n6.bind(r);function o(){return r.loggingConsoleStyle&&r.loggerConsoleStyle?n.styled:n.noStyle}return r.create=o(),{configureLogger(e){var t;"console"===e?(r.loggerConsoleStyle=n0.loggerConsoleStyle,r.create=o()):"console"===e.type?(r.loggerConsoleStyle=null!=(t=e.style)?t:n0.loggerConsoleStyle,r.create=o()):"keyed"===e.type?(r.creatExt=t=>e.keyed(t.names),r.create=i):"named"===e.type&&(r.creatExt=n2.bind(null,e.named),r.create=i)},configureLogging(e){var t,n,i,a,s;r.includes.dev=null!=(t=e.dev)?t:n0.includes.dev,r.includes.internal=null!=(n=e.internal)?n:n0.includes.internal,r.includes.min=null!=(i=e.min)?i:n0.includes.min,r.include=null!=(a=e.include)?a:n0.include,r.loggingConsoleStyle=null!=(s=e.consoleStyle)?s:n0.loggingConsoleStyle,r.create=o()},getLogger:()=>r.create({names:[]})}}function n2(e,t){let r=[];for(let{name:e,key:n}of t.names)r.push(null==n?e:"".concat(e," (").concat(n,")"));return e(r)}function n6(e){let t=b(b({},this.includes),this.include(e)),r=this.filtered,n=this.named.bind(this,e),i=this.creatExt(e),o=nZ(t,524),a=nZ(t,522),s=nZ(t,521),u=nZ(t,529),l=nZ(t,545),c=nZ(t,265),f=nZ(t,268),h=nZ(t,273),p=nZ(t,289),d=nZ(t,137),g=nZ(t,145),y=nZ(t,73),v=nZ(t,81),_=o?i.error.bind(i,nY._hmm):r.bind(e,524),m=a?i.error.bind(i,nY._todo):r.bind(e,522),j=s?i.error.bind(i,nY._error):r.bind(e,521),w=u?i.error.bind(i,nY.errorDev):r.bind(e,529),P=l?i.error.bind(i,nY.errorPublic):r.bind(e,545),O=f?i.warn.bind(i,nY._kapow):r.bind(e,268),S=c?i.warn.bind(i,nY._warn):r.bind(e,265),T=h?i.warn.bind(i,nY.warnDev):r.bind(e,273),A=p?i.warn.bind(i,nY.warnPublic):r.bind(e,273),k=d?i.debug.bind(i,nY._debug):r.bind(e,137),x=g?i.debug.bind(i,nY.debugDev):r.bind(e,145),D=y?i.trace.bind(i,nY._trace):r.bind(e,73),C=v?i.trace.bind(i,nY.traceDev):r.bind(e,81),I={_hmm:_,_todo:m,_error:j,errorDev:w,errorPublic:P,_kapow:O,_warn:S,warnDev:T,warnPublic:A,_debug:k,debugDev:x,_trace:D,traceDev:C,lazy:{_hmm:o?nX(_):_,_todo:a?nX(m):m,_error:s?nX(j):j,errorDev:u?nX(w):w,errorPublic:l?nX(P):P,_kapow:f?nX(O):O,_warn:c?nX(S):S,warnDev:h?nX(T):T,warnPublic:p?nX(A):A,_debug:d?nX(k):k,debugDev:g?nX(x):x,_trace:y?nX(D):D,traceDev:v?nX(C):C},named:n,utilFor:{internal:()=>({debug:I._debug,error:I._error,warn:I._warn,trace:I._trace,named:(e,t)=>I.named(e,t).utilFor.internal()}),dev:()=>({debug:I.debugDev,error:I.errorDev,warn:I.warnDev,trace:I.traceDev,named:(e,t)=>I.named(e,t).utilFor.dev()}),public:()=>({error:I.errorPublic,warn:I.warnPublic,debug(e,t){I._warn('(public "debug" filtered out) '.concat(e),t)},trace(e,t){I._warn('(public "trace" filtered out) '.concat(e),t)},named:(e,t)=>I.named(e,t).utilFor.public()})}};return I}function n5(e,t){let r=b(b({},this.includes),this.include(t)),n=[],i="";for(let e=0;e<t.names.length;e++){let{name:r,key:o}=t.names[e];if(i+=" %c".concat(r),n.push(this.style.css(r)),null!=o){let e="%c#".concat(o);i+=e,n.push(this.style.css(e))}}let o=this.filtered,a=this.named.bind(this,t),s=[i,...n];return n8(o,t,r,e,s,function(e){let t=e.slice(0);for(let e=1;e<t.length;e++)t[e]+=";background-color:#e0005a;padding:2px;color:white";return t}(s),a)}function n3(e,t){let r=b(b({},this.includes),this.include(t)),n="";for(let e=0;e<t.names.length;e++){let{name:r,key:i}=t.names[e];n+=" ".concat(r),null!=i&&(n+="#".concat(i))}let i=this.filtered,o=this.named.bind(this,t),a=[n];return n8(i,t,r,e,a,a,o)}function n8(e,t,r,n,i,o,a){let s=nZ(r,524),u=nZ(r,522),l=nZ(r,521),c=nZ(r,529),f=nZ(r,545),h=nZ(r,265),p=nZ(r,268),d=nZ(r,273),g=nZ(r,289),y=nZ(r,137),b=nZ(r,145),v=nZ(r,73),_=nZ(r,81),m=s?n.error.bind(n,...i):e.bind(t,524),j=u?n.error.bind(n,...i):e.bind(t,522),w=l?n.error.bind(n,...i):e.bind(t,521),P=c?n.error.bind(n,...i):e.bind(t,529),O=f?n.error.bind(n,...i):e.bind(t,545),S=p?n.warn.bind(n,...o):e.bind(t,268),T=h?n.warn.bind(n,...i):e.bind(t,265),A=d?n.warn.bind(n,...i):e.bind(t,273),k=g?n.warn.bind(n,...i):e.bind(t,273),x=y?n.info.bind(n,...i):e.bind(t,137),D=b?n.info.bind(n,...i):e.bind(t,145),C=v?n.debug.bind(n,...i):e.bind(t,73),I=_?n.debug.bind(n,...i):e.bind(t,81),B={_hmm:m,_todo:j,_error:w,errorDev:P,errorPublic:O,_kapow:S,_warn:T,warnDev:A,warnPublic:k,_debug:x,debugDev:D,_trace:C,traceDev:I,lazy:{_hmm:s?nX(m):m,_todo:u?nX(j):j,_error:l?nX(w):w,errorDev:c?nX(P):P,errorPublic:f?nX(O):O,_kapow:p?nX(S):S,_warn:h?nX(T):T,warnDev:d?nX(A):A,warnPublic:g?nX(k):k,_debug:y?nX(x):x,debugDev:b?nX(D):D,_trace:v?nX(C):C,traceDev:_?nX(I):I},named:a,utilFor:{internal:()=>({debug:B._debug,error:B._error,warn:B._warn,trace:B._trace,named:(e,t)=>B.named(e,t).utilFor.internal()}),dev:()=>({debug:B.debugDev,error:B.errorDev,warn:B.warnDev,trace:B.traceDev,named:(e,t)=>B.named(e,t).utilFor.dev()}),public:()=>({error:B.errorPublic,warn:B.warnPublic,debug(e,t){B._warn('(public "debug" filtered out) '.concat(e),t)},trace(e,t){B._warn('(public "trace" filtered out) '.concat(e),t)},named:(e,t)=>B.named(e,t).utilFor.public()})}};return B}var n4=n1(console,{_debug:function(){},_error:function(){}});n4.configureLogging({dev:!0,min:64});var n7=n4.getLogger().named("Theatre.js (default logger)").utilFor.dev(),n9=new WeakMap;function ie(e,t,r){for(let[n,i]of Object.entries(t.props))if(!nW(i)){let t=[...e,n];r.set(JSON.stringify(t),r.size),it(t,i,r)}for(let[n,i]of Object.entries(t.props))if(nW(i)){let t=[...e,n];r.set(JSON.stringify(t),r.size),it(t,i,r)}}function it(e,t,r){if("compound"===t.type)ie(e,t,r);else if("enum"===t.type)throw Error("Enums aren't supported yet");else r.set(JSON.stringify(e),r.size)}function ir(e){return"object"==typeof e&&null!==e&&0===Object.keys(e).length}var ii=class{constructor(e,t,r,n,i){this.sheetTemplate=e,P(this,"address"),P(this,"type","Theatre_SheetObjectTemplate"),P(this,"_config"),P(this,"_temp_actions_atom"),P(this,"_cache",new eN),P(this,"project"),P(this,"pointerToSheetState"),P(this,"pointerToStaticOverrides"),this.address=v(b({},e.address),{objectKey:t}),this._config=new eq.Atom(n),this._temp_actions_atom=new eq.Atom(i),this.project=e.project,this.pointerToSheetState=this.sheetTemplate.project.pointers.historic.sheetsById[this.address.sheetId],this.pointerToStaticOverrides=this.pointerToSheetState.staticOverrides.byObject[this.address.objectKey]}get staticConfig(){return this._config.get()}get configPointer(){return this._config.pointer}get _temp_actions(){return this._temp_actions_atom.get()}get _temp_actionsPointer(){return this._temp_actions_atom.pointer}createInstance(e,t,r){return this._config.set(r),new nJ(e,this,t)}reconfigure(e){this._config.set(e)}_temp_setActions(e){this._temp_actions_atom.set(e)}getDefaultValues(){return this._cache.get("getDefaultValues()",()=>(0,eq.prism)(()=>(function e(t){if(eX.has(t))return eX.get(t);let r="compound"===t.type?function(t){let r={};for(let[n,i]of Object.entries(t.props))r[n]=e(i);return r}(t):"enum"===t.type?function(t){let r={$case:t.defaultCase};for(let[n,i]of Object.entries(t.cases))r[n]=e(i);return r}(t):t.default;return eX.set(t,r),r})((0,eq.val)(this.configPointer))))}getStaticValues(){return this._cache.get("getStaticValues",()=>(0,eq.prism)(()=>{var e;let t=null!=(e=(0,eq.val)(this.pointerToStaticOverrides))?e:{};return(0,eq.val)(this.configPointer).deserializeAndSanitize(t)||{}}))}getArrayOfValidSequenceTracks(){return this._cache.get("getArrayOfValidSequenceTracks",()=>(0,eq.prism)(()=>{let e=this.project.pointers.historic.sheetsById[this.address.sheetId],t=(0,eq.val)(e.sequence.tracksByObject[this.address.objectKey].trackIdByPropPath);if(!t)return M;let r=[];if(!t)return M;let n=(0,eq.val)(this.configPointer);for(let[e,i]of Object.entries(t)){let t=function(e){try{return JSON.parse(e)}catch(t){n7.warn("property ".concat(JSON.stringify(e)," cannot be parsed. Skipping."));return}}(e);if(!t)continue;let o=nH(n,t);o&&!nW(o)&&r.push({pathToProp:t,trackId:i})}let i=function(e){let t=n9.get(e);if(t)return t;let r=new Map;return n9.set(e,r),ie([],e,r),r}(n);return(r.sort((e,t)=>{let r=e.pathToProp,n=t.pathToProp;return i.get(JSON.stringify(r))>i.get(JSON.stringify(n))?1:-1}),0===r.length)?M:r}))}getMapOfValidSequenceTracks_forStudio(){return this._cache.get("getMapOfValidSequenceTracks_forStudio",()=>(0,eq.prism)(()=>{let e=(0,eq.val)(this.getArrayOfValidSequenceTracks()),t={};for(let{pathToProp:r,trackId:n}of e)null==t||eJ(t,r,n);return t}))}getStaticButNotSequencedOverrides(){return this._cache.get("getStaticButNotSequencedOverrides",()=>(0,eq.prism)(()=>{let e=(0,eq.val)(this.getStaticValues()),t=(0,eq.val)(this.getArrayOfValidSequenceTracks()),r=r0(e,5);for(let{pathToProp:e}of t){nL(r,e);let t=e.slice(0,-1);for(;t.length>0&&ir(eR(r,t));)nL(r,t),t=t.slice(0,-1)}if(!ir(r))return r}))}getDefaultsAtPointer(e){let{path:t}=(0,eq.getPointerParts)(e);return eR(this.getDefaultValues().getValue(),t)}},io=r(62006),ia=nK(e=>JSON.stringify(e));w(T());var is=class extends Error{},iu=class extends is{},il=r(62006),ic=r(62006),ih=r(62006),ip=r(62006);function id(){let e,t,r=new Promise((r,i)=>{e=e=>{r(e),n.status="resolved"},t=e=>{i(e),n.status="rejected"}}),n={resolve:e,reject:t,promise:r,status:"pending"};return n}var ig=()=>{},iy=r(62006),ib=class{constructor(){P(this,"_stopPlayCallback",ig),P(this,"_state",new iy.Atom({position:0,playing:!1})),P(this,"statePointer"),this.statePointer=this._state.pointer}destroy(){}pause(){this._stopPlayCallback(),this.playing=!1,this._stopPlayCallback=ig}gotoPosition(e){this._updatePositionInState(e)}_updatePositionInState(e){this._state.setByPointer(e=>e.position,e)}getCurrentPosition(){return this._state.get().position}get playing(){return this._state.get().playing}set playing(e){this._state.setByPointer(e=>e.playing,e)}play(e,t,r,n,i){this.playing&&this.pause(),this.playing=!0;let o=t[1]-t[0];{let e=this.getCurrentPosition();e<t[0]||e>t[1]?"normal"===n||"alternate"===n?this._updatePositionInState(t[0]):("reverse"===n||"alternateReverse"===n)&&this._updatePositionInState(t[1]):"normal"===n||"alternate"===n?e===t[1]&&this._updatePositionInState(t[0]):e===t[0]&&this._updatePositionInState(t[1])}let a=id(),s=i.time,u=o*e,l=this.getCurrentPosition()-t[0];("reverse"===n||"alternateReverse"===n)&&(l=t[1]-this.getCurrentPosition());let c=i=>{let c=Math.min(Math.max(i-s,0)/1e3*r+l,u);if(c!==u){let e=Math.floor(c/o),r=c/o%1*o;if("normal"!==n)if("reverse"===n)r=o-r;else{let t=e%2==0;"alternate"===n?t||(r=o-r):t&&(r=o-r)}this._updatePositionInState(r+t[0]),f()}else{if("normal"===n)this._updatePositionInState(t[1]);else if("reverse"===n)this._updatePositionInState(t[0]);else{let r=(e-1)%2==0;"alternate"===n?r?this._updatePositionInState(t[1]):this._updatePositionInState(t[0]):r?this._updatePositionInState(t[0]):this._updatePositionInState(t[1])}this.playing=!1,a.resolve(!0)}};this._stopPlayCallback=()=>{i.offThisOrNextTick(c),i.offNextTick(c),this.playing&&a.resolve(!1)};let f=()=>i.onNextTick(c);return i.onThisOrNextTick(c),a.promise}playDynamicRange(e,t){this.playing&&this.pause(),this.playing=!0;let r=id(),n=e.keepHot();r.promise.then(n,n);let i=t.time,o=t=>{let r=Math.max(t-i,0);i=t;let n=this.getCurrentPosition(),o=e.getValue();if(n<o[0]||n>o[1])this.gotoPosition(o[0]);else{let e=n+r/1e3;e>o[1]&&(e=o[0]+(e-o[1])),this.gotoPosition(e)}a()};this._stopPlayCallback=()=>{t.offThisOrNextTick(o),t.offNextTick(o),r.resolve(!1)};let a=()=>t.onNextTick(o);return t.onThisOrNextTick(o),r.promise}},iv=r(62006),i_="__TheatreJS_CoreBundle",im=e=>(...t)=>{var r;switch(e){case"success":case"info":n7.debug(t.slice(0,2).join("\n"));break;case"warning":n7.warn(t.slice(0,2).join("\n"))}return"undefined"!=typeof window?null==(r=window.__TheatreJS_Notifications)?void 0:r.notify[e](...t):void 0},ij={warning:im("warning"),success:im("success"),info:im("info"),error:im("error")};"undefined"!=typeof window&&(window.addEventListener("error",e=>{ij.error("An error occurred","<pre>".concat(e.message,"</pre>\n\nSee **console** for details."))}),window.addEventListener("unhandledrejection",e=>{ij.error("An error occurred","<pre>".concat(e.reason,"</pre>\n\nSee **console** for details."))}));var iw=class{constructor(e,t,r){this._decodedBuffer=e,this._audioContext=t,this._nodeDestination=r,P(this,"_mainGain"),P(this,"_state",new iv.Atom({position:0,playing:!1})),P(this,"statePointer"),P(this,"_stopPlayCallback",ig),this.statePointer=this._state.pointer,this._mainGain=this._audioContext.createGain(),this._mainGain.connect(this._nodeDestination)}playDynamicRange(e,t){let r,n=id();this._playing&&this.pause(),this._playing=!0;let i=()=>{null==r||r(),r=this._loopInRange(e.getValue(),t).stop},o=e.onStale(i);return i(),this._stopPlayCallback=()=>{null==r||r(),o(),n.resolve(!1)},n.promise}_loopInRange(e,t){let r=this.getCurrentPosition(),n=e[1]-e[0];r<e[0]||r>e[1]?this._updatePositionInState(e[0]):r===e[1]&&this._updatePositionInState(e[0]),r=this.getCurrentPosition();let i=this._audioContext.createBufferSource();i.buffer=this._decodedBuffer,i.connect(this._mainGain),i.playbackRate.value=1,i.loop=!0,i.loopStart=e[0],i.loopEnd=e[1];let o=t.time,a=r-e[0];i.start(0,r);let s=t=>{let r=(Math.max(t-o,0)/1e3*1+a)/n%1*n;this._updatePositionInState(r+e[0]),u()},u=()=>t.onNextTick(s);return t.onThisOrNextTick(s),{stop:()=>{i.stop(),i.disconnect(),t.offThisOrNextTick(s),t.offNextTick(s)}}}get _playing(){return this._state.get().playing}set _playing(e){this._state.setByPointer(e=>e.playing,e)}destroy(){}pause(){this._stopPlayCallback(),this._playing=!1,this._stopPlayCallback=ig}gotoPosition(e){this._updatePositionInState(e)}_updatePositionInState(e){this._state.reduce(t=>v(b({},t),{position:e}))}getCurrentPosition(){return this._state.get().position}play(e,t,r,n,i){this._playing&&this.pause(),this._playing=!0;let o=this.getCurrentPosition(),a=t[1]-t[0];if("normal"!==n)throw new iu('Audio-controlled sequences can only be played in the "normal" direction. '+"'".concat(n,"' given."));o<t[0]||o>t[1]?this._updatePositionInState(t[0]):o===t[1]&&this._updatePositionInState(t[0]),o=this.getCurrentPosition();let s=id(),u=this._audioContext.createBufferSource();u.buffer=this._decodedBuffer,u.connect(this._mainGain),u.playbackRate.value=r,e>1e3&&(ij.warning("Can't play sequences with audio more than 1000 times","The sequence will still play, but only 1000 times. The `iterationCount: ".concat(e,"` provided to `sequence.play()`\nis too high for a sequence with audio.\n\nTo fix this, either set `iterationCount` to a lower value, or remove the audio from the sequence."),[{url:"https://www.theatrejs.com/docs/latest/manual/audio",title:"Using Audio"},{url:"https://www.theatrejs.com/docs/latest/api/core#sequence.attachaudio",title:"Audio API"}]),e=1e3),e>1&&(u.loop=!0,u.loopStart=t[0],u.loopEnd=t[1]);let l=i.time,c=o-t[0],f=a*e;u.start(0,o,f-c);let h=e=>{let n=Math.min(Math.max(e-l,0)/1e3*r+c,f);n!==f?(this._updatePositionInState(n/a%1*a+t[0]),d()):(this._updatePositionInState(t[1]),this._playing=!1,p(),s.resolve(!0))},p=()=>{u.stop(),u.disconnect()};this._stopPlayCallback=()=>{p(),i.offThisOrNextTick(h),i.offNextTick(h),this._playing&&s.resolve(!1)};let d=()=>i.onNextTick(h);return i.onThisOrNextTick(h),s.promise}},iP=r(62006),iO=0;function iS(e){var t;let r=new iP.Ticker({onActive(){var t;null==(t=null==e?void 0:e.start)||t.call(e)},onDormant(){var t;null==(t=null==e?void 0:e.stop)||t.call(e)}}),n={tick:e=>{r.tick(e)},id:iO++,name:null!=(t=null==e?void 0:e.name)?t:"CustomRafDriver-".concat(iO),type:"Theatre_RafDriver_PublicAPI"},i={type:"Theatre_RafDriver_PrivateAPI",publicApi:n,ticker:r,start:null==e?void 0:e.start,stop:null==e?void 0:e.stop};return E(n,i),n}function iT(){return n||function(e){if(n)throw Error("`setCoreRafDriver()` is already called.");n=B(e)}(function(){let e=null,t=iS({name:"DefaultCoreRafDriver",start:()=>{if("undefined"!=typeof window){let r=n=>{t.tick(n),e=window.requestAnimationFrame(r)};e=window.requestAnimationFrame(r)}else t.tick(0),setTimeout(()=>t.tick(1),0)},stop:()=>{"undefined"!=typeof window&&null!==e&&window.cancelAnimationFrame(e)}});return t}()),n}function iA(){return iT().ticker}var ik=class{get type(){return"Theatre_Sequence_PublicAPI"}constructor(e){E(this,e)}play(e){let t=B(this);if(t._project.isReady()){let r=(null==e?void 0:e.rafDriver)?B(e.rafDriver).ticker:iA();return t.play(null!=e?e:{},r)}{let e=id();return e.resolve(!0),e.promise}}pause(){B(this).pause()}get position(){return B(this).position}set position(e){B(this).position=e}__experimental_getKeyframes(e){return B(this).getKeyframesOfSimpleProp(e)}async attachAudio(e){let{audioContext:t,destinationNode:r,decodedBuffer:n,gainNode:i}=await ix(e),o=new iw(n,t,i);return B(this).replacePlaybackController(o),{audioContext:t,destinationNode:r,decodedBuffer:n,gainNode:i}}get pointer(){return B(this).pointer}};async function ix(e){async function t(){let t,n,i;if(e.source instanceof AudioBuffer)return e.source;let o=id();if("string"!=typeof e.source)throw Error("Error validating arguments to sequence.attachAudio(). args.source must either be a string or an instance of AudioBuffer.");try{t=await fetch(e.source)}catch(t){throw console.error(t),Error("Could not fetch '".concat(e.source,"'. Network error logged above."))}try{n=await t.arrayBuffer()}catch(t){throw console.error(t),Error("Could not read '".concat(e.source,"' as an arrayBuffer."))}(await r).decodeAudioData(n,o.resolve,o.reject);try{i=await o.promise}catch(t){throw console.error(t),Error("Could not decode ".concat(e.source," as an audio file."))}return i}let r=function(){if(e.audioContext)return Promise.resolve(e.audioContext);let t=new AudioContext;return"running"===t.state||"undefined"==typeof window?Promise.resolve(t):new Promise(e=>{let r=()=>{t.resume().catch(e=>{console.error(e)})},n=["mousedown","keydown","touchstart"],i={capture:!0,passive:!1};n.forEach(e=>{window.addEventListener(e,r,i)}),t.addEventListener("statechange",()=>{"running"===t.state&&(n.forEach(e=>{window.removeEventListener(e,r,i)}),e(t))})})}(),n=t(),[i,o]=await Promise.all([r,n]),a=e.destinationNode||i.destination,s=i.createGain();return s.connect(a),{audioContext:i,decodedBuffer:o,gainNode:s,destinationNode:a}}iC("Theatre_Project"),iC("Theatre_Sheet"),iC("Theatre_SheetTemplate");var iD=iC("Theatre_SheetObject");function iC(e){return t=>"object"==typeof t&&!!t&&t.type===e}iC("Theatre_Sequence"),iC("Theatre_SheetObjectTemplate"),iC("Theatre_Project_PublicAPI"),iC("Theatre_Sheet_PublicAPI"),iC("Theatre_SheetObject_PublicAPI");var iI=class{constructor(e,t,r,n,i){this._project=e,this._sheet=t,this._lengthD=r,this._subUnitsPerUnitD=n,P(this,"address"),P(this,"publicApi"),P(this,"_playbackControllerBox"),P(this,"_prismOfStatePointer"),P(this,"_positionD"),P(this,"_positionFormatterD"),P(this,"_playableRangeD"),P(this,"pointer",(0,ih.pointer)({root:this,path:[]})),P(this,"$$isPointerToPrismProvider",!0),P(this,"_logger"),P(this,"closestGridPosition",e=>{let t=1/this.subUnitsPerUnit;return parseFloat((Math.round(e/t)*t).toFixed(3))}),this._logger=e._logger.named("Sheet",t.address.sheetId).named("Instance",t.address.sheetInstanceId),this.address=v(b({},this._sheet.address),{sequenceName:"default"}),this.publicApi=new ik(this),this._playbackControllerBox=new ic.Atom(null!=i?i:new ib),this._prismOfStatePointer=(0,ip.prism)(()=>this._playbackControllerBox.prism.getValue().statePointer),this._positionD=(0,ip.prism)(()=>{let e=this._prismOfStatePointer.getValue();return(0,ip.val)(e.position)}),this._positionFormatterD=(0,ip.prism)(()=>new iB((0,ip.val)(this._subUnitsPerUnitD)))}get type(){return"Theatre_Sequence"}pointerToPrism(e){let{path:t}=(0,il.getPointerParts)(e);if(0===t.length)return(0,ip.prism)(()=>({length:(0,ip.val)(this.pointer.length),playing:(0,ip.val)(this.pointer.playing),position:(0,ip.val)(this.pointer.position),subUnitsPerUnit:(0,ip.val)(this.pointer.subUnitsPerUnit)}));if(t.length>1)return(0,ip.prism)(()=>void 0);let[r]=t;return"length"===r?this._lengthD:"subUnitsPerUnit"===r?this._subUnitsPerUnitD:"position"===r?this._positionD:"playing"===r?(0,ip.prism)(()=>(0,ip.val)(this._prismOfStatePointer.getValue().playing)):(0,ip.prism)(()=>void 0)}getKeyframesOfSimpleProp(e){let{path:t,root:r}=(0,il.getPointerParts)(e);if(!iD(r))throw new iu("Argument prop must be a pointer to a SheetObject property");let n=(0,ip.val)(this._project.pointers.historic.sheetsById[this._sheet.address.sheetId].sequence.tracksByObject[r.address.objectKey]);if(!n)return[];let{trackData:i,trackIdByPropPath:o}=n,a=o[ia(t)];if(!a)return[];let s=i[a];return s?s.keyframes:[]}get positionFormatter(){return this._positionFormatterD.getValue()}get prismOfStatePointer(){return this._prismOfStatePointer}get length(){return this._lengthD.getValue()}get positionPrism(){return this._positionD}get position(){return this._playbackControllerBox.get().getCurrentPosition()}get subUnitsPerUnit(){return this._subUnitsPerUnitD.getValue()}get positionSnappedToGrid(){return this.closestGridPosition(this.position)}set position(e){let t=e;this.pause(),t>this.length&&(t=this.length);let r=this.length;this._playbackControllerBox.get().gotoPosition(t>r?r:t)}getDurationCold(){return this._lengthD.getValue()}get playing(){return(0,ip.val)(this._playbackControllerBox.get().statePointer.playing)}_makeRangeFromSequenceTemplate(){return(0,ip.prism)(()=>[0,(0,ip.val)(this._lengthD)])}playDynamicRange(e,t){return this._playbackControllerBox.get().playDynamicRange(e,t)}async play(e,t){let r=this.length,n=e&&e.range?e.range:[0,r],i=e&&"number"==typeof e.iterationCount?e.iterationCount:1,o=e&&void 0!==e.rate?e.rate:1,a=e&&e.direction?e.direction:"normal";return await this._play(i,[n[0],n[1]],o,a,t)}_play(e,t,r,n,i){return this._playbackControllerBox.get().play(e,t,r,n,i)}pause(){this._playbackControllerBox.get().pause()}replacePlaybackController(e){this.pause();let t=this._playbackControllerBox.get();this._playbackControllerBox.set(e);let r=t.getCurrentPosition();t.destroy(),e.gotoPosition(r)}},iB=class{constructor(e){this._fps=e}formatSubUnitForGrid(e){return Math.round(e%1/(1/this._fps))+"f"}formatFullUnitForGrid(e){let t=e,r="";t>=iF&&(r+=Math.floor(t/iF)+"h",t%=iF),t>=iM&&(r+=Math.floor(t/iM)+"m",t%=iM),t>=iE&&(r+=Math.floor(t/iE)+"s",t%=iE);let n=1/this._fps;return t>=n&&(r+=Math.floor(t/n)+"f",t%=n),0===r.length?"0s":r}formatForPlayhead(e){let t=e,r="";t>=iF&&(r+=nq(Math.floor(t/iF).toString(),2,"0")+"h",t%=iF),t>=iM?(r+=nq(Math.floor(t/iM).toString(),2,"0")+"m",t%=iM):r.length>0&&(r+="00m"),t>=iE?(r+=nq(Math.floor(t/iE).toString(),2,"0")+"s",t%=iE):r+="00s";let n=1/this._fps;return t>=n?(r+=nq(Math.round(t/n).toString(),2,"0")+"f",t%=n):t/n>.98?(r+=nq("1",2,"0")+"f",t%=n):r+="00f",0===r.length?"00s00f":r}formatBasic(e){return e.toFixed(2)+"s"}},iE=1,iM=60,iF=3600,iV={};function iz(e,t){return e.length<=t?e:e.substr(0,t-3)+"..."}m(iV,{boolean:()=>i6,compound:()=>iK,file:()=>iW,image:()=>iG,number:()=>iX,rgba:()=>i0,string:()=>i8,stringLiteral:()=>i7});var iU=e=>{if("string"==typeof e)return'string("'.concat(iz(e,10),'")');if("number"==typeof e)return"number(".concat(iz(String(e),10),")");if(null===e)return"null";if(void 0===e)return"undefined";if("boolean"==typeof e)return String(e);else if(Array.isArray(e))return"array";else if("object"==typeof e)return"object";else return"unknown"};function iR(e){return v(b({},e),{toString(){return function(e,{removeAlphaIfOpaque:t=!1}={}){let r=(255*e.a|256).toString(16).slice(1),n=(255*e.r|256).toString(16).slice(1)+(255*e.g|256).toString(16).slice(1)+(255*e.b|256).toString(16).slice(1)+(t&&"ff"===r?"":r);return"#".concat(n)}(this,{removeAlphaIfOpaque:!0})}})}function iN(e){function t(e){return e>=.04045?((e+.055)/1.055)**2.4:e/12.92}return{r:t(e.r),g:t(e.g),b:t(e.b),a:e.a}}function iq(e){let t=.4122214708*e.r+.5363325363*e.g+.0514459929*e.b,r=.2119034982*e.r+.6806995451*e.g+.1073969566*e.b,n=.0883024619*e.r+.2817188376*e.g+.6299787005*e.b,i=Math.cbrt(t),o=Math.cbrt(r),a=Math.cbrt(n);return{L:.2104542553*i+.793617785*o-.0040720468*a,a:1.9779984951*i-2.428592205*o+.4505937099*a,b:.0259040371*i+.7827717662*o-.808675766*a,alpha:e.a}}var iL=Symbol("TheatrePropType_Basic");function i$(e){return"object"==typeof e&&!!e&&"TheatrePropType"===e[iL]}var iK=(e,t={})=>{let r=function(e){let t={};for(let r of Object.keys(e)){let n=e[r];i$(n)?t[r]=n:t[r]=function(e){if("number"==typeof e)return iX(e);if("boolean"==typeof e)return i6(e);if("string"==typeof e)return i8(e);if("object"==typeof e&&e){if(i$(e))return e;if(tZ(e))return iK(e);}throw new iu("This value is not a valid prop type: ".concat(iU(e)))}(n)}return t}(e),n=new WeakMap;return{type:"compound",props:r,valueType:null,[iL]:"TheatrePropType",label:t.label,default:nP(r,e=>e.default),deserializeAndSanitize:e=>{if("object"!=typeof e||!e)return;if(n.has(e))return n.get(e);let t={},i=!1;for(let[n,o]of Object.entries(r))if(Object.prototype.hasOwnProperty.call(e,n)){let r=o.deserializeAndSanitize(e[n]);null!=r&&(i=!0,t[n]=r)}if(n.set(e,t),i)return t}}},iW=(e,t={})=>({type:"file",default:{type:"file",id:e},valueType:null,[iL]:"TheatrePropType",label:t.label,interpolate:(e,r,n)=>{var i;return{type:"file",id:(null!=(i=t.interpolate)?i:i3)(e.id,r.id,n)}},deserializeAndSanitize:iH}),iH=e=>{if(!e)return;let t=!0;if("string"==typeof e.id||[null,void 0].includes(e.id)||(t=!1),"file"!==e.type&&(t=!1),t)return e},iG=(e,t={})=>({type:"image",default:{type:"image",id:e},valueType:null,[iL]:"TheatrePropType",label:t.label,interpolate:(e,r,n)=>{var i;return{type:"image",id:(null!=(i=t.interpolate)?i:i3)(e.id,r.id,n)}},deserializeAndSanitize:iJ}),iJ=e=>{if(!e)return;let t=!0;if("string"==typeof e.id||[null,void 0].includes(e.id)||(t=!1),"image"!==e.type&&(t=!1),t)return e},iX=(e,t={})=>{var r;return v(b({type:"number",valueType:0,default:e,[iL]:"TheatrePropType"},t||{}),{label:t.label,nudgeFn:null!=(r=t.nudgeFn)?r:i9,nudgeMultiplier:"number"==typeof t.nudgeMultiplier?t.nudgeMultiplier:void 0,interpolate:iZ,deserializeAndSanitize:iY(t.range)})},iY=e=>e?t=>{if("number"==typeof t&&isFinite(t))return ri(t,e[0],e[1])}:iQ,iQ=e=>"number"==typeof e&&isFinite(e)?e:void 0,iZ=(e,t,r)=>e+r*(t-e),i0=(e={r:0,g:0,b:0,a:1},t={})=>{let r={};for(let t of["r","g","b","a"])r[t]=Math.min(Math.max(e[t],0),1);return{type:"rgba",valueType:null,default:iR(r),[iL]:"TheatrePropType",label:t.label,interpolate:i2,deserializeAndSanitize:i1}},i1=e=>{if(!e)return;let t=!0;for(let r of["r","g","b","a"])Object.prototype.hasOwnProperty.call(e,r)&&"number"==typeof e[r]||(t=!1);if(!t)return;let r={};for(let t of["r","g","b","a"])r[t]=Math.min(Math.max(e[t],0),1);return iR(r)},i2=(e,t,r)=>{let n=iq(iN(e)),i=iq(iN(t));return iR(function(e){function t(e){return e>=.0031308?1.055*e**(1/2.4)-.055:12.92*e}return Object.fromEntries(Object.entries({r:t(e.r),g:t(e.g),b:t(e.b),a:e.a}).map(([e,t])=>[e,ri(t,0,1)]))}(function(e){let t=e.L+.3963377774*e.a+.2158037573*e.b,r=e.L-.1055613458*e.a-.0638541728*e.b,n=e.L-.0894841775*e.a-1.291485548*e.b,i=t*t*t,o=r*r*r,a=n*n*n;return{r:4.0767416621*i-3.3077115913*o+.2309699292*a,g:-1.2684380046*i+2.6097574011*o-.3413193965*a,b:-.0041960863*i-.7034186147*o+1.707614701*a,a:e.alpha}}({L:(1-r)*n.L+r*i.L,a:(1-r)*n.a+r*i.a,b:(1-r)*n.b+r*i.b,alpha:(1-r)*n.alpha+r*i.alpha})))},i6=(e,t={})=>{var r;return{type:"boolean",default:e,valueType:null,[iL]:"TheatrePropType",label:t.label,interpolate:null!=(r=t.interpolate)?r:i3,deserializeAndSanitize:i5}},i5=e=>"boolean"==typeof e?e:void 0;function i3(e){return e}var i8=(e,t={})=>{var r;return{type:"string",default:e,valueType:null,[iL]:"TheatrePropType",label:t.label,interpolate:null!=(r=t.interpolate)?r:i3,deserializeAndSanitize:i4}};function i4(e){return"string"==typeof e?e:void 0}function i7(e,t,r={}){var n,i;return{type:"stringLiteral",default:e,valuesAndLabels:b({},t),[iL]:"TheatrePropType",valueType:null,as:null!=(n=r.as)?n:"menu",label:r.label,interpolate:null!=(i=r.interpolate)?i:i3,deserializeAndSanitize(e){if("string"==typeof e)if(Object.prototype.hasOwnProperty.call(t,e))return e;else return}}}var i9=({config:e,deltaX:t,deltaFraction:r,magnitude:n})=>{var i;let{range:o}=e;return e.nudgeMultiplier||!o||o.includes(1/0)||o.includes(-1/0)?t*n*(null!=(i=e.nudgeMultiplier)?i:1):r*(o[1]-o[0])*n};function oe(e,t){return e.replace(/^[\s\/]*/,"").replace(/[\s\/]*$/,"").replace(/\s*\/\s*/g," / ")}w(A());var ot=class{get type(){return"Theatre_Sheet_PublicAPI"}constructor(e){E(this,e)}object(e,t,r){let n=B(this),i=oe(e,"sheet.object"),o=n.getObject(i),a=null==r?void 0:r.__actions__THIS_API_IS_UNSTABLE_AND_WILL_CHANGE_IN_THE_NEXT_VERSION;if(o)return a&&o.template._temp_setActions(a),o.publicApi;{let e=iK(t);return n.createObject(i,null,e,a).publicApi}}__experimental_getExistingObject(e){let t=B(this),r=oe(e,"sheet.object"),n=t.getObject(r);return null==n?void 0:n.publicApi}get sequence(){return B(this).getSequence().publicApi}get project(){return B(this).project.publicApi}get address(){return b({},B(this).address)}detachObject(e){let t=B(this),r=oe(e,'sheet.deleteObject("'.concat(e,'")'));if(!t.getObject(r)){ij.warning("Couldn't delete object \"".concat(r,'"'),'There is no object with key "'.concat(r,'".\n\nTo fix this, make sure you are calling `sheet.deleteObject("').concat(r,'")` with the correct key.')),console.warn('Object key "'.concat(r,'" does not exist.'));return}t.deleteObject(r)}},or=r(62006),on=class{constructor(e,t){this.template=e,this.instanceId=t,P(this,"_objects",new or.Atom({})),P(this,"_sequence"),P(this,"address"),P(this,"publicApi"),P(this,"project"),P(this,"objectsP",this._objects.pointer),P(this,"type","Theatre_Sheet"),P(this,"_logger"),this._logger=e.project._logger.named("Sheet",t),this._logger._trace("creating sheet"),this.project=e.project,this.address=v(b({},e.address),{sheetInstanceId:this.instanceId}),this.publicApi=new ot(this)}createObject(e,t,r,n={}){let i=this.template.getObjectTemplate(e,t,r,n).createInstance(this,t,r);return this._objects.setByPointer(t=>t[e],i),i}getObject(e){return this._objects.get()[e]}deleteObject(e){this._objects.reduce(t=>{let r=b({},t);return delete r[e],r})}getSequence(){if(!this._sequence){let e=(0,or.prism)(()=>oi((0,or.val)(this.project.pointers.historic.sheetsById[this.address.sheetId].sequence.length))),t=(0,or.prism)(()=>oo((0,or.val)(this.project.pointers.historic.sheetsById[this.address.sheetId].sequence.subUnitsPerUnit)));this._sequence=new iI(this.template.project,this,e,t)}return this._sequence}},oi=e=>"number"==typeof e&&isFinite(e)&&e>0?e:10,oo=e=>"number"==typeof e&&function(e){return"number"==typeof e&&e==ta(e)}(e)&&e>=1&&e<=1e3?e:30,oa=class{constructor(e,t){this.project=e,P(this,"type","Theatre_SheetTemplate"),P(this,"address"),P(this,"_instances",new io.Atom({})),P(this,"instancesP",this._instances.pointer),P(this,"_objectTemplates",new io.Atom({})),P(this,"objectTemplatesP",this._objectTemplates.pointer),this.address=v(b({},e.address),{sheetId:t})}getInstance(e){let t=this._instances.get()[e];return t||(t=new on(this,e),this._instances.setByPointer(t=>t[e],t)),t}getObjectTemplate(e,t,r,n){let i=this._objectTemplates.get()[e];return i||(i=new ii(this,e,t,r,n),this._objectTemplates.setByPointer(t=>t[e],i)),i}},os=r(62006),ou=r(62006);function ol(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];throw Error("[Immer] minified error nr: "+e+(r.length?" "+r.map(function(e){return"'"+e+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function oc(e){return!!e&&!!e[oK]}function of(e){return!!e&&(function(e){if(!e||"object"!=typeof e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;var r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return r===Object||"function"==typeof r&&Function.toString.call(r)===oW}(e)||Array.isArray(e)||!!e[o$]||!!e.constructor[o$]||oy(e)||ob(e))}function oh(e,t,r){void 0===r&&(r=!1),0===op(e)?(r?Object.keys:oH)(e).forEach(function(n){r&&"symbol"==typeof n||t(n,e[n],e)}):e.forEach(function(r,n){return t(n,r,e)})}function op(e){var t=e[oK];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:oy(e)?2:3*!!ob(e)}function od(e,t){return 2===op(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function og(e,t,r){var n=op(e);2===n?e.set(t,r):3===n?(e.delete(t),e.add(r)):e[t]=r}function oy(e){return oR&&e instanceof Map}function ob(e){return oN&&e instanceof Set}function ov(e){return e.o||e.t}function o_(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=oG(e);delete t[oK];for(var r=oH(t),n=0;n<r.length;n++){var i=r[n],o=t[i];!1===o.writable&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(t[i]={configurable:!0,writable:!0,enumerable:o.enumerable,value:e[i]})}return Object.create(Object.getPrototypeOf(e),t)}function om(e,t){return void 0===t&&(t=!1),ow(e)||oc(e)||!of(e)||(op(e)>1&&(e.set=e.add=e.clear=e.delete=oj),Object.freeze(e),t&&oh(e,function(e,t){return om(t,!0)},!0)),e}function oj(){ol(2)}function ow(e){return null==e||"object"!=typeof e||Object.isFrozen(e)}function oP(e){var t=oJ[e];return t||ol(18,e),t}function oO(e,t){t&&(oP("Patches"),e.u=[],e.s=[],e.v=t)}function oS(e){oT(e),e.p.forEach(ok),e.p=null}function oT(e){e===o&&(o=e.l)}function oA(e){return o={p:[],l:o,h:e,m:!0,_:0}}function ok(e){var t=e[oK];0===t.i||1===t.i?t.j():t.O=!0}function ox(e,t){t._=t.p.length;var r=t.p[0],n=void 0!==e&&e!==r;return t.h.g||oP("ES5").S(t,e,n),n?(r[oK].P&&(oS(t),ol(4)),of(e)&&(e=oD(t,e),t.l||oI(t,e)),t.u&&oP("Patches").M(r[oK],e,t.u,t.s)):e=oD(t,r,[]),oS(t),t.u&&t.v(t.u,t.s),e!==oL?e:void 0}function oD(e,t,r){if(ow(t))return t;var n=t[oK];if(!n)return oh(t,function(i,o){return oC(e,n,t,i,o,r)},!0),t;if(n.A!==e)return t;if(!n.P)return oI(e,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var i=4===n.i||5===n.i?n.o=o_(n.k):n.o;oh(3===n.i?new Set(i):i,function(t,o){return oC(e,n,i,t,o,r)}),oI(e,i,!1),r&&e.u&&oP("Patches").R(n,r,e.u,e.s)}return n.o}function oC(e,t,r,n,i,o){if(oc(i)){var a=oD(e,i,o&&t&&3!==t.i&&!od(t.D,n)?o.concat(n):void 0);if(og(r,n,a),!oc(a))return;e.m=!1}if(of(i)&&!ow(i)){if(!e.h.F&&e._<1)return;oD(e,i),t&&t.A.l||oI(e,i)}}function oI(e,t,r){void 0===r&&(r=!1),e.h.F&&e.m&&om(t,r)}function oB(e,t){var r=e[oK];return(r?ov(r):e)[t]}function oE(e,t){if(t in e)for(var r=Object.getPrototypeOf(e);r;){var n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=Object.getPrototypeOf(r)}}function oM(e){e.P||(e.P=!0,e.l&&oM(e.l))}function oF(e){e.o||(e.o=o_(e.t))}function oV(e,t,r){var n,i,a,s,u,l,c,f=oy(t)?oP("MapSet").N(t,r):ob(t)?oP("MapSet").T(t,r):e.g?(a=i={i:+!!(n=Array.isArray(t)),A:r?r.A:o,P:!1,I:!1,D:{},l:r,t:t,k:null,o:null,j:null,C:!1},s=oX,n&&(a=[i],s=oY),l=(u=Proxy.revocable(a,s)).revoke,i.k=c=u.proxy,i.j=l,c):oP("ES5").J(t,r);return(r?r.A:o).p.push(f),f}function oz(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return o_(e)}var oU="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),oR="undefined"!=typeof Map,oN="undefined"!=typeof Set,oq="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,oL=oU?Symbol.for("immer-nothing"):((i={})["immer-nothing"]=!0,i),o$=oU?Symbol.for("immer-draftable"):"__$immer_draftable",oK=oU?Symbol.for("immer-state"):"__$immer_state",oW=""+Object.prototype.constructor,oH="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,oG=Object.getOwnPropertyDescriptors||function(e){var t={};return oH(e).forEach(function(r){t[r]=Object.getOwnPropertyDescriptor(e,r)}),t},oJ={},oX={get:function(e,t){if(t===oK)return e;var r,n,i=ov(e);if(!od(i,t))return(n=oE(i,t))?"value"in n?n.value:null==(r=n.get)?void 0:r.call(e.k):void 0;var o=i[t];return e.I||!of(o)?o:o===oB(e.t,t)?(oF(e),e.o[t]=oV(e.A.h,o,e)):o},has:function(e,t){return t in ov(e)},ownKeys:function(e){return Reflect.ownKeys(ov(e))},set:function(e,t,r){var n=oE(ov(e),t);if(null==n?void 0:n.set)return n.set.call(e.k,r),!0;if(!e.P){var i=oB(ov(e),t),o=null==i?void 0:i[oK];if(o&&o.t===r)return e.o[t]=r,e.D[t]=!1,!0;if((r===i?0!==r||1/r==1/i:r!=r&&i!=i)&&(void 0!==r||od(e.t,t)))return!0;oF(e),oM(e)}return e.o[t]===r&&"number"!=typeof r&&(void 0!==r||t in e.o)||(e.o[t]=r,e.D[t]=!0,!0)},deleteProperty:function(e,t){return void 0!==oB(e.t,t)||t in e.t?(e.D[t]=!1,oF(e),oM(e)):delete e.D[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var r=ov(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n?{writable:!0,configurable:1!==e.i||"length"!==t,enumerable:n.enumerable,value:r[t]}:n},defineProperty:function(){ol(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){ol(12)}},oY={};oh(oX,function(e,t){oY[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),oY.deleteProperty=function(e,t){return oX.deleteProperty.call(this,e[0],t)},oY.set=function(e,t,r){return oX.set.call(this,e[0],t,r,e[0])};var oQ=new(function(){function e(e){var t=this;this.g=oq,this.F=!0,this.produce=function(e,r,n){if("function"==typeof e&&"function"!=typeof r){var i,o=r;return r=e,function(e){var n=this;void 0===e&&(e=o);for(var i=arguments.length,a=Array(i>1?i-1:0),s=1;s<i;s++)a[s-1]=arguments[s];return t.produce(e,function(e){var t;return(t=r).call.apply(t,[n,e].concat(a))})}}if("function"!=typeof r&&ol(6),void 0!==n&&"function"!=typeof n&&ol(7),of(e)){var a=oA(t),s=oV(t,e,void 0),u=!0;try{i=r(s),u=!1}finally{u?oS(a):oT(a)}return"undefined"!=typeof Promise&&i instanceof Promise?i.then(function(e){return oO(a,n),ox(e,a)},function(e){throw oS(a),e}):(oO(a,n),ox(i,a))}if(!e||"object"!=typeof e){if((i=r(e))===oL)return;return void 0===i&&(i=e),t.F&&om(i,!0),i}ol(21,e)},this.produceWithPatches=function(e,r){var n,i;return"function"==typeof e?function(r){for(var n=arguments.length,i=Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return t.produceWithPatches(r,function(t){return e.apply(void 0,[t].concat(i))})}:[t.produce(e,r,function(e,t){n=e,i=t}),n,i]},"boolean"==typeof(null==e?void 0:e.useProxies)&&this.setUseProxies(e.useProxies),"boolean"==typeof(null==e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze)}var t=e.prototype;return t.createDraft=function(e){of(e)||ol(8),oc(e)&&(oc(t=e)||ol(22,t),e=function e(t){if(!of(t))return t;var r,n=t[oK],i=op(t);if(n){if(!n.P&&(n.i<4||!oP("ES5").K(n)))return n.t;n.I=!0,r=oz(t,i),n.I=!1}else r=oz(t,i);return oh(r,function(t,i){var o;n&&(o=n.t,(2===op(o)?o.get(t):o[t])===i)||og(r,t,e(i))}),3===i?new Set(r):r}(t));var t,r=oA(this),n=oV(this,e,void 0);return n[oK].C=!0,oT(r),n},t.finishDraft=function(e,t){var r=(e&&e[oK]).A;return oO(r,t),ox(void 0,r)},t.setAutoFreeze=function(e){this.F=e},t.setUseProxies=function(e){e&&!oq&&ol(20),this.g=e},t.applyPatches=function(e,t){for(r=t.length-1;r>=0;r--){var r,n=t[r];if(0===n.path.length&&"replace"===n.op){e=n.value;break}}var i=oP("Patches").$;return oc(e)?i(e,t):this.produce(e,function(e){return i(e,t.slice(r+1))})},e}());oQ.produce,oQ.produceWithPatches.bind(oQ),oQ.setAutoFreeze.bind(oQ),oQ.setUseProxies.bind(oQ),oQ.applyPatches.bind(oQ),oQ.createDraft.bind(oQ),oQ.finishDraft.bind(oQ);var oZ={currentProjectStateDefinitionVersion:"0.4.0"};async function o0(e,t,r){await new Promise(e=>setTimeout(e,0)),e.transaction(({drafts:e})=>{var n,i;let o=t.address.projectId;function a(){e.ephemeral.coreByProject[o].loadingState={type:"loaded"}}e.ephemeral.coreByProject[o]={lastExportedObject:null,loadingState:{type:"loading"}},e.ahistoric.coreByProject[o]={ahistoricStuff:""};let s=null==(oc(i=e.historic)||ol(23,i),n=i[oK].t)?void 0:n.coreByProject[t.address.projectId];s?r&&-1==s.revisionHistory.indexOf(r.revisionHistory[0])?e.ephemeral.coreByProject[o].loadingState={type:"browserStateIsNotBasedOnDiskState",onDiskState:r}:a():r?(e.ephemeral.coreByProject[o].loadingState={type:"loaded"},e.historic.coreByProject[o]=r):(e.ephemeral.coreByProject[o].loadingState={type:"loaded"},e.historic.coreByProject[o]={sheetsById:{},definitionVersion:oZ.currentProjectStateDefinitionVersion,revisionHistory:[]})})}function o1(){}function o2(e){var t,r;let n=(null==(t=null==e?void 0:e.logging)?void 0:t.internal)?null!=(r=e.logging.min)?r:256:1/0,i=n1(void 0,{_debug:n<=128?console.debug.bind(console,"_coreLogger(TheatreInternalLogger) debug"):o1,_error:n<=512?console.error.bind(console,"_coreLogger(TheatreInternalLogger) error"):o1});if(e){let{logger:t,logging:r}=e;t&&i.configureLogger(t),r?i.configureLogging(r):i.configureLogging({dev:!1})}return i.getLogger().named("Theatre")}var o6=class{constructor(e,t={},r){var n;this.config=t,this.publicApi=r,P(this,"pointers"),P(this,"_pointerProxies"),P(this,"address"),P(this,"_studioReadyDeferred"),P(this,"_assetStorageReadyDeferred"),P(this,"_readyPromise"),P(this,"_sheetTemplates",new ou.Atom({})),P(this,"sheetTemplatesP",this._sheetTemplates.pointer),P(this,"_studio"),P(this,"assetStorage"),P(this,"type","Theatre_Project"),P(this,"_logger"),this._logger=o2({logging:{dev:!0}}).named("Project",e),this._logger.traceDev("creating project"),this.address={projectId:e};let i=new ou.Atom({ahistoric:{ahistoricStuff:""},historic:null!=(n=t.state)?n:{sheetsById:{},definitionVersion:oZ.currentProjectStateDefinitionVersion,revisionHistory:[]},ephemeral:{loadingState:{type:"loaded"},lastExportedObject:null}});this._assetStorageReadyDeferred=id(),this.assetStorage={getAssetUrl:e=>{var r;return"".concat(null==(r=t.assets)?void 0:r.baseUrl,"/").concat(e)},createAsset:()=>{throw Error("Please wait for Project.ready to use assets.")}},this._pointerProxies={historic:new os.PointerProxy(i.pointer.historic),ahistoric:new os.PointerProxy(i.pointer.ahistoric),ephemeral:new os.PointerProxy(i.pointer.ephemeral)},this.pointers={historic:this._pointerProxies.historic.pointer,ahistoric:this._pointerProxies.ahistoric.pointer,ephemeral:this._pointerProxies.ephemeral.pointer},C.add(e,this),this._studioReadyDeferred=id(),this._readyPromise=Promise.all([this._studioReadyDeferred.promise,this._assetStorageReadyDeferred.promise]).then(()=>{}),t.state?setTimeout(()=>{this._studio||(this._studioReadyDeferred.resolve(void 0),this._assetStorageReadyDeferred.resolve(void 0),this._logger._trace("ready deferred resolved with no state"))},0):"undefined"==typeof window?console.error('Argument config.state in Theatre.getProject("'.concat(e,'", config) is empty. ')+"You can safely ignore this message if you're developing a Next.js/Remix project in development mode. But if you are shipping to your end-users, then you need to set config.state, otherwise your project's state will be empty and nothing will animate. Learn more at https://www.theatrejs.com/docs/latest/manual/projects#state"):setTimeout(()=>{if(!this._studio)throw Error('Argument config.state in Theatre.getProject("'.concat(e,'", config) is empty. This is fine ')+"while you are using @theatre/core along with @theatre/studio. But since @theatre/studio "+'is not loaded, the state of project "'.concat(e,'" will be empty.\n\n')+"To fix this, you need to add @theatre/studio into the bundle and export the project's state. Learn how to do that at https://www.theatrejs.com/docs/latest/manual/projects#state\n")},1e3)}attachToStudio(e){if(this._studio)if(this._studio===e)return void console.warn("Project ".concat(this.address.projectId," is already attached to studio ").concat(this._studio.address.studioId));else throw Error("Project ".concat(this.address.projectId," is already attached to studio ").concat(this._studio.address.studioId));this._studio=e,e.initialized.then(async()=>{var t;await o0(e,this,this.config.state),this._pointerProxies.historic.setPointer(e.atomP.historic.coreByProject[this.address.projectId]),this._pointerProxies.ahistoric.setPointer(e.atomP.ahistoric.coreByProject[this.address.projectId]),this._pointerProxies.ephemeral.setPointer(e.atomP.ephemeral.coreByProject[this.address.projectId]),await e.createAssetStorage(this,null==(t=this.config.assets)?void 0:t.baseUrl).then(e=>{this.assetStorage=e,this._assetStorageReadyDeferred.resolve(void 0)}),this._studioReadyDeferred.resolve(void 0)}).catch(e=>{throw console.error(e),e})}get isAttachedToStudio(){return!!this._studio}get ready(){return this._readyPromise}isReady(){return"resolved"===this._studioReadyDeferred.status&&"resolved"===this._assetStorageReadyDeferred.status}getOrCreateSheet(e,t="default"){let r=this._sheetTemplates.get()[e];return r||(r=new oa(this,e),this._sheetTemplates.reduce(t=>v(b({},t),{[e]:r}))),r.getInstance(t)}},o5=class{get type(){return"Theatre_Project_PublicAPI"}constructor(e,t={}){E(this,new o6(e,t,this))}get ready(){return B(this).ready}get isReady(){return B(this).isReady()}get address(){return b({},B(this).address)}getAssetUrl(e){return this.isReady?e.id?B(this).assetStorage.getAssetUrl(e.id):void 0:void console.error("Calling `project.getAssetUrl()` before `project.ready` is resolved, will always return `undefined`. Either use `project.ready.then(() => project.getAssetUrl())` or `await project.ready` before calling `project.getAssetUrl()`.")}sheet(e,t="default"){let r=oe(e,"project.sheet");return B(this).getOrCreateSheet(r,t).publicApi}};w(A());var o3=r(62006),o8=r(62006);function o4(e,t={}){let r=C.get(e);if(r)return r.publicApi;let n=o2().named("Project",e);return t.state?(o7(e,t.state),n._debug("deep validated config.state on disk")):n._debug("no config.state"),new o5(e,t)}var o7=(e,t)=>{((e,t)=>{if(Array.isArray(t)||null==t||t.definitionVersion!==oZ.currentProjectStateDefinitionVersion)throw new iu("Error validating conf.state in Theatre.getProject(".concat(JSON.stringify(e),", conf). The state seems to be formatted in a way that is unreadable to Theatre.js. Read more at https://www.theatrejs.com/docs/latest/manual/projects#state"))})(e,t)};function o9(e,t,r){let n=r?B(r).ticker:iA();if((0,o3.isPointer)(e))return(0,o8.pointerToPrism)(e).onChange(n,t,!0);if((0,o8.isPrism)(e))return e.onChange(n,t,!0);throw Error("Called onChange(p) where p is neither a pointer nor a prism.")}function ae(e){if((0,o3.isPointer)(e))return(0,o8.pointerToPrism)(e).getValue();throw Error("Called val(p) where p is not a pointer.")}var at=class{constructor(){P(this,"_studio")}get type(){return"Theatre_CoreBundle"}get version(){return"0.7.2"}getBitsForStudio(e,t){if(this._studio)throw Error("@theatre/core is already attached to @theatre/studio");this._studio=e,t({projectsP:C.atom.pointer.projects,privateAPI:B,coreExports:x,getCoreRafDriver:iT})}};!function(){if("undefined"==typeof window)return;let e=window[i_];if(void 0!==e)if("object"==typeof e&&e&&"string"==typeof e.version)throw Error("It seems that the module '@theatre/core' is loaded more than once. This could have two possible causes:\n1. You might have two separate versions of Theatre.js in node_modules.\n2. Or this might be a bundling misconfiguration, in case you're using a bundler like Webpack/ESBuild/Rollup.\n\nNote that it **is okay** to import '@theatre/core' multiple times. But those imports should point to the same module.");else throw Error("The variable window.".concat(i_," seems to be already set by a module other than @theatre/core."));let t=new at;window[i_]=t;let r=window.__TheatreJS_StudioBundle;r&&null!==r&&"Theatre_StudioBundle"===r.type&&r.registerCoreBundle(t)}()}}]);